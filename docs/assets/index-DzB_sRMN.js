var FM=Object.defineProperty;var OM=(t,e,n)=>e in t?FM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var tn=(t,e,n)=>(OM(t,typeof e!="symbol"?e+"":e,n),n);function PM(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();var za=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wm(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _M(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var aT={exports:{}},Um={},lT={exports:{}},Pe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Id=Symbol.for("react.element"),LM=Symbol.for("react.portal"),MM=Symbol.for("react.fragment"),zM=Symbol.for("react.strict_mode"),BM=Symbol.for("react.profiler"),VM=Symbol.for("react.provider"),WM=Symbol.for("react.context"),UM=Symbol.for("react.forward_ref"),GM=Symbol.for("react.suspense"),HM=Symbol.for("react.memo"),jM=Symbol.for("react.lazy"),ek=Symbol.iterator;function KM(t){return t===null||typeof t!="object"?null:(t=ek&&t[ek]||t["@@iterator"],typeof t=="function"?t:null)}var uT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},cT=Object.assign,dT={};function gu(t,e,n){this.props=t,this.context=e,this.refs=dT,this.updater=n||uT}gu.prototype.isReactComponent={};gu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};gu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function hT(){}hT.prototype=gu.prototype;function y1(t,e,n){this.props=t,this.context=e,this.refs=dT,this.updater=n||uT}var v1=y1.prototype=new hT;v1.constructor=y1;cT(v1,gu.prototype);v1.isPureReactComponent=!0;var tk=Array.isArray,fT=Object.prototype.hasOwnProperty,b1={current:null},pT={key:!0,ref:!0,__self:!0,__source:!0};function mT(t,e,n){var s,r={},o=null,i=null;if(e!=null)for(s in e.ref!==void 0&&(i=e.ref),e.key!==void 0&&(o=""+e.key),e)fT.call(e,s)&&!pT.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:Id,type:t,key:o,ref:i,props:r,_owner:b1.current}}function XM(t,e){return{$$typeof:Id,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function w1(t){return typeof t=="object"&&t!==null&&t.$$typeof===Id}function qM(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var nk=/\/+/g;function X0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?qM(""+t.key):e.toString(36)}function Kf(t,e,n,s,r){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var i=!1;if(t===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(t.$$typeof){case Id:case LM:i=!0}}if(i)return i=t,r=r(i),t=s===""?"."+X0(i,0):s,tk(r)?(n="",t!=null&&(n=t.replace(nk,"$&/")+"/"),Kf(r,e,n,"",function(u){return u})):r!=null&&(w1(r)&&(r=XM(r,n+(!r.key||i&&i.key===r.key?"":(""+r.key).replace(nk,"$&/")+"/")+t)),e.push(r)),1;if(i=0,s=s===""?".":s+":",tk(t))for(var a=0;a<t.length;a++){o=t[a];var l=s+X0(o,a);i+=Kf(o,e,n,l,r)}else if(l=KM(t),typeof l=="function")for(t=l.call(t),a=0;!(o=t.next()).done;)o=o.value,l=s+X0(o,a++),i+=Kf(o,e,n,l,r);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return i}function sf(t,e,n){if(t==null)return t;var s=[],r=0;return Kf(t,s,"","",function(o){return e.call(n,o,r++)}),s}function YM(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Qn={current:null},Xf={transition:null},QM={ReactCurrentDispatcher:Qn,ReactCurrentBatchConfig:Xf,ReactCurrentOwner:b1};function gT(){throw Error("act(...) is not supported in production builds of React.")}Pe.Children={map:sf,forEach:function(t,e,n){sf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return sf(t,function(){e++}),e},toArray:function(t){return sf(t,function(e){return e})||[]},only:function(t){if(!w1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Pe.Component=gu;Pe.Fragment=MM;Pe.Profiler=BM;Pe.PureComponent=y1;Pe.StrictMode=zM;Pe.Suspense=GM;Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QM;Pe.act=gT;Pe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=cT({},t.props),r=t.key,o=t.ref,i=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,i=b1.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)fT.call(e,l)&&!pT.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];s.children=a}return{$$typeof:Id,type:t.type,key:r,ref:o,props:s,_owner:i}};Pe.createContext=function(t){return t={$$typeof:WM,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:VM,_context:t},t.Consumer=t};Pe.createElement=mT;Pe.createFactory=function(t){var e=mT.bind(null,t);return e.type=t,e};Pe.createRef=function(){return{current:null}};Pe.forwardRef=function(t){return{$$typeof:UM,render:t}};Pe.isValidElement=w1;Pe.lazy=function(t){return{$$typeof:jM,_payload:{_status:-1,_result:t},_init:YM}};Pe.memo=function(t,e){return{$$typeof:HM,type:t,compare:e===void 0?null:e}};Pe.startTransition=function(t){var e=Xf.transition;Xf.transition={};try{t()}finally{Xf.transition=e}};Pe.unstable_act=gT;Pe.useCallback=function(t,e){return Qn.current.useCallback(t,e)};Pe.useContext=function(t){return Qn.current.useContext(t)};Pe.useDebugValue=function(){};Pe.useDeferredValue=function(t){return Qn.current.useDeferredValue(t)};Pe.useEffect=function(t,e){return Qn.current.useEffect(t,e)};Pe.useId=function(){return Qn.current.useId()};Pe.useImperativeHandle=function(t,e,n){return Qn.current.useImperativeHandle(t,e,n)};Pe.useInsertionEffect=function(t,e){return Qn.current.useInsertionEffect(t,e)};Pe.useLayoutEffect=function(t,e){return Qn.current.useLayoutEffect(t,e)};Pe.useMemo=function(t,e){return Qn.current.useMemo(t,e)};Pe.useReducer=function(t,e,n){return Qn.current.useReducer(t,e,n)};Pe.useRef=function(t){return Qn.current.useRef(t)};Pe.useState=function(t){return Qn.current.useState(t)};Pe.useSyncExternalStore=function(t,e,n){return Qn.current.useSyncExternalStore(t,e,n)};Pe.useTransition=function(){return Qn.current.useTransition()};Pe.version="18.3.1";lT.exports=Pe;var O=lT.exports;const ct=Wm(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZM=O,JM=Symbol.for("react.element"),ez=Symbol.for("react.fragment"),tz=Object.prototype.hasOwnProperty,nz=ZM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sz={key:!0,ref:!0,__self:!0,__source:!0};function xT(t,e,n){var s,r={},o=null,i=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(i=e.ref);for(s in e)tz.call(e,s)&&!sz.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:JM,type:t,key:o,ref:i,props:r,_owner:nz.current}}Um.Fragment=ez;Um.jsx=xT;Um.jsxs=xT;aT.exports=Um;var q=aT.exports,ty={},yT={exports:{}},ks={},vT={exports:{}},bT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,W){var H=D.length;D.push(W);e:for(;0<H;){var X=H-1>>>1,Z=D[X];if(0<r(Z,W))D[X]=W,D[H]=Z,H=X;else break e}}function n(D){return D.length===0?null:D[0]}function s(D){if(D.length===0)return null;var W=D[0],H=D.pop();if(H!==W){D[0]=H;e:for(var X=0,Z=D.length,J=Z>>>1;X<J;){var se=2*(X+1)-1,te=D[se],oe=se+1,ce=D[oe];if(0>r(te,H))oe<Z&&0>r(ce,te)?(D[X]=ce,D[oe]=H,X=oe):(D[X]=te,D[se]=H,X=se);else if(oe<Z&&0>r(ce,H))D[X]=ce,D[oe]=H,X=oe;else break e}}return W}function r(D,W){var H=D.sortIndex-W.sortIndex;return H!==0?H:D.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();t.unstable_now=function(){return i.now()-a}}var l=[],u=[],c=1,d=null,h=3,f=!1,p=!1,m=!1,x=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(D){for(var W=n(u);W!==null;){if(W.callback===null)s(u);else if(W.startTime<=D)s(u),W.sortIndex=W.expirationTime,e(l,W);else break;W=n(u)}}function b(D){if(m=!1,v(D),!p)if(n(l)!==null)p=!0,_(w);else{var W=n(u);W!==null&&M(b,W.startTime-D)}}function w(D,W){p=!1,m&&(m=!1,g(C),C=-1),f=!0;var H=h;try{for(v(W),d=n(l);d!==null&&(!(d.expirationTime>W)||D&&!R());){var X=d.callback;if(typeof X=="function"){d.callback=null,h=d.priorityLevel;var Z=X(d.expirationTime<=W);W=t.unstable_now(),typeof Z=="function"?d.callback=Z:d===n(l)&&s(l),v(W)}else s(l);d=n(l)}if(d!==null)var J=!0;else{var se=n(u);se!==null&&M(b,se.startTime-W),J=!1}return J}finally{d=null,h=H,f=!1}}var $=!1,k=null,C=-1,S=5,T=-1;function R(){return!(t.unstable_now()-T<S)}function A(){if(k!==null){var D=t.unstable_now();T=D;var W=!0;try{W=k(!0,D)}finally{W?E():($=!1,k=null)}}else $=!1}var E;if(typeof y=="function")E=function(){y(A)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,P=N.port2;N.port1.onmessage=A,E=function(){P.postMessage(null)}}else E=function(){x(A,0)};function _(D){k=D,$||($=!0,E())}function M(D,W){C=x(function(){D(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,_(w))},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(D){switch(h){case 1:case 2:case 3:var W=3;break;default:W=h}var H=h;h=W;try{return D()}finally{h=H}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(D,W){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var H=h;h=D;try{return W()}finally{h=H}},t.unstable_scheduleCallback=function(D,W,H){var X=t.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?X+H:X):H=X,D){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=H+Z,D={id:c++,callback:W,priorityLevel:D,startTime:H,expirationTime:Z,sortIndex:-1},H>X?(D.sortIndex=H,e(u,D),n(l)===null&&D===n(u)&&(m?(g(C),C=-1):m=!0,M(b,H-X))):(D.sortIndex=Z,e(l,D),p||f||(p=!0,_(w))),D},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(D){var W=h;return function(){var H=h;h=W;try{return D.apply(this,arguments)}finally{h=H}}}})(bT);vT.exports=bT;var rz=vT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oz=O,Cs=rz;function re(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var wT=new Set,Gc={};function Ba(t,e){Hl(t,e),Hl(t+"Capture",e)}function Hl(t,e){for(Gc[t]=e,t=0;t<e.length;t++)wT.add(e[t])}var wo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ny=Object.prototype.hasOwnProperty,iz=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,sk={},rk={};function az(t){return ny.call(rk,t)?!0:ny.call(sk,t)?!1:iz.test(t)?rk[t]=!0:(sk[t]=!0,!1)}function lz(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function uz(t,e,n,s){if(e===null||typeof e>"u"||lz(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Zn(t,e,n,s,r,o,i){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=i}var wn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){wn[t]=new Zn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];wn[e]=new Zn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){wn[t]=new Zn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){wn[t]=new Zn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){wn[t]=new Zn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){wn[t]=new Zn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){wn[t]=new Zn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){wn[t]=new Zn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){wn[t]=new Zn(t,5,!1,t.toLowerCase(),null,!1,!1)});var C1=/[\-:]([a-z])/g;function $1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(C1,$1);wn[e]=new Zn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(C1,$1);wn[e]=new Zn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(C1,$1);wn[e]=new Zn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){wn[t]=new Zn(t,1,!1,t.toLowerCase(),null,!1,!1)});wn.xlinkHref=new Zn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){wn[t]=new Zn(t,1,!1,t.toLowerCase(),null,!0,!0)});function k1(t,e,n,s){var r=wn.hasOwnProperty(e)?wn[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(uz(e,n,r,s)&&(n=null),s||r===null?az(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var No=oz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rf=Symbol.for("react.element"),pl=Symbol.for("react.portal"),ml=Symbol.for("react.fragment"),S1=Symbol.for("react.strict_mode"),sy=Symbol.for("react.profiler"),CT=Symbol.for("react.provider"),$T=Symbol.for("react.context"),I1=Symbol.for("react.forward_ref"),ry=Symbol.for("react.suspense"),oy=Symbol.for("react.suspense_list"),T1=Symbol.for("react.memo"),Vo=Symbol.for("react.lazy"),kT=Symbol.for("react.offscreen"),ok=Symbol.iterator;function Wu(t){return t===null||typeof t!="object"?null:(t=ok&&t[ok]||t["@@iterator"],typeof t=="function"?t:null)}var Rt=Object.assign,q0;function ic(t){if(q0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);q0=e&&e[1]||""}return`
`+q0+t}var Y0=!1;function Q0(t,e){if(!t||Y0)return"";Y0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){s=u}t.call(e.prototype)}else{try{throw Error()}catch(u){s=u}t()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),i=r.length-1,a=o.length-1;1<=i&&0<=a&&r[i]!==o[a];)a--;for(;1<=i&&0<=a;i--,a--)if(r[i]!==o[a]){if(i!==1||a!==1)do if(i--,a--,0>a||r[i]!==o[a]){var l=`
`+r[i].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=i&&0<=a);break}}}finally{Y0=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ic(t):""}function cz(t){switch(t.tag){case 5:return ic(t.type);case 16:return ic("Lazy");case 13:return ic("Suspense");case 19:return ic("SuspenseList");case 0:case 2:case 15:return t=Q0(t.type,!1),t;case 11:return t=Q0(t.type.render,!1),t;case 1:return t=Q0(t.type,!0),t;default:return""}}function iy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ml:return"Fragment";case pl:return"Portal";case sy:return"Profiler";case S1:return"StrictMode";case ry:return"Suspense";case oy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case $T:return(t.displayName||"Context")+".Consumer";case CT:return(t._context.displayName||"Context")+".Provider";case I1:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case T1:return e=t.displayName||null,e!==null?e:iy(t.type)||"Memo";case Vo:e=t._payload,t=t._init;try{return iy(t(e))}catch{}}return null}function dz(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return iy(e);case 8:return e===S1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function hi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ST(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function hz(t){var e=ST(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(i){s=""+i,o.call(this,i)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(i){s=""+i},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function of(t){t._valueTracker||(t._valueTracker=hz(t))}function IT(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=ST(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function gp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ay(t,e){var n=e.checked;return Rt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ik(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=hi(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function TT(t,e){e=e.checked,e!=null&&k1(t,"checked",e,!1)}function ly(t,e){TT(t,e);var n=hi(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?uy(t,e.type,n):e.hasOwnProperty("defaultValue")&&uy(t,e.type,hi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ak(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function uy(t,e,n){(e!=="number"||gp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ac=Array.isArray;function Al(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+hi(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function cy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(re(91));return Rt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function lk(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(re(92));if(ac(n)){if(1<n.length)throw Error(re(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:hi(n)}}function ET(t,e){var n=hi(e.value),s=hi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function uk(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function NT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dy(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?NT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var af,RT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(af=af||document.createElement("div"),af.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=af.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Hc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var wc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fz=["Webkit","ms","Moz","O"];Object.keys(wc).forEach(function(t){fz.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),wc[e]=wc[t]})});function AT(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||wc.hasOwnProperty(t)&&wc[t]?(""+e).trim():e+"px"}function DT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=AT(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var pz=Rt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hy(t,e){if(e){if(pz[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(re(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(re(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(re(61))}if(e.style!=null&&typeof e.style!="object")throw Error(re(62))}}function fy(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var py=null;function E1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var my=null,Dl=null,Fl=null;function ck(t){if(t=Nd(t)){if(typeof my!="function")throw Error(re(280));var e=t.stateNode;e&&(e=Xm(e),my(t.stateNode,t.type,e))}}function FT(t){Dl?Fl?Fl.push(t):Fl=[t]:Dl=t}function OT(){if(Dl){var t=Dl,e=Fl;if(Fl=Dl=null,ck(t),e)for(t=0;t<e.length;t++)ck(e[t])}}function PT(t,e){return t(e)}function _T(){}var Z0=!1;function LT(t,e,n){if(Z0)return t(e,n);Z0=!0;try{return PT(t,e,n)}finally{Z0=!1,(Dl!==null||Fl!==null)&&(_T(),OT())}}function jc(t,e){var n=t.stateNode;if(n===null)return null;var s=Xm(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(re(231,e,typeof n));return n}var gy=!1;if(wo)try{var Uu={};Object.defineProperty(Uu,"passive",{get:function(){gy=!0}}),window.addEventListener("test",Uu,Uu),window.removeEventListener("test",Uu,Uu)}catch{gy=!1}function mz(t,e,n,s,r,o,i,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Cc=!1,xp=null,yp=!1,xy=null,gz={onError:function(t){Cc=!0,xp=t}};function xz(t,e,n,s,r,o,i,a,l){Cc=!1,xp=null,mz.apply(gz,arguments)}function yz(t,e,n,s,r,o,i,a,l){if(xz.apply(this,arguments),Cc){if(Cc){var u=xp;Cc=!1,xp=null}else throw Error(re(198));yp||(yp=!0,xy=u)}}function Va(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function MT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function dk(t){if(Va(t)!==t)throw Error(re(188))}function vz(t){var e=t.alternate;if(!e){if(e=Va(t),e===null)throw Error(re(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return dk(r),t;if(o===s)return dk(r),e;o=o.sibling}throw Error(re(188))}if(n.return!==s.return)n=r,s=o;else{for(var i=!1,a=r.child;a;){if(a===n){i=!0,n=r,s=o;break}if(a===s){i=!0,s=r,n=o;break}a=a.sibling}if(!i){for(a=o.child;a;){if(a===n){i=!0,n=o,s=r;break}if(a===s){i=!0,s=o,n=r;break}a=a.sibling}if(!i)throw Error(re(189))}}if(n.alternate!==s)throw Error(re(190))}if(n.tag!==3)throw Error(re(188));return n.stateNode.current===n?t:e}function zT(t){return t=vz(t),t!==null?BT(t):null}function BT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=BT(t);if(e!==null)return e;t=t.sibling}return null}var VT=Cs.unstable_scheduleCallback,hk=Cs.unstable_cancelCallback,bz=Cs.unstable_shouldYield,wz=Cs.unstable_requestPaint,zt=Cs.unstable_now,Cz=Cs.unstable_getCurrentPriorityLevel,N1=Cs.unstable_ImmediatePriority,WT=Cs.unstable_UserBlockingPriority,vp=Cs.unstable_NormalPriority,$z=Cs.unstable_LowPriority,UT=Cs.unstable_IdlePriority,Gm=null,Ur=null;function kz(t){if(Ur&&typeof Ur.onCommitFiberRoot=="function")try{Ur.onCommitFiberRoot(Gm,t,void 0,(t.current.flags&128)===128)}catch{}}var yr=Math.clz32?Math.clz32:Tz,Sz=Math.log,Iz=Math.LN2;function Tz(t){return t>>>=0,t===0?32:31-(Sz(t)/Iz|0)|0}var lf=64,uf=4194304;function lc(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function bp(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,o=t.pingedLanes,i=n&268435455;if(i!==0){var a=i&~r;a!==0?s=lc(a):(o&=i,o!==0&&(s=lc(o)))}else i=n&~r,i!==0?s=lc(i):o!==0&&(s=lc(o));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,o=e&-e,r>=o||r===16&&(o&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-yr(e),r=1<<n,s|=t[n],e&=~r;return s}function Ez(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nz(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,o=t.pendingLanes;0<o;){var i=31-yr(o),a=1<<i,l=r[i];l===-1?(!(a&n)||a&s)&&(r[i]=Ez(a,e)):l<=e&&(t.expiredLanes|=a),o&=~a}}function yy(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function GT(){var t=lf;return lf<<=1,!(lf&4194240)&&(lf=64),t}function J0(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Td(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-yr(e),t[e]=n}function Rz(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-yr(n),o=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~o}}function R1(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-yr(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var nt=0;function HT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var jT,A1,KT,XT,qT,vy=!1,cf=[],Zo=null,Jo=null,ei=null,Kc=new Map,Xc=new Map,Go=[],Az="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fk(t,e){switch(t){case"focusin":case"focusout":Zo=null;break;case"dragenter":case"dragleave":Jo=null;break;case"mouseover":case"mouseout":ei=null;break;case"pointerover":case"pointerout":Kc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xc.delete(e.pointerId)}}function Gu(t,e,n,s,r,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},e!==null&&(e=Nd(e),e!==null&&A1(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Dz(t,e,n,s,r){switch(e){case"focusin":return Zo=Gu(Zo,t,e,n,s,r),!0;case"dragenter":return Jo=Gu(Jo,t,e,n,s,r),!0;case"mouseover":return ei=Gu(ei,t,e,n,s,r),!0;case"pointerover":var o=r.pointerId;return Kc.set(o,Gu(Kc.get(o)||null,t,e,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,Xc.set(o,Gu(Xc.get(o)||null,t,e,n,s,r)),!0}return!1}function YT(t){var e=Yi(t.target);if(e!==null){var n=Va(e);if(n!==null){if(e=n.tag,e===13){if(e=MT(n),e!==null){t.blockedOn=e,qT(t.priority,function(){KT(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function qf(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=by(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);py=s,n.target.dispatchEvent(s),py=null}else return e=Nd(n),e!==null&&A1(e),t.blockedOn=n,!1;e.shift()}return!0}function pk(t,e,n){qf(t)&&n.delete(e)}function Fz(){vy=!1,Zo!==null&&qf(Zo)&&(Zo=null),Jo!==null&&qf(Jo)&&(Jo=null),ei!==null&&qf(ei)&&(ei=null),Kc.forEach(pk),Xc.forEach(pk)}function Hu(t,e){t.blockedOn===e&&(t.blockedOn=null,vy||(vy=!0,Cs.unstable_scheduleCallback(Cs.unstable_NormalPriority,Fz)))}function qc(t){function e(r){return Hu(r,t)}if(0<cf.length){Hu(cf[0],t);for(var n=1;n<cf.length;n++){var s=cf[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Zo!==null&&Hu(Zo,t),Jo!==null&&Hu(Jo,t),ei!==null&&Hu(ei,t),Kc.forEach(e),Xc.forEach(e),n=0;n<Go.length;n++)s=Go[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<Go.length&&(n=Go[0],n.blockedOn===null);)YT(n),n.blockedOn===null&&Go.shift()}var Ol=No.ReactCurrentBatchConfig,wp=!0;function Oz(t,e,n,s){var r=nt,o=Ol.transition;Ol.transition=null;try{nt=1,D1(t,e,n,s)}finally{nt=r,Ol.transition=o}}function Pz(t,e,n,s){var r=nt,o=Ol.transition;Ol.transition=null;try{nt=4,D1(t,e,n,s)}finally{nt=r,Ol.transition=o}}function D1(t,e,n,s){if(wp){var r=by(t,e,n,s);if(r===null)ux(t,e,s,Cp,n),fk(t,s);else if(Dz(r,t,e,n,s))s.stopPropagation();else if(fk(t,s),e&4&&-1<Az.indexOf(t)){for(;r!==null;){var o=Nd(r);if(o!==null&&jT(o),o=by(t,e,n,s),o===null&&ux(t,e,s,Cp,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else ux(t,e,s,null,n)}}var Cp=null;function by(t,e,n,s){if(Cp=null,t=E1(s),t=Yi(t),t!==null)if(e=Va(t),e===null)t=null;else if(n=e.tag,n===13){if(t=MT(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Cp=t,null}function QT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Cz()){case N1:return 1;case WT:return 4;case vp:case $z:return 16;case UT:return 536870912;default:return 16}default:return 16}}var jo=null,F1=null,Yf=null;function ZT(){if(Yf)return Yf;var t,e=F1,n=e.length,s,r="value"in jo?jo.value:jo.textContent,o=r.length;for(t=0;t<n&&e[t]===r[t];t++);var i=n-t;for(s=1;s<=i&&e[n-s]===r[o-s];s++);return Yf=r.slice(t,1<s?1-s:void 0)}function Qf(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function df(){return!0}function mk(){return!1}function Ss(t){function e(n,s,r,o,i){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?df:mk,this.isPropagationStopped=mk,this}return Rt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=df)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=df)},persist:function(){},isPersistent:df}),e}var xu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},O1=Ss(xu),Ed=Rt({},xu,{view:0,detail:0}),_z=Ss(Ed),ex,tx,ju,Hm=Rt({},Ed,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:P1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ju&&(ju&&t.type==="mousemove"?(ex=t.screenX-ju.screenX,tx=t.screenY-ju.screenY):tx=ex=0,ju=t),ex)},movementY:function(t){return"movementY"in t?t.movementY:tx}}),gk=Ss(Hm),Lz=Rt({},Hm,{dataTransfer:0}),Mz=Ss(Lz),zz=Rt({},Ed,{relatedTarget:0}),nx=Ss(zz),Bz=Rt({},xu,{animationName:0,elapsedTime:0,pseudoElement:0}),Vz=Ss(Bz),Wz=Rt({},xu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Uz=Ss(Wz),Gz=Rt({},xu,{data:0}),xk=Ss(Gz),Hz={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Kz={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xz(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Kz[t])?!!e[t]:!1}function P1(){return Xz}var qz=Rt({},Ed,{key:function(t){if(t.key){var e=Hz[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Qf(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?jz[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:P1,charCode:function(t){return t.type==="keypress"?Qf(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Qf(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Yz=Ss(qz),Qz=Rt({},Hm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yk=Ss(Qz),Zz=Rt({},Ed,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:P1}),Jz=Ss(Zz),e4=Rt({},xu,{propertyName:0,elapsedTime:0,pseudoElement:0}),t4=Ss(e4),n4=Rt({},Hm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),s4=Ss(n4),r4=[9,13,27,32],_1=wo&&"CompositionEvent"in window,$c=null;wo&&"documentMode"in document&&($c=document.documentMode);var o4=wo&&"TextEvent"in window&&!$c,JT=wo&&(!_1||$c&&8<$c&&11>=$c),vk=" ",bk=!1;function eE(t,e){switch(t){case"keyup":return r4.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var gl=!1;function i4(t,e){switch(t){case"compositionend":return tE(e);case"keypress":return e.which!==32?null:(bk=!0,vk);case"textInput":return t=e.data,t===vk&&bk?null:t;default:return null}}function a4(t,e){if(gl)return t==="compositionend"||!_1&&eE(t,e)?(t=ZT(),Yf=F1=jo=null,gl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return JT&&e.locale!=="ko"?null:e.data;default:return null}}var l4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wk(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!l4[t.type]:e==="textarea"}function nE(t,e,n,s){FT(s),e=$p(e,"onChange"),0<e.length&&(n=new O1("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var kc=null,Yc=null;function u4(t){fE(t,0)}function jm(t){var e=vl(t);if(IT(e))return t}function c4(t,e){if(t==="change")return e}var sE=!1;if(wo){var sx;if(wo){var rx="oninput"in document;if(!rx){var Ck=document.createElement("div");Ck.setAttribute("oninput","return;"),rx=typeof Ck.oninput=="function"}sx=rx}else sx=!1;sE=sx&&(!document.documentMode||9<document.documentMode)}function $k(){kc&&(kc.detachEvent("onpropertychange",rE),Yc=kc=null)}function rE(t){if(t.propertyName==="value"&&jm(Yc)){var e=[];nE(e,Yc,t,E1(t)),LT(u4,e)}}function d4(t,e,n){t==="focusin"?($k(),kc=e,Yc=n,kc.attachEvent("onpropertychange",rE)):t==="focusout"&&$k()}function h4(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return jm(Yc)}function f4(t,e){if(t==="click")return jm(e)}function p4(t,e){if(t==="input"||t==="change")return jm(e)}function m4(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $r=typeof Object.is=="function"?Object.is:m4;function Qc(t,e){if($r(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!ny.call(e,r)||!$r(t[r],e[r]))return!1}return!0}function kk(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sk(t,e){var n=kk(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=kk(n)}}function oE(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?oE(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function iE(){for(var t=window,e=gp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=gp(t.document)}return e}function L1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function g4(t){var e=iE(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&oE(n.ownerDocument.documentElement,n)){if(s!==null&&L1(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!t.extend&&o>s&&(r=s,s=o,o=r),r=Sk(n,o);var i=Sk(n,s);r&&i&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==i.node||t.focusOffset!==i.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),o>s?(t.addRange(e),t.extend(i.node,i.offset)):(e.setEnd(i.node,i.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var x4=wo&&"documentMode"in document&&11>=document.documentMode,xl=null,wy=null,Sc=null,Cy=!1;function Ik(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Cy||xl==null||xl!==gp(s)||(s=xl,"selectionStart"in s&&L1(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Sc&&Qc(Sc,s)||(Sc=s,s=$p(wy,"onSelect"),0<s.length&&(e=new O1("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=xl)))}function hf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var yl={animationend:hf("Animation","AnimationEnd"),animationiteration:hf("Animation","AnimationIteration"),animationstart:hf("Animation","AnimationStart"),transitionend:hf("Transition","TransitionEnd")},ox={},aE={};wo&&(aE=document.createElement("div").style,"AnimationEvent"in window||(delete yl.animationend.animation,delete yl.animationiteration.animation,delete yl.animationstart.animation),"TransitionEvent"in window||delete yl.transitionend.transition);function Km(t){if(ox[t])return ox[t];if(!yl[t])return t;var e=yl[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in aE)return ox[t]=e[n];return t}var lE=Km("animationend"),uE=Km("animationiteration"),cE=Km("animationstart"),dE=Km("transitionend"),hE=new Map,Tk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ci(t,e){hE.set(t,e),Ba(e,[t])}for(var ix=0;ix<Tk.length;ix++){var ax=Tk[ix],y4=ax.toLowerCase(),v4=ax[0].toUpperCase()+ax.slice(1);Ci(y4,"on"+v4)}Ci(lE,"onAnimationEnd");Ci(uE,"onAnimationIteration");Ci(cE,"onAnimationStart");Ci("dblclick","onDoubleClick");Ci("focusin","onFocus");Ci("focusout","onBlur");Ci(dE,"onTransitionEnd");Hl("onMouseEnter",["mouseout","mouseover"]);Hl("onMouseLeave",["mouseout","mouseover"]);Hl("onPointerEnter",["pointerout","pointerover"]);Hl("onPointerLeave",["pointerout","pointerover"]);Ba("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ba("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ba("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ba("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ba("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ba("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var uc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),b4=new Set("cancel close invalid load scroll toggle".split(" ").concat(uc));function Ek(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,yz(s,e,void 0,t),t.currentTarget=null}function fE(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var o=void 0;if(e)for(var i=s.length-1;0<=i;i--){var a=s[i],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;Ek(r,a,u),o=l}else for(i=0;i<s.length;i++){if(a=s[i],l=a.instance,u=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;Ek(r,a,u),o=l}}}if(yp)throw t=xy,yp=!1,xy=null,t}function vt(t,e){var n=e[Ty];n===void 0&&(n=e[Ty]=new Set);var s=t+"__bubble";n.has(s)||(pE(e,t,2,!1),n.add(s))}function lx(t,e,n){var s=0;e&&(s|=4),pE(n,t,s,e)}var ff="_reactListening"+Math.random().toString(36).slice(2);function Zc(t){if(!t[ff]){t[ff]=!0,wT.forEach(function(n){n!=="selectionchange"&&(b4.has(n)||lx(n,!1,t),lx(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ff]||(e[ff]=!0,lx("selectionchange",!1,e))}}function pE(t,e,n,s){switch(QT(e)){case 1:var r=Oz;break;case 4:r=Pz;break;default:r=D1}n=r.bind(null,e,n,t),r=void 0,!gy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function ux(t,e,n,s,r){var o=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var i=s.tag;if(i===3||i===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(i===4)for(i=s.return;i!==null;){var l=i.tag;if((l===3||l===4)&&(l=i.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;i=i.return}for(;a!==null;){if(i=Yi(a),i===null)return;if(l=i.tag,l===5||l===6){s=o=i;continue e}a=a.parentNode}}s=s.return}LT(function(){var u=o,c=E1(n),d=[];e:{var h=hE.get(t);if(h!==void 0){var f=O1,p=t;switch(t){case"keypress":if(Qf(n)===0)break e;case"keydown":case"keyup":f=Yz;break;case"focusin":p="focus",f=nx;break;case"focusout":p="blur",f=nx;break;case"beforeblur":case"afterblur":f=nx;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=gk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=Mz;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Jz;break;case lE:case uE:case cE:f=Vz;break;case dE:f=t4;break;case"scroll":f=_z;break;case"wheel":f=s4;break;case"copy":case"cut":case"paste":f=Uz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=yk}var m=(e&4)!==0,x=!m&&t==="scroll",g=m?h!==null?h+"Capture":null:h;m=[];for(var y=u,v;y!==null;){v=y;var b=v.stateNode;if(v.tag===5&&b!==null&&(v=b,g!==null&&(b=jc(y,g),b!=null&&m.push(Jc(y,b,v)))),x)break;y=y.return}0<m.length&&(h=new f(h,p,null,n,c),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==py&&(p=n.relatedTarget||n.fromElement)&&(Yi(p)||p[Co]))break e;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=n.relatedTarget||n.toElement,f=u,p=p?Yi(p):null,p!==null&&(x=Va(p),p!==x||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=u),f!==p)){if(m=gk,b="onMouseLeave",g="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(m=yk,b="onPointerLeave",g="onPointerEnter",y="pointer"),x=f==null?h:vl(f),v=p==null?h:vl(p),h=new m(b,y+"leave",f,n,c),h.target=x,h.relatedTarget=v,b=null,Yi(c)===u&&(m=new m(g,y+"enter",p,n,c),m.target=v,m.relatedTarget=x,b=m),x=b,f&&p)t:{for(m=f,g=p,y=0,v=m;v;v=nl(v))y++;for(v=0,b=g;b;b=nl(b))v++;for(;0<y-v;)m=nl(m),y--;for(;0<v-y;)g=nl(g),v--;for(;y--;){if(m===g||g!==null&&m===g.alternate)break t;m=nl(m),g=nl(g)}m=null}else m=null;f!==null&&Nk(d,h,f,m,!1),p!==null&&x!==null&&Nk(d,x,p,m,!0)}}e:{if(h=u?vl(u):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var w=c4;else if(wk(h))if(sE)w=p4;else{w=h4;var $=d4}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(w=f4);if(w&&(w=w(t,u))){nE(d,w,n,c);break e}$&&$(t,h,u),t==="focusout"&&($=h._wrapperState)&&$.controlled&&h.type==="number"&&uy(h,"number",h.value)}switch($=u?vl(u):window,t){case"focusin":(wk($)||$.contentEditable==="true")&&(xl=$,wy=u,Sc=null);break;case"focusout":Sc=wy=xl=null;break;case"mousedown":Cy=!0;break;case"contextmenu":case"mouseup":case"dragend":Cy=!1,Ik(d,n,c);break;case"selectionchange":if(x4)break;case"keydown":case"keyup":Ik(d,n,c)}var k;if(_1)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else gl?eE(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(JT&&n.locale!=="ko"&&(gl||C!=="onCompositionStart"?C==="onCompositionEnd"&&gl&&(k=ZT()):(jo=c,F1="value"in jo?jo.value:jo.textContent,gl=!0)),$=$p(u,C),0<$.length&&(C=new xk(C,t,null,n,c),d.push({event:C,listeners:$}),k?C.data=k:(k=tE(n),k!==null&&(C.data=k)))),(k=o4?i4(t,n):a4(t,n))&&(u=$p(u,"onBeforeInput"),0<u.length&&(c=new xk("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:u}),c.data=k))}fE(d,e)})}function Jc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function $p(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=jc(t,n),o!=null&&s.unshift(Jc(t,o,r)),o=jc(t,e),o!=null&&s.push(Jc(t,o,r))),t=t.return}return s}function nl(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Nk(t,e,n,s,r){for(var o=e._reactName,i=[];n!==null&&n!==s;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&u!==null&&(a=u,r?(l=jc(n,o),l!=null&&i.unshift(Jc(n,l,a))):r||(l=jc(n,o),l!=null&&i.push(Jc(n,l,a)))),n=n.return}i.length!==0&&t.push({event:e,listeners:i})}var w4=/\r\n?/g,C4=/\u0000|\uFFFD/g;function Rk(t){return(typeof t=="string"?t:""+t).replace(w4,`
`).replace(C4,"")}function pf(t,e,n){if(e=Rk(e),Rk(t)!==e&&n)throw Error(re(425))}function kp(){}var $y=null,ky=null;function Sy(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Iy=typeof setTimeout=="function"?setTimeout:void 0,$4=typeof clearTimeout=="function"?clearTimeout:void 0,Ak=typeof Promise=="function"?Promise:void 0,k4=typeof queueMicrotask=="function"?queueMicrotask:typeof Ak<"u"?function(t){return Ak.resolve(null).then(t).catch(S4)}:Iy;function S4(t){setTimeout(function(){throw t})}function cx(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),qc(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);qc(e)}function ti(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Dk(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var yu=Math.random().toString(36).slice(2),Vr="__reactFiber$"+yu,ed="__reactProps$"+yu,Co="__reactContainer$"+yu,Ty="__reactEvents$"+yu,I4="__reactListeners$"+yu,T4="__reactHandles$"+yu;function Yi(t){var e=t[Vr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Co]||n[Vr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Dk(t);t!==null;){if(n=t[Vr])return n;t=Dk(t)}return e}t=n,n=t.parentNode}return null}function Nd(t){return t=t[Vr]||t[Co],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function vl(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(re(33))}function Xm(t){return t[ed]||null}var Ey=[],bl=-1;function $i(t){return{current:t}}function bt(t){0>bl||(t.current=Ey[bl],Ey[bl]=null,bl--)}function pt(t,e){bl++,Ey[bl]=t.current,t.current=e}var fi={},Mn=$i(fi),is=$i(!1),ma=fi;function jl(t,e){var n=t.type.contextTypes;if(!n)return fi;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=e[o];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function as(t){return t=t.childContextTypes,t!=null}function Sp(){bt(is),bt(Mn)}function Fk(t,e,n){if(Mn.current!==fi)throw Error(re(168));pt(Mn,e),pt(is,n)}function mE(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(re(108,dz(t)||"Unknown",r));return Rt({},n,s)}function Ip(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||fi,ma=Mn.current,pt(Mn,t),pt(is,is.current),!0}function Ok(t,e,n){var s=t.stateNode;if(!s)throw Error(re(169));n?(t=mE(t,e,ma),s.__reactInternalMemoizedMergedChildContext=t,bt(is),bt(Mn),pt(Mn,t)):bt(is),pt(is,n)}var co=null,qm=!1,dx=!1;function gE(t){co===null?co=[t]:co.push(t)}function E4(t){qm=!0,gE(t)}function ki(){if(!dx&&co!==null){dx=!0;var t=0,e=nt;try{var n=co;for(nt=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}co=null,qm=!1}catch(r){throw co!==null&&(co=co.slice(t+1)),VT(N1,ki),r}finally{nt=e,dx=!1}}return null}var wl=[],Cl=0,Tp=null,Ep=0,Os=[],Ps=0,ga=null,mo=1,go="";function zi(t,e){wl[Cl++]=Ep,wl[Cl++]=Tp,Tp=t,Ep=e}function xE(t,e,n){Os[Ps++]=mo,Os[Ps++]=go,Os[Ps++]=ga,ga=t;var s=mo;t=go;var r=32-yr(s)-1;s&=~(1<<r),n+=1;var o=32-yr(e)+r;if(30<o){var i=r-r%5;o=(s&(1<<i)-1).toString(32),s>>=i,r-=i,mo=1<<32-yr(e)+r|n<<r|s,go=o+t}else mo=1<<o|n<<r|s,go=t}function M1(t){t.return!==null&&(zi(t,1),xE(t,1,0))}function z1(t){for(;t===Tp;)Tp=wl[--Cl],wl[Cl]=null,Ep=wl[--Cl],wl[Cl]=null;for(;t===ga;)ga=Os[--Ps],Os[Ps]=null,go=Os[--Ps],Os[Ps]=null,mo=Os[--Ps],Os[Ps]=null}var bs=null,ys=null,$t=!1,dr=null;function yE(t,e){var n=Vs(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Pk(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,bs=t,ys=ti(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,bs=t,ys=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ga!==null?{id:mo,overflow:go}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Vs(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,bs=t,ys=null,!0):!1;default:return!1}}function Ny(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ry(t){if($t){var e=ys;if(e){var n=e;if(!Pk(t,e)){if(Ny(t))throw Error(re(418));e=ti(n.nextSibling);var s=bs;e&&Pk(t,e)?yE(s,n):(t.flags=t.flags&-4097|2,$t=!1,bs=t)}}else{if(Ny(t))throw Error(re(418));t.flags=t.flags&-4097|2,$t=!1,bs=t}}}function _k(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;bs=t}function mf(t){if(t!==bs)return!1;if(!$t)return _k(t),$t=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Sy(t.type,t.memoizedProps)),e&&(e=ys)){if(Ny(t))throw vE(),Error(re(418));for(;e;)yE(t,e),e=ti(e.nextSibling)}if(_k(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(re(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ys=ti(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ys=null}}else ys=bs?ti(t.stateNode.nextSibling):null;return!0}function vE(){for(var t=ys;t;)t=ti(t.nextSibling)}function Kl(){ys=bs=null,$t=!1}function B1(t){dr===null?dr=[t]:dr.push(t)}var N4=No.ReactCurrentBatchConfig;function Ku(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(re(309));var s=n.stateNode}if(!s)throw Error(re(147,t));var r=s,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(i){var a=r.refs;i===null?delete a[o]:a[o]=i},e._stringRef=o,e)}if(typeof t!="string")throw Error(re(284));if(!n._owner)throw Error(re(290,t))}return t}function gf(t,e){throw t=Object.prototype.toString.call(e),Error(re(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Lk(t){var e=t._init;return e(t._payload)}function bE(t){function e(g,y){if(t){var v=g.deletions;v===null?(g.deletions=[y],g.flags|=16):v.push(y)}}function n(g,y){if(!t)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function s(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function r(g,y){return g=oi(g,y),g.index=0,g.sibling=null,g}function o(g,y,v){return g.index=v,t?(v=g.alternate,v!==null?(v=v.index,v<y?(g.flags|=2,y):v):(g.flags|=2,y)):(g.flags|=1048576,y)}function i(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,y,v,b){return y===null||y.tag!==6?(y=yx(v,g.mode,b),y.return=g,y):(y=r(y,v),y.return=g,y)}function l(g,y,v,b){var w=v.type;return w===ml?c(g,y,v.props.children,b,v.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Vo&&Lk(w)===y.type)?(b=r(y,v.props),b.ref=Ku(g,y,v),b.return=g,b):(b=rp(v.type,v.key,v.props,null,g.mode,b),b.ref=Ku(g,y,v),b.return=g,b)}function u(g,y,v,b){return y===null||y.tag!==4||y.stateNode.containerInfo!==v.containerInfo||y.stateNode.implementation!==v.implementation?(y=vx(v,g.mode,b),y.return=g,y):(y=r(y,v.children||[]),y.return=g,y)}function c(g,y,v,b,w){return y===null||y.tag!==7?(y=la(v,g.mode,b,w),y.return=g,y):(y=r(y,v),y.return=g,y)}function d(g,y,v){if(typeof y=="string"&&y!==""||typeof y=="number")return y=yx(""+y,g.mode,v),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case rf:return v=rp(y.type,y.key,y.props,null,g.mode,v),v.ref=Ku(g,null,y),v.return=g,v;case pl:return y=vx(y,g.mode,v),y.return=g,y;case Vo:var b=y._init;return d(g,b(y._payload),v)}if(ac(y)||Wu(y))return y=la(y,g.mode,v,null),y.return=g,y;gf(g,y)}return null}function h(g,y,v,b){var w=y!==null?y.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return w!==null?null:a(g,y,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case rf:return v.key===w?l(g,y,v,b):null;case pl:return v.key===w?u(g,y,v,b):null;case Vo:return w=v._init,h(g,y,w(v._payload),b)}if(ac(v)||Wu(v))return w!==null?null:c(g,y,v,b,null);gf(g,v)}return null}function f(g,y,v,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return g=g.get(v)||null,a(y,g,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case rf:return g=g.get(b.key===null?v:b.key)||null,l(y,g,b,w);case pl:return g=g.get(b.key===null?v:b.key)||null,u(y,g,b,w);case Vo:var $=b._init;return f(g,y,v,$(b._payload),w)}if(ac(b)||Wu(b))return g=g.get(v)||null,c(y,g,b,w,null);gf(y,b)}return null}function p(g,y,v,b){for(var w=null,$=null,k=y,C=y=0,S=null;k!==null&&C<v.length;C++){k.index>C?(S=k,k=null):S=k.sibling;var T=h(g,k,v[C],b);if(T===null){k===null&&(k=S);break}t&&k&&T.alternate===null&&e(g,k),y=o(T,y,C),$===null?w=T:$.sibling=T,$=T,k=S}if(C===v.length)return n(g,k),$t&&zi(g,C),w;if(k===null){for(;C<v.length;C++)k=d(g,v[C],b),k!==null&&(y=o(k,y,C),$===null?w=k:$.sibling=k,$=k);return $t&&zi(g,C),w}for(k=s(g,k);C<v.length;C++)S=f(k,g,C,v[C],b),S!==null&&(t&&S.alternate!==null&&k.delete(S.key===null?C:S.key),y=o(S,y,C),$===null?w=S:$.sibling=S,$=S);return t&&k.forEach(function(R){return e(g,R)}),$t&&zi(g,C),w}function m(g,y,v,b){var w=Wu(v);if(typeof w!="function")throw Error(re(150));if(v=w.call(v),v==null)throw Error(re(151));for(var $=w=null,k=y,C=y=0,S=null,T=v.next();k!==null&&!T.done;C++,T=v.next()){k.index>C?(S=k,k=null):S=k.sibling;var R=h(g,k,T.value,b);if(R===null){k===null&&(k=S);break}t&&k&&R.alternate===null&&e(g,k),y=o(R,y,C),$===null?w=R:$.sibling=R,$=R,k=S}if(T.done)return n(g,k),$t&&zi(g,C),w;if(k===null){for(;!T.done;C++,T=v.next())T=d(g,T.value,b),T!==null&&(y=o(T,y,C),$===null?w=T:$.sibling=T,$=T);return $t&&zi(g,C),w}for(k=s(g,k);!T.done;C++,T=v.next())T=f(k,g,C,T.value,b),T!==null&&(t&&T.alternate!==null&&k.delete(T.key===null?C:T.key),y=o(T,y,C),$===null?w=T:$.sibling=T,$=T);return t&&k.forEach(function(A){return e(g,A)}),$t&&zi(g,C),w}function x(g,y,v,b){if(typeof v=="object"&&v!==null&&v.type===ml&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case rf:e:{for(var w=v.key,$=y;$!==null;){if($.key===w){if(w=v.type,w===ml){if($.tag===7){n(g,$.sibling),y=r($,v.props.children),y.return=g,g=y;break e}}else if($.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Vo&&Lk(w)===$.type){n(g,$.sibling),y=r($,v.props),y.ref=Ku(g,$,v),y.return=g,g=y;break e}n(g,$);break}else e(g,$);$=$.sibling}v.type===ml?(y=la(v.props.children,g.mode,b,v.key),y.return=g,g=y):(b=rp(v.type,v.key,v.props,null,g.mode,b),b.ref=Ku(g,y,v),b.return=g,g=b)}return i(g);case pl:e:{for($=v.key;y!==null;){if(y.key===$)if(y.tag===4&&y.stateNode.containerInfo===v.containerInfo&&y.stateNode.implementation===v.implementation){n(g,y.sibling),y=r(y,v.children||[]),y.return=g,g=y;break e}else{n(g,y);break}else e(g,y);y=y.sibling}y=vx(v,g.mode,b),y.return=g,g=y}return i(g);case Vo:return $=v._init,x(g,y,$(v._payload),b)}if(ac(v))return p(g,y,v,b);if(Wu(v))return m(g,y,v,b);gf(g,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,y!==null&&y.tag===6?(n(g,y.sibling),y=r(y,v),y.return=g,g=y):(n(g,y),y=yx(v,g.mode,b),y.return=g,g=y),i(g)):n(g,y)}return x}var Xl=bE(!0),wE=bE(!1),Np=$i(null),Rp=null,$l=null,V1=null;function W1(){V1=$l=Rp=null}function U1(t){var e=Np.current;bt(Np),t._currentValue=e}function Ay(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Pl(t,e){Rp=t,V1=$l=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ss=!0),t.firstContext=null)}function Xs(t){var e=t._currentValue;if(V1!==t)if(t={context:t,memoizedValue:e,next:null},$l===null){if(Rp===null)throw Error(re(308));$l=t,Rp.dependencies={lanes:0,firstContext:t}}else $l=$l.next=t;return e}var Qi=null;function G1(t){Qi===null?Qi=[t]:Qi.push(t)}function CE(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,G1(e)):(n.next=r.next,r.next=n),e.interleaved=n,$o(t,s)}function $o(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Wo=!1;function H1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $E(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function vo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ni(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,He&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,$o(t,n)}return r=s.interleaved,r===null?(e.next=e,G1(s)):(e.next=r.next,r.next=e),s.interleaved=e,$o(t,n)}function Zf(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,R1(t,n)}}function Mk(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=i:o=o.next=i,n=n.next}while(n!==null);o===null?r=o=e:o=o.next=e}else r=o=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ap(t,e,n,s){var r=t.updateQueue;Wo=!1;var o=r.firstBaseUpdate,i=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,i===null?o=u:i.next=u,i=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==i&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(o!==null){var d=r.baseState;i=0,c=u=l=null,a=o;do{var h=a.lane,f=a.eventTime;if((s&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(h=e,f=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=Rt({},d,h);break e;case 2:Wo=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,i|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(c===null&&(l=d),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do i|=r.lane,r=r.next;while(r!==e)}else o===null&&(r.shared.lanes=0);ya|=i,t.lanes=i,t.memoizedState=d}}function zk(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(re(191,r));r.call(s)}}}var Rd={},Gr=$i(Rd),td=$i(Rd),nd=$i(Rd);function Zi(t){if(t===Rd)throw Error(re(174));return t}function j1(t,e){switch(pt(nd,e),pt(td,t),pt(Gr,Rd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:dy(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=dy(e,t)}bt(Gr),pt(Gr,e)}function ql(){bt(Gr),bt(td),bt(nd)}function kE(t){Zi(nd.current);var e=Zi(Gr.current),n=dy(e,t.type);e!==n&&(pt(td,t),pt(Gr,n))}function K1(t){td.current===t&&(bt(Gr),bt(td))}var Et=$i(0);function Dp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var hx=[];function X1(){for(var t=0;t<hx.length;t++)hx[t]._workInProgressVersionPrimary=null;hx.length=0}var Jf=No.ReactCurrentDispatcher,fx=No.ReactCurrentBatchConfig,xa=0,Nt=null,nn=null,un=null,Fp=!1,Ic=!1,sd=0,R4=0;function En(){throw Error(re(321))}function q1(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!$r(t[n],e[n]))return!1;return!0}function Y1(t,e,n,s,r,o){if(xa=o,Nt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jf.current=t===null||t.memoizedState===null?O4:P4,t=n(s,r),Ic){o=0;do{if(Ic=!1,sd=0,25<=o)throw Error(re(301));o+=1,un=nn=null,e.updateQueue=null,Jf.current=_4,t=n(s,r)}while(Ic)}if(Jf.current=Op,e=nn!==null&&nn.next!==null,xa=0,un=nn=Nt=null,Fp=!1,e)throw Error(re(300));return t}function Q1(){var t=sd!==0;return sd=0,t}function Dr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return un===null?Nt.memoizedState=un=t:un=un.next=t,un}function qs(){if(nn===null){var t=Nt.alternate;t=t!==null?t.memoizedState:null}else t=nn.next;var e=un===null?Nt.memoizedState:un.next;if(e!==null)un=e,nn=t;else{if(t===null)throw Error(re(310));nn=t,t={memoizedState:nn.memoizedState,baseState:nn.baseState,baseQueue:nn.baseQueue,queue:nn.queue,next:null},un===null?Nt.memoizedState=un=t:un=un.next=t}return un}function rd(t,e){return typeof e=="function"?e(t):e}function px(t){var e=qs(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var s=nn,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var i=r.next;r.next=o.next,o.next=i}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var a=i=null,l=null,u=o;do{var c=u.lane;if((xa&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:t(s,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,i=s):l=l.next=d,Nt.lanes|=c,ya|=c}u=u.next}while(u!==null&&u!==o);l===null?i=s:l.next=a,$r(s,e.memoizedState)||(ss=!0),e.memoizedState=s,e.baseState=i,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do o=r.lane,Nt.lanes|=o,ya|=o,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function mx(t){var e=qs(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,o=e.memoizedState;if(r!==null){n.pending=null;var i=r=r.next;do o=t(o,i.action),i=i.next;while(i!==r);$r(o,e.memoizedState)||(ss=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,s]}function SE(){}function IE(t,e){var n=Nt,s=qs(),r=e(),o=!$r(s.memoizedState,r);if(o&&(s.memoizedState=r,ss=!0),s=s.queue,Z1(NE.bind(null,n,s,t),[t]),s.getSnapshot!==e||o||un!==null&&un.memoizedState.tag&1){if(n.flags|=2048,od(9,EE.bind(null,n,s,r,e),void 0,null),hn===null)throw Error(re(349));xa&30||TE(n,e,r)}return r}function TE(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function EE(t,e,n,s){e.value=n,e.getSnapshot=s,RE(e)&&AE(t)}function NE(t,e,n){return n(function(){RE(e)&&AE(t)})}function RE(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$r(t,n)}catch{return!0}}function AE(t){var e=$o(t,1);e!==null&&vr(e,t,1,-1)}function Bk(t){var e=Dr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:rd,lastRenderedState:t},e.queue=t,t=t.dispatch=F4.bind(null,Nt,t),[e.memoizedState,t]}function od(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function DE(){return qs().memoizedState}function ep(t,e,n,s){var r=Dr();Nt.flags|=t,r.memoizedState=od(1|e,n,void 0,s===void 0?null:s)}function Ym(t,e,n,s){var r=qs();s=s===void 0?null:s;var o=void 0;if(nn!==null){var i=nn.memoizedState;if(o=i.destroy,s!==null&&q1(s,i.deps)){r.memoizedState=od(e,n,o,s);return}}Nt.flags|=t,r.memoizedState=od(1|e,n,o,s)}function Vk(t,e){return ep(8390656,8,t,e)}function Z1(t,e){return Ym(2048,8,t,e)}function FE(t,e){return Ym(4,2,t,e)}function OE(t,e){return Ym(4,4,t,e)}function PE(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function _E(t,e,n){return n=n!=null?n.concat([t]):null,Ym(4,4,PE.bind(null,e,t),n)}function J1(){}function LE(t,e){var n=qs();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&q1(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function ME(t,e){var n=qs();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&q1(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function zE(t,e,n){return xa&21?($r(n,e)||(n=GT(),Nt.lanes|=n,ya|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ss=!0),t.memoizedState=n)}function A4(t,e){var n=nt;nt=n!==0&&4>n?n:4,t(!0);var s=fx.transition;fx.transition={};try{t(!1),e()}finally{nt=n,fx.transition=s}}function BE(){return qs().memoizedState}function D4(t,e,n){var s=ri(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},VE(t))WE(e,n);else if(n=CE(t,e,n,s),n!==null){var r=Kn();vr(n,t,s,r),UE(n,e,s)}}function F4(t,e,n){var s=ri(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(VE(t))WE(e,r);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var i=e.lastRenderedState,a=o(i,n);if(r.hasEagerState=!0,r.eagerState=a,$r(a,i)){var l=e.interleaved;l===null?(r.next=r,G1(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=CE(t,e,r,s),n!==null&&(r=Kn(),vr(n,t,s,r),UE(n,e,s))}}function VE(t){var e=t.alternate;return t===Nt||e!==null&&e===Nt}function WE(t,e){Ic=Fp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function UE(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,R1(t,n)}}var Op={readContext:Xs,useCallback:En,useContext:En,useEffect:En,useImperativeHandle:En,useInsertionEffect:En,useLayoutEffect:En,useMemo:En,useReducer:En,useRef:En,useState:En,useDebugValue:En,useDeferredValue:En,useTransition:En,useMutableSource:En,useSyncExternalStore:En,useId:En,unstable_isNewReconciler:!1},O4={readContext:Xs,useCallback:function(t,e){return Dr().memoizedState=[t,e===void 0?null:e],t},useContext:Xs,useEffect:Vk,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ep(4194308,4,PE.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ep(4194308,4,t,e)},useInsertionEffect:function(t,e){return ep(4,2,t,e)},useMemo:function(t,e){var n=Dr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=Dr();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=D4.bind(null,Nt,t),[s.memoizedState,t]},useRef:function(t){var e=Dr();return t={current:t},e.memoizedState=t},useState:Bk,useDebugValue:J1,useDeferredValue:function(t){return Dr().memoizedState=t},useTransition:function(){var t=Bk(!1),e=t[0];return t=A4.bind(null,t[1]),Dr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=Nt,r=Dr();if($t){if(n===void 0)throw Error(re(407));n=n()}else{if(n=e(),hn===null)throw Error(re(349));xa&30||TE(s,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,Vk(NE.bind(null,s,o,t),[t]),s.flags|=2048,od(9,EE.bind(null,s,o,n,e),void 0,null),n},useId:function(){var t=Dr(),e=hn.identifierPrefix;if($t){var n=go,s=mo;n=(s&~(1<<32-yr(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=sd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=R4++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},P4={readContext:Xs,useCallback:LE,useContext:Xs,useEffect:Z1,useImperativeHandle:_E,useInsertionEffect:FE,useLayoutEffect:OE,useMemo:ME,useReducer:px,useRef:DE,useState:function(){return px(rd)},useDebugValue:J1,useDeferredValue:function(t){var e=qs();return zE(e,nn.memoizedState,t)},useTransition:function(){var t=px(rd)[0],e=qs().memoizedState;return[t,e]},useMutableSource:SE,useSyncExternalStore:IE,useId:BE,unstable_isNewReconciler:!1},_4={readContext:Xs,useCallback:LE,useContext:Xs,useEffect:Z1,useImperativeHandle:_E,useInsertionEffect:FE,useLayoutEffect:OE,useMemo:ME,useReducer:mx,useRef:DE,useState:function(){return mx(rd)},useDebugValue:J1,useDeferredValue:function(t){var e=qs();return nn===null?e.memoizedState=t:zE(e,nn.memoizedState,t)},useTransition:function(){var t=mx(rd)[0],e=qs().memoizedState;return[t,e]},useMutableSource:SE,useSyncExternalStore:IE,useId:BE,unstable_isNewReconciler:!1};function lr(t,e){if(t&&t.defaultProps){e=Rt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Dy(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Rt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Qm={isMounted:function(t){return(t=t._reactInternals)?Va(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=Kn(),r=ri(t),o=vo(s,r);o.payload=e,n!=null&&(o.callback=n),e=ni(t,o,r),e!==null&&(vr(e,t,r,s),Zf(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=Kn(),r=ri(t),o=vo(s,r);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=ni(t,o,r),e!==null&&(vr(e,t,r,s),Zf(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Kn(),s=ri(t),r=vo(n,s);r.tag=2,e!=null&&(r.callback=e),e=ni(t,r,s),e!==null&&(vr(e,t,s,n),Zf(e,t,s))}};function Wk(t,e,n,s,r,o,i){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,o,i):e.prototype&&e.prototype.isPureReactComponent?!Qc(n,s)||!Qc(r,o):!0}function GE(t,e,n){var s=!1,r=fi,o=e.contextType;return typeof o=="object"&&o!==null?o=Xs(o):(r=as(e)?ma:Mn.current,s=e.contextTypes,o=(s=s!=null)?jl(t,r):fi),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Qm,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=o),e}function Uk(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&Qm.enqueueReplaceState(e,e.state,null)}function Fy(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},H1(t);var o=e.contextType;typeof o=="object"&&o!==null?r.context=Xs(o):(o=as(e)?ma:Mn.current,r.context=jl(t,o)),r.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Dy(t,e,o,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Qm.enqueueReplaceState(r,r.state,null),Ap(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Yl(t,e){try{var n="",s=e;do n+=cz(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:r,digest:null}}function gx(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Oy(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var L4=typeof WeakMap=="function"?WeakMap:Map;function HE(t,e,n){n=vo(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){_p||(_p=!0,Gy=s),Oy(t,e)},n}function jE(t,e,n){n=vo(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){Oy(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Oy(t,e),typeof s!="function"&&(si===null?si=new Set([this]):si.add(this));var i=e.stack;this.componentDidCatch(e.value,{componentStack:i!==null?i:""})}),n}function Gk(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new L4;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=Q4.bind(null,t,e,n),e.then(t,t))}function Hk(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function jk(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=vo(-1,1),e.tag=2,ni(n,e,1))),n.lanes|=1),t)}var M4=No.ReactCurrentOwner,ss=!1;function Wn(t,e,n,s){e.child=t===null?wE(e,null,n,s):Xl(e,t.child,n,s)}function Kk(t,e,n,s,r){n=n.render;var o=e.ref;return Pl(e,r),s=Y1(t,e,n,s,o,r),n=Q1(),t!==null&&!ss?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ko(t,e,r)):($t&&n&&M1(e),e.flags|=1,Wn(t,e,s,r),e.child)}function Xk(t,e,n,s,r){if(t===null){var o=n.type;return typeof o=="function"&&!ab(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,KE(t,e,o,s,r)):(t=rp(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&r)){var i=o.memoizedProps;if(n=n.compare,n=n!==null?n:Qc,n(i,s)&&t.ref===e.ref)return ko(t,e,r)}return e.flags|=1,t=oi(o,s),t.ref=e.ref,t.return=e,e.child=t}function KE(t,e,n,s,r){if(t!==null){var o=t.memoizedProps;if(Qc(o,s)&&t.ref===e.ref)if(ss=!1,e.pendingProps=s=o,(t.lanes&r)!==0)t.flags&131072&&(ss=!0);else return e.lanes=t.lanes,ko(t,e,r)}return Py(t,e,n,s,r)}function XE(t,e,n){var s=e.pendingProps,r=s.children,o=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},pt(Sl,ms),ms|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,pt(Sl,ms),ms|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,pt(Sl,ms),ms|=s}else o!==null?(s=o.baseLanes|n,e.memoizedState=null):s=n,pt(Sl,ms),ms|=s;return Wn(t,e,r,n),e.child}function qE(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Py(t,e,n,s,r){var o=as(n)?ma:Mn.current;return o=jl(e,o),Pl(e,r),n=Y1(t,e,n,s,o,r),s=Q1(),t!==null&&!ss?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ko(t,e,r)):($t&&s&&M1(e),e.flags|=1,Wn(t,e,n,r),e.child)}function qk(t,e,n,s,r){if(as(n)){var o=!0;Ip(e)}else o=!1;if(Pl(e,r),e.stateNode===null)tp(t,e),GE(e,n,s),Fy(e,n,s,r),s=!0;else if(t===null){var i=e.stateNode,a=e.memoizedProps;i.props=a;var l=i.context,u=n.contextType;typeof u=="object"&&u!==null?u=Xs(u):(u=as(n)?ma:Mn.current,u=jl(e,u));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof i.getSnapshotBeforeUpdate=="function";d||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==s||l!==u)&&Uk(e,i,s,u),Wo=!1;var h=e.memoizedState;i.state=h,Ap(e,s,i,r),l=e.memoizedState,a!==s||h!==l||is.current||Wo?(typeof c=="function"&&(Dy(e,n,c,s),l=e.memoizedState),(a=Wo||Wk(e,n,a,s,h,l,u))?(d||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),i.props=s,i.state=l,i.context=u,s=a):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{i=e.stateNode,$E(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:lr(e.type,a),i.props=u,d=e.pendingProps,h=i.context,l=n.contextType,typeof l=="object"&&l!==null?l=Xs(l):(l=as(n)?ma:Mn.current,l=jl(e,l));var f=n.getDerivedStateFromProps;(c=typeof f=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Uk(e,i,s,l),Wo=!1,h=e.memoizedState,i.state=h,Ap(e,s,i,r);var p=e.memoizedState;a!==d||h!==p||is.current||Wo?(typeof f=="function"&&(Dy(e,n,f,s),p=e.memoizedState),(u=Wo||Wk(e,n,u,s,h,p,l)||!1)?(c||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(s,p,l),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(s,p,l)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=p),i.props=s,i.state=p,i.context=l,s=u):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),s=!1)}return _y(t,e,n,s,o,r)}function _y(t,e,n,s,r,o){qE(t,e);var i=(e.flags&128)!==0;if(!s&&!i)return r&&Ok(e,n,!1),ko(t,e,o);s=e.stateNode,M4.current=e;var a=i&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&i?(e.child=Xl(e,t.child,null,o),e.child=Xl(e,null,a,o)):Wn(t,e,a,o),e.memoizedState=s.state,r&&Ok(e,n,!0),e.child}function YE(t){var e=t.stateNode;e.pendingContext?Fk(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Fk(t,e.context,!1),j1(t,e.containerInfo)}function Yk(t,e,n,s,r){return Kl(),B1(r),e.flags|=256,Wn(t,e,n,s),e.child}var Ly={dehydrated:null,treeContext:null,retryLane:0};function My(t){return{baseLanes:t,cachePool:null,transitions:null}}function QE(t,e,n){var s=e.pendingProps,r=Et.current,o=!1,i=(e.flags&128)!==0,a;if((a=i)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),pt(Et,r&1),t===null)return Ry(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(i=s.children,t=s.fallback,o?(s=e.mode,o=e.child,i={mode:"hidden",children:i},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=eg(i,s,0,null),t=la(t,s,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=My(n),e.memoizedState=Ly,t):eb(e,i));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return z4(t,e,i,s,a,r,n);if(o){o=s.fallback,i=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(i&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=oi(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?o=oi(a,o):(o=la(o,i,n,null),o.flags|=2),o.return=e,s.return=e,s.sibling=o,e.child=s,s=o,o=e.child,i=t.child.memoizedState,i=i===null?My(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=t.childLanes&~n,e.memoizedState=Ly,s}return o=t.child,t=o.sibling,s=oi(o,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function eb(t,e){return e=eg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xf(t,e,n,s){return s!==null&&B1(s),Xl(e,t.child,null,n),t=eb(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function z4(t,e,n,s,r,o,i){if(n)return e.flags&256?(e.flags&=-257,s=gx(Error(re(422))),xf(t,e,i,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=s.fallback,r=e.mode,s=eg({mode:"visible",children:s.children},r,0,null),o=la(o,r,i,null),o.flags|=2,s.return=e,o.return=e,s.sibling=o,e.child=s,e.mode&1&&Xl(e,t.child,null,i),e.child.memoizedState=My(i),e.memoizedState=Ly,o);if(!(e.mode&1))return xf(t,e,i,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,o=Error(re(419)),s=gx(o,s,void 0),xf(t,e,i,s)}if(a=(i&t.childLanes)!==0,ss||a){if(s=hn,s!==null){switch(i&-i){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|i)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,$o(t,r),vr(s,t,r,-1))}return ib(),s=gx(Error(re(421))),xf(t,e,i,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Z4.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,ys=ti(r.nextSibling),bs=e,$t=!0,dr=null,t!==null&&(Os[Ps++]=mo,Os[Ps++]=go,Os[Ps++]=ga,mo=t.id,go=t.overflow,ga=e),e=eb(e,s.children),e.flags|=4096,e)}function Qk(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),Ay(t.return,e,n)}function xx(t,e,n,s,r){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function ZE(t,e,n){var s=e.pendingProps,r=s.revealOrder,o=s.tail;if(Wn(t,e,s.children,n),s=Et.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Qk(t,n,e);else if(t.tag===19)Qk(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(pt(Et,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Dp(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),xx(e,!1,r,n,o);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Dp(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}xx(e,!0,n,null,o);break;case"together":xx(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function tp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ko(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ya|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(re(153));if(e.child!==null){for(t=e.child,n=oi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=oi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function B4(t,e,n){switch(e.tag){case 3:YE(e),Kl();break;case 5:kE(e);break;case 1:as(e.type)&&Ip(e);break;case 4:j1(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;pt(Np,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(pt(Et,Et.current&1),e.flags|=128,null):n&e.child.childLanes?QE(t,e,n):(pt(Et,Et.current&1),t=ko(t,e,n),t!==null?t.sibling:null);pt(Et,Et.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return ZE(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),pt(Et,Et.current),s)break;return null;case 22:case 23:return e.lanes=0,XE(t,e,n)}return ko(t,e,n)}var JE,zy,eN,tN;JE=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};zy=function(){};eN=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,Zi(Gr.current);var o=null;switch(n){case"input":r=ay(t,r),s=ay(t,s),o=[];break;case"select":r=Rt({},r,{value:void 0}),s=Rt({},s,{value:void 0}),o=[];break;case"textarea":r=cy(t,r),s=cy(t,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=kp)}hy(n,s);var i;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(i in a)a.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Gc.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var l=s[u];if(a=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(i in a)!a.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in l)l.hasOwnProperty(i)&&a[i]!==l[i]&&(n||(n={}),n[i]=l[i])}else n||(o||(o=[]),o.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Gc.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&vt("scroll",t),o||a===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}};tN=function(t,e,n,s){n!==s&&(e.flags|=4)};function Xu(t,e){if(!$t)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Nn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function V4(t,e,n){var s=e.pendingProps;switch(z1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nn(e),null;case 1:return as(e.type)&&Sp(),Nn(e),null;case 3:return s=e.stateNode,ql(),bt(is),bt(Mn),X1(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(mf(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dr!==null&&(Ky(dr),dr=null))),zy(t,e),Nn(e),null;case 5:K1(e);var r=Zi(nd.current);if(n=e.type,t!==null&&e.stateNode!=null)eN(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(re(166));return Nn(e),null}if(t=Zi(Gr.current),mf(e)){s=e.stateNode,n=e.type;var o=e.memoizedProps;switch(s[Vr]=e,s[ed]=o,t=(e.mode&1)!==0,n){case"dialog":vt("cancel",s),vt("close",s);break;case"iframe":case"object":case"embed":vt("load",s);break;case"video":case"audio":for(r=0;r<uc.length;r++)vt(uc[r],s);break;case"source":vt("error",s);break;case"img":case"image":case"link":vt("error",s),vt("load",s);break;case"details":vt("toggle",s);break;case"input":ik(s,o),vt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},vt("invalid",s);break;case"textarea":lk(s,o),vt("invalid",s)}hy(n,o),r=null;for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];i==="children"?typeof a=="string"?s.textContent!==a&&(o.suppressHydrationWarning!==!0&&pf(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&pf(s.textContent,a,t),r=["children",""+a]):Gc.hasOwnProperty(i)&&a!=null&&i==="onScroll"&&vt("scroll",s)}switch(n){case"input":of(s),ak(s,o,!0);break;case"textarea":of(s),uk(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=kp)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{i=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=NT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=i.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=i.createElement(n,{is:s.is}):(t=i.createElement(n),n==="select"&&(i=t,s.multiple?i.multiple=!0:s.size&&(i.size=s.size))):t=i.createElementNS(t,n),t[Vr]=e,t[ed]=s,JE(t,e,!1,!1),e.stateNode=t;e:{switch(i=fy(n,s),n){case"dialog":vt("cancel",t),vt("close",t),r=s;break;case"iframe":case"object":case"embed":vt("load",t),r=s;break;case"video":case"audio":for(r=0;r<uc.length;r++)vt(uc[r],t);r=s;break;case"source":vt("error",t),r=s;break;case"img":case"image":case"link":vt("error",t),vt("load",t),r=s;break;case"details":vt("toggle",t),r=s;break;case"input":ik(t,s),r=ay(t,s),vt("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=Rt({},s,{value:void 0}),vt("invalid",t);break;case"textarea":lk(t,s),r=cy(t,s),vt("invalid",t);break;default:r=s}hy(n,r),a=r;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?DT(t,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&RT(t,l)):o==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Hc(t,l):typeof l=="number"&&Hc(t,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Gc.hasOwnProperty(o)?l!=null&&o==="onScroll"&&vt("scroll",t):l!=null&&k1(t,o,l,i))}switch(n){case"input":of(t),ak(t,s,!1);break;case"textarea":of(t),uk(t);break;case"option":s.value!=null&&t.setAttribute("value",""+hi(s.value));break;case"select":t.multiple=!!s.multiple,o=s.value,o!=null?Al(t,!!s.multiple,o,!1):s.defaultValue!=null&&Al(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=kp)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Nn(e),null;case 6:if(t&&e.stateNode!=null)tN(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(re(166));if(n=Zi(nd.current),Zi(Gr.current),mf(e)){if(s=e.stateNode,n=e.memoizedProps,s[Vr]=e,(o=s.nodeValue!==n)&&(t=bs,t!==null))switch(t.tag){case 3:pf(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&pf(s.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Vr]=e,e.stateNode=s}return Nn(e),null;case 13:if(bt(Et),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if($t&&ys!==null&&e.mode&1&&!(e.flags&128))vE(),Kl(),e.flags|=98560,o=!1;else if(o=mf(e),s!==null&&s.dehydrated!==null){if(t===null){if(!o)throw Error(re(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(re(317));o[Vr]=e}else Kl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Nn(e),o=!1}else dr!==null&&(Ky(dr),dr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Et.current&1?rn===0&&(rn=3):ib())),e.updateQueue!==null&&(e.flags|=4),Nn(e),null);case 4:return ql(),zy(t,e),t===null&&Zc(e.stateNode.containerInfo),Nn(e),null;case 10:return U1(e.type._context),Nn(e),null;case 17:return as(e.type)&&Sp(),Nn(e),null;case 19:if(bt(Et),o=e.memoizedState,o===null)return Nn(e),null;if(s=(e.flags&128)!==0,i=o.rendering,i===null)if(s)Xu(o,!1);else{if(rn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(i=Dp(t),i!==null){for(e.flags|=128,Xu(o,!1),s=i.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)o=n,t=s,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,t=i.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return pt(Et,Et.current&1|2),e.child}t=t.sibling}o.tail!==null&&zt()>Ql&&(e.flags|=128,s=!0,Xu(o,!1),e.lanes=4194304)}else{if(!s)if(t=Dp(i),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Xu(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!$t)return Nn(e),null}else 2*zt()-o.renderingStartTime>Ql&&n!==1073741824&&(e.flags|=128,s=!0,Xu(o,!1),e.lanes=4194304);o.isBackwards?(i.sibling=e.child,e.child=i):(n=o.last,n!==null?n.sibling=i:e.child=i,o.last=i)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=zt(),e.sibling=null,n=Et.current,pt(Et,s?n&1|2:n&1),e):(Nn(e),null);case 22:case 23:return ob(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?ms&1073741824&&(Nn(e),e.subtreeFlags&6&&(e.flags|=8192)):Nn(e),null;case 24:return null;case 25:return null}throw Error(re(156,e.tag))}function W4(t,e){switch(z1(e),e.tag){case 1:return as(e.type)&&Sp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ql(),bt(is),bt(Mn),X1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return K1(e),null;case 13:if(bt(Et),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(re(340));Kl()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return bt(Et),null;case 4:return ql(),null;case 10:return U1(e.type._context),null;case 22:case 23:return ob(),null;case 24:return null;default:return null}}var yf=!1,Fn=!1,U4=typeof WeakSet=="function"?WeakSet:Set,he=null;function kl(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){At(t,e,s)}else n.current=null}function By(t,e,n){try{n()}catch(s){At(t,e,s)}}var Zk=!1;function G4(t,e){if($y=wp,t=iE(),L1(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var i=0,a=-1,l=-1,u=0,c=0,d=t,h=null;t:for(;;){for(var f;d!==n||r!==0&&d.nodeType!==3||(a=i+r),d!==o||s!==0&&d.nodeType!==3||(l=i+s),d.nodeType===3&&(i+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++u===r&&(a=i),h===o&&++c===s&&(l=i),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ky={focusedElem:t,selectionRange:n},wp=!1,he=e;he!==null;)if(e=he,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,he=t;else for(;he!==null;){e=he;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,x=p.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?m:lr(e.type,m),x);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(re(163))}}catch(b){At(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,he=t;break}he=e.return}return p=Zk,Zk=!1,p}function Tc(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var o=r.destroy;r.destroy=void 0,o!==void 0&&By(e,n,o)}r=r.next}while(r!==s)}}function Zm(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function Vy(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function nN(t){var e=t.alternate;e!==null&&(t.alternate=null,nN(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Vr],delete e[ed],delete e[Ty],delete e[I4],delete e[T4])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function sN(t){return t.tag===5||t.tag===3||t.tag===4}function Jk(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||sN(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Wy(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=kp));else if(s!==4&&(t=t.child,t!==null))for(Wy(t,e,n),t=t.sibling;t!==null;)Wy(t,e,n),t=t.sibling}function Uy(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(Uy(t,e,n),t=t.sibling;t!==null;)Uy(t,e,n),t=t.sibling}var xn=null,cr=!1;function Mo(t,e,n){for(n=n.child;n!==null;)rN(t,e,n),n=n.sibling}function rN(t,e,n){if(Ur&&typeof Ur.onCommitFiberUnmount=="function")try{Ur.onCommitFiberUnmount(Gm,n)}catch{}switch(n.tag){case 5:Fn||kl(n,e);case 6:var s=xn,r=cr;xn=null,Mo(t,e,n),xn=s,cr=r,xn!==null&&(cr?(t=xn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):xn.removeChild(n.stateNode));break;case 18:xn!==null&&(cr?(t=xn,n=n.stateNode,t.nodeType===8?cx(t.parentNode,n):t.nodeType===1&&cx(t,n),qc(t)):cx(xn,n.stateNode));break;case 4:s=xn,r=cr,xn=n.stateNode.containerInfo,cr=!0,Mo(t,e,n),xn=s,cr=r;break;case 0:case 11:case 14:case 15:if(!Fn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&By(n,e,i),r=r.next}while(r!==s)}Mo(t,e,n);break;case 1:if(!Fn&&(kl(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){At(n,e,a)}Mo(t,e,n);break;case 21:Mo(t,e,n);break;case 22:n.mode&1?(Fn=(s=Fn)||n.memoizedState!==null,Mo(t,e,n),Fn=s):Mo(t,e,n);break;default:Mo(t,e,n)}}function eS(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new U4),e.forEach(function(s){var r=J4.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function rr(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=t,i=e,a=i;e:for(;a!==null;){switch(a.tag){case 5:xn=a.stateNode,cr=!1;break e;case 3:xn=a.stateNode.containerInfo,cr=!0;break e;case 4:xn=a.stateNode.containerInfo,cr=!0;break e}a=a.return}if(xn===null)throw Error(re(160));rN(o,i,r),xn=null,cr=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){At(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oN(e,t),e=e.sibling}function oN(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(rr(e,t),Rr(t),s&4){try{Tc(3,t,t.return),Zm(3,t)}catch(m){At(t,t.return,m)}try{Tc(5,t,t.return)}catch(m){At(t,t.return,m)}}break;case 1:rr(e,t),Rr(t),s&512&&n!==null&&kl(n,n.return);break;case 5:if(rr(e,t),Rr(t),s&512&&n!==null&&kl(n,n.return),t.flags&32){var r=t.stateNode;try{Hc(r,"")}catch(m){At(t,t.return,m)}}if(s&4&&(r=t.stateNode,r!=null)){var o=t.memoizedProps,i=n!==null?n.memoizedProps:o,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&TT(r,o),fy(a,i);var u=fy(a,o);for(i=0;i<l.length;i+=2){var c=l[i],d=l[i+1];c==="style"?DT(r,d):c==="dangerouslySetInnerHTML"?RT(r,d):c==="children"?Hc(r,d):k1(r,c,d,u)}switch(a){case"input":ly(r,o);break;case"textarea":ET(r,o);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?Al(r,!!o.multiple,f,!1):h!==!!o.multiple&&(o.defaultValue!=null?Al(r,!!o.multiple,o.defaultValue,!0):Al(r,!!o.multiple,o.multiple?[]:"",!1))}r[ed]=o}catch(m){At(t,t.return,m)}}break;case 6:if(rr(e,t),Rr(t),s&4){if(t.stateNode===null)throw Error(re(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(m){At(t,t.return,m)}}break;case 3:if(rr(e,t),Rr(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{qc(e.containerInfo)}catch(m){At(t,t.return,m)}break;case 4:rr(e,t),Rr(t);break;case 13:rr(e,t),Rr(t),r=t.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(sb=zt())),s&4&&eS(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Fn=(u=Fn)||c,rr(e,t),Fn=u):rr(e,t),Rr(t),s&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(he=t,c=t.child;c!==null;){for(d=he=c;he!==null;){switch(h=he,f=h.child,h.tag){case 0:case 11:case 14:case 15:Tc(4,h,h.return);break;case 1:kl(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){s=h,n=h.return;try{e=s,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){At(s,n,m)}}break;case 5:kl(h,h.return);break;case 22:if(h.memoizedState!==null){nS(d);continue}}f!==null?(f.return=h,he=f):nS(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,l=d.memoizedProps.style,i=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=AT("display",i))}catch(m){At(t,t.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){At(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:rr(e,t),Rr(t),s&4&&eS(t);break;case 21:break;default:rr(e,t),Rr(t)}}function Rr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(sN(n)){var s=n;break e}n=n.return}throw Error(re(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Hc(r,""),s.flags&=-33);var o=Jk(t);Uy(t,o,r);break;case 3:case 4:var i=s.stateNode.containerInfo,a=Jk(t);Wy(t,a,i);break;default:throw Error(re(161))}}catch(l){At(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function H4(t,e,n){he=t,iN(t)}function iN(t,e,n){for(var s=(t.mode&1)!==0;he!==null;){var r=he,o=r.child;if(r.tag===22&&s){var i=r.memoizedState!==null||yf;if(!i){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Fn;a=yf;var u=Fn;if(yf=i,(Fn=l)&&!u)for(he=r;he!==null;)i=he,l=i.child,i.tag===22&&i.memoizedState!==null?sS(r):l!==null?(l.return=i,he=l):sS(r);for(;o!==null;)he=o,iN(o),o=o.sibling;he=r,yf=a,Fn=u}tS(t)}else r.subtreeFlags&8772&&o!==null?(o.return=r,he=o):tS(t)}}function tS(t){for(;he!==null;){var e=he;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Fn||Zm(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Fn)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:lr(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&zk(e,o,s);break;case 3:var i=e.updateQueue;if(i!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}zk(e,i,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&qc(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(re(163))}Fn||e.flags&512&&Vy(e)}catch(h){At(e,e.return,h)}}if(e===t){he=null;break}if(n=e.sibling,n!==null){n.return=e.return,he=n;break}he=e.return}}function nS(t){for(;he!==null;){var e=he;if(e===t){he=null;break}var n=e.sibling;if(n!==null){n.return=e.return,he=n;break}he=e.return}}function sS(t){for(;he!==null;){var e=he;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Zm(4,e)}catch(l){At(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){At(e,r,l)}}var o=e.return;try{Vy(e)}catch(l){At(e,o,l)}break;case 5:var i=e.return;try{Vy(e)}catch(l){At(e,i,l)}}}catch(l){At(e,e.return,l)}if(e===t){he=null;break}var a=e.sibling;if(a!==null){a.return=e.return,he=a;break}he=e.return}}var j4=Math.ceil,Pp=No.ReactCurrentDispatcher,tb=No.ReactCurrentOwner,Ks=No.ReactCurrentBatchConfig,He=0,hn=null,Ht=null,bn=0,ms=0,Sl=$i(0),rn=0,id=null,ya=0,Jm=0,nb=0,Ec=null,ts=null,sb=0,Ql=1/0,uo=null,_p=!1,Gy=null,si=null,vf=!1,Ko=null,Lp=0,Nc=0,Hy=null,np=-1,sp=0;function Kn(){return He&6?zt():np!==-1?np:np=zt()}function ri(t){return t.mode&1?He&2&&bn!==0?bn&-bn:N4.transition!==null?(sp===0&&(sp=GT()),sp):(t=nt,t!==0||(t=window.event,t=t===void 0?16:QT(t.type)),t):1}function vr(t,e,n,s){if(50<Nc)throw Nc=0,Hy=null,Error(re(185));Td(t,n,s),(!(He&2)||t!==hn)&&(t===hn&&(!(He&2)&&(Jm|=n),rn===4&&Ho(t,bn)),ls(t,s),n===1&&He===0&&!(e.mode&1)&&(Ql=zt()+500,qm&&ki()))}function ls(t,e){var n=t.callbackNode;Nz(t,e);var s=bp(t,t===hn?bn:0);if(s===0)n!==null&&hk(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&hk(n),e===1)t.tag===0?E4(rS.bind(null,t)):gE(rS.bind(null,t)),k4(function(){!(He&6)&&ki()}),n=null;else{switch(HT(s)){case 1:n=N1;break;case 4:n=WT;break;case 16:n=vp;break;case 536870912:n=UT;break;default:n=vp}n=pN(n,aN.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function aN(t,e){if(np=-1,sp=0,He&6)throw Error(re(327));var n=t.callbackNode;if(_l()&&t.callbackNode!==n)return null;var s=bp(t,t===hn?bn:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=Mp(t,s);else{e=s;var r=He;He|=2;var o=uN();(hn!==t||bn!==e)&&(uo=null,Ql=zt()+500,aa(t,e));do try{q4();break}catch(a){lN(t,a)}while(!0);W1(),Pp.current=o,He=r,Ht!==null?e=0:(hn=null,bn=0,e=rn)}if(e!==0){if(e===2&&(r=yy(t),r!==0&&(s=r,e=jy(t,r))),e===1)throw n=id,aa(t,0),Ho(t,s),ls(t,zt()),n;if(e===6)Ho(t,s);else{if(r=t.current.alternate,!(s&30)&&!K4(r)&&(e=Mp(t,s),e===2&&(o=yy(t),o!==0&&(s=o,e=jy(t,o))),e===1))throw n=id,aa(t,0),Ho(t,s),ls(t,zt()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(re(345));case 2:Bi(t,ts,uo);break;case 3:if(Ho(t,s),(s&130023424)===s&&(e=sb+500-zt(),10<e)){if(bp(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){Kn(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Iy(Bi.bind(null,t,ts,uo),e);break}Bi(t,ts,uo);break;case 4:if(Ho(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var i=31-yr(s);o=1<<i,i=e[i],i>r&&(r=i),s&=~o}if(s=r,s=zt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*j4(s/1960))-s,10<s){t.timeoutHandle=Iy(Bi.bind(null,t,ts,uo),s);break}Bi(t,ts,uo);break;case 5:Bi(t,ts,uo);break;default:throw Error(re(329))}}}return ls(t,zt()),t.callbackNode===n?aN.bind(null,t):null}function jy(t,e){var n=Ec;return t.current.memoizedState.isDehydrated&&(aa(t,e).flags|=256),t=Mp(t,e),t!==2&&(e=ts,ts=n,e!==null&&Ky(e)),t}function Ky(t){ts===null?ts=t:ts.push.apply(ts,t)}function K4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!$r(o(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ho(t,e){for(e&=~nb,e&=~Jm,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-yr(e),s=1<<n;t[n]=-1,e&=~s}}function rS(t){if(He&6)throw Error(re(327));_l();var e=bp(t,0);if(!(e&1))return ls(t,zt()),null;var n=Mp(t,e);if(t.tag!==0&&n===2){var s=yy(t);s!==0&&(e=s,n=jy(t,s))}if(n===1)throw n=id,aa(t,0),Ho(t,e),ls(t,zt()),n;if(n===6)throw Error(re(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Bi(t,ts,uo),ls(t,zt()),null}function rb(t,e){var n=He;He|=1;try{return t(e)}finally{He=n,He===0&&(Ql=zt()+500,qm&&ki())}}function va(t){Ko!==null&&Ko.tag===0&&!(He&6)&&_l();var e=He;He|=1;var n=Ks.transition,s=nt;try{if(Ks.transition=null,nt=1,t)return t()}finally{nt=s,Ks.transition=n,He=e,!(He&6)&&ki()}}function ob(){ms=Sl.current,bt(Sl)}function aa(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,$4(n)),Ht!==null)for(n=Ht.return;n!==null;){var s=n;switch(z1(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Sp();break;case 3:ql(),bt(is),bt(Mn),X1();break;case 5:K1(s);break;case 4:ql();break;case 13:bt(Et);break;case 19:bt(Et);break;case 10:U1(s.type._context);break;case 22:case 23:ob()}n=n.return}if(hn=t,Ht=t=oi(t.current,null),bn=ms=e,rn=0,id=null,nb=Jm=ya=0,ts=Ec=null,Qi!==null){for(e=0;e<Qi.length;e++)if(n=Qi[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var i=o.next;o.next=r,s.next=i}n.pending=s}Qi=null}return t}function lN(t,e){do{var n=Ht;try{if(W1(),Jf.current=Op,Fp){for(var s=Nt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Fp=!1}if(xa=0,un=nn=Nt=null,Ic=!1,sd=0,tb.current=null,n===null||n.return===null){rn=1,id=e,Ht=null;break}e:{var o=t,i=n.return,a=n,l=e;if(e=bn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Hk(i);if(f!==null){f.flags&=-257,jk(f,i,a,o,e),f.mode&1&&Gk(o,u,e),e=f,l=u;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){Gk(o,u,e),ib();break e}l=Error(re(426))}}else if($t&&a.mode&1){var x=Hk(i);if(x!==null){!(x.flags&65536)&&(x.flags|=256),jk(x,i,a,o,e),B1(Yl(l,a));break e}}o=l=Yl(l,a),rn!==4&&(rn=2),Ec===null?Ec=[o]:Ec.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var g=HE(o,l,e);Mk(o,g);break e;case 1:a=l;var y=o.type,v=o.stateNode;if(!(o.flags&128)&&(typeof y.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(si===null||!si.has(v)))){o.flags|=65536,e&=-e,o.lanes|=e;var b=jE(o,a,e);Mk(o,b);break e}}o=o.return}while(o!==null)}dN(n)}catch(w){e=w,Ht===n&&n!==null&&(Ht=n=n.return);continue}break}while(!0)}function uN(){var t=Pp.current;return Pp.current=Op,t===null?Op:t}function ib(){(rn===0||rn===3||rn===2)&&(rn=4),hn===null||!(ya&268435455)&&!(Jm&268435455)||Ho(hn,bn)}function Mp(t,e){var n=He;He|=2;var s=uN();(hn!==t||bn!==e)&&(uo=null,aa(t,e));do try{X4();break}catch(r){lN(t,r)}while(!0);if(W1(),He=n,Pp.current=s,Ht!==null)throw Error(re(261));return hn=null,bn=0,rn}function X4(){for(;Ht!==null;)cN(Ht)}function q4(){for(;Ht!==null&&!bz();)cN(Ht)}function cN(t){var e=fN(t.alternate,t,ms);t.memoizedProps=t.pendingProps,e===null?dN(t):Ht=e,tb.current=null}function dN(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=W4(n,e),n!==null){n.flags&=32767,Ht=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{rn=6,Ht=null;return}}else if(n=V4(n,e,ms),n!==null){Ht=n;return}if(e=e.sibling,e!==null){Ht=e;return}Ht=e=t}while(e!==null);rn===0&&(rn=5)}function Bi(t,e,n){var s=nt,r=Ks.transition;try{Ks.transition=null,nt=1,Y4(t,e,n,s)}finally{Ks.transition=r,nt=s}return null}function Y4(t,e,n,s){do _l();while(Ko!==null);if(He&6)throw Error(re(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(re(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(Rz(t,o),t===hn&&(Ht=hn=null,bn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vf||(vf=!0,pN(vp,function(){return _l(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Ks.transition,Ks.transition=null;var i=nt;nt=1;var a=He;He|=4,tb.current=null,G4(t,n),oN(n,t),g4(ky),wp=!!$y,ky=$y=null,t.current=n,H4(n),wz(),He=a,nt=i,Ks.transition=o}else t.current=n;if(vf&&(vf=!1,Ko=t,Lp=r),o=t.pendingLanes,o===0&&(si=null),kz(n.stateNode),ls(t,zt()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(_p)throw _p=!1,t=Gy,Gy=null,t;return Lp&1&&t.tag!==0&&_l(),o=t.pendingLanes,o&1?t===Hy?Nc++:(Nc=0,Hy=t):Nc=0,ki(),null}function _l(){if(Ko!==null){var t=HT(Lp),e=Ks.transition,n=nt;try{if(Ks.transition=null,nt=16>t?16:t,Ko===null)var s=!1;else{if(t=Ko,Ko=null,Lp=0,He&6)throw Error(re(331));var r=He;for(He|=4,he=t.current;he!==null;){var o=he,i=o.child;if(he.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(he=u;he!==null;){var c=he;switch(c.tag){case 0:case 11:case 15:Tc(8,c,o)}var d=c.child;if(d!==null)d.return=c,he=d;else for(;he!==null;){c=he;var h=c.sibling,f=c.return;if(nN(c),c===u){he=null;break}if(h!==null){h.return=f,he=h;break}he=f}}}var p=o.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var x=m.sibling;m.sibling=null,m=x}while(m!==null)}}he=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,he=i;else e:for(;he!==null;){if(o=he,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Tc(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,he=g;break e}he=o.return}}var y=t.current;for(he=y;he!==null;){i=he;var v=i.child;if(i.subtreeFlags&2064&&v!==null)v.return=i,he=v;else e:for(i=y;he!==null;){if(a=he,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Zm(9,a)}}catch(w){At(a,a.return,w)}if(a===i){he=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,he=b;break e}he=a.return}}if(He=r,ki(),Ur&&typeof Ur.onPostCommitFiberRoot=="function")try{Ur.onPostCommitFiberRoot(Gm,t)}catch{}s=!0}return s}finally{nt=n,Ks.transition=e}}return!1}function oS(t,e,n){e=Yl(n,e),e=HE(t,e,1),t=ni(t,e,1),e=Kn(),t!==null&&(Td(t,1,e),ls(t,e))}function At(t,e,n){if(t.tag===3)oS(t,t,n);else for(;e!==null;){if(e.tag===3){oS(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(si===null||!si.has(s))){t=Yl(n,t),t=jE(e,t,1),e=ni(e,t,1),t=Kn(),e!==null&&(Td(e,1,t),ls(e,t));break}}e=e.return}}function Q4(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=Kn(),t.pingedLanes|=t.suspendedLanes&n,hn===t&&(bn&n)===n&&(rn===4||rn===3&&(bn&130023424)===bn&&500>zt()-sb?aa(t,0):nb|=n),ls(t,e)}function hN(t,e){e===0&&(t.mode&1?(e=uf,uf<<=1,!(uf&130023424)&&(uf=4194304)):e=1);var n=Kn();t=$o(t,e),t!==null&&(Td(t,e,n),ls(t,n))}function Z4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),hN(t,n)}function J4(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(re(314))}s!==null&&s.delete(e),hN(t,n)}var fN;fN=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||is.current)ss=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ss=!1,B4(t,e,n);ss=!!(t.flags&131072)}else ss=!1,$t&&e.flags&1048576&&xE(e,Ep,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;tp(t,e),t=e.pendingProps;var r=jl(e,Mn.current);Pl(e,n),r=Y1(null,e,s,t,r,n);var o=Q1();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,as(s)?(o=!0,Ip(e)):o=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,H1(e),r.updater=Qm,e.stateNode=r,r._reactInternals=e,Fy(e,s,t,n),e=_y(null,e,s,!0,o,n)):(e.tag=0,$t&&o&&M1(e),Wn(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(tp(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=tB(s),t=lr(s,t),r){case 0:e=Py(null,e,s,t,n);break e;case 1:e=qk(null,e,s,t,n);break e;case 11:e=Kk(null,e,s,t,n);break e;case 14:e=Xk(null,e,s,lr(s.type,t),n);break e}throw Error(re(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:lr(s,r),Py(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:lr(s,r),qk(t,e,s,r,n);case 3:e:{if(YE(e),t===null)throw Error(re(387));s=e.pendingProps,o=e.memoizedState,r=o.element,$E(t,e),Ap(e,s,null,n);var i=e.memoizedState;if(s=i.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){r=Yl(Error(re(423)),e),e=Yk(t,e,s,n,r);break e}else if(s!==r){r=Yl(Error(re(424)),e),e=Yk(t,e,s,n,r);break e}else for(ys=ti(e.stateNode.containerInfo.firstChild),bs=e,$t=!0,dr=null,n=wE(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Kl(),s===r){e=ko(t,e,n);break e}Wn(t,e,s,n)}e=e.child}return e;case 5:return kE(e),t===null&&Ry(e),s=e.type,r=e.pendingProps,o=t!==null?t.memoizedProps:null,i=r.children,Sy(s,r)?i=null:o!==null&&Sy(s,o)&&(e.flags|=32),qE(t,e),Wn(t,e,i,n),e.child;case 6:return t===null&&Ry(e),null;case 13:return QE(t,e,n);case 4:return j1(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=Xl(e,null,s,n):Wn(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:lr(s,r),Kk(t,e,s,r,n);case 7:return Wn(t,e,e.pendingProps,n),e.child;case 8:return Wn(t,e,e.pendingProps.children,n),e.child;case 12:return Wn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,o=e.memoizedProps,i=r.value,pt(Np,s._currentValue),s._currentValue=i,o!==null)if($r(o.value,i)){if(o.children===r.children&&!is.current){e=ko(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){i=o.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(o.tag===1){l=vo(-1,n&-n),l.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Ay(o.return,n,e),a.lanes|=n;break}l=l.next}}else if(o.tag===10)i=o.type===e.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(re(341));i.lanes|=n,a=i.alternate,a!==null&&(a.lanes|=n),Ay(i,n,e),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===e){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}Wn(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Pl(e,n),r=Xs(r),s=s(r),e.flags|=1,Wn(t,e,s,n),e.child;case 14:return s=e.type,r=lr(s,e.pendingProps),r=lr(s.type,r),Xk(t,e,s,r,n);case 15:return KE(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:lr(s,r),tp(t,e),e.tag=1,as(s)?(t=!0,Ip(e)):t=!1,Pl(e,n),GE(e,s,r),Fy(e,s,r,n),_y(null,e,s,!0,t,n);case 19:return ZE(t,e,n);case 22:return XE(t,e,n)}throw Error(re(156,e.tag))};function pN(t,e){return VT(t,e)}function eB(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vs(t,e,n,s){return new eB(t,e,n,s)}function ab(t){return t=t.prototype,!(!t||!t.isReactComponent)}function tB(t){if(typeof t=="function")return ab(t)?1:0;if(t!=null){if(t=t.$$typeof,t===I1)return 11;if(t===T1)return 14}return 2}function oi(t,e){var n=t.alternate;return n===null?(n=Vs(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function rp(t,e,n,s,r,o){var i=2;if(s=t,typeof t=="function")ab(t)&&(i=1);else if(typeof t=="string")i=5;else e:switch(t){case ml:return la(n.children,r,o,e);case S1:i=8,r|=8;break;case sy:return t=Vs(12,n,e,r|2),t.elementType=sy,t.lanes=o,t;case ry:return t=Vs(13,n,e,r),t.elementType=ry,t.lanes=o,t;case oy:return t=Vs(19,n,e,r),t.elementType=oy,t.lanes=o,t;case kT:return eg(n,r,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case CT:i=10;break e;case $T:i=9;break e;case I1:i=11;break e;case T1:i=14;break e;case Vo:i=16,s=null;break e}throw Error(re(130,t==null?t:typeof t,""))}return e=Vs(i,n,e,r),e.elementType=t,e.type=s,e.lanes=o,e}function la(t,e,n,s){return t=Vs(7,t,s,e),t.lanes=n,t}function eg(t,e,n,s){return t=Vs(22,t,s,e),t.elementType=kT,t.lanes=n,t.stateNode={isHidden:!1},t}function yx(t,e,n){return t=Vs(6,t,null,e),t.lanes=n,t}function vx(t,e,n){return e=Vs(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function nB(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=J0(0),this.expirationTimes=J0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=J0(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function lb(t,e,n,s,r,o,i,a,l){return t=new nB(t,e,n,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Vs(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},H1(o),t}function sB(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pl,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function mN(t){if(!t)return fi;t=t._reactInternals;e:{if(Va(t)!==t||t.tag!==1)throw Error(re(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(as(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(re(171))}if(t.tag===1){var n=t.type;if(as(n))return mE(t,n,e)}return e}function gN(t,e,n,s,r,o,i,a,l){return t=lb(n,s,!0,t,r,o,i,a,l),t.context=mN(null),n=t.current,s=Kn(),r=ri(n),o=vo(s,r),o.callback=e??null,ni(n,o,r),t.current.lanes=r,Td(t,r,s),ls(t,s),t}function tg(t,e,n,s){var r=e.current,o=Kn(),i=ri(r);return n=mN(n),e.context===null?e.context=n:e.pendingContext=n,e=vo(o,i),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=ni(r,e,i),t!==null&&(vr(t,r,i,o),Zf(t,r,i)),i}function zp(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function iS(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ub(t,e){iS(t,e),(t=t.alternate)&&iS(t,e)}function rB(){return null}var xN=typeof reportError=="function"?reportError:function(t){console.error(t)};function cb(t){this._internalRoot=t}ng.prototype.render=cb.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(re(409));tg(t,e,null,null)};ng.prototype.unmount=cb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;va(function(){tg(null,t,null,null)}),e[Co]=null}};function ng(t){this._internalRoot=t}ng.prototype.unstable_scheduleHydration=function(t){if(t){var e=XT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Go.length&&e!==0&&e<Go[n].priority;n++);Go.splice(n,0,t),n===0&&YT(t)}};function db(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function sg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function aS(){}function oB(t,e,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=zp(i);o.call(u)}}var i=gN(e,s,t,0,null,!1,!1,"",aS);return t._reactRootContainer=i,t[Co]=i.current,Zc(t.nodeType===8?t.parentNode:t),va(),i}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var u=zp(l);a.call(u)}}var l=lb(t,0,!1,null,null,!1,!1,"",aS);return t._reactRootContainer=l,t[Co]=l.current,Zc(t.nodeType===8?t.parentNode:t),va(function(){tg(e,l,n,s)}),l}function rg(t,e,n,s,r){var o=n._reactRootContainer;if(o){var i=o;if(typeof r=="function"){var a=r;r=function(){var l=zp(i);a.call(l)}}tg(e,i,t,r)}else i=oB(n,e,t,r,s);return zp(i)}jT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=lc(e.pendingLanes);n!==0&&(R1(e,n|1),ls(e,zt()),!(He&6)&&(Ql=zt()+500,ki()))}break;case 13:va(function(){var s=$o(t,1);if(s!==null){var r=Kn();vr(s,t,1,r)}}),ub(t,1)}};A1=function(t){if(t.tag===13){var e=$o(t,134217728);if(e!==null){var n=Kn();vr(e,t,134217728,n)}ub(t,134217728)}};KT=function(t){if(t.tag===13){var e=ri(t),n=$o(t,e);if(n!==null){var s=Kn();vr(n,t,e,s)}ub(t,e)}};XT=function(){return nt};qT=function(t,e){var n=nt;try{return nt=t,e()}finally{nt=n}};my=function(t,e,n){switch(e){case"input":if(ly(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=Xm(s);if(!r)throw Error(re(90));IT(s),ly(s,r)}}}break;case"textarea":ET(t,n);break;case"select":e=n.value,e!=null&&Al(t,!!n.multiple,e,!1)}};PT=rb;_T=va;var iB={usingClientEntryPoint:!1,Events:[Nd,vl,Xm,FT,OT,rb]},qu={findFiberByHostInstance:Yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},aB={bundleType:qu.bundleType,version:qu.version,rendererPackageName:qu.rendererPackageName,rendererConfig:qu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:No.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=zT(t),t===null?null:t.stateNode},findFiberByHostInstance:qu.findFiberByHostInstance||rB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bf.isDisabled&&bf.supportsFiber)try{Gm=bf.inject(aB),Ur=bf}catch{}}ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iB;ks.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!db(e))throw Error(re(200));return sB(t,e,null,n)};ks.createRoot=function(t,e){if(!db(t))throw Error(re(299));var n=!1,s="",r=xN;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=lb(t,1,!1,null,null,n,!1,s,r),t[Co]=e.current,Zc(t.nodeType===8?t.parentNode:t),new cb(e)};ks.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(re(188)):(t=Object.keys(t).join(","),Error(re(268,t)));return t=zT(e),t=t===null?null:t.stateNode,t};ks.flushSync=function(t){return va(t)};ks.hydrate=function(t,e,n){if(!sg(e))throw Error(re(200));return rg(null,t,e,!0,n)};ks.hydrateRoot=function(t,e,n){if(!db(t))throw Error(re(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",i=xN;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),e=gN(e,null,t,1,n??null,r,!1,o,i),t[Co]=e.current,Zc(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new ng(e)};ks.render=function(t,e,n){if(!sg(e))throw Error(re(200));return rg(null,t,e,!1,n)};ks.unmountComponentAtNode=function(t){if(!sg(t))throw Error(re(40));return t._reactRootContainer?(va(function(){rg(null,null,t,!1,function(){t._reactRootContainer=null,t[Co]=null})}),!0):!1};ks.unstable_batchedUpdates=rb;ks.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!sg(n))throw Error(re(200));if(t==null||t._reactInternals===void 0)throw Error(re(38));return rg(t,e,n,!1,s)};ks.version="18.3.1-next-f1338f8080-20240426";function yN(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yN)}catch(t){console.error(t)}}yN(),yT.exports=ks;var vN=yT.exports;const lB=Wm(vN);var lS=vN;ty.createRoot=lS.createRoot,ty.hydrateRoot=lS.hydrateRoot;var bN={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var o="",i=0;i<arguments.length;i++){var a=arguments[i];a&&(o=r(o,s(a)))}return o}function s(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return n.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var i="";for(var a in o)e.call(o,a)&&o[a]&&(i=r(i,a));return i}function r(o,i){return i?o?o+" "+i:o+i:o}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(bN);var uB=bN.exports;const Yu=Wm(uB);var hb=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},V=(t,e,n)=>(hb(t,e,"read from private field"),n?n.call(t):e.get(t)),Re=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},cn=(t,e,n,s)=>(hb(t,e,"write to private field"),e.set(t,n),n),cB=(t,e,n,s)=>({set _(r){cn(t,e,r)},get _(){return V(t,e,s)}}),Le=(t,e,n)=>(hb(t,e,"access private method"),n),We=new Uint8Array(8),Zr=new DataView(We.buffer),Fs=t=>[(t%256+256)%256],ut=t=>(Zr.setUint16(0,t,!1),[We[0],We[1]]),dB=t=>(Zr.setInt16(0,t,!1),[We[0],We[1]]),wN=t=>(Zr.setUint32(0,t,!1),[We[1],We[2],We[3]]),de=t=>(Zr.setUint32(0,t,!1),[We[0],We[1],We[2],We[3]]),hB=t=>(Zr.setInt32(0,t,!1),[We[0],We[1],We[2],We[3]]),ba=t=>(Zr.setUint32(0,Math.floor(t/2**32),!1),Zr.setUint32(4,t,!1),[We[0],We[1],We[2],We[3],We[4],We[5],We[6],We[7]]),fb=t=>(Zr.setInt16(0,2**8*t,!1),[We[0],We[1]]),_r=t=>(Zr.setInt32(0,2**16*t,!1),[We[0],We[1],We[2],We[3]]),bx=t=>(Zr.setInt32(0,2**30*t,!1),[We[0],We[1],We[2],We[3]]),ur=(t,e=!1)=>{let n=Array(t.length).fill(null).map((s,r)=>t.charCodeAt(r));return e&&n.push(0),n},Bp=t=>t&&t[t.length-1],pb=t=>{let e;for(let n of t)(!e||n.presentationTimestamp>e.presentationTimestamp)&&(e=n);return e},Hr=(t,e,n=!0)=>{let s=t*e;return n?Math.round(s):s},CN=t=>{let e=t*(Math.PI/180),n=Math.cos(e),s=Math.sin(e);return[n,s,0,-s,n,0,0,0,1]},$N=CN(0),kN=t=>[_r(t[0]),_r(t[1]),bx(t[2]),_r(t[3]),_r(t[4]),bx(t[5]),_r(t[6]),_r(t[7]),bx(t[8])],Rc=t=>!t||typeof t!="object"?t:Array.isArray(t)?t.map(Rc):Object.fromEntries(Object.entries(t).map(([e,n])=>[e,Rc(n)])),Zl=t=>t>=0&&t<2**32,Zt=(t,e,n)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:n}),It=(t,e,n,s,r)=>Zt(t,[Fs(e),wN(n),s??[]],r),fB=t=>{let e=512;return t.fragmented?Zt("ftyp",[ur("iso5"),de(e),ur("iso5"),ur("iso6"),ur("mp41")]):Zt("ftyp",[ur("isom"),de(e),ur("isom"),t.holdsAvc?ur("avc1"):[],ur("mp41")])},Xy=t=>({type:"mdat",largeSize:t}),pB=t=>({type:"free",size:t}),op=(t,e,n=!1)=>Zt("moov",null,[mB(e,t),...t.map(s=>gB(s,e)),n?UB(t):null]),mB=(t,e)=>{let n=Hr(Math.max(0,...e.filter(i=>i.samples.length>0).map(i=>{const a=pb(i.samples);return a.presentationTimestamp+a.duration})),Qy),s=Math.max(...e.map(i=>i.id))+1,r=!Zl(t)||!Zl(n),o=r?ba:de;return It("mvhd",+r,0,[o(t),o(t),de(Qy),o(n),_r(1),fb(1),Array(10).fill(0),kN($N),Array(24).fill(0),de(s)])},gB=(t,e)=>Zt("trak",null,[xB(t,e),yB(t,e)]),xB=(t,e)=>{let n=pb(t.samples),s=Hr(n?n.presentationTimestamp+n.duration:0,Qy),r=!Zl(e)||!Zl(s),o=r?ba:de,i;return t.info.type==="video"?i=typeof t.info.rotation=="number"?CN(t.info.rotation):t.info.rotation:i=$N,It("tkhd",+r,3,[o(e),o(e),de(t.id),de(0),o(s),Array(8).fill(0),ut(0),ut(0),fb(t.info.type==="audio"?1:0),ut(0),kN(i),_r(t.info.type==="video"?t.info.width:0),_r(t.info.type==="video"?t.info.height:0)])},yB=(t,e)=>Zt("mdia",null,[vB(t,e),bB(t.info.type==="video"?"vide":"soun"),wB(t)]),vB=(t,e)=>{let n=pb(t.samples),s=Hr(n?n.presentationTimestamp+n.duration:0,t.timescale),r=!Zl(e)||!Zl(s),o=r?ba:de;return It("mdhd",+r,0,[o(e),o(e),de(t.timescale),o(s),ut(21956),ut(0)])},bB=t=>It("hdlr",0,0,[ur("mhlr"),ur(t),de(0),de(0),de(0),ur("mp4-muxer-hdlr",!0)]),wB=t=>Zt("minf",null,[t.info.type==="video"?CB():$B(),kB(),TB(t)]),CB=()=>It("vmhd",0,1,[ut(0),ut(0),ut(0),ut(0)]),$B=()=>It("smhd",0,0,[ut(0),ut(0)]),kB=()=>Zt("dinf",null,[SB()]),SB=()=>It("dref",0,0,[de(1)],[IB()]),IB=()=>It("url ",0,1),TB=t=>{const e=t.compositionTimeOffsetTable.length>1||t.compositionTimeOffsetTable.some(n=>n.sampleCompositionTimeOffset!==0);return Zt("stbl",null,[EB(t),LB(t),MB(t),zB(t),BB(t),VB(t),e?WB(t):null])},EB=t=>It("stsd",0,0,[de(1)],[t.info.type==="video"?NB(JB[t.info.codec],t):OB(tV[t.info.codec],t)]),NB=(t,e)=>Zt(t,[Array(6).fill(0),ut(1),ut(0),ut(0),Array(12).fill(0),ut(e.info.width),ut(e.info.height),de(4718592),de(4718592),de(0),ut(1),Array(32).fill(0),ut(24),dB(65535)],[eV[e.info.codec](e)]),RB=t=>t.codecPrivate&&Zt("avcC",[...t.codecPrivate]),AB=t=>t.codecPrivate&&Zt("hvcC",[...t.codecPrivate]),DB=t=>t.codecPrivate&&Zt("vpcC",[...t.codecPrivate]),FB=t=>t.codecPrivate&&Zt("av1C",[...t.codecPrivate]),OB=(t,e)=>Zt(t,[Array(6).fill(0),ut(1),ut(0),ut(0),de(0),ut(e.info.numberOfChannels),ut(16),ut(0),ut(0),_r(e.info.sampleRate)],[nV[e.info.codec](e)]),PB=t=>It("esds",0,0,[de(58753152),Fs(32+t.codecPrivate.byteLength),ut(1),Fs(0),de(75530368),Fs(18+t.codecPrivate.byteLength),Fs(64),Fs(21),wN(0),de(130071),de(130071),de(92307584),Fs(t.codecPrivate.byteLength),...t.codecPrivate,de(109084800),Fs(1),Fs(2)]),_B=t=>Zt("dOps",[Fs(0),Fs(t.info.numberOfChannels),ut(3840),de(t.info.sampleRate),fb(0),Fs(0)]),LB=t=>It("stts",0,0,[de(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[de(e.sampleCount),de(e.sampleDelta)])]),MB=t=>{if(t.samples.every(n=>n.type==="key"))return null;let e=[...t.samples.entries()].filter(([,n])=>n.type==="key");return It("stss",0,0,[de(e.length),e.map(([n])=>de(n+1))])},zB=t=>It("stsc",0,0,[de(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[de(e.firstChunk),de(e.samplesPerChunk),de(1)])]),BB=t=>It("stsz",0,0,[de(0),de(t.samples.length),t.samples.map(e=>de(e.size))]),VB=t=>t.finalizedChunks.length>0&&Bp(t.finalizedChunks).offset>=2**32?It("co64",0,0,[de(t.finalizedChunks.length),t.finalizedChunks.map(e=>ba(e.offset))]):It("stco",0,0,[de(t.finalizedChunks.length),t.finalizedChunks.map(e=>de(e.offset))]),WB=t=>It("ctts",0,0,[de(t.compositionTimeOffsetTable.length),t.compositionTimeOffsetTable.map(e=>[de(e.sampleCount),de(e.sampleCompositionTimeOffset)])]),UB=t=>Zt("mvex",null,t.map(GB)),GB=t=>It("trex",0,0,[de(t.id),de(1),de(0),de(0),de(0)]),uS=(t,e)=>Zt("moof",null,[HB(t),...e.map(jB)]),HB=t=>It("mfhd",0,0,[de(t)]),SN=t=>{let e=0,n=0,s=0,r=0,o=t.type==="delta";return n|=+o,o?e|=1:e|=2,e<<24|n<<16|s<<8|r},jB=t=>Zt("traf",null,[KB(t),XB(t),qB(t)]),KB=t=>{let e=0;e|=8,e|=16,e|=32,e|=131072;let n=t.currentChunk.samples[1]??t.currentChunk.samples[0],s={duration:n.timescaleUnitsToNextSample,size:n.size,flags:SN(n)};return It("tfhd",0,e,[de(t.id),de(s.duration),de(s.size),de(s.flags)])},XB=t=>It("tfdt",1,0,[ba(Hr(t.currentChunk.startTimestamp,t.timescale))]),qB=t=>{let e=t.currentChunk.samples.map(m=>m.timescaleUnitsToNextSample),n=t.currentChunk.samples.map(m=>m.size),s=t.currentChunk.samples.map(SN),r=t.currentChunk.samples.map(m=>Hr(m.presentationTimestamp-m.decodeTimestamp,t.timescale)),o=new Set(e),i=new Set(n),a=new Set(s),l=new Set(r),u=a.size===2&&s[0]!==s[1],c=o.size>1,d=i.size>1,h=!u&&a.size>1,f=l.size>1||[...l].some(m=>m!==0),p=0;return p|=1,p|=4*+u,p|=256*+c,p|=512*+d,p|=1024*+h,p|=2048*+f,It("trun",1,p,[de(t.currentChunk.samples.length),de(t.currentChunk.offset-t.currentChunk.moofOffset||0),u?de(s[0]):[],t.currentChunk.samples.map((m,x)=>[c?de(e[x]):[],d?de(n[x]):[],h?de(s[x]):[],f?hB(r[x]):[]])])},YB=t=>Zt("mfra",null,[...t.map(QB),ZB()]),QB=(t,e)=>It("tfra",1,0,[de(t.id),de(63),de(t.finalizedChunks.length),t.finalizedChunks.map(s=>[ba(Hr(s.startTimestamp,t.timescale)),ba(s.moofOffset),de(e+1),de(1),de(1)])]),ZB=()=>It("mfro",0,0,[de(0)]),JB={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},eV={avc:RB,hevc:AB,vp9:DB,av1:FB},tV={aac:"mp4a",opus:"Opus"},nV={aac:PB,opus:_B},sV=class{constructor(){this.buffer=null}},IN=class{constructor(t){this.options=t}},TN=class{constructor(t,e){this.stream=t,this.options=e}},Vi,ul,mb=class{constructor(){this.pos=0,Re(this,Vi,new Uint8Array(8)),Re(this,ul,new DataView(V(this,Vi).buffer)),this.offsets=new WeakMap}seek(t){this.pos=t}writeU32(t){V(this,ul).setUint32(0,t,!1),this.write(V(this,Vi).subarray(0,4))}writeU64(t){V(this,ul).setUint32(0,Math.floor(t/2**32),!1),V(this,ul).setUint32(4,t,!1),this.write(V(this,Vi).subarray(0,8))}writeAscii(t){for(let e=0;e<t.length;e++)V(this,ul).setUint8(e%8,t.charCodeAt(e)),e%8===7&&this.write(V(this,Vi));t.length%8!==0&&this.write(V(this,Vi).subarray(0,t.length%8))}writeBox(t){if(this.offsets.set(t,this.pos),t.contents&&!t.children)this.writeBoxHeader(t,t.size??t.contents.byteLength+8),this.write(t.contents);else{let e=this.pos;if(this.writeBoxHeader(t,0),t.contents&&this.write(t.contents),t.children)for(let r of t.children)r&&this.writeBox(r);let n=this.pos,s=t.size??n-e;this.seek(e),this.writeBoxHeader(t,s),this.seek(n)}}writeBoxHeader(t,e){this.writeU32(t.largeSize?1:e),this.writeAscii(t.type),t.largeSize&&this.writeU64(e)}measureBoxHeader(t){return 8+(t.largeSize?8:0)}patchBox(t){let e=this.pos;this.seek(this.offsets.get(t)),this.writeBox(t),this.seek(e)}measureBox(t){if(t.contents&&!t.children)return this.measureBoxHeader(t)+t.contents.byteLength;{let e=this.measureBoxHeader(t);if(t.contents&&(e+=t.contents.byteLength),t.children)for(let n of t.children)n&&(e+=this.measureBox(n));return e}}};Vi=new WeakMap;ul=new WeakMap;var ip,ua,ad,cc,ap,qy,rV=class extends mb{constructor(t){super(),Re(this,ap),Re(this,ip,void 0),Re(this,ua,new ArrayBuffer(2**16)),Re(this,ad,new Uint8Array(V(this,ua))),Re(this,cc,0),cn(this,ip,t)}write(t){Le(this,ap,qy).call(this,this.pos+t.byteLength),V(this,ad).set(t,this.pos),this.pos+=t.byteLength,cn(this,cc,Math.max(V(this,cc),this.pos))}finalize(){Le(this,ap,qy).call(this,this.pos),V(this,ip).buffer=V(this,ua).slice(0,Math.max(V(this,cc),this.pos))}};ip=new WeakMap;ua=new WeakMap;ad=new WeakMap;cc=new WeakMap;ap=new WeakSet;qy=function(t){let e=V(this,ua).byteLength;for(;e<t;)e*=2;if(e===V(this,ua).byteLength)return;let n=new ArrayBuffer(e),s=new Uint8Array(n);s.set(V(this,ad),0),cn(this,ua,n),cn(this,ad,s)};var lp,Wi,EN=class extends mb{constructor(t){super(),Re(this,lp,void 0),Re(this,Wi,[]),cn(this,lp,t)}write(t){V(this,Wi).push({data:t.slice(),start:this.pos}),this.pos+=t.byteLength}flush(){var n,s;if(V(this,Wi).length===0)return;let t=[],e=[...V(this,Wi)].sort((r,o)=>r.start-o.start);t.push({start:e[0].start,size:e[0].data.byteLength});for(let r=1;r<e.length;r++){let o=t[t.length-1],i=e[r];i.start<=o.start+o.size?o.size=Math.max(o.size,i.start+i.data.byteLength-o.start):t.push({start:i.start,size:i.data.byteLength})}for(let r of t){r.data=new Uint8Array(r.size);for(let o of V(this,Wi))r.start<=o.start&&o.start<r.start+r.size&&r.data.set(o.data,o.start-r.start);(s=(n=V(this,lp).options).onData)==null||s.call(n,r.data,r.start)}V(this,Wi).length=0}finalize(){}};lp=new WeakMap;Wi=new WeakMap;var oV=2**24,iV=2,Vp,mr,gs,Wp,Yy,gb,NN,xb,RN,Ac,Up,AN=class extends mb{constructor(t){var e;if(super(),Re(this,Wp),Re(this,gb),Re(this,xb),Re(this,Ac),Re(this,Vp,void 0),Re(this,mr,void 0),Re(this,gs,[]),cn(this,Vp,t),cn(this,mr,((e=t.options)==null?void 0:e.chunkSize)??oV),!Number.isInteger(V(this,mr))||V(this,mr)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(t){Le(this,Wp,Yy).call(this,t,this.pos),Le(this,Ac,Up).call(this),this.pos+=t.byteLength}finalize(){Le(this,Ac,Up).call(this,!0)}};Vp=new WeakMap;mr=new WeakMap;gs=new WeakMap;Wp=new WeakSet;Yy=function(t,e){let n=V(this,gs).findIndex(a=>a.start<=e&&e<a.start+V(this,mr));n===-1&&(n=Le(this,xb,RN).call(this,e));let s=V(this,gs)[n],r=e-s.start,o=t.subarray(0,Math.min(V(this,mr)-r,t.byteLength));s.data.set(o,r);let i={start:r,end:r+o.byteLength};if(Le(this,gb,NN).call(this,s,i),s.written[0].start===0&&s.written[0].end===V(this,mr)&&(s.shouldFlush=!0),V(this,gs).length>iV){for(let a=0;a<V(this,gs).length-1;a++)V(this,gs)[a].shouldFlush=!0;Le(this,Ac,Up).call(this)}o.byteLength<t.byteLength&&Le(this,Wp,Yy).call(this,t.subarray(o.byteLength),e+o.byteLength)};gb=new WeakSet;NN=function(t,e){let n=0,s=t.written.length-1,r=-1;for(;n<=s;){let o=Math.floor(n+(s-n+1)/2);t.written[o].start<=e.start?(n=o+1,r=o):s=o-1}for(t.written.splice(r+1,0,e),(r===-1||t.written[r].end<e.start)&&r++;r<t.written.length-1&&t.written[r].end>=t.written[r+1].start;)t.written[r].end=Math.max(t.written[r].end,t.written[r+1].end),t.written.splice(r+1,1)};xb=new WeakSet;RN=function(t){let n={start:Math.floor(t/V(this,mr))*V(this,mr),data:new Uint8Array(V(this,mr)),written:[],shouldFlush:!1};return V(this,gs).push(n),V(this,gs).sort((s,r)=>s.start-r.start),V(this,gs).indexOf(n)};Ac=new WeakSet;Up=function(t=!1){var e,n;for(let s=0;s<V(this,gs).length;s++){let r=V(this,gs)[s];if(!(!r.shouldFlush&&!t)){for(let o of r.written)(n=(e=V(this,Vp).options).onData)==null||n.call(e,r.data.subarray(o.start,o.end),r.start+o.start);V(this,gs).splice(s--,1)}}};var aV=class extends AN{constructor(t){var e;super(new IN({onData:(n,s)=>t.stream.write({type:"write",data:n,position:s}),chunkSize:(e=t.options)==null?void 0:e.chunkSize}))}},Qy=1e3,lV=["avc","hevc","vp9","av1"],uV=["aac","opus"],cV=2082844800,dV=["strict","offset","cross-track-offset"],Ce,ke,Gp,ps,yn,vn,Il,Ll,yb,Ui,Gi,Dc,Zy,DN,Jy,FN,vb,ON,ev,PN,bb,_N,up,tv,Ar,lo,wb,LN,Fc,Hp,jp,Cb,Jl,Ad,cp,nv,hV=class{constructor(t){var e;if(Re(this,Zy),Re(this,Jy),Re(this,vb),Re(this,ev),Re(this,bb),Re(this,up),Re(this,Ar),Re(this,wb),Re(this,Fc),Re(this,jp),Re(this,Jl),Re(this,cp),Re(this,Ce,void 0),Re(this,ke,void 0),Re(this,Gp,void 0),Re(this,ps,void 0),Re(this,yn,null),Re(this,vn,null),Re(this,Il,Math.floor(Date.now()/1e3)+cV),Re(this,Ll,[]),Re(this,yb,1),Re(this,Ui,[]),Re(this,Gi,[]),Re(this,Dc,!1),Le(this,Zy,DN).call(this,t),t.video=Rc(t.video),t.audio=Rc(t.audio),t.fastStart=Rc(t.fastStart),this.target=t.target,cn(this,Ce,{firstTimestampBehavior:"strict",...t}),t.target instanceof sV)cn(this,ke,new rV(t.target));else if(t.target instanceof IN)cn(this,ke,(e=t.target.options)!=null&&e.chunked?new AN(t.target):new EN(t.target));else if(t.target instanceof TN)cn(this,ke,new aV(t.target));else throw new Error(`Invalid target: ${t.target}`);Le(this,ev,PN).call(this),Le(this,Jy,FN).call(this)}addVideoChunk(t,e,n,s){let r=new Uint8Array(t.byteLength);t.copyTo(r),this.addVideoChunkRaw(r,t.type,n??t.timestamp,t.duration,e,s)}addVideoChunkRaw(t,e,n,s,r,o){if(Le(this,cp,nv).call(this),!V(this,Ce).video)throw new Error("No video track declared.");if(typeof V(this,Ce).fastStart=="object"&&V(this,yn).samples.length===V(this,Ce).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${V(this,Ce).fastStart.expectedVideoChunks}).`);let i=Le(this,up,tv).call(this,V(this,yn),t,e,n,s,r,o);if(V(this,Ce).fastStart==="fragmented"&&V(this,vn)){for(;V(this,Gi).length>0&&V(this,Gi)[0].decodeTimestamp<=i.decodeTimestamp;){let a=V(this,Gi).shift();Le(this,Ar,lo).call(this,V(this,vn),a)}i.decodeTimestamp<=V(this,vn).lastDecodeTimestamp?Le(this,Ar,lo).call(this,V(this,yn),i):V(this,Ui).push(i)}else Le(this,Ar,lo).call(this,V(this,yn),i)}addAudioChunk(t,e,n){let s=new Uint8Array(t.byteLength);t.copyTo(s),this.addAudioChunkRaw(s,t.type,n??t.timestamp,t.duration,e)}addAudioChunkRaw(t,e,n,s,r){if(Le(this,cp,nv).call(this),!V(this,Ce).audio)throw new Error("No audio track declared.");if(typeof V(this,Ce).fastStart=="object"&&V(this,vn).samples.length===V(this,Ce).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${V(this,Ce).fastStart.expectedAudioChunks}).`);let o=Le(this,up,tv).call(this,V(this,vn),t,e,n,s,r);if(V(this,Ce).fastStart==="fragmented"&&V(this,yn)){for(;V(this,Ui).length>0&&V(this,Ui)[0].decodeTimestamp<=o.decodeTimestamp;){let i=V(this,Ui).shift();Le(this,Ar,lo).call(this,V(this,yn),i)}o.decodeTimestamp<=V(this,yn).lastDecodeTimestamp?Le(this,Ar,lo).call(this,V(this,vn),o):V(this,Gi).push(o)}else Le(this,Ar,lo).call(this,V(this,vn),o)}finalize(){if(V(this,Dc))throw new Error("Cannot finalize a muxer more than once.");if(V(this,Ce).fastStart==="fragmented"){for(let e of V(this,Ui))Le(this,Ar,lo).call(this,V(this,yn),e);for(let e of V(this,Gi))Le(this,Ar,lo).call(this,V(this,vn),e);Le(this,jp,Cb).call(this,!1)}else V(this,yn)&&Le(this,Fc,Hp).call(this,V(this,yn)),V(this,vn)&&Le(this,Fc,Hp).call(this,V(this,vn));let t=[V(this,yn),V(this,vn)].filter(Boolean);if(V(this,Ce).fastStart==="in-memory"){let e;for(let s=0;s<2;s++){let r=op(t,V(this,Il)),o=V(this,ke).measureBox(r);e=V(this,ke).measureBox(V(this,ps));let i=V(this,ke).pos+o+e;for(let a of V(this,Ll)){a.offset=i;for(let{data:l}of a.samples)i+=l.byteLength,e+=l.byteLength}if(i<2**32)break;e>=2**32&&(V(this,ps).largeSize=!0)}let n=op(t,V(this,Il));V(this,ke).writeBox(n),V(this,ps).size=e,V(this,ke).writeBox(V(this,ps));for(let s of V(this,Ll))for(let r of s.samples)V(this,ke).write(r.data),r.data=null}else if(V(this,Ce).fastStart==="fragmented"){let e=V(this,ke).pos,n=YB(t);V(this,ke).writeBox(n);let s=V(this,ke).pos-e;V(this,ke).seek(V(this,ke).pos-4),V(this,ke).writeU32(s)}else{let e=V(this,ke).offsets.get(V(this,ps)),n=V(this,ke).pos-e;V(this,ps).size=n,V(this,ps).largeSize=n>=2**32,V(this,ke).patchBox(V(this,ps));let s=op(t,V(this,Il));if(typeof V(this,Ce).fastStart=="object"){V(this,ke).seek(V(this,Gp)),V(this,ke).writeBox(s);let r=e-V(this,ke).pos;V(this,ke).writeBox(pB(r))}else V(this,ke).writeBox(s)}Le(this,Jl,Ad).call(this),V(this,ke).finalize(),cn(this,Dc,!0)}};Ce=new WeakMap;ke=new WeakMap;Gp=new WeakMap;ps=new WeakMap;yn=new WeakMap;vn=new WeakMap;Il=new WeakMap;Ll=new WeakMap;yb=new WeakMap;Ui=new WeakMap;Gi=new WeakMap;Dc=new WeakMap;Zy=new WeakSet;DN=function(t){if(t.video){if(!lV.includes(t.video.codec))throw new Error(`Unsupported video codec: ${t.video.codec}`);const e=t.video.rotation;if(typeof e=="number"&&![0,90,180,270].includes(e))throw new Error(`Invalid video rotation: ${e}. Has to be 0, 90, 180 or 270.`);if(Array.isArray(e)&&(e.length!==9||e.some(n=>typeof n!="number")))throw new Error(`Invalid video transformation matrix: ${e.join()}`)}if(t.audio&&!uV.includes(t.audio.codec))throw new Error(`Unsupported audio codec: ${t.audio.codec}`);if(t.firstTimestampBehavior&&!dV.includes(t.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`);if(typeof t.fastStart=="object"){if(t.video&&t.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(t.audio&&t.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory","fragmented"].includes(t.fastStart))throw new Error("'fastStart' option must be false, 'in-memory', 'fragmented' or an object.")};Jy=new WeakSet;FN=function(){var t;if(V(this,ke).writeBox(fB({holdsAvc:((t=V(this,Ce).video)==null?void 0:t.codec)==="avc",fragmented:V(this,Ce).fastStart==="fragmented"})),cn(this,Gp,V(this,ke).pos),V(this,Ce).fastStart==="in-memory")cn(this,ps,Xy(!1));else if(V(this,Ce).fastStart!=="fragmented"){if(typeof V(this,Ce).fastStart=="object"){let e=Le(this,vb,ON).call(this);V(this,ke).seek(V(this,ke).pos+e)}cn(this,ps,Xy(!0)),V(this,ke).writeBox(V(this,ps))}Le(this,Jl,Ad).call(this)};vb=new WeakSet;ON=function(){if(typeof V(this,Ce).fastStart!="object")return;let t=0,e=[V(this,Ce).fastStart.expectedVideoChunks,V(this,Ce).fastStart.expectedAudioChunks];for(let n of e)n&&(t+=8*Math.ceil(2/3*n),t+=4*n,t+=12*Math.ceil(2/3*n),t+=4*n,t+=8*n);return t+=4096,t};ev=new WeakSet;PN=function(){if(V(this,Ce).video&&cn(this,yn,{id:1,info:{type:"video",codec:V(this,Ce).video.codec,width:V(this,Ce).video.width,height:V(this,Ce).video.height,rotation:V(this,Ce).video.rotation??0},timescale:11520,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),V(this,Ce).audio){let t=Le(this,bb,_N).call(this,2,V(this,Ce).audio.sampleRate,V(this,Ce).audio.numberOfChannels);cn(this,vn,{id:V(this,Ce).video?2:1,info:{type:"audio",codec:V(this,Ce).audio.codec,numberOfChannels:V(this,Ce).audio.numberOfChannels,sampleRate:V(this,Ce).audio.sampleRate},timescale:V(this,Ce).audio.sampleRate,codecPrivate:t,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]})}};bb=new WeakSet;_N=function(t,e,n){let r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),o=n,i="";i+=t.toString(2).padStart(5,"0"),i+=r.toString(2).padStart(4,"0"),r===15&&(i+=e.toString(2).padStart(24,"0")),i+=o.toString(2).padStart(4,"0");let a=Math.ceil(i.length/8)*8;i=i.padEnd(a,"0");let l=new Uint8Array(i.length/8);for(let u=0;u<i.length;u+=8)l[u/8]=parseInt(i.slice(u,u+8),2);return l};up=new WeakSet;tv=function(t,e,n,s,r,o,i){var h;let a=s/1e6,l=(s-(i??0))/1e6,u=r/1e6,c=Le(this,wb,LN).call(this,a,l,t);return a=c.presentationTimestamp,l=c.decodeTimestamp,(h=o==null?void 0:o.decoderConfig)!=null&&h.description&&(t.codecPrivate=new Uint8Array(o.decoderConfig.description)),{presentationTimestamp:a,decodeTimestamp:l,duration:u,data:e,size:e.byteLength,type:n,timescaleUnitsToNextSample:Hr(u,t.timescale)}};Ar=new WeakSet;lo=function(t,e){V(this,Ce).fastStart!=="fragmented"&&t.samples.push(e);const n=Hr(e.presentationTimestamp-e.decodeTimestamp,t.timescale);if(t.lastTimescaleUnits!==null){let r=Hr(e.decodeTimestamp,t.timescale,!1),o=Math.round(r-t.lastTimescaleUnits);if(t.lastTimescaleUnits+=o,t.lastSample.timescaleUnitsToNextSample=o,V(this,Ce).fastStart!=="fragmented"){let i=Bp(t.timeToSampleTable);i.sampleCount===1?(i.sampleDelta=o,i.sampleCount++):i.sampleDelta===o?i.sampleCount++:(i.sampleCount--,t.timeToSampleTable.push({sampleCount:2,sampleDelta:o}));const a=Bp(t.compositionTimeOffsetTable);a.sampleCompositionTimeOffset===n?a.sampleCount++:t.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:n})}}else t.lastTimescaleUnits=0,V(this,Ce).fastStart!=="fragmented"&&(t.timeToSampleTable.push({sampleCount:1,sampleDelta:Hr(e.duration,t.timescale)}),t.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:n}));t.lastSample=e;let s=!1;if(!t.currentChunk)s=!0;else{let r=e.presentationTimestamp-t.currentChunk.startTimestamp;if(V(this,Ce).fastStart==="fragmented"){let o=V(this,yn)??V(this,vn);t===o&&e.type==="key"&&r>=1&&(s=!0,Le(this,jp,Cb).call(this))}else s=r>=.5}s&&(t.currentChunk&&Le(this,Fc,Hp).call(this,t),t.currentChunk={startTimestamp:e.presentationTimestamp,samples:[]}),t.currentChunk.samples.push(e)};wb=new WeakSet;LN=function(t,e,n){var i,a;const s=V(this,Ce).firstTimestampBehavior==="strict",r=n.lastDecodeTimestamp===-1;if(s&&r&&e!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received DTS=${e}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(V(this,Ce).firstTimestampBehavior==="offset"||V(this,Ce).firstTimestampBehavior==="cross-track-offset"){n.firstDecodeTimestamp===void 0&&(n.firstDecodeTimestamp=e);let l;V(this,Ce).firstTimestampBehavior==="offset"?l=n.firstDecodeTimestamp:l=Math.min(((i=V(this,yn))==null?void 0:i.firstDecodeTimestamp)??1/0,((a=V(this,vn))==null?void 0:a.firstDecodeTimestamp)??1/0),e-=l,t-=l}if(e<n.lastDecodeTimestamp)throw new Error(`Timestamps must be monotonically increasing (DTS went from ${n.lastDecodeTimestamp*1e6} to ${e*1e6}).`);return n.lastDecodeTimestamp=e,{presentationTimestamp:t,decodeTimestamp:e}};Fc=new WeakSet;Hp=function(t){if(V(this,Ce).fastStart==="fragmented")throw new Error("Can't finalize individual chunks 'fastStart' is set to 'fragmented'.");if(t.currentChunk){if(t.finalizedChunks.push(t.currentChunk),V(this,Ll).push(t.currentChunk),(t.compactlyCodedChunkTable.length===0||Bp(t.compactlyCodedChunkTable).samplesPerChunk!==t.currentChunk.samples.length)&&t.compactlyCodedChunkTable.push({firstChunk:t.finalizedChunks.length,samplesPerChunk:t.currentChunk.samples.length}),V(this,Ce).fastStart==="in-memory"){t.currentChunk.offset=0;return}t.currentChunk.offset=V(this,ke).pos;for(let e of t.currentChunk.samples)V(this,ke).write(e.data),e.data=null;Le(this,Jl,Ad).call(this)}};jp=new WeakSet;Cb=function(t=!0){if(V(this,Ce).fastStart!=="fragmented")throw new Error("Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.");let e=[V(this,yn),V(this,vn)].filter(a=>a&&a.currentChunk);if(e.length===0)return;let n=cB(this,yb)._++;if(n===1){let a=op(e,V(this,Il),!0);V(this,ke).writeBox(a)}let s=V(this,ke).pos,r=uS(n,e);V(this,ke).writeBox(r);{let a=Xy(!1),l=0;for(let c of e)for(let d of c.currentChunk.samples)l+=d.size;let u=V(this,ke).measureBox(a)+l;u>=2**32&&(a.largeSize=!0,u=V(this,ke).measureBox(a)+l),a.size=u,V(this,ke).writeBox(a)}for(let a of e){a.currentChunk.offset=V(this,ke).pos,a.currentChunk.moofOffset=s;for(let l of a.currentChunk.samples)V(this,ke).write(l.data),l.data=null}let o=V(this,ke).pos;V(this,ke).seek(V(this,ke).offsets.get(r));let i=uS(n,e);V(this,ke).writeBox(i),V(this,ke).seek(o);for(let a of e)a.finalizedChunks.push(a.currentChunk),V(this,Ll).push(a.currentChunk),a.currentChunk=null;t&&Le(this,Jl,Ad).call(this)};Jl=new WeakSet;Ad=function(){V(this,ke)instanceof EN&&V(this,ke).flush()};cp=new WeakSet;nv=function(){if(V(this,Dc))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fV=1e-7,pV=1e-4;class MN{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class $b{refCount(e){return es("refCount")}incRef(e){return es("incRef")}timerAvailable(){return!0}time(e){return es("time")}read(e){return es("read")}readSync(e){return es("readSync")}readToGPU(e,n){return es("readToGPU")}numDataIds(){return es("numDataIds")}disposeData(e,n){return es("disposeData")}write(e,n,s){return es("write")}move(e,n,s,r,o){return es("move")}createTensorFromGPUData(e,n,s){return es("createTensorFromGPUData")}memory(){return es("memory")}floatPrecision(){return es("floatPrecision")}epsilon(){return this.floatPrecision()===32?fV:pV}dispose(){return es("dispose")}}function es(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,cl(t,e,n)}function wa(t,e,n){return Math.max(t,Math.min(e,n))}function kb(t){return t%2===0?t:t+1}function cl(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function gV(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function I(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Sb(t,e,n=""){I(qe(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function zN(t){I(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Q(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function qe(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function eu(t){return t%1===0}function sv(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Ml(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function cS(t,e=r=>0,n,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(t()){r();return}i++;const l=e(i);if(n!=null&&i>=n){o();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function BN(t,e){let n=1,s=-1;for(let o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(t[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(t[o]<0)throw Error(`Shapes can not be < 0. Found ${t[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function De(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),I(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),I(t.every(s=>eu(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function Si(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:De(e,t).sort();let i=0;for(let a=0;a<t.length;++a){if(o!=null){if(o[i]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(o[i]==null||o[i]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),o[i]<=a&&i++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function Cn(t,e){return Dt(t,e)}function Dt(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function xV(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function yV(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function VN(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Kp(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function vV(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Dd(t){return typeof t=="string"||t instanceof String}function bV(t){return typeof t=="boolean"}function rv(t){return typeof t=="number"}function vu(t){return Array.isArray(t)?vu(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":rv(t)?"float32":Dd(t)?"string":bV(t)?"bool":"float32"}function ov(t){return!!(t&&t.constructor&&t.call&&t.apply)}function iv(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function ge(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function WN(t,e,n,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=n[t+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<o;l++)r[l]=WN(t+l*a,i,n,s)}return r}function br(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,o)=>r*o)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return WN(0,t,e,n)}function wV(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function Ib(t,e){const n=$n(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function $n(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function UN(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return br(t,new Float32Array(n));if(e==="int32")return br(t,new Int32Array(n));if(e==="bool")return br(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Ro(t){t.forEach(e=>{I(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function jr(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function bu(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function Tb(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dS="tfjsflags";class CV{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=$V,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Tb(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);dS in e&&e[dS].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=SV(r,o)})}}function $V(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(kV(e,s[0],s[1]),s.join("="))),e}function kV(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function SV(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function K(){return GN}let GN=null;function IV(t){GN=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wx;function HN(){if(wx==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");wx=t}return wx}function TV(){const t=HN();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Eb(t,e){const n=TV();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const og="Abs",Fd="Acos",Od="Acosh",wu="Add",Nb="AddN",Rb="All",Ab="Any",ig="ArgMax",ag="ArgMin",Pd="Asin",_d="Asinh",Ld="Atan",Md="Atanh",zd="Atan2",lg="AvgPool",Db="AvgPoolGrad",ug="AvgPool3D",Fb="AvgPool3DGrad",cg="BatchMatMul",dg="BatchToSpaceND",Ob="Bincount",Pb="BitwiseAnd",EV="BroadcastTo",jN="BroadcastArgs",Bd="Cast",Vd="Ceil",Wd="ClipByValue",_b="Complex",hg="ComplexAbs",fg="Concat",pg="Conv2D",Lb="Conv2DBackpropFilter",mg="Conv2DBackpropInput",gg="Conv3D",Mb="Conv3DBackpropFilterV2",zb="Conv3DBackpropInputV2",Ud="Cos",Gd="Cosh",Bb="Cumprod",xg="Cumsum",Vb="CropAndResize",Wb="DenseBincount",Ub="DepthToSpace",yg="DepthwiseConv2dNative",Gb="DepthwiseConv2dNativeBackpropFilter",Hb="DepthwiseConv2dNativeBackpropInput",KN="Diag",vg="Dilation2D",av="Dilation2DBackpropInput",lv="Dilation2DBackpropFilter",NV="Draw",Hd="RealDiv",jb="Einsum",jd="Elu",Kb="EluGrad",Kd="Erf",bg="Equal",Xd="Exp",wg="ExpandDims",qd="Expm1",Xb="FFT",qb="Fill",Yb="FlipLeftRight",Yd="Floor",Qd="FloorDiv",Cg="FusedBatchNorm",$g="GatherV2",XN="GatherNd",kg="Greater",Zd="GreaterEqual",Jd="Identity",Qb="IFFT",Zb="Imag",eh="IsFinite",th="IsInf",nh="IsNan",Sg="LeakyRelu",Ig="Less",Tg="LessEqual",qN="LinSpace",sh="Log",rh="Log1p",Eg="LogicalAnd",Ng="LogicalNot",Rg="LogicalOr",RV="LogSoftmax",Ag="LRN",Jb="LRNGrad",Dg="Max",oh="Maximum",Fg="MaxPool",ew="MaxPoolGrad",Og="MaxPool3D",tw="MaxPool3DGrad",YN="MaxPoolWithArgmax",Pg="Mean",_g="Min",ih="Minimum",Lg="MirrorPad",ah="Mod",QN="Multinomial",lh="Multiply",Mg="Neg",zg="NotEqual",nw="NonMaxSuppressionV3",sw="NonMaxSuppressionV4",rw="NonMaxSuppressionV5",Bg="OnesLike",Vg="OneHot",Wg="Pack",Ug="PadV2",uh="Pow",Gg="Prelu",Hg="Prod",ZN="RaggedGather",JN="RaggedRange",eR="RaggedTensorToTensor",ow="Range",iw="Real",ch="Reciprocal",dh="Relu",jg="Reshape",Kg="ResizeNearestNeighbor",aw="ResizeNearestNeighborGrad",Xg="ResizeBilinear",lw="ResizeBilinearGrad",hh="Relu6",qg="Reverse",fh="Round",ph="Rsqrt",tR="ScatterNd",nR="TensorScatterUpdate",sR="SearchSorted",Yg="Select",mh="Selu",Qg="Slice",gh="Sin",xh="Sinh",yh="Sign",vh="Sigmoid",bh="Softplus",wh="Sqrt",Zg="Sum",Jg="SpaceToBatchND",e0="SplitV",t0="Softmax",rR="SparseFillEmptyRows",oR="SparseReshape",iR="SparseSegmentMean",aR="SparseSegmentSum",lR="SparseToDense",Ch="SquaredDifference",uw="Square",cw="StaticRegexReplace",dw="StridedSlice",uR="StringNGrams",cR="StringSplit",dR="StringToHashBucketFast",$h="Sub",kh="Tan",Sh="Tanh",Ih="Tile",hw="TopK",fw="Transform",zl="Transpose",pw="Unique",n0="Unpack",s0="UnsortedSegmentSum",r0="ZerosLike",Th="Step",AV="FromPixels",mw="RotateWithOffset",Xp="_FusedMatMul",qp="FusedConv2D",hR="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xs(...t){K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(...t)}function DV(...t){K().getBool("IS_TEST")||K().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yp=Eb("kernelRegistry",()=>new Map),uv=Eb("gradRegistry",()=>new Map);function hS(t,e){const n=pR(t,e);return Yp.get(n)}function fS(t){return uv.get(t)}function pS(t){const e=Yp.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===t&&n.push(i)}return n}function fR(t){const{kernelName:e,backendName:n}=t,s=pR(e,n);Yp.has(s)&&xs(`The kernel '${e}' for backend '${n}' is already registered`),Yp.set(s,t)}function FV(t){const{kernelName:e}=t;uv.has(e)&&K().getBool("DEBUG")&&xs(`Overriding the gradient for '${e}'`),uv.set(e,t)}function pR(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mR(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var gR=gt,Ws=null;try{Ws=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function gt(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}gt.prototype.__isLong__;Object.defineProperty(gt.prototype,"__isLong__",{value:!0});function hs(t){return(t&&t.__isLong__)===!0}gt.isLong=hs;var mS={},gS={};function Wa(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=gS[t],s)?s:(n=xt(t,(t|0)<0?-1:0,!0),r&&(gS[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=mS[t],s)?s:(n=xt(t,t<0?-1:0,!1),r&&(mS[t]=n),n))}gt.fromInt=Wa;function Us(t,e){if(isNaN(t))return e?Ji:Gs;if(e){if(t<0)return Ji;if(t>=xR)return bR}else{if(t<=-yS)return rs;if(t+1>=yS)return vR}return t<0?Us(-t,e).neg():xt(t%tu|0,t/tu|0,e)}gt.fromNumber=Us;function xt(t,e,n){return new gt(t,e,n)}gt.fromBits=xt;var Qp=Math.pow;function gw(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return Gs;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return gw(t.substring(1),e,n).neg();for(var r=Us(Qp(n,8)),o=Gs,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+a),n);if(a<8){var u=Us(Qp(n,a));o=o.mul(u).add(Us(l))}else o=o.mul(r),o=o.add(Us(l))}return o.unsigned=e,o}gt.fromString=gw;function Tr(t,e){return typeof t=="number"?Us(t,e):typeof t=="string"?gw(t,e):xt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}gt.fromValue=Tr;var xS=65536,OV=1<<24,tu=xS*xS,xR=tu*tu,yS=xR/2,vS=Wa(OV),Gs=Wa(0);gt.ZERO=Gs;var Ji=Wa(0,!0);gt.UZERO=Ji;var Tl=Wa(1);gt.ONE=Tl;var yR=Wa(1,!0);gt.UONE=yR;var cv=Wa(-1);gt.NEG_ONE=cv;var vR=xt(-1,2147483647,!1);gt.MAX_VALUE=vR;var bR=xt(-1,-1,!0);gt.MAX_UNSIGNED_VALUE=bR;var rs=xt(0,-2147483648,!1);gt.MIN_VALUE=rs;var ae=gt.prototype;ae.toInt=function(){return this.unsigned?this.low>>>0:this.low};ae.toNumber=function(){return this.unsigned?(this.high>>>0)*tu+(this.low>>>0):this.high*tu+(this.low>>>0)};ae.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(rs)){var n=Us(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Us(Qp(e,6),this.unsigned),i=this,a="";;){var l=i.div(o),u=i.sub(l.mul(o)).toInt()>>>0,c=u.toString(e);if(i=l,i.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};ae.getHighBits=function(){return this.high};ae.getHighBitsUnsigned=function(){return this.high>>>0};ae.getLowBits=function(){return this.low};ae.getLowBitsUnsigned=function(){return this.low>>>0};ae.getNumBitsAbs=function(){if(this.isNegative())return this.eq(rs)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};ae.isZero=function(){return this.high===0&&this.low===0};ae.eqz=ae.isZero;ae.isNegative=function(){return!this.unsigned&&this.high<0};ae.isPositive=function(){return this.unsigned||this.high>=0};ae.isOdd=function(){return(this.low&1)===1};ae.isEven=function(){return(this.low&1)===0};ae.equals=function(e){return hs(e)||(e=Tr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ae.eq=ae.equals;ae.notEquals=function(e){return!this.eq(e)};ae.neq=ae.notEquals;ae.ne=ae.notEquals;ae.lessThan=function(e){return this.comp(e)<0};ae.lt=ae.lessThan;ae.lessThanOrEqual=function(e){return this.comp(e)<=0};ae.lte=ae.lessThanOrEqual;ae.le=ae.lessThanOrEqual;ae.greaterThan=function(e){return this.comp(e)>0};ae.gt=ae.greaterThan;ae.greaterThanOrEqual=function(e){return this.comp(e)>=0};ae.gte=ae.greaterThanOrEqual;ae.ge=ae.greaterThanOrEqual;ae.compare=function(e){if(hs(e)||(e=Tr(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ae.comp=ae.compare;ae.negate=function(){return!this.unsigned&&this.eq(rs)?rs:this.not().add(Tl)};ae.neg=ae.negate;ae.add=function(e){hs(e)||(e=Tr(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,d=0,h=0,f=0;return f+=o+u,h+=f>>>16,f&=65535,h+=r+l,d+=h>>>16,h&=65535,d+=s+a,c+=d>>>16,d&=65535,c+=n+i,c&=65535,xt(h<<16|f,c<<16|d,this.unsigned)};ae.subtract=function(e){return hs(e)||(e=Tr(e)),this.add(e.neg())};ae.sub=ae.subtract;ae.multiply=function(e){if(this.isZero())return Gs;if(hs(e)||(e=Tr(e)),Ws){var n=Ws.mul(this.low,this.high,e.low,e.high);return xt(n,Ws.get_high(),this.unsigned)}if(e.isZero())return Gs;if(this.eq(rs))return e.isOdd()?rs:Gs;if(e.eq(rs))return this.isOdd()?rs:Gs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(vS)&&e.lt(vS))return Us(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,d=0,h=0,f=0,p=0;return p+=i*c,f+=p>>>16,p&=65535,f+=o*c,h+=f>>>16,f&=65535,f+=i*u,h+=f>>>16,f&=65535,h+=r*c,d+=h>>>16,h&=65535,h+=o*u,d+=h>>>16,h&=65535,h+=i*l,d+=h>>>16,h&=65535,d+=s*c+r*u+o*l+i*a,d&=65535,xt(f<<16|p,d<<16|h,this.unsigned)};ae.mul=ae.multiply;ae.divide=function(e){if(hs(e)||(e=Tr(e)),e.isZero())throw Error("division by zero");if(Ws){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Ws.div_u:Ws.div_s)(this.low,this.high,e.low,e.high);return xt(n,Ws.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ji:Gs;var s,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ji;if(e.gt(this.shru(1)))return yR;o=Ji}else{if(this.eq(rs)){if(e.eq(Tl)||e.eq(cv))return rs;if(e.eq(rs))return Tl;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(Gs)?e.isNegative()?Tl:cv:(r=this.sub(e.mul(s)),o=s.add(r.div(e)),o)}else if(e.eq(rs))return this.unsigned?Ji:Gs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Gs}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:Qp(2,a-48),u=Us(s),c=u.mul(e);c.isNegative()||c.gt(r);)s-=l,u=Us(s,this.unsigned),c=u.mul(e);u.isZero()&&(u=Tl),o=o.add(u),r=r.sub(c)}return o};ae.div=ae.divide;ae.modulo=function(e){if(hs(e)||(e=Tr(e)),Ws){var n=(this.unsigned?Ws.rem_u:Ws.rem_s)(this.low,this.high,e.low,e.high);return xt(n,Ws.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ae.mod=ae.modulo;ae.rem=ae.modulo;ae.not=function(){return xt(~this.low,~this.high,this.unsigned)};ae.and=function(e){return hs(e)||(e=Tr(e)),xt(this.low&e.low,this.high&e.high,this.unsigned)};ae.or=function(e){return hs(e)||(e=Tr(e)),xt(this.low|e.low,this.high|e.high,this.unsigned)};ae.xor=function(e){return hs(e)||(e=Tr(e)),xt(this.low^e.low,this.high^e.high,this.unsigned)};ae.shiftLeft=function(e){return hs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?xt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):xt(0,this.low<<e-32,this.unsigned)};ae.shl=ae.shiftLeft;ae.shiftRight=function(e){return hs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?xt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):xt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ae.shr=ae.shiftRight;ae.shiftRightUnsigned=function(e){if(hs(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return xt(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?xt(n,0,this.unsigned):xt(n>>>e-32,0,this.unsigned)};ae.shru=ae.shiftRightUnsigned;ae.shr_u=ae.shiftRightUnsigned;ae.toSigned=function(){return this.unsigned?xt(this.low,this.high,!1):this};ae.toUnsigned=function(){return this.unsigned?this:xt(this.low,this.high,!0)};ae.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ae.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ae.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};gt.fromBytes=function(e,n,s){return s?gt.fromBytesLE(e,n):gt.fromBytesBE(e,n)};gt.fromBytesLE=function(e,n){return new gt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};gt.fromBytesBE=function(e,n){return new gt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const wR=Wm(gR),PV=PM({__proto__:null,default:wR},[gR]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki=wR||PV;function o0(t){return Ki.fromString(t,!0,16)}const CR=o0("c3a5c85c97cb3127"),Hi=o0("b492b66fbe98f273"),On=o0("9ae16a3b2f90404f");function dv(t){return t.xor(t.shru(47))}function $R(t,e,n){const s=t.slice(e,e+n);return Ki.fromBytes(Array.from(s),!0,!0)}function at(t,e){return $R(t,e,8)}function bS(t,e){return $R(t,e,4)}function sn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function ii(t,e,n=o0("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function _V(t,e,n,s,r,o){r=r.add(t),o=sn(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(n),o=o.add(sn(r,44)),[r.add(s),o.add(i)]}function wf(t,e,n,s){return _V(at(t,e),at(t,e+8),at(t,e+16),at(t,e+24),n,s)}function LV(t,e=t.length){if(e>=8){const n=On.add(e*2),s=at(t,0).add(On),r=at(t,e-8),o=sn(r,37).mul(n).add(s),i=sn(s,25).add(r).mul(n);return ii(o,i,n)}if(e>=4){const n=On.add(e*2),s=bS(t,0);return ii(s.shl(3).add(e),bS(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],o=n+(s<<8),i=e+(r<<2);return dv(On.mul(o).xor(CR.mul(i))).mul(On)}return On}function MV(t,e=t.length){const n=On.add(e*2),s=at(t,0).mul(Hi),r=at(t,8),o=at(t,e-8).mul(n),i=at(t,e-16).mul(On);return ii(sn(s.add(r),43).add(sn(o,30)).add(i),s.add(sn(r.add(On),18)).add(o),n)}function zV(t,e=t.length){const n=On.add(e*2),s=at(t,0).mul(On),r=at(t,8),o=at(t,e-8).mul(n),i=at(t,e-16).mul(On),a=sn(s.add(r),43).add(sn(o,30)).add(i),l=ii(a,s.add(sn(r.add(On),18)).add(o),n),u=at(t,16).mul(n),c=at(t,24),d=a.add(at(t,e-32)).mul(n),h=l.add(at(t,e-24)).mul(n);return ii(sn(u.add(c),43).add(sn(d,30)).add(h),u.add(sn(c.add(s),18)).add(d),n)}function BV(t,e=t.length){const n=Ki.fromNumber(81,!0);if(e<=32)return e<=16?LV(t,e):MV(t,e);if(e<=64)return zV(t,e);let s=n,r=n.mul(Hi).add(113),o=dv(r.mul(On).add(113)).mul(On),i=[Ki.UZERO,Ki.UZERO],a=[Ki.UZERO,Ki.UZERO];s=s.mul(On).add(at(t,0));let l=0;const u=(e-1>>6)*64,c=u+(e-1&63)-63;do s=sn(s.add(r).add(i[0]).add(at(t,l+8)),37).mul(Hi),r=sn(r.add(i[1]).add(at(t,l+48)),42).mul(Hi),s=s.xor(a[1]),r=r.add(i[0]).add(at(t,l+40)),o=sn(o.add(a[0]),33).mul(Hi),i=wf(t,l,i[1].mul(Hi),s.add(a[0])),a=wf(t,l+32,o.add(a[1]),r.add(at(t,l+16))),[o,s]=[s,o],l+=64;while(l!==u);const d=Hi.add(o.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=sn(s.add(r).add(i[0]).add(at(t,l+8)),37).mul(d),r=sn(r.add(i[1]).add(at(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(at(t,l+40))),o=sn(o.add(a[0]),33).mul(d),i=wf(t,l,i[1].mul(d),s.add(a[0])),a=wf(t,l+32,o.add(a[1]),r.add(at(t,l+16))),[o,s]=[s,o],ii(ii(i[0],a[0],d).add(dv(r).mul(CR)).add(o),ii(i[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ii(t,e){return e==="string"?ai(t):Ua([t],e)}function VV(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Ua(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ca(t)),K().getBool("DEBUG")&&xV(t,e),VV(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Un(){return K().platform.now()}function ai(t,e="utf-8"){return e=e||"utf-8",K().platform.encode(t,e)}function pi(t,e="utf-8"){return e=e||"utf-8",K().platform.decode(t,e)}function Ys(t){return K().platform.isTypedArray!=null?K().platform.isTypedArray(t):mR(t)}function Ca(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Tb(t)||t==null||Ys(t)&&n)e.push(t);else if(Array.isArray(t)||Ys(t))for(let s=0;s<t.length;++s)Ca(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ca(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WV{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new GV)}profileKernel(e,n,s){let r;const o=()=>{r=s()};let i;const a=Un();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const u of r)u.dataSync();i=Promise.resolve({kernelMs:Un()-a})}if(K().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const c=r[u];c.data().then(d=>{UV(d,c.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],o,l[2])})})}}function UV(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class GV{logKernelProfile(e,n,s,r,o,i){const a=typeof r=="number"?Ml(`${r}ms`,9):r.error,l=Ml(e,25),u=n.rank,c=n.size,d=Ml(n.shape.toString(),14);let h="";for(const f in o){const p=o[f];if(p!=null){const m=p.shape||n.shape,x=m.length;h+=`${f}: ${x}D ${x>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${d}	%c${c}	%c${h}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const u=t[l],c=u.inputs;for(const d in c){const h=c[d];let f=!1;for(let p=0;p<e.length;p++)if(s[h.id]){u.outputs.forEach(m=>s[m.id]=!0),f=!0,r[u.id]=!0;break}if(f)break}}const o={};o[n.id]=!0;const i={};for(let l=t.length-1;l>=0;l--){const u=t[l],c=u.inputs;for(let d=0;d<u.outputs.length;d++)if(o[u.outputs[d].id]){for(const h in c)o[c[h].id]=!0,i[u.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const u=t[l];if(r[u.id]&&i[u.id]){const c={};for(const h in u.inputs){const f=u.inputs[h];s[f.id]&&(c[h]=f)}const d=Object.assign({},u);d.inputs=c,d.outputs=u.outputs,a.push(d)}}return a}function jV(t,e,n,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(l=>{const u=t[l.id];u!=null?i.push(u):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=n(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const c=o.inputs[l];if(!qe(u.shape,c.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{const d=t[c.id];t[c.id]=s(d,u),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wS=20,Qu=3,Cx=7;function KV(t,e,n,s){const r=ge(e),o=XV(t,e,n,r),i=e.length,a=dp(t,e,n,r,o),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function XV(t,e,n,s){const r=Q(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,l=n==="complex64"?hc(t):t;if(a>1)for(let u=0;u<r/o;u++){const c=u*o;for(let d=0;d<o;d++)i[d]=Math.max(i[d],dc(l[c+d],0,n).length)}return i}function dc(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(Cx))} + ${parseFloat(t[1].toFixed(Cx))}j`:Dd(t)?s=`'${t}'`:n==="bool"?s=kR(t):s=parseFloat(t.toFixed(Cx)).toString(),Ml(s,e)}function kR(t){return t===0?"false":"true"}function dp(t,e,n,s,r,o=!0){const i=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=hc(t);return[dc(m[0],0,n)]}return n==="bool"?[kR(t[0])]:[t[0].toString()]}if(l===1){if(a>wS){const x=Qu*i;let g=Array.from(t.slice(0,x)),y=Array.from(t.slice((a-Qu)*i,a*i));return n==="complex64"&&(g=hc(g),y=hc(y)),["["+g.map((v,b)=>dc(v,r[b],n)).join(", ")+", ..., "+y.map((v,b)=>dc(v,r[a-Qu+b],n)).join(", ")+"]"]}return["["+(n==="complex64"?hc(t):Array.from(t)).map((x,g)=>dc(x,r[g],n)).join(", ")+"]"]}const u=e.slice(1),c=s.slice(1),d=s[0]*i,h=[];if(a>wS){for(let m=0;m<Qu;m++){const x=m*d,g=x+d;h.push(...dp(t.slice(x,g),u,n,c,r,!1))}h.push("...");for(let m=a-Qu;m<a;m++){const x=m*d,g=x+d;h.push(...dp(t.slice(x,g),u,n,c,r,m===a-1))}}else for(let m=0;m<a;m++){const x=m*d,g=x+d;h.push(...dp(t.slice(x,g),u,n,c,r,m===a-1))}const f=l===2?",":"";h[0]="["+(a>0?h[0]+f:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+f;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":p),h}function hc(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fn{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=Q(e),s!=null){const r=s.length;I(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Dt(n,this.size),this.strides=ge(e)}set(e,...n){n.length===0&&(n=[0]),I(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return hr().makeTensor(this.values,this.shape,this.dtype)}}let hr=null,dl=null;function qV(t){hr=t}function YV(t){dl=t}class Gt{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=Q(e),this.strides=ge(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return dl.buffer(this.shape,this.dtype,e)}bufferSync(){return dl.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return br(this.shape,e,this.dtype==="complex64")}arraySync(){return br(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=hr().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>pi(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),hr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=hr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>pi(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await hr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),hr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return dl.print(this,e)}clone(){return this.throwIfDisposed(),dl.clone(this)}toString(e=!1){const n=this.dataSync();return KV(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),dl.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),hr().makeVariable(this,e,n,s)}}Object.defineProperty(Gt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function Y(){return Eb("Tensor",()=>Gt)}Y();class Zp extends Gt{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!qe(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);hr().disposeTensor(this),this.dataId=e.dataId,hr().incRef(this,null)}dispose(){hr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Zp,Symbol.hasInstance,{value:t=>t instanceof Gt&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var CS;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(CS||(CS={}));var hv;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(hv||(hv={}));var fv;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(fv||(fv={}));var pv;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(pv||(pv={}));var mv;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(mv||(mv={}));const QV={float32:pv,int32:hv,bool:fv,complex64:mv};function us(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return QV[t][e]}function xw(t){return us(t,"int32")}function SR(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function IR(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ot(t,e){if(t.dtype===e.dtype)return[t,e];const n=us(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function TR(t){const e=[];return ER(t,e,new Set),e}function ER(t,e,n){if(t==null)return;if(t instanceof Gt){e.push(t);return}if(!ZV(t))return;const s=t;for(const r in s){const o=s[r];n.has(o)||(n.add(o),ER(o,e,n))}}function ZV(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $x(t){return t.kernelName!=null}class $S{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class nu{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new $S}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(xs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new WV(this.backendInstance),!0}setupRegisteredKernels(){pS(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){pS(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof $b)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,xs(`Initialization of backend ${e} failed`),xs(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return xs(`Initialization of backend ${e} failed`),xs(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,o=this.readSync(n),i=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return nu.nextTensorId++}nextVariableId(){return nu.nextVariableId++}clone(e){const n=B.runKernel(Jd,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",l={x:i},u={dtype:a};return B.runKernel(Bd,l,u)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,o,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(hS(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let o=0;s.forEach(l=>{o+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=$x(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if($x(e)){const{kernelName:p,inputs:m,attrs:x}=e;this.backendName==null&&this.backend;const g=hS(p,this.backendName);I(g!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const y=this.backend.numDataIds();l=g.kernelFunc({inputs:m,attrs:x,backend:this.backend});const v=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,y,v);const b=v.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(r){const w=this.getTensorsForGradient(p,m,b);s=this.saveTensorsForBackwardMode(w)}return b}}else{const{forwardFunc:p}=e,m=x=>{r&&(s=x.map(g=>this.keep(this.clone(g))))};a=()=>{const x=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const g=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,x,g),g}}const{inputs:c,attrs:d}=e,h=$x(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(f=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),n=f.outputs)}),r&&this.addTapeNode(u,c,n,h,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=fS(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(I(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(u=>n[u])):a=o.map(u=>n[u]);const l=s.filter((u,c)=>i[c]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&Dd(e[0])&&(o=e.map(l=>ai(l)));const i=r.write(o,n,s),a=new Gt(n,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(i),u=vV(o);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const o={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:o}=e,i=new Gt(r,o,s,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new Zp(e,n,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Kp(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Zp||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Kp(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:o},l=fS(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((c,d)=>{if(c==null){const h=s[d],f=$n(h.size,h.dtype);return this.makeTensor(f,h.shape,h.dtype)}return c}),r(u.length>1?u:u[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=TR(e),s=new Set(n.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,n,s,r=!1){if(I(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));I(o instanceof Gt,()=>"The result y returned by f() must be a tensor.");const i=HV(this.state.activeTape,n,o);if(!r&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??JV(o.shape),jV(a,i,u=>this.tidy(u),eW);const l=n.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const c of u.saved)c.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return I(ov(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{I(n.every(a=>a instanceof Gt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const o=(a,l)=>(s=e(...n,l),I(s.value instanceof Gt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),I(ov(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const u=s.gradFunc(a,l),c=Array.isArray(u)?u:[u];I(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),I(c.every(h=>h instanceof Gt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return c.forEach((h,f)=>{d[f]=()=>h}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Un(),s=await this.backend.time(e);return s.wallMs=Un()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new $S;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}nu.nextTensorId=0;nu.nextVariableId=0;function JV(t){const e=Ib(Q(t),"float32");return B.makeTensor(e,t,"float32")}function NR(){const t=HN();if(t._tfengine==null){const e=new CV(t);t._tfengine=new nu(e)}return IV(t._tfengine.ENV),qV(()=>t._tfengine),t._tfengine}const B=NR();function eW(t,e){const n={a:t,b:e};return B.runKernel(wu,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(){return typeof navigator<"u"&&navigator!=null}function RR(t){if(t||tW()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function AR(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qn=K();qn.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});qn.registerFlag("IS_BROWSER",()=>AR());qn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");qn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));qn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));qn.registerFlag("PROD",()=>!1);qn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>qn.getBool("DEBUG"));qn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);qn.registerFlag("IS_TEST",()=>!1);qn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>qn.getBool("DEBUG"));qn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);qn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);qn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0(t,e){let n=t;if(Ys(t))return e==="string"?[]:[t.length];if(SR(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(IR(t))return[t.buffer.size/(e==null?4:Kp(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||Ys(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&K().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&DR(t,s,[]),s}function DR(t,e,n){if(n=n||[],!Array.isArray(t)&&!Ys(t)){I(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}I(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),I(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)DR(t[r],s,n.concat(r))}function kS(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function F(t,e,n,s="numeric"){if(t instanceof Y())return kS(s,t.dtype,e,n),t;let r=vu(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),kS(s,r,e,n),t==null||!Ys(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const o=i0(t,r);!Ys(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?Ua(t,r):Ca(t,[],!0);return B.makeTensor(a,o,r)}function FR(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((o,i)=>F(o,`${e}[${i}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nW="__op";function G(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+nW;const r=(...o)=>{B.startScope(n);try{const i=s(...o);return Tb(i)&&console.error("Cannot return a Promise inside of tidy."),B.endScope(i),i}catch(i){throw B.endScope(null),i}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(t,e){const n=F(t,"real","complex"),s=F(e,"imag","complex");Sb(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return B.runKernel(_b,r)}const su=G({complex_:sW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0(t,e,n,s){if(s==null)s=vu(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(IR(t)||SR(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return B.backend.createTensorFromGPUData(t,e||n,s)}if(!Ys(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Ro(e);const r=Q(e),o=Q(n);I(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<n.length;++i){const a=n[i],l=i===n.length-1?a!==Q(e.slice(i)):!0;I(n[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Ys(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?Ua(t,s):Ca(t,[],!0),B.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vn(t,e,n){const s=i0(t,n);return a0(t,e,s,n)}class Cu{static join(e){return new Cu(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Ys(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=n+r.byteLength;this.shards.push({buffer:r,start:n,end:o}),n=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],d=e+a-u.start,h=a,p=Math.min(n,u.end)-u.start,m=new Uint8Array(u.buffer,d,p-d);if(i.set(m,h),a+=m.length,n<u.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=rW(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function rW(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,o=e(t[r]);if(o===0)return r;o<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fr(){return B}function SS(){return B.memory()}function j(t,e){return B.tidy(t,e)}function Oe(t){TR(t).forEach(n=>n.dispose())}function Kr(t){return B.keep(t)}function oW(t){return B.setBackend(t)}function OR(t,e,n=1){return B.registerBackend(t,e,n)}function iW(){return B.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IS=4;async function TS(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);for(let i=0;i<r.length;++i){const a=r[i],l=Array.isArray(t)?t[i].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const c=new Promise(async d=>{const h=await l.bytes(),f=h.reduce((x,g)=>x+g.length,0)+IS*h.length,p=new Uint8Array(f);let m=0;for(let x=0;x<h.length;x++){const g=h[x],y=new Uint8Array(new Uint32Array([g.length]).buffer);p.set(y,m),m+=IS,p.set(g,m),m+=g.length}d(p)});s.push(c)}else s.push(l.data());e!=null&&(u.group=e),n.push(u)}const o=await Promise.all(s);return{data:aW(o),specs:n}}function aW(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(o=>{if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const yw=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ES(t){return yw?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function lW(t){if(yw)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function uW(t){if(yw){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function cW(t){return Cu.join(t)}function PR(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:ES(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:ES(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Cu(t.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Rn.instance==null&&(Rn.instance=new Rn),Rn.instance}static registerSaveRouter(e){Rn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Rn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Rn.getHandlers(e,"save")}static getLoadHandlers(e,n){return Rn.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?Rn.getInstance().loadRouters:Rn.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const dW=t=>Rn.getSaveHandlers(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gv="tensorflowjs",xv=1,ea="models_store",Xo="model_info_store";function _R(){if(!K().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function yv(t){const e=t.result;e.createObjectStore(ea,{keyPath:"modelPath"}),e.createObjectStore(Xo,{keyPath:"modelPath"})}class $a{constructor(e){if(this.indexedDB=_R(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const o=this.indexedDB.open(gv,xv);o.onupgradeneeded=()=>yv(o),o.onsuccess=()=>{const i=o.result;if(n==null){const a=i.transaction(ea,"readonly"),u=a.objectStore(ea).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=c=>(i.close(),r(u.error)),a.oncomplete=()=>i.close()}else{n.weightData=Cu.join(n.weightData);const a=PR(n),l=i.transaction(Xo,"readwrite");let u=l.objectStore(Xo),c;try{c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return r(h)}let d;c.onsuccess=()=>{d=i.transaction(ea,"readwrite");const h=d.objectStore(ea);let f;try{f=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return r(p)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=p=>{u=l.objectStore(Xo);const m=u.delete(this.modelPath);m.onsuccess=()=>(i.close(),r(f.error)),m.onerror=x=>(i.close(),r(f.error))}},c.onerror=h=>(i.close(),r(c.error)),l.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}$a.URL_SCHEME="indexeddb://";const LR=t=>K().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith($a.URL_SCHEME)?hW(t.slice($a.URL_SCHEME.length)):null;Rn.registerSaveRouter(LR);Rn.registerLoadRouter(LR);function hW(t){return new $a(t)}function fW(t){return t.startsWith($a.URL_SCHEME)?t.slice($a.URL_SCHEME.length):t}class pW{constructor(){this.indexedDB=_R()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(gv,xv);s.onupgradeneeded=()=>yv(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(Xo,"readonly"),a=o.objectStore(Xo).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=fW(e),new Promise((n,s)=>{const r=this.indexedDB.open(gv,xv);r.onupgradeneeded=()=>yv(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(Xo,"readwrite"),a=i.objectStore(Xo),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=a.delete(e),d=()=>{u=o.transaction(ea,"readwrite");const f=u.objectStore(ea).delete(e);f.onsuccess=()=>n(l.result.modelArtifactsInfo),f.onerror=p=>s(l.error)};c.onsuccess=d,c.onerror=h=>(d(),o.close(),s(l.error))}},l.onerror=c=>(o.close(),s(l.error)),i.oncomplete=()=>{u==null?o.close():u.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const po="/",hl="tensorflowjs_models",MR="info",mW="model_topology",gW="weight_specs",xW="weight_data",yW="model_metadata";function zR(t){return{info:[hl,t,MR].join(po),topology:[hl,t,mW].join(po),weightSpecs:[hl,t,gW].join(po),weightData:[hl,t,xW].join(po),modelMetadata:[hl,t,yW].join(po)}}function BR(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function vW(t){const e=t.split(po);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(po)}function bW(t){return t.startsWith(ka.URL_SCHEME)?t.slice(ka.URL_SCHEME.length):t}class ka{constructor(e){if(!K().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=zR(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=PR(e),o=Cu.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,lW(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw BR(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=uW(i),n}}ka.URL_SCHEME="localstorage://";const VR=t=>K().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ka.URL_SCHEME)?wW(t.slice(ka.URL_SCHEME.length)):null;Rn.registerSaveRouter(VR);Rn.registerLoadRouter(VR);function wW(t){return new ka(t)}class CW{constructor(){I(K().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),I(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=hl+po,s=po+MR;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(n)&&o.endsWith(s)){const i=vW(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=bW(e);const n=zR(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return BR(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NS="://";class Pr{constructor(){this.managers={}}static getInstance(){return Pr.instance==null&&(Pr.instance=new Pr),Pr.instance}static registerManager(e,n){I(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(NS)&&(e=e.slice(0,e.indexOf(NS))),I(e.length>0,()=>"scheme must not be an empty string.");const s=Pr.getInstance();I(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=Pr.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Pr.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $W{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!K().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return mR(e)}}if(K().get("IS_BROWSER")){K().setPlatform("browser",new $W);try{Pr.registerManager(ka.URL_SCHEME,new CW)}catch{}try{Pr.registerManager($a.URL_SCHEME,new pW)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kW={importFetch:()=>require("node-fetch")};let kx;class SW{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return K().global.fetch!=null?K().global.fetch(e,n):(kx==null&&(kx=kW.importFetch()),kx(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}K().get("IS_NODE")&&!K().get("IS_BROWSER")&&K().setPlatform("node",new SW);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ae(t,e="float32",n){return e=e||"float32",Ro(t),new fn(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(t,e){const n=F(t,"x","cast");if(!yV(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return B.runKernel(Bd,s,r)}const ue=G({cast_:IW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(t){const n={x:F(t,"x","clone","string_or_numeric")};return B.runKernel(Jd,n)}const ca=G({clone_:TW});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */NR();const NW={buffer:Ae,cast:ue,clone:ca,print:EW};YV(NW);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RW(t,e){let n=F(t,"a","add"),s=F(e,"b","add");[n,s]=Ot(n,s);const r={a:n,b:s};return B.runKernel(wu,r)}const ne=G({add_:RW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AW(t,e){let n=F(t,"a","floorDiv"),s=F(e,"b","floorDiv");[n,s]=Ot(n,s);const r={a:n,b:s};return B.runKernel(Qd,r)}const WR=G({floorDiv_:AW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DW(t,e){let n=F(t,"a","div"),s=F(e,"b","div");if([n,s]=Ot(n,s),n.dtype==="int32"&&s.dtype==="int32")return WR(n,s);const r={a:n,b:s},o={};return B.runKernel(Hd,r,o)}const ve=G({div_:DW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(t,e){let n=F(t,"a","mul"),s=F(e,"b","mul");[n,s]=Ot(n,s);const r={a:n,b:s};return B.runKernel(lh,r)}const z=G({mul_:FW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(t){const e=F(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return B.runKernel(hg,n)}else{const n={x:e};return B.runKernel(og,n)}}const Dn=G({abs_:OW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PW(t){const n={x:F(t,"x","acos")};return B.runKernel(Fd,n)}const _W=G({acos_:PW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LW(t){const n={x:F(t,"x","acosh")};return B.runKernel(Od,n)}const MW=G({acosh_:LW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(t,e=null,n=!1){const r={x:F(t,"x","all","bool")},o={axis:e,keepDims:n};return B.runKernel(Rb,r,o)}const UR=G({all_:zW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(t,e=null,n=!1){const r={x:F(t,"x","any","bool")},o={axis:e,keepDims:n};return B.runKernel(Ab,r,o)}const vv=G({any_:BW});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VW(t,e=0){const s={x:F(t,"x","argMax")},r={axis:e};return B.runKernel(ig,s,r)}const ld=G({argMax_:VW});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(t,e=0){const s={x:F(t,"x","argMin")},r={axis:e};return B.runKernel(ag,s,r)}const UW=G({argMin_:WW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(t){const n={x:F(t,"x","asin")};return B.runKernel(Pd,n)}const HW=G({asin_:GW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(t){const n={x:F(t,"x","asinh")};return B.runKernel(_d,n)}const KW=G({asinh_:jW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XW(t){const n={x:F(t,"x","atan")};return B.runKernel(Ld,n)}const qW=G({atan_:XW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YW(t,e){let n=F(t,"a","atan2"),s=F(e,"b","atan2");[n,s]=Ot(n,s);const r={a:n,b:s};return B.runKernel(zd,r)}const QW=G({atan2_:YW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(t){const n={x:F(t,"x","atanh")};return B.runKernel(Md,n)}const JW=G({atanh_:ZW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eh(t,e,n,s,r="NHWC",o){const i=t[3],a=[...e,i],l=Do(r);return pn(t,a,n,o,s,null,null,l)}function Js(t,e,n,s,r,o,i="channelsLast"){const[a,l]=ud(e);let u;if(i==="channelsLast")u=[a,l,t[3],t[3]];else if(i==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return pn(t,u,n,s,r,o,!1,i)}function Ao(t,e,n,s,r,o,i="NDHWC"){const[a,l,u]=bv(e);let c,d;if(i==="NDHWC")d="channelsLast",c=[a,l,u,t[4],t[4]];else if(i==="NCDHW")d="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return Ti(t,c,n,s,r,!1,d,o)}function pn(t,e,n,s,r,o,i=!1,a="channelsLast"){let[l,u,c,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,d]=t;else if(a==="channelsFirst")[l,d,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);const[h,f,,p]=e,[m,x]=ud(n),[g,y]=ud(s),v=Bl(h,g),b=Bl(f,y),{padInfo:w,outHeight:$,outWidth:k}=nU(r,u,c,m,x,v,b,o,a),C=i?p*d:p;let S;return a==="channelsFirst"?S=[l,C,$,k]:a==="channelsLast"&&(S=[l,$,k,C]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:d,outHeight:$,outWidth:k,outChannels:C,padInfo:w,strideHeight:m,strideWidth:x,filterHeight:h,filterWidth:f,effectiveFilterHeight:v,effectiveFilterWidth:b,dilationHeight:g,dilationWidth:y,inShape:t,outShape:S,filterShape:e}}function Ti(t,e,n,s,r,o=!1,i="channelsLast",a){let[l,u,c,d,h]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,c,d,h]=t;else if(i==="channelsFirst")[l,h,u,c,d]=t;else throw new Error(`Unknown dataFormat ${i}`);const[f,p,m,,x]=e,[g,y,v]=bv(n),[b,w,$]=bv(s),k=Bl(f,b),C=Bl(p,w),S=Bl(m,$),{padInfo:T,outDepth:R,outHeight:A,outWidth:E}=sU(r,u,c,d,g,y,v,k,C,S,a),N=o?x*h:x;let P;return i==="channelsFirst"?P=[l,N,R,A,E]:i==="channelsLast"&&(P=[l,R,A,E,N]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:c,inWidth:d,inChannels:h,outDepth:R,outHeight:A,outWidth:E,outChannels:N,padInfo:T,strideDepth:g,strideHeight:y,strideWidth:v,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:k,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationDepth:b,dilationHeight:w,dilationWidth:$,inShape:t,outShape:P,filterShape:e}}function eU(t,e,n,s,r){s==null&&(s=vw(t,e,n));const o=t[0],i=t[1],a=cd((o-e+2*s)/n+1,r),l=cd((i-e+2*s)/n+1,r);return[a,l]}function tU(t,e,n,s,r,o){r==null&&(r=vw(t,e[0],s[0]));const i=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(i[a]=cd((t[a]-e[a]+2*r)/s[a]+1,o));return i}function vw(t,e,n,s=1){const r=Bl(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function ud(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function bv(t){return typeof t=="number"?[t,t,t]:t}function Bl(t,e){return e<=1?t:t+(t-1)*(e-1)}function nU(t,e,n,s,r,o,i,a,l){let u,c,d;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const f=eU([e,n],o,s,t,a);c=f[0],d=f[1]}else if(t==="same"){c=Math.ceil(e/s),d=Math.ceil(n/r);const h=Math.max(0,(c-1)*s+o-e),f=Math.max(0,(d-1)*r+i-n),p=Math.floor(h/2),m=h-p,x=Math.floor(f/2),g=f-x;u={top:p,bottom:m,left:x,right:g,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-o+1)/s),d=Math.ceil((n-i+1)/r);else if(typeof t=="object"){const h=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];u={top:h,bottom:f,left:p,right:m,type:h===0&&f===0&&p===0&&m===0?"VALID":"EXPLICIT"},c=cd((e-o+h+f)/s+1,a),d=cd((n-i+p+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:d}}function sU(t,e,n,s,r,o,i,a,l,u,c){let d,h,f,p;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const x=tU([e,n,s,1],[a,l,u],1,[r,o,i],t,c);h=x[0],f=x[1],p=x[2]}else if(t==="same"){h=Math.ceil(e/r),f=Math.ceil(n/o),p=Math.ceil(s/i);const m=(h-1)*r+a-e,x=(f-1)*o+l-n,g=(p-1)*i+u-s,y=Math.floor(m/2),v=m-y,b=Math.floor(x/2),w=x-b,$=Math.floor(g/2),k=g-$;d={top:b,bottom:w,left:$,right:k,front:y,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:h,outHeight:f,outWidth:p}}function cd(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Sa(t){const[e,n,s]=ud(t);return e===1&&n===1&&s===1}function Sn(t,e){return Sa(t)||Sa(e)}function Ia(t){return ud(t).every(e=>e>0)}function Do(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Jn(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")I(eu(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{I(eu(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rU(t,e){const s={x:F(t,"x","reshape","string_or_numeric")},r={shape:e};return B.runKernel(jg,s,r)}const U=G({reshape_:rU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oU(t,e,n,s,r){const o=F(t,"x","avgPool","float32"),i=1;I(Sn(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),I(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Jn("avgPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let d=B.runKernel(lg,u,c);return d=ue(d,o.dtype),l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const bw=G({avgPool_:oU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iU(t,e,n,s,r,o="NDHWC"){const i=F(t,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),I(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),I(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),I(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Jn("avgPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:o};let d=B.runKernel(ug,u,c);return d=ue(d,a.dtype),l?U(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const aU=G({avgPool3d_:iU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lU(t,e=0){I(t.length>=1,()=>"Pass at least one tensor to concat");const n=FR(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),n.length===1)return ca(n[0]);const s=n,r={axis:e};return B.runKernel(fg,s,r)}const Xn=G({concat_:lU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uU(t,e,n=!1,s=!1){let r=F(t,"a","matMul"),o=F(e,"b","matMul");[r,o]=Ot(r,o);const i={a:r,b:o},a={transposeA:n,transposeB:s};return B.runKernel(cg,i,a)}const Ke=G({matMul_:uU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(t){const n={x:F(t,"x","sigmoid","float32")};return B.runKernel(vh,n)}const $u=G({sigmoid_:cU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dU(t,e,n){const s=F(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:n};return B.runKernel(Qg,r,o)}const lt=G({slice_:dU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hU(t){const n={x:F(t,"x","tanh","float32")};return B.runKernel(Sh,n)}const l0=G({tanh_:hU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(t,e,n){const s=F(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);I(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),I(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),I(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:n};return B.runKernel(dg,o,i)}const ww=G({batchToSpaceND_:fU});function pU(t){let e;return t.rank===0||t.rank===1?e=U(t,[1,1,1,t.size]):t.rank===2?e=U(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mU(t,e,n,s,r,o){o==null&&(o=.001);const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;s!=null&&(c=F(s,"offset","batchNorm")),I(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),I(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),I(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:pU(i),scale:u,offset:c,mean:a,variance:l},f={varianceEpsilon:o},p=B.runKernel(Cg,h,f);return U(p,i.shape)}const u0=G({batchNorm_:mU});function gU(t,e,n,s,r,o){const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;return s!=null&&(c=F(s,"offset","batchNorm")),I(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),I(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),I(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&I(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&I(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),u0(i,a,l,c,u,o)}const xU=G({batchNorm2d_:gU});function yU(t,e,n,s,r,o){const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;return s!=null&&(c=F(s,"offset","batchNorm")),I(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),I(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),I(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&I(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&I(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),u0(i,a,l,c,u,o)}const vU=G({batchNorm3d_:yU});function bU(t,e,n,s,r,o){const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;return s!=null&&(c=F(s,"offset","batchNorm")),I(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),I(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),I(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&I(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&I(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),u0(i,a,l,c,u,o)}const wU=G({batchNorm4d_:bU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CU(t,e,n){const s=F(t,"x","bincount"),r=F(e,"weights","bincount");I(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),I(n>=0,()=>`size must be non-negative, but got ${n}.`),I(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:n};return B.runKernel(Ob,o,i)}const $U=G({bincount_:CU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kU(t,e){let n=F(t,"broadcastTo","x");const s=n.shape;if(Ro(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const u=n.shape.slice();for(;u.length<e.length;)u.unshift(1);n=U(n,u)}const r=n.shape,o=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])o[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return ca(n);const a={x:n},l={reps:o};return B.runKernel(Ih,a,l)}const Oc=G({broadcastTo_:kU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SU(t){const n={x:F(t,"x","ceil","float32")};return B.runKernel(Vd,n)}const IU=G({ceil_:SU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0(t,e,n){Ro(t),n=n||vu(e);const s={shape:t,value:e,dtype:n};return B.runKernel(qb,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(t,e,n){const s=F(t,"x","clipByValue");if(I(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return c0(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:n};return B.runKernel(Wd,r,o)}const $s=G({clipByValue_:TU});function EU(t){return Xn(t,0)}const NU=G({concat1d_:EU});function RU(t,e){return Xn(t,e)}const AU=G({concat2d_:RU});function DU(t,e){return Xn(t,e)}const FU=G({concat3d_:DU});function OU(t,e){return Xn(t,e)}const PU=G({concat4d_:OU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _U(t,e,n,s,r="NHWC",o=[1,1],i){const a=F(t,"x","conv2d","float32"),l=F(e,"filter","conv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),I(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),I(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Jn("conv2d",s,i);const d=r==="NHWC"?u.shape[3]:u.shape[1];I(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),I(Sn(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),I(Ia(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),I(Ia(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:u,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},p=B.runKernel(pg,h,f);return c?U(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Ta=G({conv2d_:_U});function LU(t,e,n,s,r="NWC",o=1,i){const a=F(t,"x","conv1d"),l=F(e,"filter","conv1d");let u=a,c=!1;a.rank===2&&(c=!0,u=U(a,[1,a.shape[0],a.shape[1]])),I(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),I(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Jn("conv1d",s,i),I(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),I(Sn(n,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`),I(Ia(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),I(Ia(n),()=>"Error in conv1D: Stride should be larger than 0."),I(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=U(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=U(u,[u.shape[0],1,u.shape[1],u.shape[2]]),x=Ta(h,d,[1,n],s,"NHWC",[1,o],i);return c?U(x,[x.shape[2],x.shape[3]]):U(x,[x.shape[0],x.shape[2],x.shape[3]])}const GR=G({conv1d_:LU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(t,e,n,s,r,o="NHWC",i){I(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),I(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),I(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),I(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];I(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),I(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),Jn("conv2dDerInput",r,i);const h={dy:l,filter:n},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},p=B.runKernel(mg,h,f);return u?U(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Cw=G({conv2DBackpropInput_:MU});function zU(t,e,n,s,r,o){const i=F(t,"x","conv2dTranspose"),a=F(e,"filter","conv2dTranspose");return Cw(n,i,a,s,r,"NHWC",o)}const HR=G({conv2dTranspose_:zU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BU(t,e,n,s,r="NDHWC",o=[1,1,1]){const i=F(t,"x","conv3d"),a=F(e,"filter","conv3d");let l=i,u=!1;i.rank===4&&(u=!0,l=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),I(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),I(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),I(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),I(Sn(n,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),I(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),I(Ia(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),I(Ia(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:l,filter:a},d={strides:n,pad:s,dataFormat:r,dilations:o},h=B.runKernel(gg,c,d);return u?U(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const VU=G({conv3d_:BU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WU(t,e,n,s,r){I(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let o=t,i=e,a=!1;e.rank===4&&(a=!0,i=U(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const l=o[4],u=i.shape[4];I(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),I(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),I(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),I(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),I(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c={dy:i,filter:n},d={pad:r,strides:s,inputShape:o},h=B.runKernel(zb,c,d);return a?U(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const jR=G({conv3DBackpropInput_:WU});function UU(t,e,n,s,r){const o=F(t,"x","conv3dTranspose"),i=F(e,"filter","conv3dTranspose");return jR(n,o,i,s,r)}const GU=G({conv3dTranspose_:UU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HU(t){const n={x:F(t,"x","cos","float32")};return B.runKernel(Ud,n)}const $w=G({cos_:HU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(t){const n={x:F(t,"x","cosh","float32")};return B.runKernel(Gd,n)}const KR=G({cosh_:jU});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KU(t,e=0,n=!1,s=!1){const o={x:F(t,"x","cumprod")},i={axis:e,exclusive:n,reverse:s};return B.runKernel(Bb,o,i)}const wv=G({cumprod_:KU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XU(t,e=0,n=!1,s=!1){const o={x:F(t,"x","cumsum")},i={axis:e,exclusive:n,reverse:s};return B.runKernel(xg,o,i)}const XR=G({cumsum_:XU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qU(t,e,n,s=!1){const r=F(t,"x","denseBincount"),o=F(e,"weights","denseBincount");I(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),I(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),I(n>=0,()=>`size must be non-negative, but got ${n}.`),I(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:n,binaryOutput:s};return B.runKernel(Wb,i,a)}const RS=G({denseBincount_:qU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YU(t,e,n="NHWC"){const s=F(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],o=n==="NHWC"?s.shape[2]:s.shape[3],i=n==="NHWC"?s.shape[3]:s.shape[1];I(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),I(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),I(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),I(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return B.runKernel(Ub,a,l)}const QU=G({depthToSpace_:YU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZU(t,e,n,s,r="NHWC",o=[1,1],i){const a=F(t,"x","depthwiseConv2d","float32"),l=F(e,"filter","depthwiseConv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),I(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),I(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=r==="NHWC"?u.shape[3]:u.shape[1];I(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),Jn("depthwiseConv2d",s,i);const h={x:u,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},p=B.runKernel(yg,h,f);return c?U(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const kw=G({depthwiseConv2d_:ZU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JU(t,e,n,s,r=[1,1],o="NHWC"){const i=F(t,"x","dilation2d"),a=F(e,"filter","dilation2d");I(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),I(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),I(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=i,u=!1;i.rank===3&&(l=U(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0),I(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const c={x:l,filter:a},d={strides:n,pad:s,dilations:r},h=B.runKernel(vg,c,d);return u?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const eG=G({dilation2d_:JU});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ru(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const o=n-1-r,i=t[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function Jt(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&n.unshift(o)}return n}function Ie(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let o=t[t.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[n-r-1]=i;else if(i===1)s[n-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(t,e){let n=F(t,"a","equal","string_or_numeric"),s=F(e,"b","equal","string_or_numeric");[n,s]=Ot(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(bg,r)}const Jr=G({equal_:tG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nG(t,e,n){const s=F(e,"a","where"),r=F(n,"b","where"),o=F(t,"condition","where","bool"),i=Ie(Ie(o.shape,s.shape),r.shape),a=Oc(o,i),l=Oc(s,i),u=Oc(r,i),c={condition:a,t:l,e:u};return B.runKernel(Yg,c)}const Ln=G({where_:nG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sG(t){const n={x:F(t,"x","zerosLike")};return B.runKernel(r0,n)}const Be=G({zerosLike_:sG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(t,e){let n=F(t,"a","div"),s=F(e,"b","div");[n,s]=Ot(n,s);const r=ve(n,s),o=Be(r),i=Jr(s,o);return Ln(i,o,r)}const oG=G({divNoNan_:rG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iG(t,e){const n=F(t,"t1","dot"),s=F(e,"t2","dot");I((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],o=s.rank===1?s.size:s.shape[0];if(I(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),n.rank===1&&s.rank===1){const i=U(n,[1,-1]),a=U(s,[-1,1]),l=Ke(i,a);return U(l,[])}else if(n.rank===1&&s.rank===2){const i=U(n,[1,-1]),a=U(s,[s.shape[0],s.shape[1]]),l=Ke(i,a);return U(l,[l.size])}else if(n.rank===2&&s.rank===1){const i=U(s,[-1,1]),a=Ke(n,i);return U(a,[a.size])}else{const i=U(s,[s.shape[0],s.shape[1]]);return Ke(n,i)}}const aG=G({dot_:iG});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lG(t,...e){const n=e.map((r,o)=>F(r,`tensors${o}`,"einsum")),s={equation:t};return B.runKernel(jb,n,s)}const Zu=G({einsum_:lG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uG(t){const n={x:F(t,"x","elu","float32")};return B.runKernel(jd,n)}const d0=G({elu_:uG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cG(t){let e=F(t,"x","erf");I(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ue(e,"float32"));const n={x:e};return B.runKernel(Kd,n)}const qR=G({erf_:cG});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sw(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function YR(t,e,n){const s=t.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[o++]):r.push(e[i++]);return r}function ln(t,e){const n=[],s=t.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&n.push(t[o]);const r=e.map(o=>t[o]);return[n,r]}function Vt(t,e){const n=e.map(s=>1);return YR(t,n,e)}function mn(t,e,n){I(Sw(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Tt(t,e){if(Sw(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function Ei(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Pt(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(t,e=null,n=!1){const r={x:F(t,"x","max")},o={reductionIndices:e,keepDims:n};return B.runKernel(Dg,r,o)}const wr=G({max_:dG});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hG(t,e=null,n=!1){const r={x:F(t,"x","min")},o={axis:e,keepDims:n};return B.runKernel(_g,r,o)}const Jp=G({min_:hG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fG(t,e){let n=F(t,"base","pow"),s=F(e,"exp","pow");[n,s]=Ot(n,s);const r={a:n,b:s};return B.runKernel(uh,r)}const Ea=G({pow_:fG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xe(t,e){if((Ys(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ys(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return a0(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pG(t){const n={x:F(t,"x","sqrt","float32")};return B.runKernel(wh,n)}const kn=G({sqrt_:pG});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mG(t){const e=F(t,"x","square"),n={};return B.runKernel("Square",{x:e},n)}const mt=G({square_:mG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gG(t,e=null,n=!1){let s=F(t,"x","sum");s.dtype==="bool"&&(s=ue(s,"int32"));const r={x:s},o={axis:e,keepDims:n};return B.runKernel(Zg,r,o)}const ye=G({sum_:gG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xG(t,e="euclidean",n=null,s=!1){t=F(t,"x","norm");const r=QR(t,e,n);let o=r.shape;if(s){const i=De(n,t.shape);o=Vt(r.shape,i)}return U(r,o)}function QR(t,e,n=null){if(t.rank===0)return Dn(t);if(t.rank!==1&&n===null)return QR(U(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return ye(Dn(t),n);if(e===1/0)return wr(Dn(t),n);if(e===-1/0)return Jp(Dn(t),n);if(e==="euclidean"||e===2)return kn(ye(Ea(Dn(t),Xe(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return wr(ye(Dn(t),n[0]),n[1]-1);if(e===1/0)return wr(ye(Dn(t),n[1]),n[0]);if(e===-1/0)return Jp(ye(Dn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return kn(ye(mt(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const h0=G({norm_:xG});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yG(t,e=null,n=!1){return h0(t,"euclidean",e,n)}const vG=G({euclideanNorm_:yG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bG(t){const n={x:F(t,"x","exp")};return B.runKernel(Xd,n)}const eo=G({exp_:bG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wG(t,e=0){const n=F(t,"x","expandDims","string_or_numeric");I(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return B.runKernel(wg,s,r)}const Gn=G({expandDims_:wG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CG(t){const n={x:F(t,"x","expm1")};return B.runKernel(qd,n)}const $G=G({expm1_:CG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(t,e){const n=F(t,"x","tile","string_or_numeric");I(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return B.runKernel(Ih,s,r)}const gr=G({tile_:kG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SG(t,e,n,s="float32"){e==null&&(e=t);const r=Ae([t,e],s),o=t<=e?t:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=U(r.toTensor(),[t,e]);if(n==null)return i;if(n.length===1)return gr(Gn(i,0),[n[0],1,1]);if(n.length===2)return gr(Gn(Gn(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return gr(Gn(Gn(Gn(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const ZR=G({eye_:SG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IG(t){const n={x:F(t,"x","floor","float32")};return B.runKernel(Yd,n)}const f0=G({floor_:IG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TG(t,e,n=0,s=0){const r=F(t,"x","gather"),o=F(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:n,batchDims:s};return B.runKernel($g,i,a)}const Iw=G({gather_:TG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EG(t,e){let n=F(t,"a","greater","string_or_numeric"),s=F(e,"b","greater","string_or_numeric");[n,s]=Ot(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(kg,r)}const Is=G({greater_:EG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NG(t,e){let n=F(t,"a","greaterEqual","string_or_numeric"),s=F(e,"b","greaterEqual","string_or_numeric");[n,s]=Ot(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(Zd,r)}const Ga=G({greaterEqual_:NG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RG(t){const n={input:F(t,"input","imag")};return B.runKernel(Zb,n)}const Tw=G({imag_:RG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AG(t){const n={x:F(t,"x","isFinite")};return B.runKernel(eh,n)}const DG=G({isFinite_:AG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FG(t){const n={x:F(t,"x","isInf")};return B.runKernel(th,n)}const OG=G({isInf_:FG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PG(t){const n={x:F(t,"x","isNaN")};return B.runKernel(nh,n)}const _G=G({isNaN_:PG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LG(t,e=.2){const s={x:F(t,"x","leakyRelu")},r={alpha:e};return B.runKernel(Sg,s,r)}const Ew=G({leakyRelu_:LG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MG(t,e){let n=F(t,"a","less","string_or_numeric"),s=F(e,"b","less","string_or_numeric");[n,s]=Ot(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(Ig,r)}const em=G({less_:MG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zG(t,e){let n=F(t,"a","lessEqual","string_or_numeric"),s=F(e,"b","lessEqual","string_or_numeric");[n,s]=Ot(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(Tg,r)}const ku=G({lessEqual_:zG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BG(t,e=5,n=1,s=1,r=.5){const o=F(t,"x","localResponseNormalization");I(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),I(eu(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=U(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:i},u={depthRadius:e,bias:n,alpha:s,beta:r},c=B.runKernel(Ag,l,u);return a?U(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const VG=G({localResponseNormalization_:BG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WG(t){const n={x:F(t,"x","log","float32")};return B.runKernel(sh,n)}const to=G({log_:WG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UG(t){const n={x:F(t,"x","log1p")};return B.runKernel(rh,n)}const JR=G({log1p_:UG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GG(t,e){I(ov(t),()=>"The f passed in variableGrads(f) must be a function"),I(e==null||Array.isArray(e)&&e.every(u=>u instanceof Zp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const u in B.registeredVariables)e.push(B.registeredVariables[u])}const s=n?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),I(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=B.gradients(t,e,null,o);I(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),I(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:i,grads:l}}function ou(t){return B.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HG(t){const n={x:F(t,"x","neg")};return B.runKernel(Mg,n)}const Ft=G({neg_:HG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(t){const n={x:F(t,"x","softplus")};return B.runKernel(bh,n)}const Nh=G({softplus_:jG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(t){const e=F(t,"x","logSigmoid");return ou(s=>({value:Ft(Nh(Ft(s))),gradFunc:i=>z(i,$u(Ft(s)))}))(e)}const XG=G({logSigmoid_:KG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qG(t,e){let n=F(t,"a","sub"),s=F(e,"b","sub");[n,s]=Ot(n,s);const r={a:n,b:s};return B.runKernel($h,r)}const be=G({sub_:qG});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YG(t,e=-1){const n=F(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return ou((r,o)=>{const a=wr(r,e,!0),l=be(r,a),u=be(ue(l,"float32"),to(ye(eo(l),e,!0)));return o([u]),{value:u,gradFunc:(d,h)=>{const[f]=h,p=!0,m=eo(f);return be(d,z(ye(d,e,p),m))}}})(n)}const eA=G({logSoftmax_:YG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QG(t,e=null,n=!1){const s=F(t,"x","logSumExp"),r=De(e,s.shape),o=wr(s,r,!0),i=be(s,o),a=eo(i),l=ye(a,r),u=to(l),c=ne(U(o,u.shape),u);if(n){const d=Vt(c.shape,r);return U(c,d)}return c}const tA=G({logSumExp_:QG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZG(t,e){const n=F(t,"a","logicalAnd","bool"),s=F(e,"b","logicalAnd","bool");Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(Eg,r)}const So=G({logicalAnd_:ZG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JG(t){const n={x:F(t,"x","logicalNot","bool")};return B.runKernel(Ng,n)}const Nw=G({logicalNot_:JG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(t,e){const n=F(t,"a","logicalOr","bool"),s=F(e,"b","logicalOr","bool");Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(Rg,r)}const nA=G({logicalOr_:e6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6(t,e){const n=F(t,"a","logicalXor","bool"),s=F(e,"b","logicalXor","bool");return Ie(n.shape,s.shape),So(nA(t,e),Nw(So(t,e)))}const n6=G({logicalXor_:t6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6(t,e,n,s,r){const o=F(t,"x","maxPool"),i=1;let a=o,l=!1;o.rank===3&&(l=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),I(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),I(Sn(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Jn("maxPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r},d=B.runKernel(Fg,u,c);return l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Rw=G({maxPool_:s6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(t,e=[1,1,1],n,s,r,o="NDHWC"){const i=F(t,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),I(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),I(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Jn("maxPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:o},d=B.runKernel(Og,u,c);return l?U(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const o6=G({maxPool3d_:r6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(t,e){let n=F(t,"a","maximum"),s=F(e,"b","maximum");[n,s]=Ot(n,s),n.dtype==="bool"&&(n=ue(n,"int32"),s=ue(s,"int32")),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(oh,r)}const Ni=G({maximum_:i6});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(t,e=null,n=!1){const r={x:F(t,"x","mean")},o={axis:e,keepDims:n};return B.runKernel(Pg,r,o)}const Bt=G({mean_:a6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kt(t,e="float32"){if(Ro(t),e==="complex64"){const s=kt(t,"float32"),r=kt(t,"float32");return su(s,r)}const n=$n(Q(t),e);return B.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fo(t,e="float32"){if(Ro(t),e==="complex64"){const s=Fo(t,"float32"),r=kt(t,"float32");return su(s,r)}const n=Ib(Q(t),e);return B.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(t,e){let n=F(t,"a","minimum"),s=F(e,"b","minimum");[n,s]=Ot(n,s),n.dtype==="bool"&&(n=ue(n,"int32"),s=ue(s,"int32")),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(ih,r)}const dd=G({minimum_:l6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(t,e,n){I(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=F(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");I(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)I(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),I(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:n},i={x:s};return B.runKernel(Lg,i,o)}const c6=G({mirrorPad_:u6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(t,e){let n=F(t,"a","mod"),s=F(e,"b","mod");[n,s]=Ot(n,s);const r={a:n,b:s};return B.runKernel(ah,r)}const h6=G({mod_:d6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(t,e=null,n=!1){t=F(t,"x","moments");const s=De(e,t.shape),r=Bt(t,s,n);let o=r.shape;n||(o=Vt(r.shape,s));const i=mt(be(ue(t,"float32"),U(r,o))),a=Bt(i,s,n);return{mean:r,variance:a}}const Aw=G({moments_:f6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6(t,e){let n=F(t,"a","notEqual","string_or_numeric"),s=F(e,"b","notEqual","string_or_numeric");[n,s]=Ot(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return B.runKernel(zg,r)}const tm=G({notEqual_:p6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:F(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return B.runKernel(Vg,i,a)}const sA=G({oneHot_:m6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(t){const n={x:F(t,"x","onesLike")};return B.runKernel(Bg,n)}const Qs=G({onesLike_:g6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(t,e,n=0){const s=F(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},o={x:s};return B.runKernel(Ug,o,r)}const Dw=G({pad_:x6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y6(t,e,n){const s=F(t,"x","spaceToBatchND");I(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),I(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),I(s.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:n};return B.runKernel(Jg,r,o)}const Fw=G({spaceToBatchND_:y6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(t,e,n,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=F(t,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),I(Sn(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const c=Js(l.shape,e,o,r,s),d=[c.dilationHeight,c.dilationWidth];let h;s==="same"?h=w6([c.filterHeight,c.filterWidth],d):h=[[0,0],[0,0]];const f=d[0]===1&&d[1]===1,[p,m]=b6([c.inHeight,c.inWidth],d,h),x=f?s:"valid",g=f?l:Fw(l,d,p),v=(n==="avg"?()=>bw(g,e,o,x,i):()=>Rw(g,e,o,x,i))(),b=f?v:ww(v,d,m);return u?U(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function b6(t,e,n){const s=n.map(c=>c[0]),r=n.map(c=>c[1]),o=t.concat(s,r),i=e.map((c,d)=>(c-o[d]%c)%c),a=r.map((c,d)=>c+i[d]),l=e.map((c,d)=>[s[d],a[d]]),u=e.map((c,d)=>[0,i[d]]);return[l,u]}function w6(t,e){const s=t.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const C6=G({pool_:v6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $6(t,e){const n=F(t,"x","prelu"),s=F(e,"alpha","prelu"),r={x:n,alpha:s};return B.runKernel(Gg,r)}const Ow=G({prelu_:$6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(t,e=null,n=!1){let s=F(t,"x","prod");s.dtype==="bool"&&(s=ue(s,"int32"));const r={x:s},o={axis:e,keepDims:n};return B.runKernel(Hg,r,o)}const S6=G({prod_:k6});var Pw={exports:{}};Pw.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var d=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=d|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function o(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function i(l,u){var c=new r(l),d=u&&u.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,d&&(typeof d=="object"&&o(d,c),h.state=function(){return o(c,{})}),h}function a(){var l=4022871197,u=function(c){c=String(c);for(var d=0;d<c.length;d++){l+=c.charCodeAt(d);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=i:this.alea=i})(za,t)})(Pw);var I6=Pw.exports,_w={exports:{}};_w.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xor128=i})(za,t)})(_w);var T6=_w.exports,Lw={exports:{}};Lw.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xorwow=i})(za,t)})(Lw);var E6=Lw.exports,Mw={exports:{}};Mw.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,d=l.i,h,f;return h=c[d],h^=h>>>7,f=h^h<<24,h=c[d+1&7],f^=h^h>>>10,h=c[d+3&7],f^=h^h>>>3,h=c[d+4&7],f^=h^h<<7,h=c[d+7&7],h=h^h<<13,f^=h^h<<9,c[d]=f,l.i=d+1&7,f};function u(c,d){var h,f=[];if(d===(d|0))f[0]=d;else for(d=""+d,h=0;h<d.length;++h)f[h&7]=f[h&7]<<15^d.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],c.x=f,c.i=0,h=256;h>0;--h)c.next()}u(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=u.next,d.quick=d,c&&(c.x&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xorshift7=i})(za,t)})(Mw);var N6=Mw.exports,zw={exports:{}};zw.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,d=l.X,h=l.i,f,p;return l.w=c=c+1640531527|0,p=d[h+34&127],f=d[h=h+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=d[h]=p^f,l.i=h,p+(c^c>>>16)|0};function u(c,d){var h,f,p,m,x,g=[],y=128;for(d===(d|0)?(f=d,d=null):(d=d+"\0",f=0,y=Math.max(y,d.length)),p=0,m=-32;m<y;++m)d&&(f^=d.charCodeAt((m+32)%d.length)),m===0&&(x=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(x=x+1640531527|0,h=g[m&127]^=f+x,p=h==0?p+1:0);for(p>=128&&(g[(d&&d.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=g[p+34&127],h=g[p=p+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,g[p]=f^h;c.w=x,c.X=g,c.i=p}u(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=u.next,d.quick=d,c&&(c.X&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xor4096=i})(za,t)})(zw);var R6=zw.exports,Bw={exports:{}};Bw.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var d=l.b,h=l.c,f=l.d,p=l.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^p,p=p-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-f|0,l.d=f<<16^h>>>16^p,l.a=p-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.tychei=i})(za,t)})(Bw);var A6=Bw.exports,rA={exports:{}};const D6={},F6=Object.freeze(Object.defineProperty({__proto__:null,default:D6},Symbol.toStringTag,{value:"Module"})),O6=_M(F6);(function(t){(function(e,n,s){var r=256,o=6,i=52,a="random",l=s.pow(r,o),u=s.pow(2,i),c=u*2,d=r-1,h;function f(b,w,$){var k=[];w=w==!0?{entropy:!0}:w||{};var C=g(x(w.entropy?[b,v(n)]:b??y(),3),k),S=new p(k),T=function(){for(var R=S.g(o),A=l,E=0;R<u;)R=(R+E)*r,A*=r,E=S.g(1);for(;R>=c;)R/=2,A/=2,E>>>=1;return(R+E)/A};return T.int32=function(){return S.g(4)|0},T.quick=function(){return S.g(4)/4294967296},T.double=T,g(v(S.S),n),(w.pass||$||function(R,A,E,N){return N&&(N.S&&m(N,S),R.state=function(){return m(S,{})}),E?(s[a]=R,A):R})(T,C,"global"in w?w.global:this==s,w.state)}function p(b){var w,$=b.length,k=this,C=0,S=k.i=k.j=0,T=k.S=[];for($||(b=[$++]);C<r;)T[C]=C++;for(C=0;C<r;C++)T[C]=T[S=d&S+b[C%$]+(w=T[C])],T[S]=w;(k.g=function(R){for(var A,E=0,N=k.i,P=k.j,_=k.S;R--;)A=_[N=d&N+1],E=E*r+_[d&(_[N]=_[P=d&P+A])+(_[P]=A)];return k.i=N,k.j=P,E})(r)}function m(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function x(b,w){var $=[],k=typeof b,C;if(w&&k=="object")for(C in b)try{$.push(x(b[C],w-1))}catch{}return $.length?$:k=="string"?b:b+"\0"}function g(b,w){for(var $=b+"",k,C=0;C<$.length;)w[d&C]=d&(k^=w[d&C]*19)+$.charCodeAt(C++);return v(w)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(r):(b=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(b)),v(b)}catch{var w=e.navigator,$=w&&w.plugins;return[+new Date,e,$,e.screen,v(n)]}}function v(b){return String.fromCharCode.apply(0,b)}if(g(s.random(),n),t.exports){t.exports=f;try{h=O6}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:za,[],Math)})(rA);var P6=rA.exports,_6=I6,L6=T6,M6=E6,z6=N6,B6=R6,V6=A6,Ha=P6;Ha.alea=_6;Ha.xor128=L6;Ha.xorwow=M6;Ha.xorshift7=z6;Ha.xor4096=B6;Ha.tychei=V6;var Vw=Ha;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oA{constructor(e,n,s,r,o){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=Vw.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class W6{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=Vw.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6(t,e=0,n=1,s,r){if(Ro(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new oA(e,n,s,!1,r),i=Ae(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const G6=G({randomNormal_:U6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6(t,e=0,n=1,s="float32",r){Ro(t);const o=Ae(t,s),i=new W6(e,n,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Rh=G({randomUniform_:H6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hd(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return B.runKernel(ow,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6(t){const n={input:F(t,"input","real")};return B.runKernel(iw,n)}const nm=G({real_:j6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6(t){const n={x:F(t,"x","reciprocal")};return B.runKernel(ch,n)}const X6=G({reciprocal_:K6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(t){const n={x:F(t,"x","relu")};return B.runKernel(dh,n)}const ja=G({relu_:q6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(t){const n={x:F(t,"x","relu6")};return B.runKernel(hh,n)}const iA=G({relu6_:Y6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(t,e){const s={x:F(t,"x","reverse")},r={dims:e};return B.runKernel(qg,s,r)}const Na=G({reverse_:Q6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(t){const n={x:F(t,"x","round")};return B.runKernel(fh,n)}const aA=G({round_:Z6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(t){const n={x:F(t,"x","rsqrt","float32")};return B.runKernel(ph,n)}const lA=G({rsqrt_:J6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(t){const n={x:F(t,"x","selu")};return B.runKernel(mh,n)}const uA=G({selu_:e5});function t5(t,e,n,s,r,o=[1,1],i="NHWC"){const a=F(t,"x","separableConv2d"),l=F(e,"depthwiseFilter","separableConv2d"),u=F(n,"pointwiseFilter","separableConv2d");let c=a,d=!1;if(a.rank===3&&(d=!0,c=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");I(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),I(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),I(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),I(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),I(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const h=l.shape[2],f=l.shape[3];I(u.shape[2]===h*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*f}, but got ${u.shape[2]}.`);const p=kw(c,l,s,r,i,o),x=Ta(p,u,1,"valid",i);return d?U(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const cA=G({separableConv2d_:t5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(t){const n={x:F(t,"x","sign")};return B.runKernel(yh,n)}const s5=G({sign_:n5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(t){const n={x:F(t,"x","sin","float32")};return B.runKernel(gh,n)}const dA=G({sin_:r5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(t){const n={x:F(t,"x","sinh")};return B.runKernel(xh,n)}const hA=G({sinh_:o5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(t,e,n){const s=F(t,"x","slice1d");return I(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),lt(s,[e],[n])}const Ww=G({slice1d_:i5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(t,e,n){const s=F(t,"x","slice2d");return I(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),lt(s,e,n)}const fA=G({slice2d_:a5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(t,e,n){const s=F(t,"x","slice3d");return I(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),lt(s,e,n)}const Uw=G({slice3d_:l5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(t,e,n){const s=F(t,"x","slice4d");return I(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),lt(s,e,n)}const sm=G({slice4d_:u5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(t,e=-1){const n=F(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return B.runKernel(t0,s,r)}const Gw=G({softmax_:c5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(t){I(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return B.runKernel(Xb,e)}const pA=G({fft_:d5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5(t){I(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return B.runKernel(Qb,e)}const Cv=G({ifft_:h5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=U(t,[n,e]);s=Cv(r)}else{const r=[n,2*(e-1)],o=U(nm(t),[n,e]),i=U(Tw(t),[n,e]),a=Na(lt(o,[0,1],[n,e-2]),1),l=z(Na(lt(i,[0,1],[n,e-2]),1),Xe(-1)),u=Xn([o,a],1),c=Xn([i,l],1),d=U(su(u,c),[r[0],r[1]]);s=Cv(d)}if(s=nm(s),t.rank===3&&t.shape[0]!==0){const r=s,o=t.shape[0];s=U(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const p5=G({irfft_:f5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(t,e,n=0){const r={x:F(t,"x","split")},o={numOrSizeSplits:e,axis:n};return B.runKernel(e0,r,o)}const ws=G({split_:m5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(t,e){I(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const p=t.shape.map(x=>0),m=t.shape.map(x=>x);m[t.shape.length-1]=e,r=lt(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,r=Xn([t,kt(p)],t.shape.length-1),n=e}else r=t;const o=Be(r),i=U(su(r,o),[s,n]),a=pA(i),l=Math.floor(n/2)+1,u=nm(a),c=Tw(a),d=ws(u,[l,n-l],u.shape.length-1),h=ws(c,[l,n-l],c.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=l,U(su(d[0],h[0]),f)}const x5=G({rfft_:g5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(t,e){let n=F(t,"a","squaredDifference"),s=F(e,"b","squaredDifference");[n,s]=Ot(n,s),Ie(n.shape,s.shape);const r={a:n,b:s},o={};return B.runKernel(Ch,r,o)}const v5=G({squaredDifference_:y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(t,e){const n=F(t,"x","squeeze","string_or_numeric");return U(n,Si(n.shape,e).newShape)}const Ah=G({squeeze_:b5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5(t,e=0){const n=FR(t,"tensors","stack","string_or_numeric");I(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&I(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return B.runKernel(Wg,s,r)}const Io=G({stack_:w5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(t,e=0){const s={x:F(t,"x","step")},r={alpha:e};return B.runKernel(Th,s,r)}const Dh=G({step_:C5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(t,e,n,s,r=0,o=0,i=0,a=0,l=0){const c={x:F(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return B.runKernel(dw,c,d)}const k5=G({stridedSlice_:$5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(t){const n={x:F(t,"x","tan","float32")};return B.runKernel(kh,n)}const I5=G({tan_:S5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function os(t,e){zN(t);const n=i0(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return a0(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sx(t,e,n){if(zN(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=i0(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return a0(t,e,s,n)}function mA(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(o+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(o+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(o+` update.rank != ${r+t.length-s}`);for(let i=0;i<r;++i)if(n.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<n.rank-r;++i)if(n.shape[i+r]!==t[i+s])throw new Error(o+` updates.shape[${i+r}] (${n.shape[i+r]}) != shape[${i+r}] (${t[i+r]})`)}function T5(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}mA(n,e,t)}function Ka(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=n.length;let i=1;for(let d=r;d<o;++d)i*=n[d];const a=r<1?1:r,l=Q(e.shape)/a,u=[...ge(n.slice(0,r)),1],c=Q(n);return{sliceRank:r,numUpdates:l,sliceSize:i,strides:u,outputSize:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E5(t,e=1,n=!0){const s=F(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:n},[a,l]=B.runKernel(hw,o,i);return{values:a,indices:l}}const N5=G({topk_:E5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(t,e=0,n=1,s,r){if(Ro(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new oA(e,n,s,!0,r),i=Ae(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const gA=G({truncatedNormal_:R5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A5(t,e=0){const n=F(t,"x","unique","string_or_numeric");I(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[o,i]=B.runKernel(pw,s,r);return{values:o,indices:i}}const D5=G({unique_:A5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(t,e,n){const s=F(t,"x","unsortedSegmentSum"),r=F(e,"segmentIds","unsortedSegmentSum","int32");I(eu(n),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:n};return B.runKernel(s0,o,i)}const xA=G({unsortedSegmentSum_:F5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(t,e=0){const n=F(t,"x","unstack","string_or_numeric");I(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return B.runKernel(n0,s,r)}const Ra=G({unstack_:O5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5(t,e=!0,n,s){return B.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(t,e){const n=[];for(let o=0;o<e.length;o++)e[o]&&n.push(o);const s=Ae(t,"int32"),r=Ae([n.length,t.length],"int32");for(let o=0;o<n.length;o++){const i=s.indexToLoc(n[o]),a=o*t.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(t,e,n){const s=F(t,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),I(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{I(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?j(()=>{let i=nm(s),a=Tw(s);return i=B.runKernel(zl,{x:i},o),a=B.runKernel(zl,{x:a},o),n&&(a=Ft(a)),su(i,a)}):B.runKernel(zl,r,o)}const ze=G({transpose_:_5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(t,e){if(e==null)return t.shape.slice();if(qe(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(t,e,n,s){const r=F(t,"x","dropout");if(I(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),I(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Gt?r.clone():r;const o=L5(r,n),i=1-e,a=ve(f0(ne(Rh(o,0,1,"float32",s),i)),i);return z(r,a)}const z5=G({dropout_:M5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(t,e,n,s,r,o="NHWC",i){let a=t;t.rank===3&&(a=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=U(e,[1,e.shape[0],e.shape[1],e.shape[2]])),I(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),I(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),I(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const u=o==="NHWC"?a.shape[3]:a.shape[1],c=o==="NHWC"?l.shape[3]:l.shape[1];I(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),I(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Jn("conv2dDerFilter",r,i);const d={x:a,dy:l},h={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:n};return B.runKernel(Lb,d,h)}const Hw=G({conv2DBackpropFilter_:B5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jw(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return z(t,Dh(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Kw(t,e){let n=e;const s=Jt(t.shape,e.shape);return s.length>0&&(n=ye(n,s)),U(n,t.shape)}function Xw(t,e,n,s){if(e==="linear")return t;if(e==="relu")return ja(t);if(e==="elu")return d0(t);if(e==="relu6")return iA(t);if(e==="prelu")return Ow(t,n);if(e==="leakyrelu")return Ew(t,s);if(e==="sigmoid")return $u(t);throw new Error(`Unknown fused activation ${e}.`)}const qw=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",qw(B.state.gradientDepth,l)===!1){I(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=Ta(t,e,n,s,r,o,i);return a!=null&&($=ne($,a)),Xw($,l,u,c)}const d=F(t,"x","conv2d","float32"),h=F(e,"filter","conv2d","float32");let f=d,p=!1;d.rank===3&&(p=!0,f=U(d,[1,d.shape[0],d.shape[1],d.shape[2]])),I(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),I(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Jn("fused conv2d",s,i);const m=r==="NHWC"?f.shape[3]:f.shape[1];I(h.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`),I(Sn(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);const x=pn(f.shape,h.shape,n,o,s,i);let g;a!=null&&(g=F(a,"bias","fused conv2d"),[g]=Ot(g,d),r==="NHWC"?Ie(x.outShape,g.shape):(I(g.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`),I(g.shape.length===0||g.shape[0]===x.outChannels||g.shape[0]===1,()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let y;if(u!=null){const $=u.shape;if(I($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)I($[0]===1||$[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${x.outChannels}).`);else if($.length===3)try{Ie($,x.outShape)}catch{const C=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(C)}y=F(u,"prelu weights","fused conv2d")}const v=($,k)=>{I(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[C,S,T,R]=k,A=jw($,T,l);I(Sa(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const E=Cw(S.shape,A,C,n,s),N=Hw(S,A,C.shape,n,s),P=[E,N];if(R!=null){const _=Kw(R,A);P.push(_)}return P},b={x:f,filter:h,bias:g,preluActivationWeights:y},w={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return a==null?ou((k,C,S)=>{let T=B.runKernel(qp,b,w);return S([C,k,T]),p&&(T=U(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:v}})(f,h):ou((k,C,S,T)=>{let R=B.runKernel(qp,b,w);return T([C,k,R,S]),p&&(R=U(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:v}})(f,h,g)}const W5=G({fusedConv2d_:V5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(t,e,n,s,r,o=[1,1],i){let a=t;t.rank===3&&(a=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},c={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:n};return B.runKernel(Gb,u,c)}const G5=G({depthwiseConv2dNativeBackpropFilter_:U5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(t,e,n,s,r,o=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:n},c={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:t},d=B.runKernel(Hb,u,c);return l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const j5=G({depthwiseConv2dNativeBackpropInput_:H5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(qw(B.state.gradientDepth,o)===!1){let R=Ke(t,e,n,s);return r!=null&&(R=ne(R,r)),Xw(R,o,i,a)}let l=F(t,"a","fused matMul"),u=F(e,"b","fused matMul");[l,u]=Ot(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?u.shape[u.rank-1]:u.shape[u.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],f=s?u.shape[u.rank-2]:u.shape[u.rank-1],p=l.shape.slice(0,-2),m=u.shape.slice(0,-2),x=Q(p),g=Q(m);I(c===d,()=>`Error in fused matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${s} must match.`);const v=Ie(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([h,f]),b=n?U(l,[x,c,h]):U(l,[x,h,c]),w=s?U(u,[g,f,d]):U(u,[g,d,f]);let $;r!=null&&($=F(r,"bias","fused matMul"),[$]=Ot($,l),Ie(v,$.shape));let k;i!=null&&(k=F(i,"prelu weights","fused matMul"));const C=(R,A)=>{const[E,N,P,_]=A,M=jw(U(R,P.shape),P,o);let D,W;if(!n&&!s?(D=Ke(M,N,!1,!0),W=Ke(E,M,!0,!1)):!n&&s?(D=Ke(M,N,!1,!1),W=Ke(M,E,!0,!1)):n&&!s?(D=Ke(N,M,!1,!0),W=Ke(E,M,!1,!1)):(D=Ke(N,M,!0,!0),W=Ke(M,E,!0,!0)),r!=null){const H=Kw(_,M);return[D,W,H]}else return[D,W]},S={a:b,b:w,bias:$,preluActivationWeights:k},T={transposeA:n,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?ou((A,E,N)=>{const P=B.runKernel(Xp,S,T);return N([A,E,P]),{value:U(P,v),gradFunc:C}})(b,w):ou((A,E,N,P)=>{const _=B.runKernel(Xp,S,T);return P([A,E,_,N]),{value:U(_,v),gradFunc:C}})(b,w,$)}const AS=G({fusedMatMul_:K5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(t,e,n,s,r="bilinear",o=0){const i=F(t,"image","cropAndResize"),a=F(e,"boxes","cropAndResize","float32"),l=F(n,"boxInd","cropAndResize","int32"),u=a.shape[0];I(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),I(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),I(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),I(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),I(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),I(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const c={image:i,boxes:a,boxInd:l},d={method:r,extrapolationValue:o,cropSize:s};return B.runKernel(Vb,c,d)}const q5=G({cropAndResize_:X5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(t){const e=F(t,"image","flipLeftRight","float32");I(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return B.runKernel(Yb,n,{})}const Q5=G({flipLeftRight_:Y5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(t){const e=F(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];I(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),I(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,gr(e,r)}const J5=G({grayscaleToRGB_:Z5});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eH(t){const e=F(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];I(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),I(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=ue(e,"float32"),i=os([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Zu("ij,j->i",o,i);break;case 3:a=Zu("ijk,k->ij",o,i);break;case 4:a=Zu("ijkl,l->ijk",o,i);break;case 5:a=Zu("ijklm,m->ijkl",o,i);break;case 6:a=Zu("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=Gn(a,-1),ue(a,r)}const tH=G({rgbToGrayscale_:eH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nH(t,e,n=0,s=.5){const r=F(t,"image","rotateWithOffset","float32");I(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:n,center:s};return B.runKernel(mw,o,i)}const sH=G({rotateWithOffset_:nH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Su(t,e,n,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=t.shape[0];return n=Math.min(n,i),I(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),I(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),I(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),I(e.rank===1,()=>"scores must be a 1D tensor"),I(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),I(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=F(t,"boxes","nonMaxSuppression","float32"),i=F(e,"scores","nonMaxSuppression","float32"),a=Su(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return B.runKernel(nw,{boxes:o,scores:i},l)}const oH=G({nonMaxSuppression_:rH});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iH(t,e,n){const s=aH(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function aH(t,e,n){return uH(t,e,n||lH)}function lH(t,e){return t>e?1:t<e?-1:0}function uH(t,e,n){let s=0,r=t.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=n(e,t[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yw(t,e,n,s,r){return Jw(t,e,n,s,r,0)}function Qw(t,e,n,s,r,o){return Jw(t,e,n,s,r,0,!1,o,!0)}function Zw(t,e,n,s,r,o){return Jw(t,e,n,s,r,o,!0)}function Jw(t,e,n,s,r,o,i=!1,a=!1,l=!1){const u=[];for(let x=0;x<e.length;x++)e[x]>r&&u.push({score:e[x],boxIndex:x,suppressBeginIndex:0});u.sort(DS);const c=o>0?-.5/o:0,d=[],h=[];for(;d.length<n&&u.length>0;){const x=u.pop(),{score:g,boxIndex:y,suppressBeginIndex:v}=x;if(g<r)break;let b=!1;for(let w=d.length-1;w>=v;--w){const $=cH(t,y,d[w]);if($>=s){b=!0;break}if(x.score=x.score*dH(s,c,$),x.score<=r)break}x.suppressBeginIndex=d.length,b||(x.score===g?(d.push(y),h.push(x.score)):x.score>r&&iH(u,x,DS))}const f=d.length,p=n-f;a&&p>0&&(d.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const m={selectedIndices:d};return i&&(m.selectedScores=h),l&&(m.validOutputs=f),m}function cH(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),c=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),h=Math.max(r[1],r[3]),f=(a-o)*(l-i),p=(d-u)*(h-c);if(f<=0||p<=0)return 0;const m=Math.max(o,u),x=Math.max(i,c),g=Math.min(a,d),y=Math.min(l,h),v=Math.max(g-m,0)*Math.max(y-x,0);return v/(f+p-v)}function dH(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function DS(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function hH(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=F(t,"boxes","nonMaxSuppressionAsync"),i=F(e,"scores","nonMaxSuppressionAsync"),a=Su(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([o.data(),i.data()]),u=l[0],c=l[1],{selectedIndices:d}=Yw(u,c,n,s,r);return o!==t&&o.dispose(),i!==e&&i.dispose(),os(d,"int32")}const fH=hH;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pH(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Su(i,a,n,s,r,o);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u={boxes:i,scores:a},c={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},d=B.runKernel(rw,u,c);return{selectedIndices:d[0],selectedScores:d[1]}}const mH=G({nonMaxSuppressionWithScore_:pH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function gH(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Su(i,a,n,s,r,o);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u=await Promise.all([i.data(),a.data()]),c=u[0],d=u[1],{selectedIndices:h,selectedScores:f}=Zw(c,d,n,s,r,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:os(h,"int32"),selectedScores:os(f)}}const xH=gH;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yH(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Su(i,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,d=l.scoreThreshold,h={boxes:i,scores:a},f={maxOutputSize:u,iouThreshold:c,scoreThreshold:d,padToMaxOutputSize:o},p=B.runKernel(sw,h,f);return{selectedIndices:p[0],validOutputs:p[1]}}const vH=G({nonMaxSuppressionPadded_:yH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function bH(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Su(i,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,d=l.scoreThreshold,[h,f]=await Promise.all([i.data(),a.data()]),{selectedIndices:p,validOutputs:m}=Qw(h,f,u,c,d,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:os(p,"int32"),validOutputs:Xe(m,"int32")}}const wH=bH;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CH(t,e,n=!1,s=!1){const r=F(t,"images","resizeBilinear");I(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),I(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),I(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:s,size:e},u=B.runKernel(Xg,a,l);return i?U(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const vA=G({resizeBilinear_:CH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(t,e,n=!1,s=!1){const r=F(t,"images","resizeNearestNeighbor");I(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),I(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),I(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),I(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:s,size:e},u=B.runKernel(Kg,a,l);return i?U(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const bA=G({resizeNearestNeighbor_:$H});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(t,e="binary",n=!1,s=.5){const r=F(t,"image","threshold"),o=.2989,i=.587,a=.114,l=r.shape[0]*r.shape[1];let u=z(os([s]),255),c,d,h,f;if(I(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),I(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),I(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),I(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[c,d,h]=ws(r,[1,1,1],-1);const x=z(c,o),g=z(d,i),y=z(h,a);f=ne(ne(x,g),y)}else f=t;if(e==="otsu"){const x=$U(ue(aA(f),"int32"),Vn([]),256);u=SH(x,l)}const p=n?ku(f,u):Is(f,u);return ue(z(p,255),"int32")}function SH(t,e){let n=os([-1]),s=os([0]),r=os([0]),o,i,a,l,u,c;for(let d=0;d<t.size-1;d++){o=lt(t,0,d+1),i=lt(t,d+1),u=ve(ye(o),e),c=ve(ye(i),e);const h=ye(z(o,hd(0,o.size)));a=ve(h,ye(o));const f=c0(i.shape,o.size),p=ne(hd(0,i.size),f),m=z(i,p);l=ve(ye(m),ye(i));const x=be(a,l),g=be(a,l),y=z(u,c);r=z(z(y,x),g);const v=Is(r,s);s=Ln(v,r,s),n=Ln(v,os([d]),n)}return n}const IH=G({threshold_:kH});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TH(t,e,n="nearest",s="constant",r=0,o){const i=F(t,"image","transform","float32"),a=F(e,"transforms","transform","float32");I(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),I(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),I(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:i,transforms:a},u={interpolation:n,fillMode:s,fillValue:r,outputShape:o};return B.runKernel(fw,l,u)}const EH=G({transform_:TH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NH(t,e,n){const s=F(t,"a","bandPart");I(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,l;typeof e=="number"?(I(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),I(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=F(e<0?o:e,"numLower","bandPart")):(I(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Ln(em(e,0),o,dd(e,o))),typeof n=="number"?(I(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),I(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),l=F(n<0?i:n,"numUpper","bandPart")):(I(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Ln(em(n,0),i,dd(n,i)));const u=U(hd(0,o,1,"int32"),[-1,1]),c=hd(0,i,1,"int32"),d=be(u,c),h=So(ku(d,a),Ga(d,Ft(l))),f=kt([o,i],s.dtype);return U(Io(Ra(U(s,[-1,o,i])).map(p=>Ln(h,p,f))),r)}const RH=G({bandPart_:NH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AH(t){let e;if(Array.isArray(t)){e=!1,I(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let o=1;o<t.length;++o)I(t[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[o].shape[0]} vs. ${r})`)}else e=!0,t=ws(t,t.shape[0],0).map(r=>Ah(r,[0]));I(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(B.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=z(ye(z(n[i],o)),n[i]);o=be(o,a)}return ve(o,h0(o,"euclidean"))}));return e?Io(n,0):n}const DH=G({gramSchmidt_:AH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FH(t,e=!1){if(I(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return FS(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),s=Ra(U(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],o=[];s.forEach(l=>{const[u,c]=FS(l,e);r.push(u),o.push(c)});const i=U(Io(r,0),t.shape),a=U(Io(o,0),t.shape);return[i,a]}}function FS(t,e=!1){return B.tidy(()=>{I(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=ZR(n),o=ca(t);const i=Sx([[1]],[1,1]);let a=ca(i);const l=n>=s?s:n;for(let u=0;u<l;++u){const c=o,d=a,h=r;[a,o,r]=B.tidy(()=>{const f=lt(o,[u,u],[n-u,1]),p=h0(f),m=lt(o,[u,u],[1,1]),x=Ln(Is(m,0),Sx([[-1]]),Sx([[1]])),g=be(m,z(x,p)),y=ve(f,g);y.shape[0]===1?a=ca(i):a=Xn([i,lt(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);const v=Ft(ve(Ke(x,g),p)),b=lt(o,[u,0],[n-u,s]),w=z(v,a),$=ze(a);if(u===0)o=be(b,Ke(w,Ke($,b)));else{const S=be(b,Ke(w,Ke($,b)));o=Xn([lt(o,[0,0],[u,s]),S],0)}const k=ze(w),C=lt(r,[0,u],[n,r.shape[1]-u]);if(u===0)r=be(C,Ke(Ke(C,a),k));else{const S=be(C,Ke(Ke(C,a),k));r=Xn([lt(r,[0,0],[n,u]),S],1)}return[a,o,r]}),Oe([c,d,h])}return!e&&n>s&&(r=lt(r,[0,0],[n,s]),o=lt(o,[0,0],[s,s])),[r,o]})}const OH=G({qr_:FH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xo={flipLeftRight:Q5,grayscaleToRGB:J5,resizeNearestNeighbor:bA,resizeBilinear:vA,rgbToGrayscale:tH,rotateWithOffset:sH,cropAndResize:q5,nonMaxSuppression:oH,nonMaxSuppressionAsync:fH,nonMaxSuppressionWithScore:mH,nonMaxSuppressionWithScoreAsync:xH,nonMaxSuppressionPadded:vH,nonMaxSuppressionPaddedAsync:wH,threshold:IH,transform:EH},PH={bandPart:RH,gramSchmidt:DH,qr:OH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _H=new Map,LH=new Map;class Iu{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Bs{constructor(){this.classNameMap={}}static getMap(){return Bs.instance==null&&(Bs.instance=new Bs),Bs.instance}static register(e){Bs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ee(t,e,n){I(t.className!=null,()=>"Class being registered does not have the static className property defined."),I(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),I(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return Bs.register(t),_H.set(r,t),LH.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ri extends Iu{minimize(e,n=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Oe(o),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return GG(e,n)}dispose(){this.iterations_!=null&&Oe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Xe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ri,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wA extends Ri{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=B.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=B.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:j(()=>Be(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:j(()=>Be(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;j(()=>{const c=ne(z(l,this.rho),z(mt(a),1-this.rho)),d=z(ve(kn(ne(u,this.epsilon)),kn(ne(l,this.epsilon))),a),h=ne(z(u,this.rho),z(mt(d),1-this.rho));l.assign(c),u.assign(h);const f=ne(z(d,-this.learningRate),o);o.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Oe(this.accumulatedGrads.map(e=>e.variable)),Oe(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CA extends Ri{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=B.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:j(()=>c0(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;j(()=>{const l=ne(a,mt(i));a.assign(l);const u=ne(z(ve(i,kn(ne(l,B.backend.epsilon()))),-this.learningRate),o);o.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Oe(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $A extends Ri{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],j(()=>{this.accBeta1=Xe(n).variable(),this.accBeta2=Xe(s).variable()}),r==null&&(this.epsilon=B.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);j(()=>{const s=be(1,this.accBeta1),r=be(1,this.accBeta2);n.forEach((o,i)=>{const a=B.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:j(()=>Be(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:j(()=>Be(a).variable(l))});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const c=this.accumulatedFirstMoment[i].variable,d=this.accumulatedSecondMoment[i].variable,h=ne(z(c,this.beta1),z(u,1-this.beta1)),f=ne(z(d,this.beta2),z(mt(u),1-this.beta2)),p=ve(h,s),m=ve(f,r);c.assign(h),d.assign(f);const x=ne(z(ve(p,ne(kn(m),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(z(this.accBeta1,this.beta1)),this.accBeta2.assign(z(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Oe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Oe(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),j(()=>{this.accBeta1.assign(Ea(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ea(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kA extends Ri{static get className(){return"Adamax"}constructor(e,n,s,r=null,o=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],j(()=>{this.iteration=Xe(0).variable(),this.accBeta1=Xe(n).variable()}),r==null&&(this.epsilon=B.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);j(()=>{const s=be(1,this.accBeta1),r=ve(-this.learningRate,ne(z(this.iteration,this.decay),1));n.forEach((o,i)=>{const a=B.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Be(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Be(a).variable(l)});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const c=this.accumulatedFirstMoment[i].variable,d=this.accumulatedWeightedInfNorm[i].variable,h=ne(z(c,this.beta1),z(u,1-this.beta1)),f=z(d,this.beta2),p=Dn(u),m=Ni(f,p);c.assign(h),d.assign(m);const x=ne(z(ve(r,s),ve(h,ne(m,this.epsilon))),a);a.assign(x)}),this.iteration.assign(ne(this.iteration,1)),this.accBeta1.assign(z(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Oe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Oe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eC extends Ri{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=B.registeredVariables[s];j(()=>{const a=ne(z(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Kr(Xe(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SA extends eC{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Xe(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=B.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:j(()=>Be(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&j(()=>{let l;const u=ne(z(this.m,i),a);this.useNesterov?l=ne(z(this.c,ne(a,z(u,this.m))),o):l=ne(z(this.c,u),o),i.assign(u),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Oe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IA extends Ri{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=B.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=B.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:j(()=>Be(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:j(()=>Be(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:j(()=>Be(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;j(()=>{const c=ne(z(l,this.decay),z(mt(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[r].variable,h=ne(z(d,this.decay),z(a,1-this.decay)),f=ve(z(a,this.learningRate),kn(be(c,ne(mt(h),this.epsilon)))),p=ne(z(u,this.momentum),f);l.assign(c),d.assign(h),u.assign(p);const m=be(o,p);o.assign(m)}else{const d=ne(z(l,this.decay),z(mt(a),1-this.decay)),h=ne(z(u,this.momentum),ve(z(a,this.learningRate),kn(ne(d,this.epsilon))));l.assign(d),u.assign(h);const f=be(o,h);o.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Oe(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Oe(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Oe(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MH=[wA,CA,$A,kA,SA,IA,eC];function zH(){for(const t of MH)ee(t)}function tC(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(Q(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let d=0;d<r.length-1;++d)i*=r[d];const a=t.shape,l=r.slice();l.pop();let u=1;for(let d=o;d<n;++d)u*=a[d],l.push(a[d]);const c=[...ge(t.shape).map(d=>d/u),1].slice(0,o);return[l,i,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $v=-2,BH=-1;function nC(t,e,n){const s=t.shape.length;I(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),I(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)I(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function VH(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function sC(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function TA(t,e,n,s){const r=[...t];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<n;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function EA(t,e,n){return n<=t?n:n-(e-1)}function NA(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function WH(t,e,n,s,r,o,i,a,l){const u=t.length;let c=new Array(u),d=new Array(u),h=new Array(u);if(e.length&&n>0){const f=e[0],p=n+1;c=RA(i,f,p,s,t),d=AA(a,f,p,r,t),h=TA(o,f,p,t)}else for(let f=0;f<u;f++)c[f]=FA(i,s,o,t,f,l),d[f]=OA(a,r,o,t,f,l),h[f]=DA(o,f,l);return{begin:c,end:d,strides:h}}function RA(t,e,n,s,r){const o=[...r],i=NA(n,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const l=EA(e,n,a);let u=s[l];t&1<<l&&(u=0),o[a]=u}return o}function AA(t,e,n,s,r){const o=[...r],i=NA(n,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=EA(e,n,a);let u=s[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),o[a]=u}for(let a=0;a<o.length;a++){const l=r[a];o[a]<0&&(o[a]+=l),o[a]=wa(0,o[a],r[a])}return o}function DA(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function FA(t,e,n,s,r,o){let i=e[r];const a=n[r]||1;(t&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),i=wa(0,i,l-1),i}function OA(t,e,n,s,r,o){let i=e[r];const a=n[r]||1;(t&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),a>0?i=wa(0,i,l):i=wa(-1,i,l-1),i}function rC(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function oC(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function p0(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{I(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return n==null?o=new Array(r).fill(-1):typeof n=="number"?o=[n,...new Array(r-1).fill(-1)]:n.length<r?o=n.concat(new Array(r-n.length).fill(-1)):o=n,o=o.map((i,a)=>i>=0?i:(I(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,o]}function iC(t,e,n,s,r,o,i,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const d={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:u.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let v=0;v<d.dims;v++)c&&1<<v&a&&d.numAddAxisAfterEllipsis++,1<<v&i&&(c=!0);c||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};UH(d,h);let f=!0,p=!0,m=!0;const x=[],g=[];for(let v=0;v<t.length;++v){if(h.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const b=!!(h.shrinkAxisMask&1<<v),w=t[v];if(w===-1){x.push(b?1:-1);continue}const $=[h.beginMask&1<<v,h.endMask&1<<v],k=[h.strides[v]>0?0:-1,h.strides[v]>0?w:w-1];if(b&&h.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&h.strides[v]===1;const C=!!(h.beginMask&1<<v&&h.endMask&1<<v);if(h.beginValid&&h.endValid){if(b){const A=h.begin[v]<0?w+h.begin[v]:h.begin[v];if(h.begin[v]=A,h.end[v]=h.begin[v]+1,A<0||A>=w)throw Error(`slice index ${h.begin[v]} of dimension ${v} out of bounds.`)}else h.begin[v]=OS(h.begin[v],0,h.strides[v],w,$,k),h.end[v]=OS(h.end[v],1,h.strides[v],w,$,k);const R=h.strides[v]===1&&h.begin[v]===0&&h.end[v]===w;f=f&&R,p=p&&(v===0&&h.strides[v]===1||R)}else f=f&&h.strides[v]===1&&C,p=p&&(v===0&&h.strides[v]===1||C);let S,T=!1;if(h.beginValid&&h.endValid?(S=h.end[v]-h.begin[v],T=!0):b?(S=1,T=!0):C&&w>=0&&(h.strides[v]<0?S=-w:S=w,T=!0),T){let R;S===0||S<0!=h.strides[v]<0?R=0:R=Math.trunc(S/h.strides[v])+(S%h.strides[v]!==0?1:0),x.push(R)}else x.push(-1)}for(let v=0;v<h.finalShapeGatherIndices.length;++v){const b=h.finalShapeGatherIndices[v];b>=0?g.push(x[b]):b===$v&&g.push(1)}return{finalShapeSparse:g.filter((v,b)=>h.finalShapeGatherIndices[b]!==$v),finalShape:g,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function UH(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push($v),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(BH),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function OS(t,e,n,s,r,o){if(r[e])return n>0?o[e]:o[e+1&1];{const i=t<0?s+t:t;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const GH=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:nC,computeFlatOffset:oC,computeOutShape:sC,getNormalizedAxes:WH,isSliceContinous:rC,maskToAxes:VH,parseSliceParams:p0,sliceInfo:iC,startForAxis:FA,startIndicesWithElidedDims:RA,stopForAxis:OA,stopIndicesWithElidedDims:AA,stridesForAxis:DA,stridesWithElidedDims:TA},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HH{static sgd(e){return new eC(e)}static momentum(e,n,s=!1){return new SA(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,o=!1){return new IA(e,n,s,r,o)}static adam(e=.001,n=.9,s=.999,r=null){return new $A(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new wA(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,o=0){return new kA(e,n,s,r,o)}static adagrad(e,n=.1){return new CA(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sl=HH;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jH=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function PA(){return new Promise(t=>jH(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aC(t,e){const n=t[0].length;t.forEach((r,o)=>{I(r.length===n,()=>`Error in concat${n}D: rank of tensors[${o}] must be the same as the rank of the rest (${n})`)}),I(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,o)=>{for(let i=0;i<n;i++)I(i===e||r[i]===s[i],()=>`Error in concat${n}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Xr(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fr;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(fr||(fr={}));function _A(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const o=n[r],i=s[s.length-n.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${o} but shape[${r+t}] = ${a}`)}else s[i]=o}return s}function LA(t){const e={FIRST_DIM_SIZE:fr.FIRST_DIM_SIZE,VALUE_ROWIDS:fr.VALUE_ROWIDS,ROW_LENGTHS:fr.ROW_LENGTHS,ROW_SPLITS:fr.ROW_SPLITS,ROW_LIMITS:fr.ROW_LIMITS,ROW_STARTS:fr.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function MA(t){return t.length===0?0:t[0]===fr.FIRST_DIM_SIZE?t.length-1:t.length}function zA(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const o=t[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${o} but ragged tensor input.flatValues.shape[${r-t.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lC=30;function m0(t){return t<=lC?t:iv(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uC(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fh(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([t[i+1]/e[i],e[i]]);r=r.concat(t.slice(o+1))}return r}function Oh(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<t;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function Ph(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let o=1;o<t.length;++o)o<=e.length?s?r.push(e[o-1]*t[o]):r.push(t[o]/e[o-1]):r.push(t[o]);return r}function cC(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function dC(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g0=1.7580993408473768,x0=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hC=.3275911,fC=.254829592,pC=-.284496736,mC=1.421413741,gC=-1.453152027,xC=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function To(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function BA(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function VA(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function WA(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function yC(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function UA(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function GA(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const o=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:n,imag:s}}function HA(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ix="->",KH=/->/g,PS=",",_S="...";function vC(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(KH,"").length)/Ix.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Ix}").`);const[s,r]=t.split(Ix);I(s.indexOf(_S)===-1,()=>`The ellipsis notation ("${_S}") is not supported yet.`);const o=s.split(PS),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<r.length;++h){const f=r[h];if(!o.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let h=0;h<s.length;++h){const f=s[h];a.indexOf(f)===-1&&f!==PS&&a.push(f)}const l=new Array(o.length);for(let h=0;h<i;++h){if(new Set(o[h].split("")).size!==o[h].length)throw new Error(`Found duplicate axes in input component ${o[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let f=0;f<o[h].length;++f)l[h].push(a.indexOf(o[h][f]))}const u=a.length,c=r.length,d=[];for(let h=c;h<u;++h)d.push(h);return{allDims:a,summedDims:d,idDims:l}}function bC(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function wC(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const o=n[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:I(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function CC(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<n.length;++i){const a=n[i],l=XH(e,a);for(const u of l)o.indexOf(u)===-1&&(s[i].push(u),o.push(u))}return{path:n,steps:s}}function $C(t){return t.every((e,n)=>e===n)}function XH(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function kC(t,e,n=0){let s=[];if(typeof e=="number")I(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);I(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[o]=t.shape[n]-i}I(t.shape[n]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jA(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function KA(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function XA(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qA(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function YA(t,e){return`size ${t} must be non-negative, not ${e}`}function QA(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function ZA(t,e){const n=Q(t),s=Q(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function JA(t,e){const n=Q(t),s=Q(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kv(){return"segment ids must be >= 0"}function eD(){return"segment ids are not increasing"}function tD(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function nD(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sD(t,e){let n=!1,s;for(t<=lC?(s=t,n=!0):s=iv(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=iv(t,s+1);return s}function rD(t,e,n){const s=[],r=t.length;for(let o=0;o<r;o++)o!==e?s.push(t[o]):s.push(n);return s}function SC(t,e,n,s){const r=e.shape.length,o=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const i=t.shape[n],a=[];let l=1,u=1,c=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),u*=t.shape[d];for(let d=s;d<r;d++)a.push(e.shape[d]);for(let d=n+1;d<o;d++)a.push(t.shape[d]),c*=t.shape[d];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:i,outputShape:a}}const qH=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:SC,computeOutShape:rD,segOpComputeOptimalWindowSize:sD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eo(t){try{return t.map(e=>pi(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function oD(t){return t.map(e=>ai(e))}const YH=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:fC,ERF_A2:pC,ERF_A3:mC,ERF_A4:gC,ERF_A5:xC,ERF_P:hC,PARALLELIZE_THRESHOLD:lC,get RowPartitionType(){return fr},SELU_SCALE:x0,SELU_SCALEALPHA:g0,applyActivation:Xw,assertAndGetBroadcastShape:Ie,assertAxesAreInnerMostDims:mn,assertParamsConsistent:aC,assignToTypedArray:UA,axesAreInnerMostDims:Sw,calculateShapes:Ka,checkEinsumDimSizes:wC,checkPadOnDimRoundingMode:Jn,combineLocations:YR,combineRaggedTensorToTensorShapes:_A,complexWithEvenIndex:VA,complexWithOddIndex:WA,computeConv2DInfo:pn,computeConv3DInfo:Ti,computeDefaultPad:vw,computeDilation2DInfo:Eh,computeOptimalWindowSize:m0,computeOutAndReduceShapes:ln,computeOutShape:Xr,computePool2DInfo:Js,computePool3DInfo:Ao,convertConv2DDataFormat:Do,decodeEinsumEquation:vC,eitherStridesOrDilationsAreOne:Sn,expandShapeToKeepDim:Vt,exponent:HA,exponents:GA,fromStringArrayToUint8:oD,fromUint8ToStringArray:Eo,getAxesPermutation:Tt,getBroadcastDims:ru,getComplexWithIndex:yC,getEinsumComputePath:CC,getEinsumPermutation:bC,getFusedBiasGradient:Kw,getFusedDyActivation:jw,getImageCenter:uC,getInnerMostAxes:Pt,getPermuted:Oh,getRaggedRank:MA,getReductionAxes:Jt,getReshaped:Fh,getReshapedPermuted:Ph,getRowPartitionTypesHelper:LA,getSliceBeginCoords:cC,getSliceSize:dC,getSparseFillEmptyRowsIndicesDenseShapeMismatch:jA,getSparseFillEmptyRowsNegativeIndexErrorMessage:KA,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:XA,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:QA,getSparseReshapeInputOutputMismatchErrorMessage:JA,getSparseReshapeInputOutputMultipleErrorMessage:ZA,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:qA,getSparseReshapeNegativeOutputDimErrorMessage:YA,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:nD,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:kv,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:eD,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:tD,getUndoAxesPermutation:Ei,isIdentityPermutation:$C,log:DV,mergeRealAndImagArrays:To,prepareAndValidate:tC,prepareSplitSize:kC,segment_util:qH,shouldFuse:qw,slice_util:GH,splitRealAndImagArrays:BA,stridesOrDilationsArePositive:Ia,tupleValuesAreOne:Sa,upcastType:us,validateDefaultValueShape:zA,validateInput:T5,validateUpdateShape:mA,warn:xs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */zH();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iD={kernelName:og,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(t,Dh(ue(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QH={kernelName:Fd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=mt(ue(n,"float32")),r=kn(be(Xe(1),s));return Ft(ve(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZH={kernelName:Od,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=kn(be(mt(ue(n,"float32")),1));return ve(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JH={kernelName:wu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{let a=t;const l=Jt(n.shape,r);return l.length>0&&(a=ye(a,l)),U(a,n.shape)},b:()=>{let a=t;const l=Jt(s.shape,r);return l.length>0&&(a=ye(a,l)),U(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8={kernelName:Nb,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8={kernelName:ig,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Be(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8={kernelName:ag,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Be(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8={kernelName:Pd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,kn(be(Xe(1),mt(ue(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8={kernelName:_d,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=kn(ne(Xe(1),mt(ue(n,"float32"))));return ve(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o8={kernelName:zd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=ne(mt(n),mt(s));let l=z(t,ve(s,a));const u=Jt(n.shape,r);return u.length>0&&(l=ye(l,u)),U(l,n.shape)},b:()=>{const a=ne(mt(n),mt(s));let l=Ft(z(t,ve(n,a)));const u=Jt(s.shape,r);return u.length>0&&(l=ye(l,u)),U(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i8={kernelName:Ld,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,ne(mt(ue(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8={kernelName:Md,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,be(Xe(1),mt(ue(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(t,e,n,s,r,o){const i=F(t,"dy","avgPool3dGrad"),a=F(e,"input","avgPool3dGrad");let l=i,u=a,c=!1;a.rank===4&&(c=!0,l=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),I(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),I(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Jn("avgPool3dGrad",r,o);const d={dy:l,input:u},h={filterSize:n,strides:s,pad:r,dimRoundingMode:o},f=B.runKernel(Fb,d,h);return c?U(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const u8=G({avgPool3dGrad_:l8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8={kernelName:ug,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=n;return{x:()=>u8(t,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(t,e,n,s,r){const o=F(t,"dy","avgPoolGrad"),i=F(e,"input","avgPoolGrad");I(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,l=o,u=!1;i.rank===3&&(u=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),I(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),I(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:l,input:a},d={filterSize:n,strides:s,pad:r},h=B.runKernel(Db,c,d);return u?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const h8=G({avgPoolGrad_:d8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f8={kernelName:lg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=n;return{x:()=>h8(t,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p8={kernelName:cg,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:o,transposeB:i}=n;return!o&&!i?{a:()=>Ke(t,r,!1,!0),b:()=>Ke(s,t,!0,!1)}:!o&&i?{a:()=>Ke(t,r,!1,!1),b:()=>Ke(t,s,!0,!1)}:o&&!i?{a:()=>Ke(r,t,!1,!0),b:()=>Ke(s,t,!1,!1)}:{a:()=>Ke(r,t,!0,!0),b:()=>Ke(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8={kernelName:dg,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>Fw(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8={kernelName:EV,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,o=s.shape,i=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])i[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>ye(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8={kernelName:Bd,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8={kernelName:Vd,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8={kernelName:Wd,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=n;return{x:()=>Ln(So(Ga(s,r),ku(s,o)),t,Be(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b8={kernelName:hg,inputsToSave:["x"],gradFunc:iD.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w8={kernelName:fg,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,o=De(r,e[0].shape)[0],i=s.map(l=>l[o]);return ws(t,i,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8={kernelName:pg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:l}=n;return I(Sa(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>Cw(s.shape,t,r,i,a,l),filter:()=>Hw(s,t,r.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $8={kernelName:mg,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Ta(t,r,o,i,a,1,l),filter:()=>Hw(t,s,r.shape,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k8(t,e,n,s,r){let o=t;t.rank===4&&(o=U(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let i=e;i.rank===4&&(i=U(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),I(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),I(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),I(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),I(o.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${n[3]}.`),I(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:o,dy:i},l={strides:s,pad:r,filterShape:n};return B.runKernel(Mb,a,l)}const S8=G({conv3DBackpropFilter_:k8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I8={kernelName:gg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:o}=n;I(Sa(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>jR(i.shape,t,a,r,o),filter:()=>S8(i,t,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8={kernelName:Ud,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(Ft(dA(ue(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8={kernelName:Gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(hA(ue(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N8={kernelName:xg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=n;return{x:()=>{const a=Tt([r],s.rank);let l=XR(t,r,o,!i);return a!=null&&(l=ze(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8={kernelName:yg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=n,a=s??[1,1];I(Sa(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return I(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),I(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),I(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),I(Sn(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Jn("depthwiseConv2d",o,i),{x:()=>j5(l.shape,t,u,r,o,a,i),filter:()=>G5(l,t,u.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A8={kernelName:vg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,o={x:s,filter:r,dy:t},i={x:s,filter:r,dy:t};return{x:()=>B.runKernel(av,o,n),filter:()=>B.runKernel(lv,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8={kernelName:jd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>B.runKernel(Kb,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8={kernelName:Kd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=z(eo(Ft(mt(n))),2/Math.sqrt(Math.PI));return{x:()=>z(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8={kernelName:Xd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8={kernelName:wg,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>U(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8={kernelName:qd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(t,eo(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8={kernelName:Yd,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8={kernelName:Qd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=ve(t,ue(s,"float32")),l=Jt(n.shape,r);return l.length>0?U(ye(a,l),n.shape):a},b:()=>{let a=z(t,ue(n,"float32"));const l=Jt(s.shape,r);l.length>0&&(a=U(ye(a,l),s.shape));const u=mt(s);return Ft(ve(a,ue(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8={kernelName:Cg,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,o,i,a]=e,l=a??Xe(1),u=Jt(o.shape,r.shape),c=[];if(o.rank===1){for(let b=0;b<r.shape.length-1;++b)c.push(r.shape[b]);c.push(1)}const d=be(r,o),h=z(t,l),f=lA(ne(i,Xe(s))),p=z(z(z(f,f),f),Xe(-.5));return{x:()=>o.rank===1?U(z(z(t,gr(U(f,[1,1,1,o.shape[0]]),c)),l),r.shape):U(z(z(t,f),l),r.shape),mean:()=>{let b=z(z(f,Xe(-1)),h);return o.rank===1&&(b=ye(b,u)),U(b,o.shape)},variance:()=>{let b=z(z(p,d),h);return o.rank===1&&(b=ye(b,u)),U(b,o.shape)},scale:()=>{const b=z(d,f);let w=z(t,b);return o.rank===1&&(w=ye(w,u)),U(w,o.shape)},offset:()=>{let b=t;return o.rank===1&&(b=ye(b,u)),U(b,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8={kernelName:$g,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:o,batchDims:i}=n,a=De(o,s.shape)[0],l=(u,c,d)=>()=>{const h=u.shape,f=c.size,p=h.slice(0,a),m=p.length,x=h.slice(o,h.length).slice(1),g=x.length,y=LS(0,m),v=LS(m+1,m+1+g),b=MS([p,[f],x]),w=U(d,b),$=U(c,[f]),k=MS([[m],y,v]),C=ze(w,k);let S=xA(C,$,u.shape[a]);const T=Ei(k);return S=ze(S,T),S};if(i===1){const u=s.shape[0],c=s.split(u,0);return{x:()=>Io(c.map((f,p)=>l(f,r.slice(p,1),t.slice(p,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function LS(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function MS(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8={kernelName:Zd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>Be(n),b:()=>Be(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W8={kernelName:Jd,gradFunc:t=>({x:()=>ue(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8={kernelName:eh,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8={kernelName:th,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8={kernelName:nh,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8={kernelName:Sg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,o=Is(s,0);return{x:()=>Ln(o,t,z(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8={kernelName:rh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,ne(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8={kernelName:sh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,ue(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8={kernelName:RV,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const i=eo(s);return be(t,z(ye(t,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y8(t,e,n,s=5,r=1,o=1,i=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:o,beta:i};return B.runKernel(Jb,a,l)}const Q8=G({localResponseNormalizationBackprop_:Y8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8={kernelName:Ag,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:l}=n;return{x:()=>Q8(s,r,t,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aD(t,e,n,s){return e.rank<n.rank&&(e=U(e,Vt(e.shape,s))),t.rank<n.rank&&(t=U(t,Vt(t.shape,s))),{x:()=>z(t,ue(Jr(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zS={kernelName:Dg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,o=e[0],i=e[1],a=De(r,o.shape),l=aD(t,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8={kernelName:oh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>z(t,ue(Ga(n,s),"float32")),b:()=>z(t,ue(em(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(t,e,n,s,r,o,i){const a=F(t,"dy","maxPool3dGrad"),l=F(e,"input","maxPool3dGrad"),u=F(n,"output","maxPool3dGrad");let c=a,d=l,h=u,f=!1;l.rank===4&&(f=!0,c=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=U(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=U(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),I(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),I(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),I(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Jn("maxPool3dGrad",o,i);const p={dy:c,input:d,output:h},m={filterSize:s,strides:r,pad:o,dimRoundingMode:i},x=B.runKernel(tw,p,m);return f?U(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const tj=G({maxPool3dGrad_:ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nj={kernelName:Og,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=n;return{x:()=>tj(t,s,r,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sj(t,e,n,s,r,o,i){const a=F(t,"dy","maxPoolGrad"),l=F(e,"input","maxPoolGrad"),u=F(n,"output","maxPoolGrad");I(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),I(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),I(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Jn("maxPoolGrad",o,i);const c={dy:a,input:l,output:u},d={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return B.runKernel(ew,c,d)}const rj=G({maxPoolGrad_:sj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oj={kernelName:Fg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=n;return{x:()=>rj(t,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ij={kernelName:Pg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,o=De(r,s.shape),a=ln(s.shape,o)[1],l=Q(a);return{x:()=>{const c=s.shape.slice();o.forEach(f=>{c[f]=1});const d=U(t,c);return ve(z(d,Fo(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aj={kernelName:_g,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[o,i]=e,a=De(r,o.shape),l=aD(t,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lj={kernelName:ih,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>z(t,ue(ku(n,s),"float32")),b:()=>z(t,ue(Is(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uj={kernelName:Lg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>lt(t,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cj={kernelName:ah,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=Jt(n.shape,r);return a.length>0?U(ye(t,a),n.shape):t},b:()=>{const a=z(t,Ft(f0(ve(n,s)))),l=Jt(s.shape,r);return l.length>0?U(ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dj={kernelName:lh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=z(t,ue(s,"float32")),l=Jt(n.shape,r);return l.length>0?U(ye(a,l),n.shape):a},b:()=>{const a=z(t,ue(n,"float32")),l=Jt(s.shape,r);return l.length>0?U(ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hj={kernelName:Mg,gradFunc:t=>({x:()=>Ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fj={kernelName:Vg,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>kt(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pj={kernelName:Bg,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mj={kernelName:Wg,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return Ra(t,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS={kernelName:Ug,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>lt(t,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gj={kernelName:uh,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,o=n,i=s,a=Ie(o.shape,i.shape);return{a:()=>{const c=ue(i,"float32");let d=z(t,z(c,Ea(o,be(c,Xe(1)))));const h=Jt(o.shape,a);return h.length>0&&(d=ye(d,h)),U(d,o.shape)},b:()=>{const c=Is(o,0),d=Ln(c,to(o),Be(o));let h=z(t,z(r,d));const f=Jt(i.shape,a);return f.length>0&&(h=ye(h,f)),U(h,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xj={kernelName:Gg,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=Is(n,0);return{x:()=>Ln(r,t,z(t,s)),alpha:()=>{let o=Ln(r,Be(t),z(t,n));const i=Jt(s.shape,t.shape);return i.length>0&&(o=ye(o,i)),U(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yj(t,e,n){const s=t.shape.slice();s[n]=1;const r=U(e,s),o=wv(t,n,!0,!1),i=wv(t,n,!0,!0),a=z(o,i);return z(r,a)}function vj(t,e,n){const s=t.shape.length,r=s-n.length,o=Tt(n,s);let i=t;o!=null&&(i=ze(t,o));const a=i.shape.slice(),u=a.splice(s-n.length,n.length).reduce((h,f)=>h*f,1);a.push(u);const c=i.reshape(a);let d=yj(c,e,r);if(d=d.reshape(i.shape),o!=null){const h=Ei(o);d=ze(d,h)}return d}const bj={kernelName:Hg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>vj(s,t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wj={kernelName:Hd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=ve(t,ue(s,"float32")),l=Jt(n.shape,r);return l.length>0?U(ye(a,l),n.shape):a},b:()=>{let a=z(t,ue(n,"float32"));const l=Jt(s.shape,r);l.length>0&&(a=U(ye(a,l),s.shape));const u=mt(s);return Ft(ve(a,ue(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cj={kernelName:ch,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,Ft(mt(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $j={kernelName:hh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=z(ku(n,6),Dh(n));return{x:()=>z(t,ue(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kj={kernelName:dh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(t,ue(Dh(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sj={kernelName:jg,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ij={kernelName:Xg,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>B.runKernel(lw,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tj={kernelName:Kg,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>B.runKernel(aw,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ej={kernelName:qg,gradFunc:(t,e,n)=>{const{dims:s}=n,r=De(s,t.shape);return{x:()=>Na(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nj={kernelName:fh,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rj={kernelName:ph,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ft(ve(t,z(Ea(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aj={kernelName:Yg,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>ue(Be(n),"float32"),t:()=>z(t,ue(n,t.dtype)),e:()=>z(t,ue(Nw(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dj={kernelName:mh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Is(n,Xe(0)),r=Xe(g0),o=Xe(x0),i=z(t,o),a=z(z(t,r),eo(ue(n,"float32")));return Ln(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fj={kernelName:vh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(t,z(n,be(Xe(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oj={kernelName:yh,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pj={kernelName:gh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z($w(ue(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _j={kernelName:xh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(KR(ue(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lj={kernelName:Qg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:o}=n,i=s.shape,[a,l]=p0(s,r,o),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],i[c]-a[c]-l[c]]);return{x:()=>Dw(t,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mj={kernelName:t0,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,o=!0,i=z(t,s);return{logits:()=>be(i,z(ye(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zj={kernelName:bh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(t,$u(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VS={kernelName:Jg,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>ww(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WS={kernelName:e0,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>Xn(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bj={kernelName:wh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,z(kn(ue(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vj={kernelName:uw,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(t,z(ue(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wj={kernelName:Ch,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Xe(2);return{a:()=>z(t,z(r,be(n,s))),b:()=>z(t,z(r,be(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uj={kernelName:Th,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gj={kernelName:$h,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{let a=t;const l=Jt(n.shape,r);return l.length>0&&(a=ye(a,l)),U(a,n.shape)},b:()=>{let a=t;const l=Jt(s.shape,r);return l.length>0&&(a=ye(a,l)),U(Ft(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hj={kernelName:Zg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:o}=n;De(o,s.shape).forEach(u=>{r[u]=1});const a=U(t,r),l=z(a,Fo(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jj={kernelName:kh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ve(t,mt($w(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kj={kernelName:Sh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>z(be(Xe(1),mt(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xj={kernelName:Ih,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let i=Be(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=ne(i,lt(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)i=ne(i,lt(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)i=ne(i,lt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let c=0;c<r[3];++c)i=ne(i,lt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2],c*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qj={kernelName:zl,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,o=Ei(r);return{x:()=>ze(t,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yj={kernelName:n0,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>Io(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qj={kernelName:s0,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Zj(t,n)}}};function Zj(t,e){const n=Ni(e,Be(e)),s=Iw(t,n);let r=Ga(e,Xe(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=Gn(r,a+1);r=So(r,Fo(s.shape,"bool"));const i=Be(s);return Ln(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jj={kernelName:r0,gradFunc:t=>({x:()=>Be(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e7=[iD,QH,ZH,JH,e8,t8,n8,s8,r8,o8,i8,a8,c8,f8,p8,m8,g8,x8,y8,v8,b8,w8,$8,C8,I8,T8,E8,N8,R8,A8,wj,D8,F8,O8,P8,_8,M8,L8,z8,B8,V8,W8,U8,G8,H8,j8,K8,X8,q8,Z8,zS,zS,J8,nj,oj,ij,aj,lj,uj,cj,dj,hj,fj,pj,mj,BS,BS,gj,xj,bj,Cj,$j,kj,Sj,Ij,Tj,Ej,Nj,Rj,Aj,Dj,Fj,Oj,Pj,_j,Lj,Mj,zj,VS,VS,WS,WS,Bj,Wj,Vj,Uj,Gj,Hj,jj,Kj,Xj,qj,Yj,Qj,Jj];for(const t of e7)FV(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.abs=function(){return this.throwIfDisposed(),Dn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.acos=function(){return this.throwIfDisposed(),_W(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.acosh=function(){return this.throwIfDisposed(),MW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.add=function(t){return this.throwIfDisposed(),ne(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.all=function(t,e){return this.throwIfDisposed(),UR(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.any=function(t,e){return this.throwIfDisposed(),vv(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.argMax=function(t){return this.throwIfDisposed(),ld(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.argMin=function(t){return this.throwIfDisposed(),UW(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asScalar=function(){return this.throwIfDisposed(),I(this.size===1,()=>"The array must have only 1 element."),U(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asType=function(t){return this.throwIfDisposed(),ue(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as1D=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as2D=function(t,e){return this.throwIfDisposed(),U(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),U(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),U(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),U(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asin=function(){return this.throwIfDisposed(),HW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asinh=function(){return this.throwIfDisposed(),KW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atan=function(){return this.throwIfDisposed(),qW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atan2=function(t){return this.throwIfDisposed(),QW(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atanh=function(){return this.throwIfDisposed(),JW(this)};Y().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),bw(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),ww(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),u0(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Oc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cast=function(t){return this.throwIfDisposed(),ue(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.ceil=function(){return this.throwIfDisposed(),IU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),$s(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Gt&&(t=[t]),Xn([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv1d=function(t,e,n,s,r,o){return this.throwIfDisposed(),GR(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),HR(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),Ta(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cos=function(){return this.throwIfDisposed(),$w(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cosh=function(){return this.throwIfDisposed(),KR(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),wv(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),XR(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),QU(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.depthwiseConv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),kw(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),eG(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.divNoNan=function(t){return this.throwIfDisposed(),oG(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.div=function(t){return this.throwIfDisposed(),ve(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.dot=function(t){return this.throwIfDisposed(),aG(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.elu=function(){return this.throwIfDisposed(),d0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.equal=function(t){return this.throwIfDisposed(),Jr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.erf=function(){return this.throwIfDisposed(),qR(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),vG(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.exp=function(){return this.throwIfDisposed(),eo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.expandDims=function(t){return this.throwIfDisposed(),Gn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.expm1=function(){return this.throwIfDisposed(),$G(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.fft=function(){return this.throwIfDisposed(),pA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.flatten=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.floor=function(){return this.throwIfDisposed(),f0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.floorDiv=function(t){return this.throwIfDisposed(),WR(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.gather=function(t,e,n){return this.throwIfDisposed(),Iw(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Ga(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.greater=function(t){return this.throwIfDisposed(),Is(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.ifft=function(){return this.throwIfDisposed(),Cv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.irfft=function(){return this.throwIfDisposed(),p5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isFinite=function(){return this.throwIfDisposed(),DG(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isInf=function(){return this.throwIfDisposed(),OG(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isNaN=function(){return this.throwIfDisposed(),_G(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Ew(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.lessEqual=function(t){return this.throwIfDisposed(),ku(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.less=function(t){return this.throwIfDisposed(),em(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),VG(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSigmoid=function(){return this.throwIfDisposed(),XG(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSoftmax=function(t){return this.throwIfDisposed(),eA(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),tA(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.log=function(){return this.throwIfDisposed(),to(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.log1p=function(){return this.throwIfDisposed(),JR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalAnd=function(t){return this.throwIfDisposed(),So(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalNot=function(){return this.throwIfDisposed(),Nw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalOr=function(t){return this.throwIfDisposed(),nA(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalXor=function(t){return this.throwIfDisposed(),n6(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Ke(this,t,e,n)};Y().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),Rw(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.max=function(t,e){return this.throwIfDisposed(),wr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.maximum=function(t){return this.throwIfDisposed(),Ni(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mean=function(t,e){return this.throwIfDisposed(),Bt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.min=function(t,e){return this.throwIfDisposed(),Jp(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.minimum=function(t){return this.throwIfDisposed(),dd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),c6(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mod=function(t){return this.throwIfDisposed(),h6(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mul=function(t){return this.throwIfDisposed(),z(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.neg=function(){return this.throwIfDisposed(),Ft(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.norm=function(t,e,n){return this.throwIfDisposed(),h0(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.notEqual=function(t){return this.throwIfDisposed(),tm(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),sA(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.onesLike=function(){return this.throwIfDisposed(),Qs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.pad=function(t,e){return this.throwIfDisposed(),Dw(this,t,e)};Y().prototype.pool=function(t,e,n,s,r,o){return this.throwIfDisposed(),C6(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.pow=function(t){return this.throwIfDisposed(),Ea(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.prelu=function(t){return this.throwIfDisposed(),Ow(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.prod=function(t,e){return this.throwIfDisposed(),S6(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reciprocal=function(){return this.throwIfDisposed(),X6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.relu=function(){return this.throwIfDisposed(),ja(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.relu6=function(){return this.throwIfDisposed(),iA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reshapeAs=function(t){return this.throwIfDisposed(),U(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reshape=function(t){return this.throwIfDisposed(),U(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),vA(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),bA(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reverse=function(t){return this.throwIfDisposed(),Na(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.rfft=function(){return this.throwIfDisposed(),x5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.round=function(){return this.throwIfDisposed(),aA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.rsqrt=function(){return this.throwIfDisposed(),lA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.selu=function(){return this.throwIfDisposed(),uA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.separableConv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),cA(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sigmoid=function(){return this.throwIfDisposed(),$u(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sign=function(){return this.throwIfDisposed(),s5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sin=function(){return this.throwIfDisposed(),dA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sinh=function(){return this.throwIfDisposed(),hA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.slice=function(t,e){return this.throwIfDisposed(),lt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.softmax=function(t){return this.throwIfDisposed(),Gw(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.softplus=function(){return this.throwIfDisposed(),Nh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Fw(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.split=function(t,e){return this.throwIfDisposed(),ws(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sqrt=function(){return this.throwIfDisposed(),kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.square=function(){return this.throwIfDisposed(),mt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.squaredDifference=function(t){return this.throwIfDisposed(),v5(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.squeeze=function(t){return this.throwIfDisposed(),Ah(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Gt?[this,t]:[this,...t];return Io(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.step=function(t){return this.throwIfDisposed(),Dh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.stridedSlice=function(t,e,n,s,r,o,i,a){return this.throwIfDisposed(),k5(this,t,e,n,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sub=function(t){return this.throwIfDisposed(),be(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sum=function(t,e){return this.throwIfDisposed(),ye(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tan=function(){return this.throwIfDisposed(),I5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tanh=function(){return this.throwIfDisposed(),l0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tile=function(t){return this.throwIfDisposed(),gr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toBool=function(){return this.throwIfDisposed(),ue(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toFloat=function(){return this.throwIfDisposed(),ue(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toInt=function(){return this.throwIfDisposed(),ue(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.topk=function(t,e){return this.throwIfDisposed(),N5(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.transpose=function(t){return this.throwIfDisposed(),ze(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unique=function(t){return this.throwIfDisposed(),D5(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),xA(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unstack=function(t){return this.throwIfDisposed(),Ra(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.where=function(t,e){return this.throwIfDisposed(),Ln(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.zerosLike=function(){return this.throwIfDisposed(),Be(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Lr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Lr.prototype)}}class Hs extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Hs.prototype)}}class L extends Error{constructor(e){super(e),Object.setPrototypeOf(this,L.prototype)}}class Ne extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ne.prototype)}}class IC extends Error{constructor(e){super(e),Object.setPrototypeOf(this,IC.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class lD{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Aa(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function Mr(t,e){if(!t)throw new IC(e)}function US(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Hn(t){return t.length===1?t[0]:t}function et(t){return Array.isArray(t)?t:[t]}function ho(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Xi(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let Es={};function TC(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function Sv(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>Sv(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:Sv(s))}}}function _h(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const o=t;let i;if(o in n)i=n[o];else if(o in Es)i=Es[o];else if(i=e[o],i==null)throw new L(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=t;if(o.className==null||o.config==null)throw new L(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,l;if(i in n?[a,l]=n[i]:i in Es?[a,l]=Es.className:i in e&&([a,l]=e[i]),a==null)throw new L(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const f of Object.keys(Es))u[f]=Es[f];for(const f of Object.keys(n))u[f]=n[f];const c=o.config;c.customObjects=u;const d=Object.assign({},Es);for(const f of Object.keys(n))Es[f]=n[f];Sv(o.config);const h=l(a,o.config,n,r);return Es=Object.assign({},d),h}else{const u=Object.assign({},Es);for(const d of Object.keys(n))Es[d]=n[d];const c=new a(o.config);return Es=Object.assign({},u),c}}}function t7(t,e){return t<e?-1:t>e?1:0}function Cf(t,e){return-1*t7(t,e)}function li(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function n7(t){if(t==null)throw new L(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Xa(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new L(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function EC(t,e,n=0,s=1/0){return Mr(n>=0),Mr(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function on(t,e){Array.isArray(t)?(I(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>on(n,`element ${s+1} of ${e}`))):I(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${uD(t)}.`)}function uD(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>uD(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function s7(t,e,n){let s=n!=null?n():Un(),r;return(...i)=>{const a=n!=null?n():Un();return a-s<e||(s=a,r=t(...i)),r}}function cD(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let r7=0;function dD(){return r7++}const $f={};function y0(t=""){return t in $f||($f[t]=0),$f[t]+=1,t+$f[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const o7=["channelsFirst","channelsLast"],i7=["nearest","bilinear"],a7=["valid","same","causal"],l7=["max","avg"],u7=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const rl=new Map;function _t(t){Xa(o7,"DataFormat",t)}function c7(t){Xa(i7,"InterpolationFormat",t)}function Ts(t){Xa(a7,"PaddingMode",t)}function hD(t){Xa(l7,"PoolMode",t)}const Pc=[],GS="/";function da(t,e){Pc.push(t);try{const n=e();return Pc.pop(),n}catch(n){throw Pc.pop(),n}}function d7(){return Pc.length===0?"":Pc.join(GS)+GS}function fD(t){if(!mD(t))throw new Error("Not a valid tensor name: '"+t+"'");return d7()+t}function pD(t){if(!mD(t))throw new Error("Not a valid tensor name: '"+t+"'");rl.has(t)||rl.set(t,0);const e=rl.get(t);if(rl.set(t,rl.get(t)+1),e>0){const n=`${t}_${e}`;return rl.set(n,1),n}else return t}const h7=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function mD(t){return!!t.match(h7)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function f7(t){return t===parseInt(t.toString(),10)}function ui(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function iu(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function mi(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function kr(t,e){if(e<t)throw new L(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Tx;function jt(){return Tx==null&&(Tx=iW().epsilon()),Tx}function Sr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qr(t,e){return ue(t,e)}function Lh(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),U(t,n)}function p7(t,e){return j(()=>{if(t.shape.length!==2)throw new L(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=Lh(t,1);return Iv(n,[1,e,1])})}function m7(t){const e=[ui(t.shape)];return U(t,e)}function g7(t){if(t.rank<=1)throw new L(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],ui(t.shape,1)];return U(t,e)}function ha(t,e,n){return j(()=>{switch(t.rank){case 1:return Ww(t,e,n);case 2:return fA(t,[e,0],[n,t.shape[1]]);case 3:return Uw(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return sm(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return lt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return lt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new L(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Ex(t,e,n){return j(()=>{switch(t.rank){case 1:return Ww(t,e,n);case 2:return fA(t,[0,e],[t.shape[0],n]);case 3:return Uw(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return sm(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new L(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function kf(t,e,n,s){return j(()=>{switch(t.rank){case 1:return Ww(t,e,n);case 2:switch(s){case 1:return ha(t,e,n);case 2:return Ex(t,e,n);default:throw new L(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return ha(t,e,n);case 2:return Uw(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Ex(t,e,n);default:throw new L(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return ha(t,e,n);case 2:return sm(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return sm(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Ex(t,e,n);default:throw new L(`The axis is not within the rank of the tensor ${s}`)}default:throw new L(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function NC(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),Xn(t,e)}function HS(t,e){switch(t.rank){case 1:return NU([t,e]);case 2:return AU([t,e],0);case 3:return FU([t,e],0);case 4:return PU([t,e],0);default:throw new L(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Iv(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new L(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return gr(t,e)}function v0(t,e=0,n=1,s,r){return G6(t,e,n,s,r)}function Yr(t,e,n,s){if(t.rank<2||e.rank<2)throw new Ne(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new Ne(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return AS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?Tv(t.rank,s,Sr()):null,activation:n});{const r=t.shape.slice(),o=r.pop();t=U(t,[-1,o]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],c=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=U(ze(e,c),[l,-1]);const d=[...r,...u];return U(AS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?Tv(t.rank,s,Sr()):null,activation:n}),d)}}function gD(t,e,n){return j(()=>(Array.isArray(e)?e=os(e,"int32"):e=ue(e,"int32"),Iw(t,e,n)))}function Mh(t){return z(t,t)}function Tv(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new L(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?U(e,[1,s[0],1,1,1]):U(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?U(e,[1,1,1,1,s[0]]):U(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?U(e,[1,s[0],1,1]):U(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?U(e,[1,1,1,s[0]]):U(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?U(e,[1,s[0],1]):U(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?U(e,[1,1,s[0]]):U(e,[1].concat(s))}else if(t<3)return e;throw new L(`Unsupported input rank by biasAdd: ${e.rank}`)}function Er(t,e,n){return j(()=>(n==null&&(n=Sr()),_t(n),ne(t,Tv(t.rank,e,n))))}function x7(t,e=1){if(e!==1)throw new Ne(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return d0(t)}function y7(t){return j(()=>ve(t,ne(Dn(t),1)))}function xD(t,e,n,s){return j(()=>z5(t,e,n,s))}function v7(t){return j(()=>{const e=ne(.5,z(.2,t));return $s(e,0,1)})}function zh(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const b7=["fanIn","fanOut","fanAvg"],w7=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function C7(t){Xa(b7,"FanMode",t)}function $7(t){Xa(w7,"Distribution",t)}class er extends Iu{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class yD extends er{apply(e,n){return kt(e,n)}}yD.className="Zeros";ee(yD);class RC extends er{apply(e,n){return Fo(e,n)}}RC.className="Ones";ee(RC);class vD extends er{constructor(e){if(super(),typeof e!="object")throw new L(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new L(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return j(()=>z(Xe(this.value),Fo(e,n)))}getConfig(){return{value:this.value}}}vD.className="Constant";ee(vD);class bD extends er{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return Rh(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}bD.className="RandomUniform";ee(bD);class wD extends er{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ne(`randomNormal does not support dType ${n}.`);return v0(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}wD.className="RandomNormal";ee(wD);class CD extends er{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ne(`truncatedNormal does not support dType ${n}.`);return gA(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}CD.className="TruncatedNormal";ee(CD);class $D extends er{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return j(()=>{if(e.length!==2||e[0]!==e[1])throw new L("Identity matrix initializer can only be used for 2D square matrices.");return z(this.gain,ZR(e[0]))})}getConfig(){return{gain:this.gain}}}$D.className="Identity";ee($D);function k7(t,e="channelsLast"){let n,s;if(_t(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=ui(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=ui(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=ui(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class cs extends er{constructor(e){if(super(),e.scale<0)throw new L(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,C7(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,$7(this.distribution),this.seed=e.seed}apply(e,n){const s=k7(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ne(`${this.getClassName()} does not support dType ${n}.`);return gA(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*i);return Rh(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}cs.className="VarianceScaling";ee(cs);class AC extends cs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return cs.className}}AC.className="GlorotUniform";ee(AC);class DC extends cs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return cs.className}}DC.className="GlorotNormal";ee(DC);class FC extends cs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return cs.className}}FC.className="HeNormal";ee(FC);class OC extends cs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return cs.className}}OC.className="HeUniform";ee(OC);class PC extends cs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return cs.className}}PC.className="LeCunNormal";ee(PC);class _C extends cs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return cs.className}}_C.className="LeCunUniform";ee(_C);class kD extends er{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return j(()=>{if(e.length<2)throw new Ne("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=Q(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=v0(i,0,1,n,this.seed),l=PH.qr(a,!1);let u=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=z(u,d.sign()),s<r&&(u=u.transpose()),z(Xe(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}kD.className="Orthogonal";ee(kD);const jS={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function KS(t,e={}){return _h(t,Bs.getMap().classNameMap,e,"initializer")}function St(t){return TC(t)}function wt(t){if(typeof t=="string"){const e=t in jS?jS[t]:t;if(e==="GlorotNormal")return new DC;if(e==="GlorotUniform")return new AC;if(e==="HeNormal")return new FC;if(e==="HeUniform")return new OC;if(e==="LeCunNormal")return new PC;if(e==="LeCunUniform")return new _C;{const n={};return n.className=e,n.config={},KS(n)}}else return t instanceof er?t:KS(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ev(t){return Array.isArray(t)&&Array.isArray(t[0])}function rm(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function we(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new L(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Ue(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new L(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function om(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const XS="Variable";class S7{constructor(e,n="float32",s=XS,r=!0,o=null){this.dtype=n??"float32",this.shape=e.shape,this.id=dD(),s=s??XS,this.originalName=fD(s),this.name=pD(this.originalName),this.trainable_=r,this.constraint=o,this.val=P5(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),I7(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function I7(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function Nv(t){return t.map(e=>e.read())}function LC(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Kt{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class no{constructor(e,n,s,r,o,i,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=dD(),i!=null&&(this.originalName=fD(i),this.name=pD(this.originalName)),this.rank=n.length}}let T7=0;class b0{constructor(e,n){this.callArgs=n,this.id=T7++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let E7=0;class Fe extends Iu{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=E7++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=ho(s)+"_"+y0(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Hs(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new L(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Hn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Hn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Lr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Lr(`Layer ${this.name} is not connected, no input to return.`);return Hn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Lr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Lr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Hn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=et(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=et(this.inputSpec);if(n.length!==s.length)throw new L(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const o=n[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new L(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const l=o.shape;for(const u in i.axes){const c=Number(u),d=i.axes[u],h=c>=0?l[c]:l[l.length+c];if(d!=null&&[d,null].indexOf(h)===-1)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${d} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const u=i.shape[l],c=o.shape[l];if(u!=null&&c!=null&&u!==c)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=et(e),r=A7(e),o=D7(e);if(r===o)throw new L("Arguments to apply() must be all SymbolicTensors or all Tensors");return da(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of et(e))i.push(a.shape);this.build(Hn(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,i);const a=et(i),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=Hn(l),this.activityRegularizer!=null)throw new Ne("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=N7(e),a=this.computeOutputShape(i);let l;const u=R7(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,d)=>new no(u,c,this,et(e),n,this.name,d)):l=new no(u,a,this,et(e),n,this.name),this.addInboundNode(e,l,null,null,i,a,n),this._refCount++,this.activityRegularizer!=null)throw new Ne("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Lr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new Lr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Hs(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return om(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Nv(e?this.trainableWeights:this.weights)}setWeights(e){j(()=>{const n=this.weights;if(n.length!==e.length)throw new L(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=Nv(n);for(let o=0;o<r.length;++o){const i=r[o],a=n[o],l=e[o];if(!qe(i.shape,l.shape))throw new L(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}LC(s)})}addWeight(e,n,s,r,o,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new L(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():wt("zeros"));const u=r.apply(n,s),c=new S7(u,s,e,i,a);return u.dispose(),o!=null&&this.addLoss(()=>o.apply(c.read())),i==null&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=et(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=et(n),i=et(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,n,s,r,o,i,a=null){const l=et(e);n=et(n),s=et(s),r=et(r),o=rm(o),i=rm(i);const u=[],c=[],d=[];for(const h of l)u.push(h.sourceLayer),c.push(h.nodeIndex),d.push(h.tensorIndex);new b0({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function N7(t){t=et(t);const e=[];for(const n of t)e.push(n.shape);return Hn(e)}function R7(t){return"float32"}function SD(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],l=s.nodeIndices[o],u=SD(i,a,l);for(const c of u)r.indexOf(c)===-1&&r.push(c)}return r}}}function A7(t){let e=!0;for(const n of et(t))if(!(n instanceof no)){e=!1;break}return e}function D7(t){let e=!0;for(const n of et(t))if(n instanceof no){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Bh extends Fe{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:y0("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new L("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new L("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new L("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new no(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new b0({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new L(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Bh.className="InputLayer";ee(Bh);function F7(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new L("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new Bh({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function O7(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return ue(e,t.dtype)}catch{throw new L(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class qo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof qo)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=O7(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new L(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof no){if(this.id2Value[e.id]==null)throw new L(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new L(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof no){if(this.id2Value[e.id]==null)throw new L(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new L(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Oe(this.id2Mask)}}const im=new lD,am=new lD;function P7(t){im!=null&&im.setMaxEntries(t),am!=null&&am.setMaxEntries(t)}function fc(t,e,n,s){const r=n==null?!1:n.training,o=Array.isArray(t),i=o?t:[t],a=i.map(p=>p.name),l=[],u=e.names();for(const p of a)u.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);const c=a.join(",")+"|"+e.names().sort().join(",");let d=im.get(c),h;if(d==null){const p=_7(i,e);d=p.sorted,h=p.recipientCounts,im.put(c,d),am.put(c,h)}h={},r||Object.assign(h,am.get(c));const f=new qo(e);for(let p=0;p<d.length;++p){const m=d[p],x=m.sourceLayer;if(x instanceof Bh)continue;const g=[],y=[],v=[];let b=!1;for(const S of m.inputs){const T=f.getValue(S),R=f.getMask(S);g.push(T),y.push(R),R!=null&&(b=!0),r||(h[S.name]--,h[S.name]===0&&!e.hasKey(S)&&a.indexOf(S.name)===-1&&!T.isDisposed&&S.sourceLayer.stateful!==!0&&v.push(T))}b&&(n=n||{},n.mask=y[0]);const w=et(x.apply(g,n));let $=null;x.supportsMasking&&($=x.computeMask(g,y));const k=M7(m),C=Array.isArray(k)?k:[k];for(let S=0;S<C.length;++S){f.hasKey(C[S])||f.add(C[S],w[S],Array.isArray($)?$[0]:$);const T=a.indexOf(C[S].name);T!==-1&&(l[T]=w[S])}r||Oe(v)}return f.disposeMasks(),o?l:l[0]}function _7(t,e){I(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=qS(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of t){const{sorted:i,recipientMap:a}=qS(o,e);for(const l of i)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:n,recipientCounts:L7(s)}}function L7(t){const e={};for(const n in t)e[n]=t[n].size;return e}function qS(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const o=[],i=[];for(o.push(t);o.length>0;){const a=o[o.length-1];if(n.has(a.name)){o.pop();continue}const l=i[i.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),s.push(a),n.add(a.name),l&&i.pop();else{i.push(o.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!n.has(u.name)&&o.push(u)}}return{sorted:s,recipientMap:r}}function M7(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7=K();z7.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,P7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MC(t,e){return j(()=>kn(ye(z(t,t),e,!0)))}class Vh extends Iu{getConfig(){return{}}}class ID extends Vh{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>{const n=MC(e,this.axis),s=$s(n,0,this.maxValue);return z(e,ve(s,ne(jt(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}ID.className="MaxNorm";ee(ID);class TD extends Vh{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>ve(e,ne(jt(),MC(e,this.axis))))}getConfig(){return{axis:this.axis}}}TD.className="UnitNorm";ee(TD);class ED extends Vh{apply(e){return ja(e)}}ED.className="NonNeg";ee(ED);class ND extends Vh{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>{const n=MC(e,this.axis),s=ne(z(this.rate,$s(n,this.minValue,this.maxValue)),z(1-this.rate,n));return z(e,ve(s,ne(jt(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}ND.className="MinMaxNorm";ee(ND);const YS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Yt(t){return TC(t)}function QS(t,e={}){return _h(t,Bs.getMap().classNameMap,e,"constraint")}function Qt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in YS?YS[t]:t,config:{}};return QS(n)}else return t instanceof Vh?t:QS(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function _i(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const o=t[r];if(typeof o!="number"){const i=o;e.push(i.data()),n.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)t[n[o]]=r[o][0];Oe(s)}}function RD(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var ZS;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(ZS||(ZS={}));const B7=125;class fd{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class V7{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class W7 extends fd{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const o=n[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=j(()=>ne(this.totals[r],z(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:j(()=>{const r=z(ve(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),Kr(n[s])}))}}class U7 extends fd{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),n.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[n[o]][s[o]].dispose(),this.history[n[o]][s[o]]=r[o][0]}}class G7 extends fd{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||PA,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=B7),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");rv(this.yieldEvery)&&(this.maybeWait=s7(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await _i(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await _i(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await _i(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await _i(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await _i(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):rv(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await _i(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await _i(e),await this.trainEnd(e))}}function AD(t,e){return t==null&&(t={}),t instanceof fd?[t]:Array.isArray(t)&&t[0]instanceof fd?t:et(t).map(s=>new G7(s,e))}class Ds{constructor(){}static registerCallbackConstructor(e,n){I(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Ds.checkForDuplicate(n),Ds.constructors[e]==null&&(Ds.constructors[e]=[]),Ds.constructors[e].push(n)}static checkForDuplicate(e){for(const n in Ds.constructors)Ds.constructors[+n].forEach(r=>{if(r===e)throw new L("Duplicate callback constructor.")})}static clear(){Ds.constructors={}}static createCallbacks(e){const n=[];for(const s in Ds.constructors){const r=+s;e>=r&&n.push(...Ds.constructors[r])}return n.map(s=>new s)}}Ds.constructors={};function DD(t,e,n,s,r,o,i,a,l){const u=new U7,c=[new W7,...Ds.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);const d=new V7(c);return d.setParams({epochs:n,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bo(t,e={},n=!1){return _h(t,Bs.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lm(t,e){return j(()=>{t.dtype!=="float32"&&(t=ue(t,"float32"));const n=ye(Mh(t),e,!0),s=c0(n.shape,jt()),r=kn(Ni(n,s));return ve(t,r)})}function w0(t,e){return j(()=>Bt(Mh(be(e,t)),-1))}function zC(t,e){return j(()=>Bt(Dn(be(e,t)),-1))}function BC(t,e){return j(()=>{const n=be(t,e),s=$s(Dn(t),jt(),Number.MAX_VALUE),r=Dn(ve(n,s));return z(100,Bt(r,-1))})}function H7(t,e){return j(()=>{const n=$s(e,jt(),Number.MAX_VALUE),s=to(ne(1,n)),r=$s(t,jt(),Number.MAX_VALUE),o=to(ne(1,r));return Bt(Mh(be(s,o)),-1)})}function j7(t,e){return j(()=>{const n=Ni(0,be(1,z(t,e)));return Bt(Mh(n),-1)})}function K7(t,e){return j(()=>{const n=Ni(0,be(1,z(t,e)));return Bt(n,-1)})}function X7(t,e){return j(()=>{const n=ye(z(t,e),-1),s=wr(z(be(1,t),e),-1);return Ni(0,ne(1,be(s,n)))})}function q7(t,e){return j(()=>{const n=Math.log(2),s=be(e,t),r=be(ne(s,Nh(z(-2,s))),n);return Bt(r,-1)})}function pd(t,e,n=!1){return j(()=>{if(n)e=Gw(e);else{const s=ye(e,e.shape.length-1,!0);e=ve(e,s)}return e=$s(e,jt(),1-jt()),Ft(ye(z(ue(t,"float32"),to(e)),e.shape.length-1))})}function um(t,e,n=!1){return j(()=>{const s=ue(f0(m7(t)),"int32");e=$s(e,jt(),1-jt());const r=e.shape,o=U(sA(s,r[r.length-1]),r);return pd(o,e,n)})}function Y7(t,e){if(!qe(t.shape,e.shape))throw new L(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return j(()=>{const n=ja(e),s=Ft(Dn(e));return ne(be(n,z(e,t)),JR(eo(s)))})}function C0(t,e){return j(()=>{let n;return n=$s(e,jt(),1-jt()),n=to(ve(n,be(1,n))),Bt(Y7(t,n),-1)})}function Q7(t,e){return j(()=>{const n=$s(t,jt(),1),s=$s(e,jt(),1);return ye(z(t,to(ve(n,s))),-1)})}function Z7(t,e){return j(()=>{const n=to(ne(jt(),e));return Bt(be(e,z(t,n)),-1)})}function FD(t,e){return j(()=>{const n=lm(t,-1),s=lm(e,-1),r=z(n,s);return Ft(ye(r,-1))})}const cm={meanSquaredError:w0,meanAbsoluteError:zC,meanAbsolutePercentageError:BC,meanSquaredLogarithmicError:H7,squaredHinge:j7,hinge:K7,categoricalHinge:X7,logcosh:q7,categoricalCrossentropy:pd,sparseCategoricalCrossentropy:um,binaryCrossentropy:C0,kullbackLeiblerDivergence:Q7,poisson:Z7,cosineProximity:FD};function Nx(t){if(typeof t=="string"){if(t in cm)return cm[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new L(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function OD(t,e){return j(()=>{const n=z(.5,Qs(e)),s=qr(Is(e,n),t.dtype);return Bt(Jr(t,s),-1)})}function PD(t,e){return j(()=>qr(Jr(ld(t,-1),ld(e,-1)),"float32"))}function J7(t,e){return j(()=>ue(ye(So(Jr(t,1),Jr(e,1))),"float32"))}function eK(t,e){return j(()=>ue(ye(So(Jr(t,0),Jr(e,1))),"float32"))}function tK(t,e){return j(()=>{const n=J7(t,e),s=eK(t,e),r=ne(n,s);return ue(Ln(Is(r,0),ve(n,r),0),"float32")})}function nK(t,e){return C0(t,e)}function sK(t,e){return t.rank===e.rank&&(t=Ah(t,[t.rank-1])),e=ld(e,-1),e.dtype!==t.dtype&&(e=ue(e,t.dtype)),ue(Jr(t,e),"float32")}const rK=w0,oK=w0,iK=zC,aK=zC,lK=BC,uK=BC,_D=pd,cK=FD,LD=um,dm={binaryAccuracy:OD,categoricalAccuracy:PD,precision:tK,categoricalCrossentropy:_D,sparseCategoricalCrossentropy:LD,mse:rK,MSE:oK,mae:iK,MAE:aK,mape:lK,MAPE:uK,cosine:cK};function dK(t){if(typeof t=="string"&&t in dm)return dm[t];if(typeof t!="string"&&t!=null)return t;throw new L(`Unknown metric ${t}`)}function Sf(t){if(Mr(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(cm))if(cm[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(dm))if(dm[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hK(t){const e={Adagrad:()=>sl.adagrad(.01),Adadelta:()=>sl.adadelta(1,.95,jt()),Adam:()=>sl.adam(.001,.9,.999,jt()),Adamax:()=>sl.adamax(.002,.9,.999,jt(),0),RMSProp:()=>sl.rmsprop(.001,.9,0,jt()),SGD:()=>sl.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new L(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const JS=1*1024*1024;function eI(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!Rv(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>JS&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${JS}.`)}}function Rv(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!Rv(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!Rv(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fK(t,e,n,s=console.log){const r=mK(t),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(e*c)));let i;if(!r){o.push("Receives inputs"),i=[];for(const c in t.nodesByDepth)i.push(...t.nodesByDepth[c])}s("_".repeat(e)),hm(o,n,s),s("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)r?gK(a[c],n,s):xK(a[c],n,i,s),s((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=pK(t),u=om(t.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function pK(t){let e;return t.collectedTrainableWeights!=null?e=om(t.collectedTrainableWeights):e=om(t.trainableWeights),e}function mK(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function hm(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function gK(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const o=t.name,i=t.getClassName(),a=[`${o} (${i})`,r,s,t.countParams().toString()];hm(a,e,n)}function xK(t,e,n,s){let r,o;try{o=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const i=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const f=d.inboundLayers[h].name,p=d.nodeIndices[h],m=d.tensorIndices[h];i.push(`${f}[${p}][${m}]`)}const a=t.name,l=t.getClassName(),u=i.length===0?"":i[0],c=[`${a} (${l})`,o,r,t.countParams().toString(),u];hm(c,e,s);for(let d=1;d<i.length;++d)hm(["","","","",i[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MD(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Av(t,e){if(t===null)return null;if(typeof t=="string")return Xi(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const o=t[r];MD(e,r,o)?n.push(o):n.push(Av(o,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const o=Xi(s);n[o]=Av(r,o)}}return n}}function Dv(t,e){if(t==null)return null;if(typeof t=="string")return ho(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const o=t[r];MD(e,r,o)?n.push(o):n.push(Dv(o,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],o=ho(s);(s==="name"||s==="className")&&typeof r=="string"?n[o]=r:n[o]=Dv(r,s)}return n}}/** @license See the LICENSE file. */const zD="4.20.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const yK=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class ar extends Fe{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const y=this.getClassName().toLowerCase();this.name=y0(y)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],li(this.inputs).length!==this.inputs.length)throw new L(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(y=>y.name)}`);li(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(y=>y.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const v=y.sourceLayer,b=y.nodeIndex,w=y.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(b),this.outputLayersTensorIndices.push(w)}for(const y of this.inputs){const v=y.sourceLayer,b=y.nodeIndex,w=y.tensorIndex;Mr(b===0,"input layer has >1 nodes"),Mr(w===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(b),this.inputLayersTensorIndices.push(w)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const v=this.inputLayers[y];if(!(v instanceof Bh))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${y} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(y=>y.shape),this.internalOutputShapes=this.outputs.map(y=>y.shape);const n={},s={},r={},o={},i={},a=[],l=(y,v,b,w,$,k)=>{(w==null||$==null||k==null)&&(w=y.sourceLayer,$=y.nodeIndex,k=y.tensorIndex);const C=w.inboundNodes[$];if(b.indexOf(C)!==-1)throw new Hs(`The tensor ${y.name} at layer "${w.name}" is part of a cycle.`);if(v.indexOf(C)!==-1)return;this.containerNodes.add(ar.nodeKey(w,$)),w.id in i||(i[w.id]=Object.keys(i).length),b.indexOf(C)===-1&&b.push(C);const S=C.inboundLayers.length;for(let T=0;T<S;T++){const R=C.inputTensors[T],A=C.inboundLayers[T],E=C.nodeIndices[T],N=C.tensorIndices[T];l(R,v,b,A,E,N)}for(v.push(C);b.indexOf(C)>=0;)b.splice(b.indexOf(C),1);a.push(C)},u=[],c=[];for(const y of this.outputs)l(y,u,c);const d=a.slice().reverse();for(const y of d){s[y.id]=y,y.id in n||(n[y.id]=0);let v=n[y.id];const b=r[y.outboundLayer.id]==null?0:r[y.outboundLayer.id];v=Math.max(v,b),r[y.outboundLayer.id]=v,o[y.outboundLayer.id]=y.outboundLayer,n[y.id]=v;for(let w=0;w<y.inboundLayers.length;w++){const $=y.inboundLayers[w],k=y.nodeIndices[w],C=$.inboundNodes[k],S=n[C.id]==null?0:n[C.id];n[C.id]=Math.max(v+1,S),s[C.id]=C}}const h={};for(const y in n){const v=n[y];v in h||(h[v]=[]),h[v].push(s[y])}const f={};for(const y in r){const v=r[y];v in f||(f[v]=[]),f[v].push(o[y])}let p=Object.keys(f).map(y=>parseInt(y,10)).sort(Cf);this.layers=[];for(const y of p){const v=f[y];v.sort((b,w)=>{const $=i[b.id],k=i[w.id];return $<k?-1:$>k?1:0});for(const b of v)b instanceof ar&&this.internalContainerRefs.push(b),this.layers.push(b)}this.layersByDepth=f,p=Object.keys(h).map(y=>parseInt(y,10)).sort(Cf);const m=this.inputs.slice(),x=[];for(const y of p)for(const v of h[y]){const b=v.outboundLayer;if(b!=null){for(const w of v.inputTensors)if(m.indexOf(w)===-1)throw new Hs(`Graph disconnected: cannot obtain value for tensor ${w} at layer "${b.name}". The following previous layers were accessed without issue: ${x}`);for(const w of v.outputTensors)m.push(w);x.push(b.name)}}this.nodesByDepth=h;const g=this.layers.map(y=>y.name);for(const y of g){const v=g.filter(b=>b===y).length;if(v!==1)throw new Hs(`The name "${y}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new b0({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(y=>null),outputMasks:this.outputs.map(y=>null),inputShapes:this.inputs.map(y=>y.shape),outputShapes:this.outputs.map(y=>y.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new L("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const o=yK(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const c=o?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[c]!=null)throw new L(`Duplicate weight name: ${c}`);s[c]=u,r++}const i=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],e[a]]);else if(n)throw new L(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new L(`${a.length} of ${r} weights are not set: ${a}`)}LC(i)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==n&&(e[o]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${zD}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=Dv(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return j(()=>{e=et(e);const s=new qo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return fc(this.outputs,s,n)})}computeMask(e,n){return j(()=>{e=et(e);let s;return n==null?s=Aa(null,e.length):s=et(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=rm(e);if(n.length!==this.inputLayers.length)throw new L(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],u=n[a],c=l.name+"_0_0";s[c]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Cf);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const c=u.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const d=[];for(let m=0;m<u.inboundLayers.length;m++){const x=u.inboundLayers[m],g=u.nodeIndices[m],y=u.tensorIndices[m],v=`${x.name}_${g}_${y}`,b=s[v];d.push(b)}const h=c.computeOutputShape(Hn(d)),f=rm(h),p=c.inboundNodes.indexOf(u);for(let m=0;m<f.length;m++){const x=`${c.name}_${p}_${m}`;s[x]=f[m]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],d=`${l.name}_${u}_${c}`;i.push(d)}for(let a=0;a<i.length;a++){const l=i[a];Mr(l in s),o.push(s[l])}return Hn(o)}runInternalGraph(e,n){n==null&&(n=Aa(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],c=e[l],d=n[l];s[u.id]=[c,d]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Cf);for(const l of r){const u=this.nodesByDepth[l];for(const c of u){const d=c.outboundLayer,h=c.inputTensors,f=c.outputTensors,p=new Array;for(const m of h)m.id in s&&p.push(s[m.id]);if(p.length===h.length){let m={},x,g,y,v;if(c.callArgs!=null&&(m=c.callArgs),p.length===1){const[b,w]=p[0];m.mask==null&&(m.mask=w),y=et(d.call(b,m)),v=et(d.computeMask(b,w)),x=[b],g=[w]}else x=p.map(b=>b[0]),g=p.map(b=>b[1]),m.mask==null&&(m.mask=g),y=et(d.call(x,m)),v=et(d.computeMask(x,g));if(d.activityRegularizer)throw new Ne("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let b=0;b<f.length;++b){const w=f[b],$=y[b],k=v[b];s[w.id]=[$,k]}}}}const o=[],i=[],a=[];for(const l of this.outputs){Mr(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,c]=s[l.id];a.push(u.shape),o.push(u),i.push(c)}return[o,i,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof ar?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=ar.nodeKey(r,o);this.containerNodes.has(i)&&(n[i]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new L("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new L(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new L(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return j(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=ar.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),u=[];for(let d=0;d<i.inboundNodes.length;d++){const h=i.inboundNodes[d],f=ar.nodeKey(i,d);let p={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),p=h.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(h.inboundLayers.length>0){const m=[];for(let x=0;x<h.inboundLayers.length;x++){const g=h.inboundLayers[x],y=h.nodeIndices[x],v=h.tensorIndices[x],b=ar.nodeKey(g,y);let w=n[b];w==null&&(w=0),m.push([g.name,w,v,p])}u.push(m)}}}const c={};c.name=i.name,c.className=a,c.config=l,c.inboundNodes=u,s.push(c)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=ar.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const d=this.inputLayersTensorIndices[i];r.push([a.name,c,d])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=ar.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const d=this.outputLayersTensorIndices[i];o.push([a.name,c,d])}return e.outputLayers=o,e}static fromConfig(e,n,s={},r=!1){const o={},i={};function a(x,g){x.name in i?i[x.name].push(g):i[x.name]=[g]}function l(x,g){const y=[];let v;for(const b of g){const w=b[0],$=b[1],k=b[2];if(v=b[3]==null?{}:b[3],!(w in o)){a(x,g);return}const C=o[w];if(C.inboundNodes.length<=$){a(x,g);return}const S=C.inboundNodes[$];y.push(S.outputTensors[k])}y.length>0&&x.apply(Hn(y),v)}function u(x){const g=x.name,y=bo(x,n.customObjects!=null?n.customObjects:{});y.setFastWeightInitDuringBuild(r),o[g]=y,x.inboundNodes.forEach(b=>{if(!(b instanceof Array))throw new L(`Corrupted configuration, expected array for nodeData: ${b}`);a(y,b)})}const c=n.name,d=n.layers;for(const x of d)u(x);for(;!n7(i);)for(const x of d){const g=o[x.name];if(g.name in i){const y=i[g.name];delete i[g.name];for(const v of y)l(g,v)}}const h=[],f=[],p=n.inputLayers;for(const x of p){const g=x[0],y=x[1],v=x[2];Mr(g in o);const w=o[g].inboundNodes[y].outputTensors;h.push(w[v])}const m=n.outputLayers;for(const x of m){const g=x[0],y=x[1],v=x[2];Mr(g in o);const w=o[g].inboundNodes[y].outputTensors;f.push(w[v])}return new e({inputs:h,outputs:f,name:c})}get stateful(){if(this._stateful)throw new L("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){j(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vK(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(o=>{o in t?r.push(t[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function BD(t,e){return vK(t,e,"classWeight")}async function VD(t,e,n,s){if(n!=null){const r=j(()=>{if(t.shape.length===1)return ca(t);if(t.shape.length===2){if(t.shape[1]>1)return ld(t,1);if(t.shape[1]===1)return U(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Oe(r);const i=[];return o.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(n[a])}),os(i,"float32")}else return null}function bK(t,e){return z(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wK=32;function WD(t,e){let n,s;const r=e;n=r.xs,s=r.ys,I(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=tI("input",t.inputNames,n),i=tI("output",t.outputNames,s),a=o[0].shape[0];I(o.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),I(i.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<o.length;l++)I(o[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<i.length;l++)I(i[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:o,ys:i}}function tI(t,e,n){if(n instanceof Gt)return[n];if(Array.isArray(n))return I(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new L(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function CK(t){if(t.length===3)throw new Ne("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function $K(t,e,n){const s=n.batchesPerEpoch!=null;if(I(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),I(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),I(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),I(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),I(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let o,i;if(r)if(nI(n.validationData))I(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const x=CK(n.validationData);o=x.xs,i=x.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(x=>"val_"+x)):u=l.slice();const c=AD(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:h,history:f}=DD(c,d,n.epochs,null,null,kK(e,n),null,r,u);h.setModel(t),t.history=f,await h.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;p<n.epochs;){const x={};await h.onEpochBegin(p);let g=0,y=0;for(s||(m=await e.iterator());!s||g<n.batchesPerEpoch;){const v=await m.next();if(s&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${g} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:b,ys:w}=WD(t,v.value),$={};$.batch=y,$.size=b[0].shape[0],await h.onBatchBegin(y,$);const k=[];if(n.classWeight!=null){const T=BD(n.classWeight,t.outputNames);for(let R=0;R<T.length;++R)k.push(await VD(w[R],null,T[R]))}const C=b.concat(w).concat(k),S=a(C);Oe(C);for(let T=0;T<l.length;++T){const R=l[T],A=S[T];$[R]=A,Kr(A)}await h.onBatchEnd(y,$),RD($),y++,g++}if(s?g>=n.batchesPerEpoch:v.done){if(r){let b;nI(n.validationData)?b=et(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):b=et(t.evaluate(o,i,{batchSize:n.validationBatchSize==null?wK:n.validationBatchSize,verbose:0}));for(let w=0;w<t.metricsNames.length;++w)x[`val_${t.metricsNames[w]}`]=b[w]}break}if(t.stopTraining_)break}if(await h.onEpochEnd(p,x),p++,t.stopTraining_)break}return await h.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function kK(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function nI(t){return typeof t.iterator=="function"}function SK(t){return typeof t.next=="function"}async function IK(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let o=[];if(n.verbose>0)throw new Ne("Verbose mode is not implemented yet.");I(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const i=SK(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const u=await i.next();if(o=j(()=>{if(u.value){const{xs:c,ys:d}=WD(t,u.value),h=c.concat(d),f=j(()=>r(h));if(Oe(h),l===0)for(let m=0;m<f.length;++m)o.push(Xe(0));const p=h[0].shape[0];for(let m=0;m<f.length;++m){const x=f[m],g=o[m];o[m]=j(()=>ne(o[m],z(p,x))),l>0&&Oe(g)}Oe(f),a+=p,++l}return o}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<o.length;++u){const c=o[u];o[u]=ve(o[u],a),Oe(c)}return Hn(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rx(t){I(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Ju(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>ha(s,e,n-e)):ha(t,e,n-e)}function Fv(t,e){return j(()=>t==null?null:Array.isArray(t)?t.map(n=>Fv(n,e)):gD(t,e.dtype==="int32"?e:ue(e,"int32")))}function Ax(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function UD(t){const e=[];t instanceof Gt&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(Lh(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function or(t,e){if(t==null)return;const n=[];if(e instanceof Gt)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const o=e[r];n.push(o.id)}const s=[];if(t instanceof Gt)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const o=t[r];n.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TK(t){return t instanceof Gt}function Ov(t){return Array.isArray(t)}function sI(t){return!TK(t)&&!Ov(t)}function rI(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let i=!1;if(Ov(t)&&t.length>0)i=!0;else if(sI(t)){for(const a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new L(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(i=>null);let o;if(sI(t)){t=t,o=[];for(const i of e){if(t[i]==null)throw new L(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(t[i])}}else if(Ov(t)){if(t=t,t.length!==e.length)throw new L(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);o=t}else{if(t=t,e.length>1)throw new L(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);o=[t]}if(o=UD(o),n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new L(`Error when checking ${r}: expected ${e[i]} to have ${n[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[i][l];if(c!=null&&c>=0&&u!==c)throw new L(`${r} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function EK(t,e,n){const s=li(t.map(o=>o.shape[0]));s.sort();const r=li(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new L(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(o=>o.shape))}`);if(r.length>1)throw new L(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!qe(s,r))throw new L(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function NK(t,e,n){const s=[w0,C0,pd];for(let r=0;r<t.length;++r){const o=t[r],i=e[r],a=n[r];if(i!=null){if(i===pd&&o.shape[o.shape.length-1]===1)throw new L(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=o.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){const d=l[c],h=u[c];if(h!=null&&d!==h)throw new L(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function oI(t,e,n,s=!0,r=""){let o;if(Array.isArray(t)){if(t.length!==e.length)throw new L(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);o=t}else{if(e.length>1)throw new L(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);o=[t]}if(n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new L(`Error when checking ${r}: expected ${e[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[i][l];if(c!=null&&c!==u)throw new L(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function RK(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let o=n.hasOwnProperty(r)?n[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const AK="layers-model";class Vl extends ar{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new L("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");fK(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=hK(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ri))throw new L("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new L(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),n.push(Nx(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new L(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>Nx(a))}else{const i=Nx(e.loss);this.outputs.forEach(a=>{n.push(i)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],da("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=RK(e.metrics,this.outputNames),o=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};da("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(u=>{const c="";let d,h,f;for(const p of u){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const x=this.internalOutputShapes[i];x[x.length-1]===1||this.lossFunctions[i]===C0?["accuracy","acc"].indexOf(p)!==-1?h=OD:["crossentropy","ce"].indexOf(p)!==-1&&(h=nK):this.lossFunctions[i]===um?["accuracy","acc"].indexOf(p)!==-1?h=sK:["crossentropy","ce"].indexOf(p)!==-1&&(h=LD):["accuracy","acc"].indexOf(p)!==-1?h=PD:["crossentropy","ce"].indexOf(p)!==-1&&(h=_D);let g;["accuracy","acc"].indexOf(p)!==-1?g="acc":["crossentropy","ce"].indexOf(p)!==-1&&(g="ce"),f=h,d=c+g}else f=dK(p),d=c+Sf(p);let m;da(d,()=>{m=f}),o(i,d,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;Rx(r);const i=this.standardizeUserDataXY(e,n,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Hn(u)}finally{or(i[0],e),or(i[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),IK(this,e,n)}checkNumSamples(e,n,s,r="steps"){let o;if(s!=null){if(o=null,n!=null)throw new L(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new L(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new L("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],o=this.retrieveSymbolicTensors(r),i=new qo;if(e instanceof Gt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new L(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new L(`No value is provided for the model's input ${l.name}`);i.add(l,u)}const a=fc(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const n=Aa(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(n[a]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((o,i)=>{o==null&&r.push(e[i])}),new L(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return j(()=>{const r=this.checkNumSamples(e);if(s)throw new Ne("Verbose predictLoop() is not implemented yet.");const o=Ax(r,n),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)j(()=>{const u=o[a][0],c=o[a][1],d=Ju(e,u,c),h=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)h.push({key:this.inputs[p],value:d[p]});else h.push({key:this.inputs[0],value:d});const f=new qo(h);return fc(this.outputs,f)}).forEach((u,c)=>i[c].push(u));return Hn(i.map(a=>Xn(a,0)))})}predict(e,n={}){const s=UD(e);oI(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return Rx(r),this.predictLoop(s,r)}finally{or(s,e)}}predictOnBatch(e){oI(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new Hs("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===um?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=rI(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=rI(n,this.feedOutputNames,o,!1,"target"),EK(e,n),NK(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new L(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,o=!0,i){const[a,l]=this.standardizeUserDataXY(e,n,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const c=BD(r,this.outputNames);u=[];for(let d=0;d<c.length;++d)u.push(await VD(l[d],null,c[d]))}return[a,l,u]}testLoop(e,n,s,r=0,o){return j(()=>{const i=this.checkNumSamples(n,s,o,"steps"),a=[];if(r>0)throw new Ne("Verbose mode is not implemented yet.");if(o!=null)throw new Ne("steps mode in testLoop() is not implemented yet");{const l=Ax(i,s),u=os(kr(0,i));for(let c=0;c<l.length;++c){const d=l[c][0],h=l[c][1],f=ha(u,d,h-d),p=Fv(n,f),m=e(p);if(c===0)for(let x=0;x<m.length;++x)a.push(Xe(0));for(let x=0;x<m.length;++x){const g=m[x];a[x]=ne(a[x],z(h-d,g))}}for(let c=0;c<a.length;++c)a[c]=ve(a[c],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(US(e,r)>1){const i=US(e.slice(0,s),r);o+=`_${i}`}n.push(o)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const d=[];for(let m=0;m<this.inputs.length;++m)d.push({key:this.inputs[m],value:s[m]});const h=new qo(d),f=fc(this.outputs,h,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const x=this.lossFunctions[m];let g=x(r[m],f[m]);o[m]!=null&&(g=bK(g,o[m]));const y=Bt(g);n.push(y),m===0?p=g:p=ne(p,g)}for(let m=0;m<this.metricsTensors.length;++m){let x;if(this.outputs.length>1&&m<this.outputs.length)x=n[m];else{const g=this.metricsTensors[m][0],y=this.metricsTensors[m][1];x=Bt(g(r[y],f[y]))}Kr(x),i.push(x)}return p=Bt(p),this.calculateLosses().forEach(m=>{p=ne(p,m)}),p},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>j(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:r[u]});const a=new qo(i),l=fc(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const c=this.lossFunctions[u],d=Bt(c(o[u],l[u]));u===0?s=d:s=ne(s,d),n.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const c=this.metricsTensors[u][0],d=this.metricsTensors[u][1],h=Bt(c(o[d],l[d]));n.push(h)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,l,u,c,d,h;try{const f=s.batchSize==null?32:s.batchSize;Rx(f);const m=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,f);r=m[0],o=m[1],h=m[2];let x=!1,g;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new Ne("validationData including sample weights is not supported yet."):new L(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const T=await this.standardizeUserData(l,u,null,null,!0,f);c=T[0],d=T[1],g=c.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const S=Math.floor(r[0].shape[0]*(1-s.validationSplit)),T=r[0].shape[0];c=Ju(r,S,T),i=r,r=Ju(r,0,S),d=Ju(o,S,T),a=o,o=Ju(o,0,S),g=c.concat(d)}else s.validationSteps!=null&&(x=!0);const y=r.concat(o).concat(h);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),b=this.getDedupedMetricsNames();let w,$;x?(this.makeTestFunction(),w=this.testFunction,$=b.slice().concat(b.map(S=>"val_"+S))):(w=null,g=[],$=b.slice());const k=AD(s.callbacks,s.yieldEvery);return await this.fitLoop(v,y,b,f,s.epochs,s.verbose,k,w,g,s.shuffle,$,s.initialEpoch,null,null)}finally{this.isTraining=!1,or(r,e),or(o,n),or(i,e),or(a,n),or(c,l),or(d,u),h!=null&&Oe(h)}}async fitLoop(e,n,s,r,o,i,a,l,u,c,d,h,f,p){r==null&&(r=32),o==null&&(o=1),c==null&&(c=!0),h==null&&(h=0);let m=!1;if(l!=null&&u!=null&&(m=!0),p!=null&&(m=!0,f==null))throw new L("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(n,r,f,"steps_per_epoch");let g;x!=null&&(g=kr(0,x)),i==null&&(i=1);const{callbackList:y,history:v}=DD(a,i,o,h,x,f,r,m,d);y.setModel(this),this.history=v,await y.onTrainBegin(),this.stopTraining_=!1;for(let b=h;b<o;++b){await y.onEpochBegin(b);const w={};if(f!=null)throw new Ne("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new Ne("batch shuffling is not implemneted yet");c&&mV(g);const $=os(g),k=Ax(x,r);for(let C=0;C<k.length;++C){const S={};if(await y.onBatchBegin(C,S),j(()=>{const T=k[C][0],R=k[C][1],A=ha($,T,R-T);S.batch=C,S.size=R-T;const E=Fv(n,A),N=e(E);for(let P=0;P<s.length;++P){const _=s[P],M=N[P];S[_]=M,Kr(M)}if(C===k.length-1&&m){const P=this.testLoop(l,u,r);for(let _=0;_<s.length;++_){const M=s[_],D=P[_];Kr(D),w["val_"+M]=D}}}),await y.onBatchEnd(C,S),RD(S),this.stopTraining_)break}$.dispose()}if(await y.onEpochEnd(b,w),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return $K(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),l=[];for(const u of a){const c=await u.data();l.push(c[0])}return Oe(a),or(s[0],e),or(s[1],n),Hn(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||n.push({name:r[i].originalName,tensor:o[i]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=SS().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-SS().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ho(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>ho(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=ho(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ho(Sf(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ho(Sf(e)));{const e={};for(const n in this.metrics)e[n]=ho(Sf(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Av(e.optimizer_config),s=bo(n);let r;if(typeof e.loss=="string")r=Xi(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>Xi(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=Xi(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>Xi(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=Xi(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,n){if(typeof e=="string"){const u=dW(e);if(u.length===0)throw new L(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new L(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new L("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await TS(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:AK,generatedBy:`TensorFlow.js tfjs-layers v${zD}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:c,specs:d}=await TS(await this.optimizer.getWeights(),u);s.specs.push(...d),s.data=cW([s.data,c])}return this.userDefinedMetadata!=null&&(eI(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){eI(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Vl.className="Model";ee(Vl);class GD extends Vl{}GD.className="Functional";ee(GD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class md extends Vl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:y0("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new L(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof md||e instanceof Vl;let s;if(n){if(s=e,s.outputs.length!==1)throw new L("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new L("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new L("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=F7({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new L(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new L("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=SD(this.outputs[0])}this.inboundNodes=[],new b0({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Aa(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(Ue(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Vl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new Hs("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new Hs("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new Hs("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new Hs("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let o,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new L("Legacy serialization format not supported yet.");o=n}else I(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=n.layers,delete n.layers,i=n;const a=new e(i);if(!(a instanceof md))throw new Ne(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const c=bo(l,void 0,r);r&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new L("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new L("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}md.className="Sequential";ee(md);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let In=class extends Iu{getConfig(){return{}}};class HD extends In{apply(e,n=1){return x7(e,n)}}HD.className="elu";ee(HD);class jD extends In{apply(e){return uA(e)}}jD.className="selu";ee(jD);class KD extends In{apply(e){return ja(e)}}KD.className="relu";ee(KD);class XD extends In{apply(e){return j(()=>dd(6,ja(e)))}}XD.className="relu6";ee(XD);class qD extends In{apply(e){return e}}qD.className="linear";ee(qD);class YD extends In{apply(e){return $u(e)}}YD.className="sigmoid";ee(YD);class QD extends In{apply(e){return v7(e)}}QD.className="hardSigmoid";ee(QD);class ZD extends In{apply(e){return Nh(e)}}ZD.className="softplus";ee(ZD);class JD extends In{apply(e){return y7(e)}}JD.className="softsign";ee(JD);class eF extends In{apply(e){return l0(e)}}eF.className="tanh";ee(eF);let VC=class extends In{apply(e,n=-1){return Gw(e,n)}};VC.className="softmax";ee(VC);class tF extends In{apply(e,n=-1){return eA(e,n)}}tF.className="logSoftmax";ee(tF);class nF extends In{apply(e){return j(()=>j(()=>{const n=Math.sqrt(2),s=z(.5,ne(1,qR(ve(e,n))));return z(e,s)}))}}nF.className="gelu";ee(nF);class sF extends In{apply(e){return j(()=>z(.5,z(e,ne(1,l0(z(kn(ve(2,Math.PI)),ne(e,z(.044715,Ea(e,3)))))))))}}sF.className="gelu_new";ee(sF);class rF extends In{apply(e){return j(()=>z(e,l0(Nh(e))))}}rF.className="mish";ee(rF);class oF extends In{apply(e,n=1){return j(()=>z($u(z(e,n)),e))}}oF.className="swish";ee(oF);function gi(t){return t.getClassName()}function Dx(t,e={}){return _h(t,Bs.getMap().classNameMap,e,"activation")}function xi(t){if(t==null){const e={};return e.className="linear",e.config={},Dx(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},Dx(e)}else return t instanceof In?t:Dx(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DK(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class iF extends Iu{}class aF extends iF{constructor(e){super(),DK(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return j(()=>{let n=kt([1]);return this.hasL1&&(n=ne(n,ye(z(this.l1,Dn(e))))),this.hasL2&&(n=ne(n,ye(z(this.l2,Mh(e))))),U(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}aF.className="L1L2";ee(aF);const iI={l1l2:"L1L2"};function rt(t){return TC(t)}function aI(t,e={}){return _h(t,Bs.getMap().classNameMap,e,"regularizer")}function Ct(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in iI?iI[t]:t,config:{}};return aI(n)}else return t instanceof iF?t:aI(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class lF extends Fe{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=we(e);let s=ja(e);return this.maxValue!=null&&(s=$s(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}lF.className="ReLU";ee(lF);class uF extends Fe{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=we(e);return Ew(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}uF.className="LeakyReLU";ee(uF);class cF extends Fe{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=wt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Ct(e.alphaRegularizer),this.alphaConstraint=Qt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new L(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ue(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Kt({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=we(e),Ow(e,this.alpha.read())}getConfig(){const e={alphaInitializer:St(this.alphaInitializer),alphaRegularizer:rt(this.alphaRegularizer),alphaConstraint:Yt(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}cF.className="PReLU";ee(cF);let dF=class extends Fe{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ne(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=we(e);return d0(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};dF.className="ELU";ee(dF);class hF extends Fe{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=we(e);return z(s,ue(Is(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}hF.className="ThresholdedReLU";ee(hF);class fF extends Fe{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new VC().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return j(()=>{let s=we(e);const r=n.mask;if(r!=null){const o=z(be(Fo(s.shape),ue(r,s.dtype)),Xe(-1e9));s=ne(s,o)}return this.axis instanceof Array?this.axis.length>1?eo(be(s,tA(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}fF.className="Softmax";ee(fF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wl(t,e,n){if(typeof t=="number")return Aa(t,e);if(t.length!==e)throw new L(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!f7(r))throw new L(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Cr(t,e,n,s,r=1){if(t==null)return t;const o=e+(e-1)*(r-1);let i;return n==="same"?i=t:i=t-o+1,Math.floor((i+s-1)/s)}function zr(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+mi([n-e,0]);else if(s==="same")t=t*e;else throw new L(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WC(t,e){return j(()=>(_t(e),e==="channelsFirst"?ze(t,[0,2,3,1]):t))}function pF(t,e){return j(()=>(_t(e),e==="channelsFirst"?ze(t,[0,2,3,4,1]):t))}function FK(t,e,n,s=1,r="valid",o,i=1){return j(()=>{if(o==null&&(o=Sr()),_t(o),t.shape.length!==3)throw new L(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new L(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new L(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(o==="channelsFirst"&&(t=ze(t,[0,2,1])),r==="causal")throw new Ne("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=GR(t,e,s,r==="same"?"same":"valid","NWC",i);return n!=null&&(a=Er(a,n)),a})}function lI(t,e,n,s=[1,1],r="valid",o,i,a=null){return j(()=>{if(o==null&&(o=Sr()),_t(o),t.rank!==3&&t.rank!==4)throw new L(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new L(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=WC(t,o);if(r==="causal")throw new Ne("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=W5({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:a}),o==="channelsFirst"&&(l=ze(l,[0,3,1,2])),l})}function OK(t,e,n,s=[1,1,1],r="valid",o,i){return j(()=>{if(o==null&&(o=Sr()),_t(o),t.rank!==4&&t.rank!==5)throw new L(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new L(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=pF(t,o);if(r==="causal")throw new Ne("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=VU(a,e,s,r==="same"?"same":"valid","NDHWC",i),n!=null&&(a=Er(a,n)),o==="channelsFirst"&&(a=ze(a,[0,4,1,2,3])),a})}class $0 extends Fe{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",$0.verifyArgs(n),this.rank=e,on(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ne(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Wl(n.kernelSize,e,"kernelSize"),this.strides=Wl(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Ts(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,_t(this.dataFormat),this.activation=xi(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=wt(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Qt(n.biasConstraint),this.biasRegularizer=Ct(n.biasRegularizer),this.activityRegularizer=Ct(n.activityRegularizer),this.dilationRate=Wl(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new L(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new L(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new L(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Mr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!EC(e.kernelSize,"number",1,3))throw new L(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:gi(this.activation),useBias:this.useBias,biasInitializer:St(this.biasInitializer),biasRegularizer:rt(this.biasRegularizer),activityRegularizer:rt(this.activityRegularizer),biasConstraint:Yt(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Tu extends $0{constructor(e,n){super(e,n),this.kernel=null,Tu.verifyArgs(n),this.filters=n.filters,on(this.filters,"filters"),this.kernelInitializer=wt(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Qt(n.kernelConstraint),this.kernelRegularizer=Ct(n.kernelRegularizer)}build(e){e=Ue(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new L(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return j(()=>{e=we(e);let s;const r=this.bias==null?null:this.bias.read(),o=cD(this.activation.getClassName());if(o!=null&&this.rank===2)s=lI(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=FK(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=lI(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=OK(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ne("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Ue(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=Cr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);n.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:St(this.kernelInitializer),kernelRegularizer:rt(this.kernelRegularizer),kernelConstraint:Yt(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new L(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Wh extends Tu{constructor(e){super(2,e),Wh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!EC(e.kernelSize,"number",1,2))throw new L(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Wh.className="Conv2D";ee(Wh);class Uh extends Tu{constructor(e){super(3,e),Uh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new L(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Uh.className="Conv3D";ee(Uh);class mF extends Wh{constructor(e){if(super(e),this.inputSpec=[new Kt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new L(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ue(e),e.length!==4)throw new L("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new L("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Kt({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return j(()=>{let s=we(e);if(s.shape.length!==4)throw new L(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=r[i],u=r[a],c=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],f=this.strides[1],p=zr(l,h,c,this.padding),m=zr(u,f,d,this.padding),x=[o,p,m,this.filters];this.dataFormat!=="channelsLast"&&(s=ze(s,[0,2,3,1]));let g=HR(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(g=ze(g,[0,3,1,2])),this.bias!=null&&(g=Er(g,this.bias.read(),this.dataFormat)),this.activation!=null&&(g=this.activation.apply(g)),g})}computeOutputShape(e){e=Ue(e);const n=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[s]=this.filters,n[r]=zr(n[r],l,i,this.padding),n[o]=zr(n[o],u,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}mF.className="Conv2DTranspose";ee(mF);class gF extends Uh{constructor(e){if(super(e),this.inputSpec=[new Kt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new L(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ue(e),e.length!==5)throw new L("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new L("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Kt({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return j(()=>{let s=we(e);if(s.shape.length!==5)throw new L(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const u=r[l],c=r[i],d=r[a],h=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],x=this.strides[1],g=this.strides[2],y=zr(u,m,h,this.padding),v=zr(c,x,f,this.padding),b=zr(d,g,p,this.padding),w=[o,y,v,b,this.filters];this.dataFormat!=="channelsLast"&&(s=ze(s,[0,2,3,4,1]));let $=GU(s,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&($=ze($,[0,4,1,2,3])),this.bias!==null&&($=Er($,this.bias.read(),this.dataFormat)),this.activation!==null&&($=this.activation.apply($)),$})}computeOutputShape(e){e=Ue(e);const n=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],d=this.strides[1],h=this.strides[2];return n[s]=this.filters,n[r]=zr(n[r],c,a,this.padding),n[o]=zr(n[o],d,l,this.padding),n[i]=zr(n[i],h,u,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}gF.className="Conv3DTranspose";ee(gF);class xF extends Tu{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new L("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new L("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new L(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=wt(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Ct(n.depthwiseRegularizer),this.depthwiseConstraint=Qt(n.depthwiseConstraint),this.pointwiseInitializer=wt(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Ct(n.pointwiseRegularizer),this.pointwiseConstraint=Qt(n.pointwiseConstraint)}build(e){if(e=Ue(e),e.length<this.rank+2)throw new L(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new L(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Kt({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return j(()=>{e=we(e);let s;if(this.rank===1)throw new Ne("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=ze(e,[0,2,3,1])),s=cA(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Er(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=ze(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=St(this.depthwiseInitializer),e.pointwiseInitializer=St(this.pointwiseInitializer),e.depthwiseRegularizer=rt(this.depthwiseRegularizer),e.pointwiseRegularizer=rt(this.pointwiseRegularizer),e.depthwiseConstraint=Yt(this.depthwiseConstraint),e.pointwiseConstraint=Yt(this.pointwiseConstraint),e}}xF.className="SeparableConv";class yF extends xF{constructor(e){super(2,e)}}yF.className="SeparableConv2D";ee(yF);class k0 extends Tu{constructor(e){super(1,e),k0.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!EC(e.kernelSize,"number",1,1))throw new L(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}k0.className="Conv1D";ee(k0);class vF extends Fe{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return j(()=>{if(e=we(e),this.dataFormat==="channelsLast"){const s=kf(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return kf(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=kf(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return kf(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}vF.className="Cropping2D";ee(vF);class bF extends Fe{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,c7(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return j(()=>{let s=we(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=ze(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?xo.resizeNearestNeighbor(s,[o,i]):xo.resizeBilinear(s,[o,i]);return ze(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?xo.resizeNearestNeighbor(s,[o,i]):xo.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}bF.className="UpSampling2D";ee(bF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PK(t,e,n=[1,1],s="valid",r,o){return j(()=>{r==null&&(r=Sr()),_t(r);let i=WC(t,r);if(t.rank!==4)throw new L(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new L(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=kw(i,e,n,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=ze(i,[0,3,1,2])),i})}class wF extends $0{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=wt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Qt(e.depthwiseConstraint),this.depthwiseRegularizer=Ct(e.depthwiseRegularizer)}build(e){if(e=Ue(e),e.length<4)throw new L(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new L(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return j(()=>{e=we(e);let s=PK(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Er(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Ue(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Cr(n,this.kernelSize[0],this.padding,this.strides[0]),i=Cr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=St(this.depthwiseInitializer),e.depthwiseRegularizer=rt(this.depthwiseRegularizer),e.depthwiseConstraint=Yt(this.depthwiseRegularizer),e}}wF.className="DepthwiseConv2D";ee(wF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CF(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new L("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function $F(t,e,n,s=!1,r,o,i=!1,a=!1){return j(()=>{const l=e.shape.length;if(l<3)throw new L(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(kr(2,l));e=ze(e,u),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=ue(ue(r,"bool"),"float32"),r.rank===l-1&&(r=Gn(r,-1)),r=ze(r,u)),s&&(e=Na(e,0),r!=null&&(r=Na(r,0)));const c=[];let d,h=n;const f=e.shape[0],p=Ra(e);let m;r!=null&&(m=Ra(r));for(let g=0;g<f;++g){const y=p[g],v=j(()=>t(y,h));if(r==null)d=v[0],h=v[1];else{const b=j(()=>{const w=m[g],$=be(Qs(w),w),k=ne(z(v[0],w),z(h[0],$)),C=h.map((S,T)=>ne(z(v[1][T],w),z(S,$)));return{output:k,newStates:C}});d=b.output,h=b.newStates}a&&c.push(d)}let x;return a&&(x=Io(c,1)),[d,x,h]})}class Ai extends Fe{constructor(e){super(e);let n;if(e.cell==null)throw new L("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new HC({cells:e.cell}):n=e.cell,n.stateSize==null)throw new L("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Kt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return kr(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Ev(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of n)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,n){return j(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ne("Constants support is not implemented in RNN yet.");Ev(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Kt({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!qe(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new L(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Kt({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){j(()=>{if(!this.stateful)throw new Lr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new L("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>kt([s,r])):this.states_=[kt([s,this.cell.stateSize])];else if(e==null)Oe(this.states_),this.keptStates!=null&&(Oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>kt([s,r])):this.states_[0]=kt([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new L(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):Oe(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!qe(o.shape,a))throw new L(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>Kr(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=CF(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){n.initialState=s,i=i.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new Kt({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof no){const u=[e].concat(i),c=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=c;const h=super.apply(u,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return j(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let o=n==null?null:n.initialState;e=we(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new L(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=$F((p,m)=>{const x=this.cell.call([p].concat(m),a);return[x[0],x.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),c=u[0],d=u[1],h=u[2];this.stateful&&this.resetStates(h,r);const f=this.returnSequences?d:c;return this.returnState?[f].concat(h):f})}getInitialState(e){return j(()=>{let n=kt(e.shape);return n=ye(n,[1,2]),n=Lh(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Iv(n,[1,s]):n):this.cell.stateSize>1?[Iv(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ai.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,o=bo(r,s);return new e(Object.assign(n,{cell:o}))}}Ai.className="RNN";ee(Ai);class S0 extends Fe{}class UC extends S0{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,on(this.units,"units"),this.activation=xi(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=wt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ct(e.kernelRegularizer),this.recurrentRegularizer=Ct(e.recurrentRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.kernelConstraint=Qt(e.kernelConstraint),this.recurrentConstraint=Qt(e.recurrentConstraint),this.biasConstraint=Qt(e.biasConstraint),this.dropout=iu([1,mi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=iu([1,mi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ue(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return j(()=>{if(e=e,e.length!==2)throw new L(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=yi({ones:()=>Qs(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=yi({ones:()=>Qs(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=Yr(z(e,i),this.kernel.read()):o=Yr(e,this.kernel.read()),this.bias!=null&&(o=Er(o,this.bias.read())),a!=null&&(s=z(s,a));let l=ne(o,Yr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:gi(this.activation),useBias:this.useBias,kernelInitializer:St(this.kernelInitializer),recurrentInitializer:St(this.recurrentInitializer),biasInitializer:St(this.biasInitializer),kernelRegularizer:rt(this.kernelRegularizer),recurrentRegularizer:rt(this.recurrentRegularizer),biasRegularizer:rt(this.biasRegularizer),activityRegularizer:rt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}UC.className="SimpleRNNCell";ee(UC);class kF extends Ai{constructor(e){e.cell=new UC(e),super(e)}call(e,n){return j(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return new e(n)}}kF.className="SimpleRNN";ee(kF);class GC extends S0{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new L("GRUCell does not support reset_after parameter set to true.");this.units=e.units,on(this.units,"units"),this.activation=xi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=xi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=wt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ct(e.kernelRegularizer),this.recurrentRegularizer=Ct(e.recurrentRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.kernelConstraint=Qt(e.kernelConstraint),this.recurrentConstraint=Qt(e.recurrentConstraint),this.biasConstraint=Qt(e.biasConstraint),this.dropout=iu([1,mi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=iu([1,mi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ue(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return j(()=>{if(e=e,e.length!==2)throw new L(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=yi({ones:()=>Qs(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=yi({ones:()=>Qs(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=z(e,o[0]));let c=Yr(e,this.kernel.read());this.useBias&&(c=Er(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=z(r,i[0]));const d=this.recurrentKernel.read(),[h,f]=ws(d,[2*this.units,this.units],d.rank-1),p=Yr(r,h),[m,x,g]=ws(c,3,c.rank-1),[y,v]=ws(p,2,p.rank-1);a=this.recurrentActivation.apply(ne(m,y)),l=this.recurrentActivation.apply(ne(x,v));const b=Yr(z(l,r),f);u=this.activation.apply(ne(g,b));const w=ne(z(a,r),z(ne(1,Ft(a)),u));return[w,w]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:gi(this.activation),recurrentActivation:gi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:St(this.kernelInitializer),recurrentInitializer:St(this.recurrentInitializer),biasInitializer:St(this.biasInitializer),kernelRegularizer:rt(this.kernelRegularizer),recurrentRegularizer:rt(this.recurrentRegularizer),biasRegularizer:rt(this.biasRegularizer),activityRegularizer:rt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}GC.className="GRUCell";ee(GC);class SF extends Ai{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new GC(e),super(e)}call(e,n){return j(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}SF.className="GRU";ee(SF);class I0 extends S0{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,on(this.units,"units"),this.activation=xi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=xi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=wt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Ct(e.kernelRegularizer),this.recurrentRegularizer=Ct(e.recurrentRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.kernelConstraint=Qt(e.kernelConstraint),this.recurrentConstraint=Qt(e.recurrentConstraint),this.biasConstraint=Qt(e.biasConstraint),this.dropout=iu([1,mi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=iu([1,mi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=Ue(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(n=class extends er{apply(l,u){const c=o.apply([i]),d=new RC().apply([i]),h=o.apply([i*2]);return HS(HS(c,d),h)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return j(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new L(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=yi({ones:()=>Qs(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=yi({ones:()=>Qs(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,c,d;0<this.dropout&&this.dropout<1&&(e=z(e,i[0]));let h=Yr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=z(r,a[0])),h=ne(h,Yr(r,this.recurrentKernel.read())),this.useBias&&(h=Er(h,this.bias.read()));const[f,p,m,x]=ws(h,4,h.rank-1);l=this.recurrentActivation.apply(f),u=this.recurrentActivation.apply(p),c=ne(z(u,o),z(l,this.activation.apply(m))),d=this.recurrentActivation.apply(x);const g=z(d,this.activation.apply(c));return[g,g,c]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:gi(this.activation),recurrentActivation:gi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:St(this.kernelInitializer),recurrentInitializer:St(this.recurrentInitializer),biasInitializer:St(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:rt(this.kernelRegularizer),recurrentRegularizer:rt(this.recurrentRegularizer),biasRegularizer:rt(this.biasRegularizer),activityRegularizer:rt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}I0.className="LSTMCell";ee(I0);class IF extends Ai{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new I0(e),super(e)}call(e,n){return j(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}IF.className="LSTM";ee(IF);class HC extends S0{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return j(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,n),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){Ev(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{da(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const o of n.cells)r.push(bo(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return Nv(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)n.push([s.weights[i],o[i]])}LC(n)}}HC.className="StackedRNNCells";ee(HC);function yi(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:o}=t,i=()=>o!=null?o(e(),n):xD(e(),n),a=()=>zh(i,e,s);return!r||r<=1?Kr(a().clone()):Array(r).fill(void 0).map(a).map(u=>Kr(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var _K=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class TF extends Ai{constructor(e){if(e.unroll)throw new Ne("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ne("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Kt({ndim:5})]}call(e,n){return j(()=>{if(this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new L("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return j(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=kt(o);return Array.isArray(n)?Array(n.length).fill(i):[i]})}resetStates(e,n=!1){j(()=>{if(!this.stateful)throw new Lr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new L("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kt(o)):this.states_=[kt(o)];else if(e==null)Oe(this.states_),this.keptStates!=null&&(Oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kt(o)):this.states_[0]=kt(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new L(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):Oe(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=o;if(!qe(l.shape,u))throw new L(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Kr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,l=n==="channelsFirst",u=e[l?3:2],c=e[l?4:3],d=Cr(u,r[0],o,i[0],a[0]),h=Cr(c,r[1],o,i[1],a[1]);return[...e.slice(0,2),...l?[s,d,h]:[d,h,s]]}}TF.className="ConvRNN2D";class jC extends I0{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,on(this.filters,"filters"),this.kernelSize=Wl(s,2,"kernelSize"),this.kernelSize.forEach(l=>on(l,"kernelSize")),this.strides=Wl(r||1,2,"strides"),this.strides.forEach(l=>on(l,"strides")),this.padding=o||"valid",Ts(this.padding),this.dataFormat=i||"channelsLast",_t(this.dataFormat),this.dilationRate=Wl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>on(l,"dilationRate"))}build(e){var n;e=Ue(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new L(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,c=this.filters;l=new(n=class extends er{apply(h,f){const p=u.apply([c]),m=Fo([c]),x=u.apply([c*2]);return NC([p,m,x])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return j(()=>{if(e.length!==3)throw new L(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=yi({ones:()=>Qs(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(H,X,Z)=>!X||!X[Z]?H:z(X[Z],H);let c=u(r,l,0),d=u(r,l,1),h=u(r,l,2),f=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=yi({ones:()=>Qs(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=u(o,p,0),x=u(o,p,1),g=u(o,p,2),y=u(o,p,3);const v=3,[b,w,$,k]=ws(this.kernel.read(),a,v),[C,S,T,R]=this.useBias?ws(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,b,C,this.padding),d=this.inputConv(d,w,S,this.padding),h=this.inputConv(h,$,T,this.padding),f=this.inputConv(f,k,R,this.padding);const[A,E,N,P]=ws(this.recurrentKernel.read(),a,v);m=this.recurrentConv(m,A),x=this.recurrentConv(x,E),g=this.recurrentConv(g,N),y=this.recurrentConv(y,P);const _=this.recurrentActivation.apply(ne(c,m)),M=this.recurrentActivation.apply(ne(d,x)),D=ne(z(M,i),z(_,this.activation.apply(ne(h,g)))),W=z(this.recurrentActivation.apply(ne(f,y)),this.activation.apply(D));return[W,W,D]})}getConfig(){const e=super.getConfig(),n=_K(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,r){const o=Ta(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Er(o,s,this.dataFormat):o}recurrentConv(e,n){return Ta(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}jC.className="ConvLSTM2DCell";ee(jC);class EF extends TF{constructor(e){const n=new jC(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}EF.className="ConvLSTM2D";ee(EF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KC extends Fe{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return j(()=>{this.invokeCallHook(e,n);const s=we(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,o=this.getNoiseShape(s);return zh(()=>xD(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}KC.className="Dropout";ee(KC);class NF extends KC{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}NF.className="SpatialDropout1D";ee(NF);class RF extends Fe{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,on(this.units,"units"),this.activation=xi(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Qt(e.kernelConstraint),this.biasConstraint=Qt(e.biasConstraint),this.kernelRegularizer=Ct(e.kernelRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.activityRegularizer=Ct(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ue(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=Ue(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return j(()=>{this.invokeCallHook(e,n);const s=we(e),r=cD(this.activation.getClassName());let o;return r!=null?o=Yr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Yr(s,this.kernel.read()),this.bias!=null&&(o=Er(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:gi(this.activation),useBias:this.useBias,kernelInitializer:St(this.kernelInitializer),biasInitializer:St(this.biasInitializer),kernelRegularizer:rt(this.kernelRegularizer),biasRegularizer:rt(this.biasRegularizer),activityRegularizer:rt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),biasConstraint:Yt(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}RF.className="Dense";ee(RF);class AF extends Fe{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ue(e);for(const n of e.slice(1))if(n==null)throw new L(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ui(e,1)]}call(e,n){return j(()=>{this.invokeCallHook(e,n);let s=we(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=ze(s,r)}return g7(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}AF.className="Flatten";ee(AF);class DF extends Fe{constructor(e){super(e),this.supportsMasking=!0,this.activation=xi(e.activation)}call(e,n){return j(()=>{this.invokeCallHook(e,n);const s=we(e);return this.activation.apply(s)})}getConfig(){const e={activation:gi(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}DF.className="Activation";ee(DF);class FF extends Fe{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return j(()=>(e=we(e),p7(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}FF.className="RepeatVector";ee(FF);class OF extends Fe{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let o=1,i=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(i===null)i=l;else throw new L("Can only specifiy one unknown dimension.");else o*=u}const a=ui(e);if(i!==null){if(o===0||a%o!==0)throw new L(s);r[i]=a/o}else if(a!==o)throw new L(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return j(()=>{this.invokeCallHook(e,n);const s=we(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return U(s,o)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}OF.className="Reshape";ee(OF);class PF extends Fe{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=kr(1,e.dims.length+1);if(!qe(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Kt({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ue(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return ze(we(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}PF.className="Permute";ee(PF);class _F extends Fe{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=we(e);return vv(tm(s,this.maskValue),-1)}call(e,n){return j(()=>{this.invokeCallHook(e,n);const s=we(e),i=vv(tm(s,this.maskValue),-1,!0);return z(s,ue(i,s.dtype))})}}_F.className="Masking";ee(_F);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class LF extends Fe{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(et(e.inputLength))}this.inputDim=e.inputDim,on(this.inputDim,"inputDim"),this.outputDim=e.outputDim,on(this.outputDim,"outputDim"),this.embeddingsInitializer=wt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Ct(e.embeddingsRegularizer),this.activityRegularizer=Ct(e.activityRegularizer),this.embeddingsConstraint=Qt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return j(()=>this.maskZero?(e=we(e),tm(e,Be(e))):null)}computeOutputShape(e){if(e=Ue(e),this.inputLength==null)return[...e,this.outputDim];const n=et(this.inputLength);if(n.length!==e.length-1)throw new L(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const o=n[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new L(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(n[s]=i),s++}}return[e[0],...n,this.outputDim]}call(e,n){return j(()=>{this.invokeCallHook(e,n);let s=we(e);s.dtype!=="int32"&&(s=qr(s,"int32"));const r=gD(this.embeddings.read(),U(s,[s.size]));return U(r,Ue(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:St(this.embeddingsInitializer),embeddingsRegularizer:rt(this.embeddingsRegularizer),activityRegularizer:rt(this.activityRegularizer),embeddingsConstraint:Yt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}LF.className="Embedding";ee(LF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qa extends Fe{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ne}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const o=e[e.length-n.length+r],i=n[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new L("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ue(e)]),e=e,e.length<2)throw new L(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const o of e)o!=null&&o[0]!==null&&n.push(o[0]);if(n=li(n),n.length>1)throw new L(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&li(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return j(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=mi(r);for(let i of e){const a=i.rank;for(let l=0;l<o-a;++l)i=Lh(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const l of e){const u=l.rank;if(u==null){const c=l.shape,d=c[0],h=c.slice(1).concat([d]);let f=U(l,[d].concat(ui(c.slice(1))));f=ze(f,[1,0]),f=U(f,h),s.push(f),o=!0}else if(u>1){const c=kr(1,u).concat([0]);s.push(ze(l,c)),o=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const l=i.shape,u=l.length,c=l[u-1],d=[c].concat(l.slice(0,l.length-1));i=U(ze(U(i,[-1,c]),[1,0]),d)}else if(a>1){const l=[a-1].concat(kr(0,a-1));i=ze(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=li(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return j(()=>{if(n==null)return null;if(!Array.isArray(n))throw new L("`mask` should be an Array");if(!Array.isArray(e))throw new L("`inputs` should be an Array");if(n.length!==e.length)throw new L(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:Gn(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=So(s,n[r]);return s})}}class MF extends qa{constructor(e){super(e)}mergeFunction(e){return j(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=ne(n,e[s]);return n})}}MF.className="Add";ee(MF);class zF extends qa{constructor(e){super(e)}mergeFunction(e){return j(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=z(n,e[s]);return n})}}zF.className="Multiply";ee(zF);class BF extends qa{constructor(e){super(e)}mergeFunction(e){return j(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=ne(n,e[s]);return z(1/e.length,n)})}}BF.className="Average";ee(BF);class VF extends qa{constructor(e){super(e)}mergeFunction(e){return j(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Ni(n,e[s]);return n})}}VF.className="Maximum";ee(VF);class WF extends qa{constructor(e){super(e)}mergeFunction(e){return j(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=dd(n,e[s]);return n})}}WF.className="Minimum";ee(WF);class UF extends qa{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new L("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(qe(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new L("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return j(()=>NC(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new L("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of n.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new L("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new L("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new L(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return j(()=>{let s=!0;if(n.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)n[i]==null?r.push(ue(Qs(e[i]),"bool")):n[i].rank<e[i].rank?r.push(Gn(n[i],-1)):r.push(n[i]);const o=Xn(r,this.axis);return UR(o,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}UF.className="Concatenate";ee(UF);function ec(t,e){for(;t<0;)t+=e;return t}function LK(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Ne("batchDot is not implemented for tensors of 4D or higher rank yet");if(I(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),I(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Ne("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const o=n;return j(()=>{let i;if(s>r){i=s-r;const l=[];for(let u=0;u<i;++u)l.push(1);e=U(e,e.shape.concat(l))}else if(r>s){i=r-s;const l=[];for(let u=0;u<i;++u)l.push(1);t=U(t,t.shape.concat(l))}else i=0;let a;if(t.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=ye(z(t,e),o[0]):a=ye(z(ze(t,[1,0]),e),o[1]);else{const l=o[0]!==t.shape.length-1,u=o[1]===e.shape.length-1;a=Ke(t,e,l,u)}if(i>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let c=l;c<l+i;++c)u.push(c);a=Ah(a,u)}return a.shape.length===1&&(a=Gn(a,1)),a})}class GF extends qa{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){I(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Ne("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new L(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new L(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>ec(o,e[i].shape.length)):r=[ec(this.axes,n.shape.length),ec(this.axes,s.shape.length)],this.normalize&&(n=lm(n,r[0]),s=lm(s,r[1])),LK(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[ec(this.axes,e.length),ec(this.axes,n.length)],s}computeOutputShape(e){I(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Ne("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=n.concat(s);return o.length===1&&o.push(1),o}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}GF.className="Dot";ee(GF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HF extends Fe{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return j(()=>{this.invokeCallHook(e,n);const s=we(e);return zh(()=>ne(v0(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}HF.className="GaussianNoise";ee(HF);class jF extends Fe{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return j(()=>{this.invokeCallHook(e,n);const s=we(e);return this.rate>0&&this.rate<1?zh(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return z(s,v0(s.shape,1,o))},()=>s,n.training||!1):s})}}jF.className="GaussianDropout";ee(jF);class KF extends Fe{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||we(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return j(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return zh(()=>{const o=we(e),l=-1.6732632423543772*1.0507009873554805;let u=Ga(Rh(s),this.rate);u=qr(u,"float32");const c=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-c*l*this.rate,h=ne(z(o,u),z(ne(u,-1),l));return ne(z(h,c),d)},()=>we(e),n.training||!1)}return e})}}KF.className="AlphaDropout";ee(KF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gd(t,e,n,s,r,o=.001){let i;if(t.rank===2)i=xU(t,e,n,s,r,o);else if(t.rank===3)i=vU(t,e,n,s,r,o);else if(t.rank===4)i=wU(t,e,n,s,r,o);else throw new Ne(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return i}function MK(t,e,n,s,r=.001){return j(()=>{const o=Aw(t,s),i=o.mean,a=o.variance;return[gd(t,i,a,n,e,r),i,a]})}function zK(t,e,n,s,r=.001){return j(()=>{const o=Aw(t,s),i=o.mean,a=o.variance,l=[];for(const p of kr(0,t.rank))s.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const u=U(i,l),c=U(a,l),d=e==null?null:U(e,l),h=n==null?null:U(n,l);return[gd(t,u,c,h,d,r),i,a]})}function BK(t,e,n,s,r=.001){return qe(s.slice().sort(),kr(0,t.rank-1))?MK(t,e,n,s,r):zK(t,e,n,s,r)}class XF extends Fe{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=wt(e.betaInitializer||"zeros"),this.gammaInitializer=wt(e.gammaInitializer||"ones"),this.movingMeanInitializer=wt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=wt(e.movingVarianceInitializer||"ones"),this.betaConstraint=Qt(e.betaConstraint),this.gammaConstraint=Qt(e.gammaConstraint),this.betaRegularizer=Ct(e.betaRegularizer),this.gammaRegularizer=Ct(e.gammaRegularizer)}build(e){e=Ue(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new L(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Kt({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return j(()=>{const s=n.training==null?!1:n.training,r=we(e),o=r.shape,i=o.length,a=kr(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const u=Aa(1,i);u[l]=o[l];const c=a.slice();c.sort();const d=!qe(c,kr(0,i).slice(0,i-1)),h=()=>{if(d){const y=U(this.movingMean.read(),u),v=U(this.movingVariance.read(),u),b=this.center?U(this.beta.read(),u):null,w=this.scale?U(this.gamma.read(),u):null;return gd(r,y,v,b,w,this.epsilon)}else return gd(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return h();const[f,p,m]=BK(r,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(y,v,b)=>{j(()=>{const w=1-b,$=y.read(),k=z(be($,v),w);y.write(be($,k))})};return(()=>{x(this.movingMean,p,this.momentum),x(this.movingVariance,m,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:St(this.betaInitializer),gammaInitializer:St(this.gammaInitializer),movingMeanInitializer:St(this.movingMeanInitializer),movingVarianceInitializer:St(this.movingVarianceInitializer),betaRegularizer:rt(this.betaRegularizer),gammaRegularizer:rt(this.gammaRegularizer),betaConstraint:Yt(this.betaConstraint),gammaConstraint:Yt(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}XF.className="BatchNormalization";ee(XF);class qF extends Fe{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=wt(e.betaInitializer||"zeros"),this.gammaInitializer=wt(e.gammaInitializer||"ones"),this.betaRegularizer=Ct(e.betaRegularizer),this.gammaRegularizer=Ct(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ue(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=n);for(const o of this.axis)if(o<0||o>=n)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==li(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=we(e),r=s.shape,o=r.length;return j(()=>{let{mean:a,variance:l}=Aw(s,this.axis,!0);const u=Aa(1,o);for(const m of this.axis)u[m]=r[m];const c=m=>m!=null&&m.shape.length!==o?U(m,u):m;let d=this.scale?c(this.gamma.read()):null,h=this.center?c(this.beta.read()):null;const f=[],p=[];for(let m=0;m<o;++m)this.axis.indexOf(m)!==-1?(f.push(r[m]),p.push(1)):(f.push(1),p.push(r[m]));return a=gr(a,f),l=gr(l,f),d!=null&&(d=gr(d,p)),h!=null&&(h=gr(h,p)),gd(s,a,l,h,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:St(this.betaInitializer),gammaInitializer:St(this.gammaInitializer),betaRegularizer:rt(this.betaRegularizer),gammaRegularizer:rt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}qF.className="LayerNormalization";ee(qF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VK(t,e,n){return j(()=>{if(t.rank!==4)throw new L(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new L("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Sr()),n!=="channelsLast"&&n!=="channelsFirst")throw new L(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Dw(t,s)})}class YF extends Fe{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Sr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new L(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new L(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new L(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new Kt({ndim:4})]}computeOutputShape(e){e=Ue(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return j(()=>VK(we(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}YF.className="ZeroPadding2D";ee(YF);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function T0(t,e,n,s,r,o){return j(()=>{_t(r),hD(o),Ts(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=Sr()),o==null&&(o="max"),t=WC(t,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=Rw(t,e,n,a):i=bw(t,e,n,a),r==="channelsFirst"&&(i=ze(i,[0,3,1,2])),i})}function QF(t,e,n,s,r,o){return j(()=>{_t(r),hD(o),Ts(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Sr()),o==null&&(o="max"),t=pF(t,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=o6(t,e,n,a):i=aU(t,e,n,a),r==="channelsFirst"&&(i=ze(i,[0,4,1,2,3])),i})}class ZF extends Fe{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new L(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(on(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new L(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);on(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ts(this.padding),this.inputSpec=[new Kt({ndim:3})]}computeOutputShape(e){e=Ue(e);const n=Cr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return j(()=>{this.invokeCallHook(e,n),e=Lh(we(e),2);const s=this.poolingFunction(we(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ah(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class JF extends ZF{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return _t(o),Ts(r),T0(e,n,s,r,o,"max")}}JF.className="MaxPooling1D";ee(JF);class eO extends ZF{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return _t(o),Ts(r),T0(e,n,s,r,o,"avg")}}eO.className="AveragePooling1D";ee(eO);class tO extends Fe{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new L(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];on(this.poolSize,"poolSize"),on(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),Ts(this.padding),this.inputSpec=[new Kt({ndim:4})]}computeOutputShape(e){e=Ue(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Cr(n,this.poolSize[0],this.padding,this.strides[0]),s=Cr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return j(()=>(this.invokeCallHook(e,n),this.poolingFunction(we(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class nO extends tO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return _t(o),Ts(r),T0(e,n,s,r,o,"max")}}nO.className="MaxPooling2D";ee(nO);class sO extends tO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return _t(o),Ts(r),T0(e,n,s,r,o,"avg")}}sO.className="AveragePooling2D";ee(sO);class rO extends Fe{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new L(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];on(this.poolSize,"poolSize"),on(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),Ts(this.padding),this.inputSpec=[new Kt({ndim:5})]}computeOutputShape(e){e=Ue(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Cr(n,this.poolSize[0],this.padding,this.strides[0]),s=Cr(s,this.poolSize[1],this.padding,this.strides[1]),r=Cr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return j(()=>(this.invokeCallHook(e,n),this.poolingFunction(we(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class oO extends rO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return _t(o),Ts(r),QF(e,n,s,r,o,"max")}}oO.className="MaxPooling3D";ee(oO);class iO extends rO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return _t(o),Ts(r),QF(e,n,s,r,o,"avg")}}iO.className="AveragePooling3D";ee(iO);class aO extends Fe{constructor(e){super(e),this.inputSpec=[new Kt({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Ne}}class lO extends aO{constructor(e){super(e||{})}call(e,n){return j(()=>{const s=we(e);return Bt(s,1)})}}lO.className="GlobalAveragePooling1D";ee(lO);class uO extends aO{constructor(e){super(e||{})}call(e,n){return j(()=>{const s=we(e);return wr(s,1)})}}uO.className="GlobalMaxPooling1D";ee(uO);class cO extends Fe{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),this.inputSpec=[new Kt({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Ne}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class dO extends cO{call(e,n){return j(()=>{const s=we(e);return this.dataFormat==="channelsLast"?Bt(s,[1,2]):Bt(s,[2,3])})}}dO.className="GlobalAveragePooling2D";ee(dO);class hO extends cO{call(e,n){return j(()=>{const s=we(e);return this.dataFormat==="channelsLast"?wr(s,[1,2]):wr(s,[2,3])})}}hO.className="GlobalMaxPooling2D";ee(hO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fO extends Fe{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,o=bo(r,s);delete n.layer;const i={layer:o};return Object.assign(i,n),new e(i)}}class pO extends fO{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ue(e),e.length<3)throw new L(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ue(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return j(()=>(e=we(e),$F((i,a)=>[we(this.layer.call(i,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}pO.className="TimeDistributed";ee(pO);function WK(t){Xa(u7,"BidirectionalMergeMode",t)}const UK="concat";class mO extends fO{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=bo(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=bo(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?UK:e.mergeMode,WK(this.mergeMode),e.weights)throw new Ne("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,o;return this.returnState&&(o=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):Hn(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=CF(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const i=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new L("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,i.push(...s);const c=s.map(d=>new Kt({shape:d.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(r!=null)throw new Ne("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof no;for(const u of i)if(u instanceof no!==l)throw new L("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(i),c=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=c;const h=super.apply(u,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return j(()=>{const s=n.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,n),o=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(n,{initialState:u}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Na(o,1));let a;return this.mergeMode==="concat"?a=NC([r,o]):this.mergeMode==="sum"?a=ne(r,o):this.mergeMode==="ave"?a=z(.5,ne(r,o)):this.mergeMode==="mul"?a=z(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){da(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),da(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=bo(n.layer);if(delete n.layer,n.numConstants!=null)throw new Ne("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}mO.className="Bidirectional";ee(mO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gO extends Fe{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return j(()=>(e=we(e),e.dtype!=="float32"&&(e=qr(e,"float32")),ne(z(e,this.scale),this.offset)))}}gO.className="Rescaling";ee(gO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:GK,cropAndResize:HK}=xo;class xO extends Fe{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,o,i,a,l){return j(()=>{let u,c=!1;const d=n/i,h=s/a,f=(r+n)/i,p=(o+s)/a,m=[d,h,f,p],x=[];e.rank===3?(c=!0,u=Io([e])):u=e;for(let w=0;w<u.shape[0];w++)x.push(m);const g=Vn(x,[x.length,4]),y=hd(0,x.length,1,"int32"),b=HK(u,g,y,[r,o],"nearest");return qr(c?we(Ra(b)):b,l)})}upsize(e,n,s,r){return j(()=>{const o=GK(e,[n,s]);return qr(o,r)})}call(e,n){return j(()=>{const s=we(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Ue(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}xO.className="CenterCrop";ee(xO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jK(t,e,n,s){let r=we(t);if(r.dtype!=="int32"&&(r=qr(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=Gn(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Gn(r,-1)),r.rank>2)throw new L(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=RS(a,s,n,i):l=RS(a,[],n,i),e!=="tfIdf")return l;if(s)return z(l,s);throw new L("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yO extends Fe{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=Ue(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return j(()=>{e=we(e),e.dtype!=="int32"&&(e=qr(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new L(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=we(n.countWeights)}const r=wr(e),o=Jp(e),i=Is(this.numTokens,r).bufferSync().get(0),a=Ga(o,0).bufferSync().get(0);if(!(i&&a))throw new L(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return jK(e,this.outputMode,this.numTokens,s)})}}yO.className="CategoryEncoding";ee(yO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const KK=["bilinear","nearest"],uI=new Set(KK);class vO extends Fe{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(uI.has(e.interpolation))this.interpolation=e.interpolation;else throw new L(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Ue(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return j(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return xo.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return xo.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...uI]} are supported`)})}}vO.className="Resizing";ee(vO);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bO{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}bO.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wO extends Fe{constructor(e){super(e),this.randomGenerator=new bO(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}wO.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const XK=["bilinear","nearest"],cI=new Set(XK);class CO extends wO{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new L(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new L(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new L(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(cI.has(s))this.interpolation=s;else throw new L(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Ue(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return j(()=>{const s=we(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Rh([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return xo.resizeBilinear(e,i);case"nearest":return xo.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...cI]} are supported`)}})}}CO.className="RandomWidth";ee(CO);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK=K();qK.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var dI;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(dI||(dI={}));var hI;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(hI||(hI={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var fI;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(fI||(fI={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fe(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&I(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK=yA;class E0 extends $b{nextDataId(){return E0.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new MN(this,Fr())}write(e,n,s){this.firstUse&&(this.firstUse=!1,K().get("IS_NODE")&&xs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Dd(s[0])){const o=s.map(i=>ai(i));r=this.write(o,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,o){this.data.set(e,{values:n,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return To(r,o)}return wV(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>pi(r));return Ae(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ae(e.shape,e.dtype,n)}makeOutput(e,n,s){return Fr().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Un();return e(),{kernelMs:Un()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){fe([e],"where");const n=this.readSync(e.dataId);return YK(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}E0.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $O(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const QK=t=>{const{x:e}=t.inputs,n=t.backend;fe(e,"abs");let s=new Float32Array(Q(e.shape));const r=n.data.get(e.dataId).values;return s=$O(r),n.makeOutput(s,e.shape,e.dtype)},ZK={kernelName:og,backendName:"cpu",kernelFunc:QK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lt(t){return(e,n,s,r,o)=>{const i=Ie(e,n),a=i.length,l=ge(i),u=Q(i),c=Cn(o,u),d=e.length,h=n.length,f=ge(e),p=ge(n),m=ru(e,i),x=ru(n,i);if(m.length+x.length===0)for(let g=0;g<c.length;++g)c[g]=t(s[g%s.length],r[g%r.length]);else for(let g=0;g<c.length;++g){const y=bu(g,a,l),v=y.slice(-d);m.forEach(k=>v[k]=0);const b=jr(v,d,f),w=y.slice(-h);x.forEach(k=>w[k]=0);const $=jr(w,h,p);c[g]=t(s[b],r[$])}return[c,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ns(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",o),imag:n.makeTensorInfo(r.shape,"float32",i)},a}const JK={kernelName:_b,backendName:"cpu",kernelFunc:ns};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fm(t,e,n="float32"){if(n==="complex64"){const r=fm(t,e,"float32"),o=fm(t,e,"float32");return ns({inputs:{real:r,imag:o},backend:t})}const s=$n(Q(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const e9={kernelName:Jd,backendName:"cpu",kernelFunc:so};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Da(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const t9={kernelName:iw,backendName:"cpu",kernelFunc:Da};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kO(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=Ua([0],n),[o,i]=Lt((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function vi(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return so({inputs:{x:r},backend:n});const c=fm(n,r.shape,r.dtype),d=vi({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),h=ns({inputs:{real:d,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),h}if(r.dtype==="complex64"){const c=Da({inputs:{input:r},backend:n}),d=vi({inputs:{x:c},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(c),d}if(!VN(r.dtype,o)){const c=so({inputs:{x:r},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:o}}const i=n.data.get(r.dataId).values,[a,l,u]=kO(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,l,u)}const n9={kernelName:Bd,backendName:"cpu",kernelFunc:vi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function en(t,e,n,s){return n==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;fe([i,a],t);const u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,d=i.dtype==="string"?Eo(u):u,h=i.dtype==="string"?Eo(c):c,f=s||i.dtype,[p,m]=e(i.shape,a.shape,d,h,f);return l.makeTensorInfo(m,f,p)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const u=vi({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),d=c.complexTensorInfos.real,h=c.complexTensorInfos.imag,f=l.data.get(d.dataId).values,p=l.data.get(h.dataId).values,m=vi({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),x=l.data.get(m.dataId),g=x.complexTensorInfos.real,y=x.complexTensorInfos.imag,v=l.data.get(g.dataId).values,b=l.data.get(y.dataId).values,[w,$,k]=n(i.shape,a.shape,f,p,v,b),C=l.makeTensorInfo(k,"float32",w),S=l.makeTensorInfo(k,"float32",$),T=ns({inputs:{real:C,imag:S},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(C),l.disposeIntermediateTensorInfo(S),T}else{const u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,d=s||i.dtype,[h,f]=e(i.shape,a.shape,u,c,d);return l.makeTensorInfo(f,d,h)}}}function XC(t){return(e,n,s,r,o,i)=>{const a=Ie(e,n),l=Q(a),u=a.length,c=ge(a),d=Cn("float32",l),h=Cn("float32",l),f=ru(e,a),p=ru(n,a),m=To(s,r),x=To(o,i),g=e.length,y=ge(e),v=n.length,b=ge(n);if(f.length+p.length===0)for(let w=0;w<d.length;w++){const $=w%m.length,k=w%x.length,C=t(m[$*2],m[$*2+1],x[k*2],x[k*2+1]);d[w]=C.real,h[w]=C.imag}else for(let w=0;w<d.length;w++){const $=bu(w,u,c),k=$.slice(-g);f.forEach(A=>k[A]=0);const C=jr(k,g,y),S=$.slice(-v);p.forEach(A=>S[A]=0);const T=jr(S,v,b),R=t(m[C*2],m[C*2+1],x[T*2],x[T*2+1]);d[w]=R.real,h[w]=R.imag}return[d,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SO=Lt((t,e)=>t+e),s9=XC((t,e,n,s)=>({real:t+n,imag:e+s})),au=en(wu,SO,s9),r9={kernelName:wu,backendName:"cpu",kernelFunc:au};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qC(t,e,n,s,r){const o=Q(s),i=$n(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?i[l]+=e[a]:i[l]+=1)}return i}function IO(t,e,n,s=!1){const r=t.shape[0],o=t.shape[1],i=Ae([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<o;l++){const u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=n||(s?i.set(1,a,u):e.size>0?i.set(i.get(a,u)+e.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TO=Lt((t,e)=>t&e),o9=en(Pb,TO),i9={kernelName:Pb,backendName:"cpu",kernelFunc:o9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ro(t){return(e,n,s)=>{const r=Dt(n,e.length);for(let o=0;o<e.length;++o)r[o]=t(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tt(t,e,n){const s=ro(e);return Di(t,s,n)}function Di(t,e,n){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;fe(i,t);const a=o,l=a.data.get(i.dataId).values;let u;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Eo(l)}else u=l;const c=n||i.dtype,d=e(u,c,r);return a.makeTensorInfo(i.shape,c,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EO=ro(t=>Math.ceil(t)),a9=Di(Vd,EO),l9={kernelName:Vd,backendName:"cpu",kernelFunc:a9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NO(t,e,n,s){const r=Dt(n,Q(e));if(s&&n!=="string"){let o=0;t.forEach(i=>{const a=Q(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;t.forEach(i=>{const a=n==="string"?Eo(i.vals):i.vals;let l=0;for(let u=0;u<i.shape[0];++u){const c=u*e[1]+o;for(let d=0;d<i.shape[1];++d)r[c+d]=a[l++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RO=Lt((t,e)=>t===e?1:0),AO=en(bg,RO,null,"bool"),u9={kernelName:bg,backendName:"cpu",kernelFunc:AO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DO=ro(t=>Math.exp(t)),FO=Di(Xd,DO,"float32"),c9={kernelName:Xd,backendName:"cpu",kernelFunc:FO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OO=ro(t=>Math.expm1(t)),d9=Di(qd,OO),h9={kernelName:qd,backendName:"cpu",kernelFunc:d9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PO=ro(t=>Math.floor(t)),f9=Di(Yd,PO),p9={kernelName:Yd,backendName:"cpu",kernelFunc:f9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _O=Lt((t,e)=>Math.floor(t/e)),m9=en(Qd,_O,null,"int32"),g9={kernelName:Qd,backendName:"cpu",kernelFunc:m9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LO(t,e,n,s,r,o,i,a,l){const u=Ae([s,o],n);for(let c=0;c<s;c++){const d=[];let h=0;for(let f=0;f<r;f++){const p=t[c*r+f];h+=p*i[f],d.push(p)}if(h<0||h>=l/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let f=0;f<o;f++)u.values[c*o+f]=e.get(...e.indexToLoc(h*o+f))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MO(t,e,n){const s=Ae(n,t.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],l=i[2],u=e.locToIndex([a,l]);i[2]=e.values[u];const c=t.locToIndex(i);0<=c&&c<t.values.length&&(s.values[r]=t.values[c])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zO=Lt((t,e)=>t>e?1:0),x9=en(kg,zO,null,"bool"),y9={kernelName:kg,backendName:"cpu",kernelFunc:x9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BO=Lt((t,e)=>t>=e?1:0),v9=en(Zd,BO,null,"bool"),b9={kernelName:Zd,backendName:"cpu",kernelFunc:v9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VO=Lt((t,e)=>t<e?1:0),w9=en(Ig,VO,null,"bool"),C9={kernelName:Ig,backendName:"cpu",kernelFunc:w9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WO=Lt((t,e)=>t<=e?1:0),$9=en(Tg,WO,null,"bool"),k9={kernelName:Tg,backendName:"cpu",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UO(t,e,n){const s=(e-t)/(n-1),r=$n(n,"float32");r[0]=t;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GO=ro(t=>Math.log(t)),S9=Di(sh,GO),I9={kernelName:sh,backendName:"cpu",kernelFunc:S9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HO(t,e,n,s){const r=Cn(s,Q(n));for(let o=0;o<r.length;++o){const i=o*e;let a=t[i];for(let l=0;l<e;++l){const u=t[i+l];(Number.isNaN(u)||u>a)&&(a=u)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jO=Lt((t,e)=>Math.max(t,e)),T9=en(oh,jO),E9={kernelName:oh,backendName:"cpu",kernelFunc:T9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KO=Lt((t,e)=>Math.min(t,e)),N9=en(ih,KO),R9={kernelName:ih,backendName:"cpu",kernelFunc:N9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YC=Lt((t,e)=>t*e),A9=XC((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),N0=en(lh,YC,A9),D9={kernelName:lh,backendName:"cpu",kernelFunc:N0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XO(t,e,n){const s=Ii(-1,n);return YC([],e,s,t,n)}function F9(t){const{inputs:e,backend:n}=t,{x:s}=e;fe(s,"neg");const r=n.data.get(s.dataId).values,[o,i]=XO(r,s.shape,s.dtype);return n.makeTensorInfo(i,s.dtype,o)}const O9={kernelName:Mg,backendName:"cpu",kernelFunc:F9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qO=Lt((t,e)=>t!==e?1:0),P9=en(zg,qO,null,"bool"),_9={kernelName:zg,backendName:"cpu",kernelFunc:P9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QC(t,e,n,s,r){const o=e.length,i=Q(e),a=ge(e),l=ge(r),u=Cn(n,Q(r));for(let c=0;c<i;++c){const d=bu(c,o,a),h=new Array(d.length);for(let p=0;p<h.length;p++)h[p]=d[s[p]];const f=jr(h,o,l);u[f]=t[c]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yn(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:o}=n;fe(r,"transpose");const i=r.shape.length,a=new Array(i);for(let d=0;d<a.length;d++)a[d]=r.shape[o[d]];const l=s.data.get(r.dataId).values,u=QC(l,r.shape,r.dtype,o,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const L9={kernelName:zl,backendName:"cpu",kernelFunc:Yn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YO(t,e,n,s){const[r,o]=ln(t,s),i=us(e,"int32"),a=$n(Q(r),i),l=Q(o);for(let u=0;u<a.length;++u){const c=u*l;let d=1;for(let h=0;h<l;++h)d*=n[c+h];a[u]=d}return{outVals:a,outShape:r,outDtype:i}}function M9(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;fe(r,"prod");const a=r.shape.length,l=De(o,r.shape),u=Tt(l,a);let c=l,d=r;const h=[];u!=null&&(d=Yn({inputs:{x:r},backend:n,attrs:{perm:u}}),h.push(d),c=Pt(c.length,a));const f=n.data.get(d.dataId).values,{outVals:p,outShape:m,outDtype:x}=YO(d.shape,d.dtype,f,c);let g=m;return i&&(g=Vt(m,l)),h.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.makeTensorInfo(g,x,p)}const z9={kernelName:Hg,backendName:"cpu",kernelFunc:M9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B9(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const o=bu(r,e.length,ge(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${n})`)}})}function V9(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function W9(t,e,n,s){const r=[];let o=0;const i=e.length-1+n.length,a=new Array(i).fill(null).map(()=>[0]);V9(n,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const c=e[u+1];for(let d=1;d<l+1;++d)a[u].push(d*c)}for(let u=0;u<t.length;++u){let c=t[u],d=t[u]+1;for(let h=0;h<n.length;++h){const f=n[h],p=h+e.length-1;if(p>=0){const m=a[p],x=m[m.length-1]-f[c];for(let g=c;g<d;++g)a[p].push(f[g+1]+x)}c=f[c],d=f[d]}d!==c&&(r.push([c,d]),o+=d-c)}return{outSplits:a,valueSlices:r,numValues:o}}function U9(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=Dt("int32",s);e.push(r),t[n].forEach((o,i)=>r[i]=o)}return e}function pI(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function G9(t,e,n,s,r,o){const i=pI(e,2)[1],a=pI(o,2)[1];let l=0;for(const u of n)for(let c=u[0];c<u[1];++c){for(let d=0;d<s;++d)r[l*a+d]=t[c*i+d];++l}}function H9(t,e,n,s,r){const o=e.slice();o[0]=r;const i=Dt(n,Q(o)),a=t.length,l=a===0?0:a/e[0];return G9(t,e,s,l,i,o),[i,o]}function QO(t,e,n,s,r,o,i,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(B9(o,i,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:c,valueSlices:d,numValues:h}=W9(o,i,t,u),f=U9(c),p=H9(n,s,r,d,h);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mI=2147483647;function ZO(t,e,n,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=i.length===0,c=[];a||c.push(e[0]),l||c.push(r[0]),u||c.push(i[0]);for(let x=1;x<c.length;++x)if(c[x]!==c[x-1])throw new Error("starts, limits, and deltas must have the same shape");const d=c.length===0?1:c[0],h=Dt("int32",d+1);h[0]=0;for(let x=0;x<d;++x){const g=a?t[0]:t[x],y=l?s[0]:s[x],v=u?o[0]:o[x];if(v===0)throw new Error("Requires delta != 0");let b;if(v>0&&y<g||v<0&&y>g)b=0;else if(b=Math.ceil(Math.abs((y-g)/v)),b>mI)throw new Error(`Requires ((limit - start) / delta) <= ${mI}`);h[x+1]=h[x]+b}const f=h[d],p=Dt(n,f);let m=0;for(let x=0;x<d;++x){const g=h[x+1]-h[x];let y=a?t[0]:t[x];const v=u?o[0]:o[x];for(let b=0;b<g;++b)p[m++]=y,y+=v}return[h,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ns=fr;class pm{constructor(e,n,s,r,o,i,a,l,u,c){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=LA(c),this.raggedRank=MA(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Ns.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Ns.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ns.VALUE_ROWIDS:return pm.getMaxWidthValueRowID(n);case Ns.ROW_SPLITS:return pm.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Ns[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<n;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(n-s,o)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return xI(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;zA(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=_A(this.raggedRank,r,n);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=n)o.push(i);for(let a=r;a<e;++a)o.push(-1);return I(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,n,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),c=n[a];c===-1&&(u=0);for(let d=0;d<u;++d)i.push(c),c+=s;for(let d=0;d<l-u;++d)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,n,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let u=n[l];i.push(u);for(let c=1;c<o;++c){const d=e[c];if(d===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);u=n[d]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,n,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Ns.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,n,s,r);case Ns.ROW_SPLITS:if(o.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(o,n,s,r);default:throw new Error(`Unsupported partition type: ${Ns[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Ns.FIRST_DIM_SIZE:return e[0];case Ns.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ns.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Ns[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const o=xI(s,!1),i=Dt(this.valuesDType,Q(o));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,i,o)}return[o,i]}setOutput(e,n,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const l=Q(a),u=n.length;let c=this.defaultValue;if(c.length!==l&&c.length!==1){const p=this.defaultValueShape;j(()=>{const m=U(c,p);c=Oc(m,a).dataSync()})}let d=0,h=0,f=0;for(let p=0;p<=u;++p){let m=p<u?n[p]:-1;if(m===f){++f;continue}if(h<f){const x=o.subarray(d*l),g=i.subarray(h*l),y=(f-h)*l;gI(g,x,y)}if(p>=u){const x=s.length;m=Math.floor(x/l)}if(m>f)if(this.defaultValue.length===1)i.subarray(f*l,m*l).fill(this.defaultValue[0]),f=m;else for(;m>f;){const x=i.slice(f*l);gI(x,c,l),++f}m<0?(d=p+1,h=f):(d=p,h=f,f=h+1)}}}function gI(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function xI(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function JO(t,e,n,s,r,o,i,a,l,u){return new pm(t,e,n,s,r,o,i,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eP(t,e,n,s){const r=t===e,o=t<e&&n<0,i=e<t&&n>1;if(r||o||i)return $n(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=$n(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP=ro(t=>1/Math.sqrt(t)),j9=Di(ph,tP),K9={kernelName:ph,backendName:"cpu",kernelFunc:j9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ta(t,e,n,s,r,o,i,a,l,u){const c=[s/r,r],d=t.values,h=e.values;if(s===0)return Ae(n,e.dtype);const f=l instanceof fn?l:Ae(c,e.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let p=0;p<o;p++){const m=[];let x=0;for(let g=0;g<i;g++){const y=d[p*i+g];m.push(y),x+=y*a[g]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let g=0;g<r;g++)u?f.values[x*r+g]+=h[p*r+g]:f.values[x*r+g]=e.rank===0?h[0]:h[p*r+g]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X9=ro(t=>1/(1+Math.exp(-t))),nP=tt(vh,t=>1/(1+Math.exp(-t))),q9={kernelName:vh,backendName:"cpu",kernelFunc:nP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sP(t,e,n,s,r){const o=rC(s,e,n),i=Q(n),a=ge(s);if(o){const d=oC(e,a);return r==="string"?t.slice(d,d+i):t.subarray(d,d+i)}const l=r==="string"?Eo(t):t,u=Ae(s,r,l),c=Ae(n,r);for(let d=0;d<c.size;++d){const h=c.indexToLoc(d),f=h.map((p,m)=>p+e[m]);c.set(u.get(...f),...h)}return r==="string"?oD(c.values):c.values}function Fa(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,size:i}=s;fe(r,"slice");const[a,l]=p0(r,o,i);nC(r,a,l);const u=n.data.get(r.dataId).values,c=sP(u,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,c)}const Y9={kernelName:Qg,backendName:"cpu",kernelFunc:Fa};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rP(t,e,n,s,r,o,i){const a=e[0],l=o[0],u=new Array(l),c=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(jA(a));const x=Dt(n,0),g=Dt(r,0);return[x,[0,d],g,u,c]}let h=!0,f=0;const p=new Array(l).fill(0);for(let x=0;x<a;++x){const g=t[x*d];if(g<0)throw new Error(KA(x,g));if(g>=l)throw new Error(XA(x,g,l));++p[g],h=h&&g>=f,f=g}let m=!0;for(let x=0;x<l;++x){const g=p[x]===0;u[x]=g,m=m&&!g,p[x]=Math.max(p[x],1),x>0&&(p[x]+=p[x-1])}if(m&&h){const x=t,g=s;for(let y=0;y<a;++y)c[y]=y;return[x,[a,d],g,u,c]}else{const x=p[l-1],g=Dt(n,x*d),y=Dt(r,x),v=new Array(l).fill(0);for(let b=0;b<a;++b){const w=t[b*d],$=v[w],k=(w===0?0:p[w-1])+$;v[w]++;for(let C=0;C<d;++C)g[k*d+C]=t[b*d+C];y[k]=s[b],c[b]=k}for(let b=0;b<l;++b)if(v[b]===0){const $=b===0?0:p[b-1];g[$*d+0]=b;for(let k=1;k<d;++k)g[$*d+k]=0;y[$]=i}return[g,[x,d],y,u,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oP(t,e,n,s,r){const o=Q(s),i=e[0],a=r.length,l=[];let u=1,c=-1;for(let x=0;x<a;++x){const g=r[x];if(g===-1){if(c!==-1)throw new Error(qA(c,x));c=x,l.push(1)}else{if(g<0)throw new Error(YA(x,g));u*=g,l.push(g)}}if(c!==-1){if(u<=0)throw new Error(QA());const x=Math.trunc(o/u);if(u*x!==o)throw new Error(ZA(s,l));l[c]=x}if(Q(l)!==o)throw new Error(JA(s,l));const h=s.length,f=[];if(h>0){f[h-1]=1;for(let x=h-2;x>=0;--x)f[x]=f[x+1]*s[x+1]}const p=[];if(a>0){p[a-1]=1;for(let x=a-2;x>=0;--x)p[x]=p[x+1]*l[x+1]}const m=Dt(n,i*a);for(let x=0;x<i;++x){let g=0;for(let y=0;y<h;++y)g+=t[x*h+y]*f[y];for(let y=0;y<a;++y)m[x*a+y]=Math.trunc(g/p[y]),g%=p[y]}return[m,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZC(t,e,n,s,r,o=!1,i=0){const a=s.length,l=[e[0],t.length/e[0]],u=l[1],d=a>0?r[a-1]+1:0;if(d<0)throw new Error(kv());const h=e.slice();h[0]=d;const f=h.reduce((v,b)=>v*b,1),p=Dt(n,f);if(a===0)return d>0&&p.fill(i),[p,h];if(d<=0)throw new Error(kv());let m=0,x=1,g=0,y=r[m];for(;;){let v=0;if(x<a){if(v=r[x],y===v){++x;continue}if(y>=v)throw new Error(eD())}if(y<0||y>=d)throw new Error(tD(y,d));y>g&&p.fill(i,g*u,y*u);for(let b=m;b<x;++b){const w=s[b];if(w<0||w>=l[0])throw new Error(nD(b,s[b],l[0]));for(let $=0;$<u;$++)p[y*u+$]+=t[w*u+$]}if(o)for(let b=0;b<u;b++)p[y*u+b]/=x-m;if(m=x,++x,g=y+1,y=v,x>a)break}return g<d&&p.fill(i,g*u,d*u),[p,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q9=ro(t=>Math.sqrt(t)),Z9=tt(wh,t=>Math.sqrt(t)),J9={kernelName:wh,backendName:"cpu",kernelFunc:Z9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iP=Lt((t,e)=>{const n=t-e;return n*n}),eX=en(Ch,iP),tX={kernelName:Ch,backendName:"cpu",kernelFunc:eX};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP=ro((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),nX=Di(cw,aP),sX={kernelName:cw,backendName:"cpu",kernelFunc:nX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lP(t,e,n,s){const r=Ae(t,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*n[l]+s[l];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rX{constructor(e,n,s,r,o,i){this.separator=ai(e),this.nGramWidths=n,this.leftPad=ai(s),this.rightPad=ai(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,o,i){for(let a=0;a<o;++a){const l=this.getPadWidth(i),u=Math.max(0,l-a),c=Math.max(0,l-(o-(a+1))),d=i-(u+c),h=n+(u>0?0:a-l);let f=0;f+=u*this.leftPad.length;for(let y=0;y<d;++y)f+=e[h+y].length;f+=c*this.rightPad.length;const p=u+c+d-1;f+=p*this.separator.length,s[r+a]=new Uint8Array(f);const m=s[r+a];let x=0;const g=y=>y.forEach(v=>m[x++]=v);for(let y=0;y<u;++y)g(this.leftPad),g(this.separator);for(let y=0;y<d-1;++y)g(e[h+y]),g(this.separator);if(d>0){g(e[h+d-1]);for(let y=0;y<c;++y)g(this.separator),g(this.rightPad)}else{for(let y=0;y<c-1;++y)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let c=n[u]>=l;if(c=c&&n[u]<=s,!c)throw new Error(`Invalid split value ${n[u]}, must be in [${l}, ${s}]`);l=n[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const o=r-1,i=Dt("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=o;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=o;++l){const u=n[l]-n[l-1];let c=0;this.nGramWidths.forEach(d=>{c+=this.getNumNGrams(u,d)}),this.preserveShort&&u>0&&c===0&&(c=1),i[l]=i[l-1]+c}const a=new Array(i[o]);for(let l=0;l<o;++l){const u=n[l];let c=i[l];if(this.nGramWidths.forEach(d=>{const h=n[l+1]-n[l],f=this.getNumNGrams(h,d);this.createNGrams(e,u,a,c,f,d),c+=f}),this.preserveShort&&c===i[l]){const d=n[l+1]-n[l];if(d===0)continue;const h=d+2*this.padWidth;this.createNGrams(e,u,a,c,1,h)}}return[a,i]}}function uP(t,e,n,s,r,o,i,a){return new rX(n,s,r,o,i,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oX(t,e,n,s){if(!t.length)return;if(e.length===0){for(let o=0;o<t.length;++o)s.push(t.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=t.indexOf(o);for(;i!==-1;){const a=t.subarray(0,i);(!n||a.length!==0)&&s.push(a),t=t.subarray(i+1),i=t.indexOf(o)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let o=0;o<t.length+1;o++)if(o===t.length||e.indexOf(t[o])!==-1){const i=t.subarray(r,o);(!n||i.length!==0)&&s.push(i),r=o+1}}function cP(t,e,n){const s=t.length,r=[];let o=0,i=0;const a=new Array(s);for(let h=0;h<s;++h){const f=r.length;oX(t[h],e,n,r);const p=r.length-f;a[h]=p,o+=p,i=Math.max(i,p)}const l=Dt("int32",o*2),u=new Array(o),c=[s,i];let d=0;for(let h=0;h<s;++h)for(let f=0;f<a[h];++f)l[d*2]=h,l[d*2+1]=f,u[d]=r[d],++d;return[l,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dP(t,e){const n=Dt("int32",t.length);for(let s=0;s<t.length;++s)n[s]=BV(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP=Lt((t,e)=>t-e),iX=XC((t,e,n,s)=>({real:t-n,imag:e-s})),JC=en($h,hP,iX),aX={kernelName:$h,backendName:"cpu",kernelFunc:JC};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fP(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=Ae(n,t.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(t.rank);for(let l=0;l<i.length;l++)i[l]=o[l]%t.shape[l];const a=t.locToIndex(i);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pc=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function pP(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),h=Math.max(n,Math.floor(e-l*c/a+d)),f=Math.min(s,Math.floor(e+(a-l)*c/a+d));pP(t,e,h,f)}const r=t[e];let o=n,i=s;for(cl(t,n,e),pc(t[s],r)>0&&cl(t,n,s);o<i;){for(cl(t,o,i),o++,i--;pc(t[o],r)<0;)o=o+1;for(;pc(t[i],r)>0;)i=i-1}pc(t[n],r)===0?cl(t,n,i):(i=i+1,cl(t,i,s)),i<=e&&(n=i+1),e<=i&&(s=i-1)}}function mP(t,e,n,s,r){const o=e[e.length-1],[i,a]=[t.length/o,o],l=Cn(n,i*s),u=Cn("int32",i*s);for(let d=0;d<i;d++){const h=d*a,f=t.subarray(h,h+a);let p=new Array(f.length);f.forEach((y,v)=>p[v]={value:y,index:v}),s<p.length&&(pP(p,s),p=p.slice(0,s)),r&&p.sort(pc);const m=d*s,x=l.subarray(m,m+s),g=u.subarray(m,m+s);for(let y=0;y<s;y++)x[y]=p[y].value,g[y]=p[y].index}const c=e.slice();return c[c.length-1]=s,[Ae(c,n,l),Ae(c,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gP(t,e,n,s){const r=De(e,n)[0],o=[1,n[0],1];for(let p=0;p<r;p++)o[0]*=n[p];o[1]=n[r];for(let p=r+1;p<n.length;p++)o[2]*=n[p];const i=new Map,a=new Int32Array(n[r]),l=new fn(o,s,t),u=[],c=o[0]===1&&o[2]===1;for(let p=0;p<n[r];p++){let m;if(c)m=t[p].toString();else{const g=[];for(let y=0;y<o[0];y++)for(let v=0;v<o[2];v++)g.push(l.get(y,p,v));m=g.join(",")}const x=i.get(m);if(x!=null)a[p]=x;else{const g=i.size;i.set(m,g),a[p]=g,u.push(p)}}const d=o.slice();d[1]=i.size;const h=new fn(d,s);u.forEach((p,m)=>{for(let x=0;x<o[0];x++)for(let g=0;g<o[2];g++)h.set(l.get(x,p,g),x,m,g)});const f=n.slice();return f[r]=d[1],{outputValues:h.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=Object.freeze(Object.defineProperty({__proto__:null,addImpl:SO,bincountImpl:qC,bincountReduceImpl:IO,bitwiseAndImpl:TO,castImpl:kO,ceilImpl:EO,concatImpl:NO,equalImpl:RO,expImpl:DO,expm1Impl:OO,floorDivImpl:_O,floorImpl:PO,gatherNdImpl:LO,gatherV2Impl:MO,greaterEqualImpl:BO,greaterImpl:zO,lessEqualImpl:WO,lessImpl:VO,linSpaceImpl:UO,logImpl:GO,maxImpl:HO,maximumImpl:jO,minimumImpl:KO,multiplyImpl:YC,negImpl:XO,notEqualImpl:qO,prodImpl:YO,raggedGatherImpl:QO,raggedRangeImpl:ZO,raggedTensorToTensorImpl:JO,rangeImpl:eP,rsqrtImpl:tP,scatterImpl:ta,sigmoidImpl:X9,simpleAbsImpl:$O,sliceImpl:sP,sparseFillEmptyRowsImpl:rP,sparseReshapeImpl:oP,sparseSegmentReductionImpl:ZC,sqrtImpl:Q9,squaredDifferenceImpl:iP,staticRegexReplaceImpl:aP,stridedSliceImpl:lP,stringNGramsImpl:uP,stringSplitImpl:cP,stringToHashBucketFastImpl:dP,subImpl:hP,tileImpl:fP,topKImpl:mP,transposeImpl:QC,uniqueImpl:gP},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */OR("cpu",()=>new E0,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP=tt(jd,t=>t>=0?t:Math.exp(t)-1),uX={kernelName:jd,backendName:"cpu",kernelFunc:xP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yP(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:o}=s;fe([r],"leakyRelu");const i=Q(r.shape),a=n.data.get(r.dataId).values,l=Cn("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?o*a[u]:a[u];return n.makeTensorInfo(r.shape,"float32",l)}const cX={kernelName:Sg,backendName:"cpu",kernelFunc:yP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dX=Lt((t,e)=>t<0?e*t:t);function vP(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;fe([s,r],"prelu");const o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,[a,l]=dX(s.shape,r.shape,o,i,"float32");return n.makeTensorInfo(l,"float32",a)}const hX={kernelName:Gg,backendName:"cpu",kernelFunc:vP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP=tt(dh,t=>Math.max(0,t)),fX={kernelName:dh,backendName:"cpu",kernelFunc:bP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP=tt(hh,t=>Math.min(Math.max(0,t),6)),pX={kernelName:hh,backendName:"cpu",kernelFunc:wP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mm(t,e,n,s,r){if(n==="linear")return so({inputs:{x:e},backend:t});if(n==="relu")return bP({inputs:{x:e},backend:t});if(n==="elu")return xP({inputs:{x:e},backend:t});if(n==="relu6")return wP({inputs:{x:e},backend:t});if(n==="prelu")return vP({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return yP({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return nP({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dt(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:o}=s,i=Q(r.shape),a=BN(o,i),l=Q(a);I(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const u=n.data.get(r.dataId);if(u.complexTensorInfos!=null){const c=u.complexTensorInfos.real,d=u.complexTensorInfos.imag;c.shape=a,d.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const mX={kernelName:jg,backendName:"cpu",kernelFunc:dt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CP(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;fe([r,o],"matMul");const l=r.shape.length,u=o.shape.length,c=i?r.shape[l-2]:r.shape[l-1],d=a?o.shape[u-1]:o.shape[u-2],h=i?r.shape[l-1]:r.shape[l-2],f=a?o.shape[u-2]:o.shape[u-1],p=r.shape.slice(0,-2),m=o.shape.slice(0,-2),x=Q(p),g=Q(m),v=Ie(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([h,f]);I(c===d,()=>`Error in matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const b=i?[x,c,h]:[x,h,c],w=a?[g,f,d]:[g,d,f],$=dt({inputs:{x:r},backend:n,attrs:{shape:b}}),k=dt({inputs:{x:o},backend:n,attrs:{shape:w}}),C=i?$.shape[1]:$.shape[2],S=i?$.shape[2]:$.shape[1],T=a?k.shape[1]:k.shape[2],R=Math.max(x,g),A=n.data.get($.dataId).values,E=n.data.get(k.dataId).values,N=ge($.shape),P=ge(k.shape),[_,M,D]=i?[N[0],1,N[1]]:[N[0],N[1],1],[W,H,X]=a?[1,P[1],P[0]]:[P[1],1,P[0]],Z=S*T,J=Ae([R,S,T],$.dtype),se=J.values,te=n.blockSize;for(let oe=0;oe<R;oe++){const ce=oe%x,xe=oe%g;for(let pe=0;pe<S;pe+=te){const Se=Math.min(pe+te,S);for(let Te=0;Te<T;Te+=te){const Ge=Math.min(Te+te,T);for(let Qe=0;Qe<C;Qe+=te){const ht=Math.min(Qe+te,C);for(let Ze=pe;Ze<Se;Ze++)for(let Ye=Te;Ye<Ge;Ye++){let ot=0;for(let it=Qe;it<ht;it++){const nr=A[ce*_+Ze*M+it*D],Wt=E[it*W+Ye*H+xe*X];ot+=nr*Wt}se[oe*Z+(Ze*T+Ye)]+=ot}}}}}return n.disposeIntermediateTensorInfo($),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(v,J.dtype,J.values)}const gX={kernelName:cg,backendName:"cpu",kernelFunc:CP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=s;let h,f,p;const m=[];h=CP({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:u},backend:n}),i&&(f=au({inputs:{a:h,b:i},backend:n}),m.push(h),h=f),c&&(p=mm(n,h,c,a,d),m.push(h),h=p);for(const g of m)n.disposeIntermediateTensorInfo(g);return h}const yX={kernelName:Xp,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX=tt(Fd,t=>Math.acos(t)),bX={kernelName:Fd,backendName:"cpu",kernelFunc:vX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX=tt(Od,t=>Math.acosh(t)),CX={kernelName:Od,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $X(t){const{inputs:e,backend:n}=t,s=e;fe(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),o=Ae(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return n.makeTensorInfo(o.shape,o.dtype,o.values)}const kX={kernelName:Nb,backendName:"cpu",kernelFunc:$X};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;fe(r,"all");const a=De(o,r.shape);let l=a;const u=Tt(l,r.shape.length);let c=r;u!=null&&(c=Yn({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Pt(l.length,r.shape.length)),mn("all",l,c.shape.length);const[d,h]=ln(c.shape,l),f=Q(h),p=$n(Q(d),c.dtype),m=n.data.get(c.dataId).values;for(let g=0;g<p.length;++g){const y=g*f;let v=m[y];for(let b=0;b<f;++b){const w=m[y+b];v=v&&w}p[g]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const x=n.makeTensorInfo(d,c.dtype,p);if(i){const g=Vt(d,a),y=dt({inputs:{x},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(x),y}return x}const IX={kernelName:Rb,backendName:"cpu",kernelFunc:SX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;fe(r,"any");const a=De(o,r.shape);let l=a;const u=Tt(l,r.shape.length);let c=r;u!=null&&(c=Yn({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Pt(l.length,r.shape.length)),mn("any",l,c.shape.length);const[d,h]=ln(c.shape,l),f=Q(h),p=$n(Q(d),c.dtype),m=n.data.get(c.dataId).values;for(let g=0;g<p.length;++g){const y=g*f;let v=m[y];for(let b=0;b<f;++b){const w=m[y+b];v=v||w}p[g]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const x=n.makeTensorInfo(d,c.dtype,p);if(i){const g=Vt(d,a),y=dt({inputs:{x},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(x),y}return x}const EX={kernelName:Ab,backendName:"cpu",kernelFunc:TX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;fe(r,"argMax");let i=De(o,r.shape);const a=Tt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=Yn({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=Pt(i.length,l.shape.length)),i=[i[0]],mn("argMax",i,l.shape.length);const[c,d]=ln(l.shape,i),h=Q(c),f=$n(h,"int32"),p=Q(d),m=n.data.get(l.dataId).values;for(let x=0;x<f.length;++x){const g=x*p;let y=m[g],v=0;for(let b=0;b<p;++b){const w=m[g+b];w>y&&(y=w,v=b)}f[x]=v}return u.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(c,"int32",f)}const RX={kernelName:ig,backendName:"cpu",kernelFunc:NX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;fe(r,"argMin");let i=De(o,r.shape);const a=Tt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=Yn({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=Pt(i.length,l.shape.length)),i=[i[0]],mn("argMin",i,l.shape.length);const[c,d]=ln(l.shape,i),h=Q(c),f=$n(h,"int32"),p=Q(d),m=n.data.get(l.dataId).values;for(let x=0;x<f.length;++x){const g=x*p;let y=m[g],v=0;for(let b=0;b<p;++b){const w=m[g+b];w<y&&(y=w,v=b)}f[x]=v}return u.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(c,"int32",f)}const DX={kernelName:ag,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX=tt(Pd,t=>Math.asin(t)),OX={kernelName:Pd,backendName:"cpu",kernelFunc:FX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX=tt(_d,t=>Math.asinh(t)),_X={kernelName:_d,backendName:"cpu",kernelFunc:PX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LX=tt(Ld,t=>Math.atan(t)),MX={kernelName:Ld,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX=Lt((t,e)=>Math.atan2(t,e)),BX=en(zd,zX),VX={kernelName:zd,backendName:"cpu",kernelFunc:BX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WX=tt(Md,t=>Math.atanh(t)),UX={kernelName:Md,backendName:"cpu",kernelFunc:WX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e$(t,e,n,s,r,o){const i=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Ae(r.outShape,n),x=m.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let b=0;b<r.batchSize;++b){const w=b*g,$=b*s[0];for(let k=0;k<r.inChannels;++k)for(let C=0;C<r.outHeight;++C){const S=C*i-h,T=Math.max(0,S),R=Math.min(r.inHeight,c+S),A=w+C*y;for(let E=0;E<r.outWidth;++E){const N=E*a-f,P=Math.max(0,N),_=Math.min(r.inWidth,d+N);let M=p,D=0,W=0;for(let X=T;X<R;X+=l){const Z=$+X*s[1];for(let J=P;J<_;J+=u){const se=Z+J*s[2],te=t[se+k];o==="max"&&te>M?M=te:o==="avg"&&(D+=te,W++)}if(isNaN(M))break}const H=A+E*v+k;x[H]=o==="avg"?D/W:M}}}return m}function $P(t,e,n,s,r=!1,o=!1){const i=Ae(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,c=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,m=Ae(e,n,t);for(let x=0;x<s.batchSize;++x)for(let g=0;g<s.inChannels;++g)for(let y=0;y<s.outHeight;++y){const v=y*a-f;let b=v;for(;b<0;)b+=u;const w=Math.min(s.inHeight,d+v);for(let $=0;$<s.outWidth;++$){const k=$*l-p;let C=k;for(;C<0;)C+=c;const S=Math.min(s.inWidth,h+k);let T=Number.NEGATIVE_INFINITY,R=-1;for(let A=b;A<w;A+=u){const E=A-v;for(let N=C;N<S;N+=c){const P=N-k,_=m.get(x,A,N,g);_>T&&(T=_,r?R=o?((x*s.inHeight+A)*s.inWidth+N)*s.inChannels+g:(A*s.inWidth+N)*s.inChannels+g:R=E*h+P)}}i.set(R,x,y,$,g)}}return i}function kP(t,e,n,s,r,o){const i=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,x=r.padInfo.top,g=r.padInfo.left,y=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Ae(r.outShape,n),b=v.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],$=r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[3]*r.outShape[4],C=r.outShape[4];for(let S=0;S<r.batchSize;++S){const T=S*w,R=S*s[0];for(let A=0;A<r.inChannels;++A)for(let E=0;E<r.outDepth;++E){const N=E*i-m;let P=N;for(;P<0;)P+=u;const _=Math.min(r.inDepth,h+N),M=T+E*$;for(let D=0;D<r.outHeight;++D){const W=D*a-x;let H=W;for(;H<0;)H+=c;const X=Math.min(r.inHeight,f+W),Z=M+D*k;for(let J=0;J<r.outWidth;++J){const se=J*l-g;let te=se;for(;te<0;)te+=d;const oe=Math.min(r.inWidth,p+se),ce=Z+J*C;let xe=y,pe=0,Se=0;for(let Ge=P;Ge<_;Ge+=u){const Qe=R+Ge*s[1];for(let ht=H;ht<X;ht+=c){const Ze=Qe+ht*s[2];for(let Ye=te;Ye<oe;Ye+=d){const ot=Ze+Ye*s[3],it=t[ot+A];if(o==="max"&&it>xe?xe=it:o==="avg"&&(pe+=it,Se++),isNaN(xe))break}if(isNaN(xe))break}if(isNaN(xe))break}const Te=ce+A;b[Te]=o==="avg"?pe/Math.max(Se,1):xe}}}}return v}function GX(t,e){const n=Ae(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let x=0;x<e.inChannels;++x)for(let g=0;g<e.outDepth;++g){const y=g*s-h;let v=y;for(;v<0;)v+=i;const b=Math.min(e.inDepth,u+y);for(let w=0;w<e.outHeight;++w){const $=w*r-f;let k=$;for(;k<0;)k+=a;const C=Math.min(e.inHeight,c+$);for(let S=0;S<e.outWidth;++S){const T=S*o-p;let R=T;for(;R<0;)R+=l;const A=Math.min(e.inWidth,d+T);let E=Number.NEGATIVE_INFINITY,N=-1;for(let P=v;P<b;P+=i){const _=P-y;for(let M=k;M<C;M+=a){const D=M-$;for(let W=R;W<A;W+=l){const H=W-T,X=t.get(m,P,M,W,x);X>=E&&(E=X,N=_*c*d+D*c+H)}}}n.set(N,m,g,w,S,x)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;fe(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;I(Sn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=Js(r.shape,o,i,u,a,l);let d;if(c.filterWidth===1&&c.filterHeight===1&&qe(c.inShape,c.outShape))d=so({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,f=ge(r.shape),p=e$(h,r.shape,r.dtype,f,c,"avg");d=n.makeTensorInfo(c.outShape,r.dtype,p.values)}return d}const jX={kernelName:lg,backendName:"cpu",kernelFunc:HX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;fe(r,"avgPool3d");const c=Ao(r.shape,o,i,1,a,l,u),d=n.data.get(r.dataId).values,h=kP(d,r.shape,r.dtype,ge(r.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const XX={kernelName:ug,backendName:"cpu",kernelFunc:KX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;fe([r,o],"avgPool3DGrad");const c=Ao(o.shape,i,a,1,l,u),d=c.strideDepth,h=c.strideHeight,f=c.strideWidth,p=c.filterDepth,m=c.filterHeight,x=c.filterWidth,g=c.dilationDepth,y=c.dilationHeight,v=c.dilationWidth,b=c.effectiveFilterDepth,w=c.effectiveFilterHeight,$=c.effectiveFilterWidth,k=b-1-c.padInfo.front,C=$-1-c.padInfo.left,S=w-1-c.padInfo.top,T=Ae(o.shape,"float32"),R=1/(p*m*x),A=n.bufferSync(r);for(let E=0;E<c.batchSize;++E)for(let N=0;N<c.inChannels;++N)for(let P=0;P<c.inDepth;++P)for(let _=0;_<c.inHeight;++_)for(let M=0;M<c.inWidth;++M){const D=P-k,W=_-S,H=M-C;let X=0;for(let Z=0;Z<b;Z+=g){const J=(D+Z)/d;if(!(J<0||J>=c.outDepth||Math.floor(J)!==J))for(let se=0;se<w;se+=y){const te=(W+se)/h;if(!(te<0||te>=c.outHeight||Math.floor(te)!==te))for(let oe=0;oe<$;oe+=v){const ce=(H+oe)/f;if(ce<0||ce>=c.outWidth||Math.floor(ce)!==ce)continue;const xe=A.get(E,J,te,ce,N);X+=xe}}}T.set(X*R,E,P,_,M,N)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const YX={kernelName:Fb,backendName:"cpu",kernelFunc:qX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o;fe([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=Js(i.shape,a,l,1,u),d=c.strideHeight,h=c.strideWidth,f=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,x=c.dilationWidth,g=c.effectiveFilterHeight,y=c.effectiveFilterWidth,v=y-1-c.padInfo.left,b=g-1-c.padInfo.top,w=Ae(i.shape,"float32"),$=1/(f*p),k=n.data.get(r.dataId).values,C=Ae(r.shape,"float32",k);for(let S=0;S<c.batchSize;++S)for(let T=0;T<c.inChannels;++T)for(let R=0;R<c.inHeight;++R)for(let A=0;A<c.inWidth;++A){const E=R-b,N=A-v;let P=0;for(let _=0;_<g;_+=m){const M=(E+_)/d;if(!(M<0||M>=c.outHeight||Math.floor(M)!==M))for(let D=0;D<y;D+=x){const W=(N+D)/h;if(W<0||W>=c.outWidth||Math.floor(W)!==W)continue;const H=C.get(S,M,W,T);P+=H}}w.set(P*$,S,R,A,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const ZX={kernelName:Db,backendName:"cpu",kernelFunc:QX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:o,offset:i,mean:a,variance:l}=e;I(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),I(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),I(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),fe([r,a,l,o,i],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const c=n.data.get(r.dataId).values,d=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,f=o?n.data.get(o.dataId).values:new Float32Array([1]),p=i?n.data.get(i.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),x=p.length,g=f.length,y=h.length,v=d.length;let b=0,w=0,$=0,k=0;for(let C=0;C<c.length;++C)m[C]=p[b++]+(c[C]-d[w++])*f[$++]/Math.sqrt(h[k++]+u),b>=x&&(b=0),w>=v&&(w=0),$>=g&&($=0),k>=y&&(k=0);return n.makeTensorInfo(r.shape,r.dtype,m)}const eq={kernelName:Cg,backendName:"cpu",kernelFunc:JX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,crops:i}=s;fe([r],"batchToSpaceND");const a=o.reduce((g,y)=>g*y),l=Fh(r.shape,o,a),u=Oh(l.length,o.length),c=Ph(r.shape,o,a),d=cC(i,o.length),h=dC(c,i,o.length),f=dt({inputs:{x:r},backend:n,attrs:{shape:l}}),p=Yn({inputs:{x:f},backend:n,attrs:{perm:u}}),m=dt({inputs:{x:p},backend:n,attrs:{shape:c}}),x=Fa({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),x}const nq={kernelName:dg,backendName:"cpu",kernelFunc:tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i}=s,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,u=qC(a,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}const rq={kernelName:Ob,backendName:"cpu",kernelFunc:sq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=Ie(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const iq={kernelName:jN,backendName:"cpu",kernelFunc:oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aq=tt(Wd,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),lq={kernelName:Wd,backendName:"cpu",kernelFunc:aq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uq=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(Q(e.shape)),r=n.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values;for(let u=0;u<a.length;u++){const c=a[u],d=l[u];s[u]=Math.hypot(c,d)}return n.makeOutput(s,e.shape,"float32")},cq={kernelName:hg,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lu(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const dq={kernelName:Zb,backendName:"cpu",kernelFunc:lu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uu(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,o=De(r,e[0].shape)[0],i=e.map(m=>m.shape);aC(i,o);let a=Xr(e.map(m=>m.shape),o);if(Q(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>Q(m.shape)>0);if(l.length===1)return so({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(b=>Da({inputs:{input:b},backend:n})),x=l.map(b=>lu({inputs:{input:b},backend:n})),g=uu({inputs:m,backend:n,attrs:{axis:o}}),y=uu({inputs:x,backend:n,attrs:{axis:o}}),v=ns({inputs:{real:g,imag:y},backend:n});return m.forEach(b=>n.disposeIntermediateTensorInfo(b)),x.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),v}const u=l.map(m=>{const g=[-1,Q(m.shape.slice(o))];return dt({inputs:{x:m},backend:n,attrs:{shape:g}})}),c=u.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=Xr(u.map(m=>m.shape),1);const d=u[0].shape[0]===1,h=NO(c,a,e[0].dtype,d),f=Xr(l.map(m=>m.shape),o),p=n.makeTensorInfo(f,e[0].dtype,h);return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const hq={kernelName:fg,backendName:"cpu",kernelFunc:uu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SP(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s;fe([r,o],"conv2d");const d=Do(l),h=pn(r.shape,o.shape,i,u,a,c,!1,d),f=h.filterHeight,p=h.filterWidth,m=h.dilationHeight,x=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,v=h.dataFormat==="channelsLast",b=new fn(h.outShape,r.dtype),w=ge(r.shape),$=ge(o.shape),k=w[0],C=v?w[1]:w[2],S=v?w[2]:1,T=v?1:w[1],R=b.strides[0],A=v?b.strides[1]:b.strides[2],E=v?b.strides[2]:1,N=v?1:b.strides[1],P=n.data.get(r.dataId).values,_=n.data.get(o.dataId).values,M=b.values;for(let D=0;D<h.batchSize;++D){const W=D*k,H=D*R;for(let X=0;X<h.outHeight;++X){const Z=H+X*A,J=X*h.strideHeight-y;for(let se=0;se<f;++se){const te=J+se*m;if(te<0||te>=h.inHeight)continue;const oe=se*$[0],ce=W+te*C;for(let xe=0;xe<h.outWidth;++xe){const pe=Z+xe*E,Se=xe*h.strideWidth-g;for(let Te=0;Te<p;++Te){const Ge=Se+Te*x;if(Ge<0||Ge>=h.inWidth)continue;const Qe=oe+Te*$[1],ht=ce+Ge*S;let Ze=Qe;for(let Ye=0;Ye<h.inChannels;++Ye){const ot=P[ht+Ye*T];for(let it=0;it<h.outChannels;++it)M[pe+it*N]+=ot*_[Ze+it];Ze+=h.outChannels}}}}}}return n.makeTensorInfo(b.shape,b.dtype,M)}const fq={kernelName:pg,backendName:"cpu",kernelFunc:SP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s;fe([r,o],"conv2dBackpropFilter");const d=Do(l),h=pn(r.shape,c,i,1,a,u,!1,d),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:x}=h,g=h.dataFormat==="channelsLast",y=new fn(h.filterShape,"float32"),v=h.padInfo.left,b=h.padInfo.top,w=n.data.get(r.dataId).values,$=n.data.get(o.dataId).values,k=new fn(r.shape,r.dtype,w),C=new fn(o.shape,o.dtype,$);for(let S=0;S<m;++S){const T=Math.max(0,Math.ceil((b-S)/f)),R=Math.min(h.outHeight,(h.inHeight+b-S)/f);for(let A=0;A<x;++A){const E=Math.max(0,Math.ceil((v-A)/p)),N=Math.min(h.outWidth,(h.inWidth+v-A)/p);for(let P=0;P<h.inChannels;++P)for(let _=0;_<h.outChannels;++_){let M=0;for(let D=0;D<h.batchSize;++D)for(let W=T;W<R;++W){const H=S+W*f-b;for(let X=E;X<N;++X){const Z=A+X*p-v;g?M+=k.get(D,H,Z,P)*C.get(D,W,X,_):M+=k.get(D,P,H,Z)*C.get(D,_,W,X)}}y.set(M,S,A,P,_)}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const mq={kernelName:Lb,backendName:"cpu",kernelFunc:pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s;fe([r,o],"conv2dBackpropInput");const d=ge(o.shape),h=ge(r.shape);let f=Do(u);const p=pn(i,o.shape,a,1,l,c,!1,f),m=new fn(p.inShape,"float32"),x=m.values,g=n.data.get(r.dataId).values,y=n.data.get(o.dataId).values,[v,b,w]=d,{batchSize:$,filterHeight:k,filterWidth:C,inChannels:S,inHeight:T,inWidth:R,outChannels:A,outHeight:E,outWidth:N,strideHeight:P,strideWidth:_}=p;f=p.dataFormat;const M=k-1-p.padInfo.top,D=C-1-p.padInfo.left,W=f==="channelsLast",H=m.strides[0],X=W?m.strides[1]:m.strides[2],Z=W?m.strides[2]:1,J=W?1:m.strides[1],se=h[0],te=W?h[1]:h[2],oe=W?h[2]:1,ce=W?1:h[1];for(let xe=0;xe<$;++xe)for(let pe=0;pe<S;++pe)for(let Se=0;Se<T;++Se){const Te=Se-M,Ge=Math.max(0,Math.ceil(Te/P)),Qe=Math.min(E,(k+Te)/P);for(let ht=0;ht<R;++ht){const Ze=ht-D,Ye=Math.max(0,Math.ceil(Ze/_)),ot=Math.min(N,(C+Ze)/_);let it=0;for(let Wt=Ge;Wt<Qe;++Wt){const Nr=Wt*P-Te;for(let Mt=Ye;Mt<ot;++Mt){const Pi=Mt*_-Ze,sr=se*xe+te*Wt+oe*Mt,oo=v*(k-1-Nr)+b*(C-1-Pi)+w*pe;for(let Po=0;Po<A;++Po){const _o=g[sr+ce*Po],Lo=y[oo+Po];it+=_o*Lo}}}const nr=H*xe+X*Se+Z*ht+J*pe;x[nr]=it}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const xq={kernelName:mg,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s;fe([r,o],"conv3d");const u=Ti(r.shape,o.shape,i,l,a),{filterDepth:c,filterHeight:d,filterWidth:h,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:x}=u,g=x.front,y=x.left,v=x.top,b=new fn(u.outShape,r.dtype),w=n.data.get(r.dataId).values,$=n.data.get(o.dataId).values,k=b.values,C=ge(r.shape),S=ge(o.shape);for(let T=0;T<u.batchSize;++T){const R=T*C[0],A=T*b.strides[0];for(let E=0;E<u.outDepth;++E){const N=A+E*b.strides[1],P=E*u.strideDepth-g;for(let _=0;_<c;++_){const M=P+_*f;if(M<0||M>=u.inDepth)continue;const D=_*S[0],W=R+M*C[1];for(let H=0;H<u.outHeight;++H){const X=N+H*b.strides[2],Z=H*u.strideHeight-v;for(let J=0;J<d;++J){const se=Z+J*p;if(se<0||se>=u.inHeight)continue;const te=D+J*S[1],oe=W+se*C[2];for(let ce=0;ce<u.outWidth;++ce){const xe=X+ce*u.outChannels,pe=ce*u.strideWidth-y;for(let Se=0;Se<h;++Se){const Te=pe+Se*m;if(Te<0||Te>=u.inWidth)continue;const Ge=te+Se*S[2],Qe=oe+Te*u.inChannels;let ht=Ge;for(let Ze=0;Ze<u.inChannels;++Ze){const Ye=w[Qe+Ze];for(let ot=0;ot<u.outChannels;++ot)k[xe+ot]+=Ye*$[ht+ot];ht+=u.outChannels}}}}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const vq={kernelName:gg,backendName:"cpu",kernelFunc:yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s;fe([r,o],"conv3dBackpropFilterV2");const u=ge(r.shape),c=ge(o.shape),d=Ti(r.shape,l,i,1,a),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,m=d.filterDepth,x=d.filterHeight,g=d.filterWidth,y=new fn(d.filterShape,"float32"),v=y.values,[b,w,$,k]=y.strides,C=n.data.get(o.dataId).values,[S,T,R,A]=c,E=n.data.get(r.dataId).values,[N,P,_,M]=u,D=d.padInfo.front,W=d.padInfo.left,H=d.padInfo.top;for(let X=0;X<m;++X){const Z=Math.max(0,Math.ceil((D-X)/h)),J=Math.min(d.outDepth,(d.inDepth+D-X)/h),se=X*b;for(let te=0;te<x;++te){const oe=Math.max(0,Math.ceil((H-te)/f)),ce=Math.min(d.outHeight,(d.inHeight+H-te)/f),xe=te*w+se;for(let pe=0;pe<g;++pe){const Se=Math.max(0,Math.ceil((W-pe)/p)),Te=Math.min(d.outWidth,(d.inWidth+W-pe)/p),Ge=pe*$+xe;for(let Qe=0;Qe<d.inChannels;++Qe){const ht=Qe*k+Ge;for(let Ze=0;Ze<d.outChannels;++Ze){let Ye=0;for(let ot=0;ot<d.batchSize;++ot){const it=ot*N,nr=ot*S;for(let Wt=Z;Wt<J;++Wt){const Mt=(X+Wt*h-D)*P+it,Pi=Wt*T+nr;for(let sr=oe;sr<ce;++sr){const Po=(te+sr*f-H)*_+Mt,_o=sr*R+Pi;for(let Lo=Se;Lo<Te;++Lo){const j0=(pe+Lo*p-W)*M+Po,K0=Lo*A+_o;Ye+=E[j0+Qe]*C[K0+Ze]}}}}v[ht+Ze]=Ye}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const wq={kernelName:Mb,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s;fe([r],"conv3dBackpropInputV2");const u=ge(r.shape),c=ge(o.shape),d=Ti(l,o.shape,a,1,i),h=new fn(d.inShape,"float32"),f=h.values,[p,m,x,g]=h.strides,y=n.data.get(r.dataId).values,[v,b,w,$]=u,k=n.data.get(o.dataId).values,[C,S,T,R]=c,{batchSize:A,filterDepth:E,filterHeight:N,filterWidth:P,inChannels:_,inDepth:M,inHeight:D,inWidth:W,outChannels:H,outDepth:X,outHeight:Z,outWidth:J,strideDepth:se,strideHeight:te,strideWidth:oe}=d,ce=E-1-d.padInfo.front,xe=N-1-d.padInfo.top,pe=P-1-d.padInfo.left;for(let Se=0;Se<A;++Se)for(let Te=0;Te<_;++Te)for(let Ge=0;Ge<M;++Ge){const Qe=Ge-ce,ht=Math.max(0,Math.ceil(Qe/se)),Ze=Math.min(X,(E+Qe)/se);for(let Ye=0;Ye<D;++Ye){const ot=Ye-xe,it=Math.max(0,Math.ceil(ot/te)),nr=Math.min(Z,(N+ot)/te);for(let Wt=0;Wt<W;++Wt){const Nr=Wt-pe,Mt=Math.max(0,Math.ceil(Nr/oe)),Pi=Math.min(J,(P+Nr)/oe);let sr=0;for(let oo=ht;oo<Ze;++oo){const Po=oo*se-Qe;for(let _o=it;_o<nr;++_o){const Lo=_o*te-ot;for(let Vu=Mt;Vu<Pi;++Vu){const j0=Vu*oe-Nr,K0=v*Se+b*oo+w*_o+$*Vu,RM=C*(E-1-Po)+S*(N-1-Lo)+T*(P-1-j0)+R*Te;for(let nf=0;nf<H;++nf){const AM=y[K0+nf],DM=k[RM+nf];sr+=AM*DM}}}}f[p*Se+m*Ge+x*Ye+g*Wt+Te]=sr}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const $q={kernelName:zb,backendName:"cpu",kernelFunc:Cq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kq=tt(Ud,t=>Math.cos(t)),Sq={kernelName:Ud,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iq=tt(Gd,t=>Math.cosh(t)),Tq={kernelName:Gd,backendName:"cpu",kernelFunc:Iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[c,d,h,f]=r.shape,p=o.shape[0],[m,x]=a,g=Ae([p,m,x,f],"float32"),y=n.data.get(o.dataId).values,v=n.data.get(i.dataId).values,b=n.data.get(r.dataId).values,w=ge(r.shape),$=ge(g.shape);for(let k=0;k<p;k++){const C=k*4,S=y[C],T=y[C+1],R=y[C+2],A=y[C+3],E=v[k];if(E>=c)continue;const N=m>1?(R-S)*(d-1)/(m-1):0,P=x>1?(A-T)*(h-1)/(x-1):0;for(let _=0;_<m;_++){const M=m>1?S*(d-1)+_*N:.5*(S+R)*(d-1);if(M<0||M>d-1){for(let D=0;D<x;D++)for(let W=0;W<f;W++){const H=W+D*$[2]+_*$[1]+k*$[0];g.values[H]=u}continue}if(l==="bilinear"){const D=Math.floor(M),W=Math.ceil(M),H=M-D;for(let X=0;X<x;X++){const Z=x>1?T*(h-1)+X*P:.5*(T+A)*(h-1);if(Z<0||Z>h-1){for(let oe=0;oe<f;oe++){const ce=oe+X*$[2]+_*$[1]+k*$[0];g.values[ce]=u}continue}const J=Math.floor(Z),se=Math.ceil(Z),te=Z-J;for(let oe=0;oe<f;oe++){let ce=oe+J*w[2]+D*w[1]+E*w[0];const xe=b[ce];ce=oe+se*w[2]+D*w[1]+E*w[0];const pe=b[ce];ce=oe+J*w[2]+W*w[1]+E*w[0];const Se=b[ce];ce=oe+se*w[2]+W*w[1]+E*w[0];const Te=b[ce],Ge=xe+(pe-xe)*te,Qe=Se+(Te-Se)*te;ce=oe+X*$[2]+_*$[1]+k*$[0],g.values[ce]=Ge+(Qe-Ge)*H}}}else for(let D=0;D<x;++D){const W=x>1?T*(h-1)+D*P:.5*(T+A)*(h-1);if(W<0||W>h-1){for(let Z=0;Z<f;Z++){const J=Z+D*$[2]+_*$[1]+k*$[0];g.values[J]=u}continue}const H=Math.round(W),X=Math.round(M);for(let Z=0;Z<f;Z++){const J=Z+H*w[2]+X*w[1]+E*w[0],se=Z+D*$[2]+_*$[1]+k*$[0];g.values[se]=b[J]}}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const Nq={kernelName:Vb,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;fe(r,"cumprod");const l=Tt([o],r.shape.length);let u=r;l!=null&&(u=Yn({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=Pt(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const d=us(u.dtype,"int32"),h=Ib(Q(u.shape),d),f=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(g,y)=>g+p-y-1:(g,y)=>g+y;for(let g=0;g<f.length;g+=p)for(let y=0;y<p;y++){const v=m(g,y);if(y===0)h[v]=i?1:f[v];else{const b=m(g,y-1);h[v]=i?f[b]*h[b]:f[v]*h[b]}}const x=n.makeTensorInfo(u.shape,d,h);if(l!=null){const g=Ei(l),y=Yn({inputs:{x},backend:n,attrs:{perm:g}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(u),y}return x}const Aq={kernelName:Bb,backendName:"cpu",kernelFunc:Rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;fe(r,"cumsum");const l=Tt([o],r.shape.length);let u=r;l!=null&&(u=Yn({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=Pt(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const d=us(u.dtype,"int32"),h=$n(Q(u.shape),d),f=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(g,y)=>g+p-y-1:(g,y)=>g+y;for(let g=0;g<f.length;g+=p)for(let y=0;y<p;y++){const v=m(g,y);if(y===0)h[v]=i?0:f[v];else{const b=m(g,y-1);h[v]=i?f[b]+h[b]:f[v]+h[b]}}const x=n.makeTensorInfo(u.shape,d,h);if(l!=null){const g=Ei(l),y=Yn({inputs:{x},backend:n,attrs:{perm:g}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(u),y}return x}const Fq={kernelName:xg,backendName:"cpu",kernelFunc:Dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=qC(l,u,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(o),c=IO(l,u,i,a);return n.makeTensorInfo(c.shape,o.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Pq={kernelName:Wb,backendName:"cpu",kernelFunc:Oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:o,dataFormat:i}=s;I(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],c=r.shape[3],d=l*o,h=u*o,f=c/(o*o),p=n.data.get(r.dataId).values,m=new Float32Array(a*d*h*f);let x=0;for(let g=0;g<a;++g)for(let y=0;y<d;++y){const v=Math.floor(y/o),b=y%o;for(let w=0;w<h;++w){const $=Math.floor(w/o),k=w%o,C=(b*o+k)*f;for(let S=0;S<f;++S){const R=S+C+c*($+u*(v+l*g));m[x++]=p[R]}}}return n.makeTensorInfo([a,d,h,f],r.dtype,m)}const Lq={kernelName:Ub,backendName:"cpu",kernelFunc:_q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IP(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;fe([r,o],"depthwiseConv2DNative");const c=ge(r.shape),d=ge(o.shape);let h=l;h==null&&(h=[1,1]),I(Sn(i,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const f=pn(r.shape,o.shape,i,h,a,u,!0),{filterHeight:p,filterWidth:m,dilationHeight:x,dilationWidth:g,padInfo:y}=f,v=y.left,b=y.top,w=f.outChannels/f.inChannels,$=new fn(f.outShape,r.dtype),k=n.data.get(r.dataId).values,C=n.data.get(o.dataId).values,S=$.values;for(let T=0;T<f.batchSize;++T){const R=T*c[0],A=T*$.strides[0];for(let E=0;E<f.outHeight;++E){const N=A+E*$.strides[1],P=E*f.strideHeight-b;for(let _=0;_<p;++_){const M=P+_*x;if(M<0||M>=f.inHeight)continue;const D=_*d[0],W=R+M*c[1];for(let H=0;H<f.outWidth;++H){const X=N+H*$.strides[2],Z=H*f.strideWidth-v;for(let J=0;J<m;++J){const se=Z+J*g;if(se<0||se>=f.inWidth)continue;const te=D+J*d[1],oe=W+se*f.inChannels;let ce=X,xe=te;for(let pe=0;pe<f.inChannels;++pe){const Se=k[oe+pe];for(let Te=0;Te<w;++Te)S[ce+Te]+=Se*C[xe+Te];ce+=w,xe+=w}}}}}}return n.makeTensorInfo($.shape,$.dtype,$.values)}const Mq={kernelName:yg,backendName:"cpu",kernelFunc:IP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s;fe([r,o],"depthwiseConv2dNativeBackpropFilter");const d=pn(r.shape,c,i,a,l,u,!0),{strideHeight:h,strideWidth:f,filterHeight:p,filterWidth:m}=d,x=new fn(d.filterShape,"float32"),g=d.padInfo.left,y=d.padInfo.top,v=d.outChannels/d.inChannels,b=n.data.get(r.dataId).values,w=new fn(r.shape,r.dtype,b),$=n.data.get(o.dataId).values,k=new fn(o.shape,o.dtype,$);for(let C=0;C<p;++C){const S=Math.max(0,Math.ceil((y-C)/h)),T=Math.min(d.outHeight,(d.inHeight+y-C)/h);for(let R=0;R<m;++R){const A=Math.max(0,Math.ceil((g-R)/f)),E=Math.min(d.outWidth,(d.inWidth+g-R)/f);for(let N=0;N<d.outChannels;++N){const P=Math.trunc(N/v),_=N%v;let M=0;for(let D=0;D<d.batchSize;++D)for(let W=S;W<T;++W){const H=C+W*h-y;for(let X=A;X<E;++X){const Z=R+X*f-g;M+=w.get(D,H,Z,P)*k.get(D,W,X,N)}}x.set(M,C,R,P,_)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const Bq={kernelName:Gb,backendName:"cpu",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s;fe([r,o],"depthwiseConv2DNativeBackpropInput");const d=ge(r.shape),h=ge(o.shape),f=pn(c,o.shape,i,a,l,u,!0),p=new fn(f.inShape,"float32"),m=p.values,[x,g,y]=p.strides,v=n.data.get(r.dataId).values,[b,w,$]=d,k=n.data.get(o.dataId).values,[C,S,T]=h,{batchSize:R,filterHeight:A,filterWidth:E,inChannels:N,inHeight:P,inWidth:_,outChannels:M,outHeight:D,outWidth:W,strideHeight:H,strideWidth:X}=f,Z=A-1-f.padInfo.top,J=E-1-f.padInfo.left,se=M/N;for(let te=0;te<R;++te)for(let oe=0;oe<N;++oe)for(let ce=0;ce<P;++ce){const xe=ce-Z,pe=Math.max(0,Math.ceil(xe/H)),Se=Math.min(D,(A+xe)/H);for(let Te=0;Te<_;++Te){const Ge=Te-J,Qe=Math.max(0,Math.ceil(Ge/X)),ht=Math.min(W,(E+Ge)/X);let Ze=0;for(let Ye=pe;Ye<Se;++Ye){const ot=Ye*H-xe;for(let it=Qe;it<ht;++it){const nr=it*X-Ge,Wt=b*te+w*Ye+$*it,Nr=C*(A-1-ot)+S*(E-1-nr)+T*oe;for(let Mt=0;Mt<se;++Mt){const Pi=oe*se+Mt,sr=v[Wt+Pi],oo=k[Nr+Mt];Ze+=sr*oo}}}m[x*te+g*ce+y*Te+oe]=Ze}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const Wq={kernelName:Hb,backendName:"cpu",kernelFunc:Vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uq(t){const{inputs:e,backend:n}=t,{x:s}=e,r=Q(s.shape),o=n.data.get(s.dataId).values,i=Ae([r,r],s.dtype),a=i.values;for(let u=0;u<o.length;u++)a[u*r+u]=o[u];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,i.dtype,i.values)}const Gq={kernelName:KN,backendName:"cpu",kernelFunc:Uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hq={kernelName:vg,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:o,pad:i,dilations:a}=n,l=e,u=l.data.get(s.dataId).values,c=s.shape.length,d=l.data.get(r.dataId).values,h=r.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:x,outHeight:g,outWidth:y,padInfo:v,strideHeight:b,strideWidth:w,filterHeight:$,filterWidth:k,dilationHeight:C,dilationWidth:S,outShape:T}=Eh(s.shape,r.shape,o,i,"NHWC",a),R=Q(T),A=T.length,E=Dt(s.dtype,R);for(let P=0;P<f;++P)for(let _=0;_<g;++_){const M=_*b-v.top;for(let D=0;D<y;++D){const W=D*w-v.left;for(let H=0;H<x;++H){let X=Number.MIN_SAFE_INTEGER;for(let J=0;J<$;++J){const se=M+J*C;if(se>=0&&se<p)for(let te=0;te<k;++te){const oe=W+te*S;if(oe>=0&&oe<m){const ce=jr([P,se,oe,H],c,ge(s.shape)),xe=jr([J,te,H],h,ge(r.shape)),pe=u[ce]+d[xe];pe>X&&(X=pe)}}}const Z=jr([P,_,D,H],A,ge(T));E[Z]=X}}}return{dataId:l.write(Ua(E,s.dtype),T,s.dtype),shape:T,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jq={kernelName:lv,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:o}=t,{strides:i,pad:a,dilations:l}=n,u=e,c=br(s.shape,u.data.get(s.dataId).values),d=br(r.shape,u.data.get(r.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:x,outWidth:g,padInfo:y,strideHeight:v,strideWidth:b,filterHeight:w,filterWidth:$,dilationHeight:k,dilationWidth:C,outShape:S}=Eh(s.shape,r.shape,i,a,"NHWC",l);I(o.rank===S.length,()=>`Error in ${lv}, dy must have the same rank as output ${S.length}, but got ${o.rank}`);const T=br(S,u.data.get(o.dataId).values),R=UN(r.shape,r.dtype);for(let E=0;E<h;++E)for(let N=0;N<x;++N){const P=N*v-y.top;for(let _=0;_<g;++_){const M=_*b-y.left;for(let D=0;D<m;++D){let W=Number.MIN_SAFE_INTEGER,H=0,X=0;for(let Z=0;Z<w;++Z){const J=P+Z*k;if(J>=0&&J<f)for(let se=0;se<$;++se){const te=M+se*C;if(te>=0&&te<p){const oe=c[E][J][te][D]+d[Z][se][D];oe>W&&(W=oe,H=Z,X=se)}}}R[H][X][D]+=T[E][N][_][D]}}}return{dataId:u.write(Ua(R,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq={kernelName:av,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:o}=t,{strides:i,pad:a,dilations:l}=n,u=e,c=br(s.shape,u.data.get(s.dataId).values),d=br(r.shape,u.data.get(r.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:x,outWidth:g,padInfo:y,strideHeight:v,strideWidth:b,filterHeight:w,filterWidth:$,dilationHeight:k,dilationWidth:C,outShape:S}=Eh(s.shape,r.shape,i,a,"NHWC",l);I(o.rank===S.length,()=>`Error in ${av}, dy must have the same rank as output ${S.length}, but got ${o.rank}`);const T=br(S,u.data.get(o.dataId).values),R=UN(s.shape,s.dtype);for(let E=0;E<h;++E)for(let N=0;N<x;++N){const P=N*v-y.top;for(let _=0;_<g;++_){const M=_*b-y.left;for(let D=0;D<m;++D){let W=Number.MIN_SAFE_INTEGER,H=P<0?0:P,X=M<0?0:M;for(let Z=0;Z<w;++Z){const J=P+Z*k;if(J>=0&&J<f)for(let se=0;se<$;++se){const te=M+se*C;if(te>=0&&te<p){const oe=c[E][J][te][D]+d[Z][se][D];oe>W&&(W=oe,H=J,X=te)}}}R[E][H][X][D]+=T[E][N][_][D]}}}return{dataId:u.write(Ua(R,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},u=(l==null?void 0:l.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=o.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${c} type.`);const[h,f]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],m=n.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,g=new Uint8ClampedArray(f*h*4);for(let v=0;v<h*f;++v){const b=[0,0,0,255*u];for(let $=0;$<p;$++){const k=m[v*p+$];if(r.dtype==="float32"){if(k<0||k>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${k}.`)}else if(r.dtype==="int32"&&(k<0||k>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${k}.`);p===1?(b[0]=k*x,b[1]=k*x,b[2]=k*x):b[$]=k*x}const w=v*4;g[w+0]=Math.round(b[0]),g[w+1]=Math.round(b[1]),g[w+2]=Math.round(b[2]),g[w+3]=Math.round(b[3])}o.width=f,o.height=h;const y=new ImageData(g,f,h);return d.putImageData(y,0,0),r}const qq={kernelName:NV,backendName:"cpu",kernelFunc:Xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gh(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;fe(r,"sum");let a;r.dtype==="bool"?a=vi({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=so({inputs:{x:r},backend:n});const l=a.shape.length,u=De(o,a.shape),c=Tt(u,l);let d=u,h=a;c!=null&&(h=Yn({inputs:{x:a},backend:n,attrs:{perm:c}}),d=Pt(d.length,l)),mn("sum",d,h.shape.length);const[f,p]=ln(h.shape,d),m=us(h.dtype,"int32");let x=fm(n,f,m);const g=Q(p),y=n.data.get(x.dataId).values,v=n.data.get(h.dataId).values;for(let b=0;b<y.length;++b){const w=b*g;let $=0;for(let k=0;k<g;++k)$+=v[w+k];y[b]=$}if(i){const b=Vt(x.shape,u),w=x;x=dt({inputs:{x},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(w)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(h),x}const Yq={kernelName:Zg,backendName:"cpu",kernelFunc:Gh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qq(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=vC(r,o.length);wC(i.length,l,o);const{path:u,steps:c}=CC(a,l),d=c.length;let h=null,f=i.length;const p=[];for(let m=0;m<d;++m){for(const x of c[m]){const{permutationIndices:g,expandDims:y}=bC(f,l[x]);let v;$C(g)?v=o[x]:(v=Yn({inputs:{x:o[x]},backend:n,attrs:{perm:g}}),p.push(v));const b=v.shape.slice();for(let w=0;w<y.length;++w)b.splice(y[w],0,1);qe(v.shape,b)||(v=dt({inputs:{x:v},backend:n,attrs:{shape:b}}),p.push(v)),h===null?h=v:(h=N0({inputs:{a:v,b:h},backend:n}),p.push(h))}m<d-1&&(u[m]>=0&&(h=Gh({inputs:{x:h},backend:n,attrs:{axis:u[m]-(i.length-f),keepDims:!1}}),p.push(h)),f--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const Zq={kernelName:jb,backendName:"cpu",kernelFunc:Qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jq(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;fe([s,r],"eluGrad");const o=new Float32Array(Q(r.shape)),i=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const u=i[l];u>=0?o[l]=a[l]:o[l]=a[l]*(u+1)}return n.makeTensorInfo(r.shape,"float32",o)}const eY={kernelName:Kb,backendName:"cpu",kernelFunc:Jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tY=hC,nY=fC,sY=pC,rY=mC,oY=gC,iY=xC,aY=tt(Kd,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+tY*n);return e*(1-((((iY*s+oY)*s+rY)*s+sY)*s+nY)*s*Math.exp(-n*n))}),lY={kernelName:Kd,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gm(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(I(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),dt({inputs:{x:r},backend:n,attrs:{shape:a}})}const uY={kernelName:wg,backendName:"cpu",kernelFunc:gm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cY=Lt((t,e)=>t/e),t$=en(Hd,cY),Pv={kernelName:Hd,backendName:"cpu",kernelFunc:t$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TP(t,e,n){const s=t.shape,r=s[0],o=s[1],i=n.data.get(t.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[r,o],c=Q(u),d=Cn("float32",c),h=Cn("float32",c);for(let x=0;x<r;x++){const g=Fa({inputs:{x:a},backend:n,attrs:{begin:[x,0],size:[1,o]}}),y=Fa({inputs:{x:l},backend:n,attrs:{begin:[x,0],size:[1,o]}}),v=ns({inputs:{real:g,imag:y},backend:n}),{real:b,imag:w}=dY(v,e,n),$=To(b,w);for(let k=0;k<o;k++){const C=yC($,k);d[x*o+k]=C.real,h[x*o+k]=C.imag}n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v)}const f=n.makeTensorInfo(u,"float32",d),p=n.makeTensorInfo(u,"float32",h),m=ns({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}function dY(t,e,n){const s=Q(t.shape),r=n.data.get(t.dataId),o=n.data.get(r.complexTensorInfos.real.dataId).values,i=n.data.get(r.complexTensorInfos.imag.dataId).values;if(hY(s)){const a=_v(o,i,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const u=n.makeTensorInfo(l,"float32",a.real),c=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",Ii(s,"float32")),h=so({inputs:{x:d},backend:n}),f=Pv.kernelFunc({inputs:{a:u,b:d},backend:n}),p=Pv.kernelFunc({inputs:{a:c,b:h},backend:n}),m=n.data.get(f.dataId).values,x=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),{real:m,imag:x}}return a}else{const a=To(o,i),l=fY(a,s,e);return BA(l)}}function hY(t){return(t&t-1)===0}function _v(t,e,n,s,r){if(n===1)return{real:t,imag:e};const o=To(t,e),i=n/2,a=VA(o),l=a.real,u=a.imag,c=[l.length],d=r.makeTensorInfo(c,"float32",l),h=r.makeTensorInfo(c,"float32",u),f=ns({inputs:{real:d,imag:h},backend:r}),p=WA(o),m=p.real,x=p.imag,g=[m.length],y=r.makeTensorInfo(g,"float32",m),v=r.makeTensorInfo(g,"float32",x),b=ns({inputs:{real:y,imag:v},backend:r}),w=_v(l,u,i,s,r),$=w.real,k=w.imag,C=[$.length],S=r.makeTensorInfo(C,"float32",$),T=r.makeTensorInfo(C,"float32",k),R=ns({inputs:{real:S,imag:T},backend:r}),A=_v(m,x,i,s,r),E=A.real,N=A.imag,P=[E.length],_=r.makeTensorInfo(P,"float32",E),M=r.makeTensorInfo(P,"float32",N),D=ns({inputs:{real:_,imag:M},backend:r}),W=GA(n,s),H=[W.real.length],X=r.makeTensorInfo(H,"float32",W.real),Z=r.makeTensorInfo(H,"float32",W.imag),J=ns({inputs:{real:X,imag:Z},backend:r}),se=N0({inputs:{a:J,b:D},backend:r}),te=au({inputs:{a:R,b:se},backend:r}),oe=JC({inputs:{a:R,b:se},backend:r}),ce=Da({inputs:{input:te},backend:r}),xe=Da({inputs:{input:oe},backend:r}),pe=lu({inputs:{input:te},backend:r}),Se=lu({inputs:{input:oe},backend:r}),Te=uu({inputs:[ce,xe],backend:r,attrs:{axis:0}}),Ge=uu({inputs:[pe,Se],backend:r,attrs:{axis:0}}),Qe=r.data.get(Te.dataId).values,ht=r.data.get(Ge.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(se),r.disposeIntermediateTensorInfo(te),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(Se),r.disposeIntermediateTensorInfo(Te),r.disposeIntermediateTensorInfo(Ge),{real:Qe,imag:ht}}function fY(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const l=HA(r*a,e,n),u=yC(t,a);o+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}n&&(o/=e,i/=e),UA(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pY(t){const{inputs:e,backend:n}=t,{input:s}=e,r=Q(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=dt({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),l=TP(a,!1,n),u=dt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const mY={kernelName:Xb,backendName:"cpu",kernelFunc:pY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n$(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:o}=n,i=o||vu(r),a=Dt(i,Q(s));return xY(a,r,i),e.makeTensorInfo(s,i,a)}const gY={kernelName:qb,backendName:"cpu",kernelFunc:n$};function xY(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yY={kernelName:Yb,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,o=Cn(s.dtype,Q(s.shape)),[i,a,l,u]=s.shape,c=r.data.get(s.dataId).values;for(let h=0;h<i;h++){const f=h*l*a*u;for(let p=0;p<a;p++){const m=p*(l*u);for(let x=0;x<l;x++){const g=x*u;for(let y=0;y<u;y++){const v=Math.round(l-x-1),b=f+m+g+y;let w=c[b];if(v>=0&&v<l){const $=v*u,k=f+m+$+y;w=c[k]}o[b]=w}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let m=SP({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(i){const x=m;if(c==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const g=dt({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});m=au({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=au({inputs:{a:m,b:i},backend:n});n.disposeIntermediateTensorInfo(x)}if(f){const x=m;if(c==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const g=dt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=mm(n,m,f,g,p),n.disposeIntermediateTensorInfo(g)}else m=mm(n,m,f,a,p);n.disposeIntermediateTensorInfo(x)}return m}const bY={kernelName:qp,backendName:"cpu",kernelFunc:vY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let m=IP({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(i){const x=m;m=au({inputs:{a:m,b:i},backend:n}),n.disposeIntermediateTensorInfo(x)}if(f){const x=m;m=mm(n,m,f,a,p),n.disposeIntermediateTensorInfo(x)}return m}const CY={kernelName:hR,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,o=Q(s.shape),i=r.shape,a=i[i.length-1],[l,u,c,d]=tC(s,r);if(u===0)return n.makeTensorInfo(l,s.dtype,[]);const h=n.data.get(r.dataId).values,f=n.bufferSync(s),p=LO(h,f,s.dtype,u,a,c,d,s.shape,o);return n.makeTensorInfo(l,s.dtype,p.values)}const kY={kernelName:XN,backendName:"cpu",kernelFunc:$Y};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;fe([r,o],"gatherV2");const l=De(i,r.shape)[0],u=n.data.get(o.dataId).values,c=r.shape[l];for(let b=0;b<u.length;++b){const w=u[b];I(w<=c-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${c-1}]`)}let d=a;a==null&&(d=0);const h=Q(o.shape),f=SC(r,o,l,d),p=dt({inputs:{x:r},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=dt({inputs:{x:o},backend:n,attrs:{shape:[f.batchSize,h/f.batchSize]}}),x=[f.batchSize,f.outerSize,h/f.batchSize,f.sliceSize],g=n.bufferSync(m),y=n.bufferSync(p),v=MO(y,g,x);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(f.outputShape,v.dtype,v.values)}const IY={kernelName:$g,backendName:"cpu",kernelFunc:SY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(t){const{inputs:e,backend:n}=t,{input:s}=e,r=Q(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=dt({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),l=TP(a,!0,n),u=dt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const EY={kernelName:Qb,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NY=tt(eh,t=>Number.isFinite(t)?1:0,"bool"),RY={kernelName:eh,backendName:"cpu",kernelFunc:NY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AY=tt(th,t=>Math.abs(t)===1/0?1:0,"bool"),DY={kernelName:th,backendName:"cpu",kernelFunc:AY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FY=tt(nh,t=>Number.isNaN(t)?1:0,"bool"),OY={kernelName:nh,backendName:"cpu",kernelFunc:FY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:o}=n,i=UO(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const _Y={kernelName:qN,backendName:"cpu",kernelFunc:PY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LY=tt(rh,t=>Math.log1p(t)),MY={kernelName:rh,backendName:"cpu",kernelFunc:LY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zY=Lt((t,e)=>t&&e),BY=en(Eg,zY,null,"bool"),VY={kernelName:Eg,backendName:"cpu",kernelFunc:BY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WY=tt(Ng,t=>t?0:1,"bool"),UY={kernelName:Ng,backendName:"cpu",kernelFunc:WY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GY=Lt((t,e)=>t||e),HY=en(Rg,GY,null,"bool"),jY={kernelName:Rg,backendName:"cpu",kernelFunc:HY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s;fe(r,"LRN");const u=r.shape[3],c=u-1,d=n.data.get(r.dataId).values,h=Q(r.shape),f=new Float32Array(h);function p(m){const x=m%u;let g=m-x+Math.max(0,x-o);const y=m-x+Math.min(x+o,c);let v=0;for(;g<=y;g++){const b=d[g];v+=b*b}return v}for(let m=0;m<h;m++){const x=p(m),g=d[m]*Math.pow(i+a*x,-l);f[m]=g}return n.makeTensorInfo(r.shape,r.dtype,f)}const XY={kernelName:Ag,backendName:"cpu",kernelFunc:KY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s;fe(i,"LRNGrad");const d=Q(i.shape),h=i.shape[3],f=n.data.get(i.dataId).values,p=n.data.get(r.dataId).values,m=n.data.get(o.dataId).values,x=new Float32Array(d),g=d;for(let y=0;y<g;y++){const v=y%h,b=y-v+Math.max(0,v-a),w=y-v+Math.min(h,v+a+1);let $=0;for(let k=b;k<w;k++)$+=Math.pow(p[k],2);$=u*$+l;for(let k=b;k<w;k++){let C=-2*u*c*p[k]*m[y]/$;y===k&&(C+=Math.pow($,-c)),C*=f[y],x[k]+=C}}return n.makeTensorInfo(i.shape,r.dtype,x)}const YY={kernelName:Jb,backendName:"cpu",kernelFunc:qY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EP(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=n;let l=r.shape;const u=l.length,c=De(o,l);let d=c;const h=Tt(d,u);let f=a.data.get(r.dataId).values;if(h!=null){const b=new Array(u);for(let w=0;w<b.length;w++)b[w]=l[h[w]];f=QC(f,l,r.dtype,h,b),d=Pt(d.length,u),l=b}fe(r,"max"),mn("max",d,u);const[p,m]=ln(l,d),x=Q(m),g=HO(f,x,p,r.dtype),y=a.write(g,p,r.dtype);let v=p;return i&&(v=Vt(p,c)),{dataId:y,shape:v,dtype:r.dtype}}const QY={kernelName:Dg,backendName:"cpu",kernelFunc:EP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;fe(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;I(Sn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=Js(r.shape,o,i,u,a,l);let d;if(c.filterWidth===1&&c.filterHeight===1&&qe(c.inShape,c.outShape))d=so({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,f=ge(r.shape),p=e$(h,r.shape,r.dtype,f,c,"max");d=n.makeTensorInfo(c.outShape,r.dtype,p.values)}return d}const JY={kernelName:Fg,backendName:"cpu",kernelFunc:ZY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;fe(r,"maxPool3d");const c=Ao(r.shape,o,i,1,a,l,u),d=n.data.get(r.dataId).values,h=kP(d,r.shape,r.dtype,ge(r.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const tQ={kernelName:Og,backendName:"cpu",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;fe([r,o],"maxPool3DGrad");const c=Ao(o.shape,i,a,1,l,u),d=n.bufferSync(o),h=GX(d,c),f=c.strideDepth,p=c.strideHeight,m=c.strideWidth,x=c.dilationDepth,g=c.dilationHeight,y=c.dilationWidth,v=c.effectiveFilterDepth,b=c.effectiveFilterHeight,w=c.effectiveFilterWidth,$=v-1-c.padInfo.front,k=w-1-c.padInfo.left,C=b-1-c.padInfo.top,S=Ae(o.shape,"float32"),T=n.bufferSync(r);for(let R=0;R<c.batchSize;++R)for(let A=0;A<c.inChannels;++A)for(let E=0;E<c.inDepth;++E)for(let N=0;N<c.inHeight;++N)for(let P=0;P<c.inWidth;++P){const _=E-$,M=N-C,D=P-k;let W=0;for(let H=0;H<v;H+=x){const X=(_+H)/f;if(!(X<0||X>=c.outDepth||Math.floor(X)!==X))for(let Z=0;Z<b;Z+=g){const J=(M+Z)/p;if(!(J<0||J>=c.outHeight||Math.floor(J)!==J))for(let se=0;se<w;se+=y){const te=(D+se)/m;if(te<0||te>=c.outWidth||Math.floor(te)!==te)continue;const oe=v*b*w-1-h.get(R,X,J,te,A),ce=H*b*w+Z*w+se,xe=oe===ce?1:0;if(xe===0)continue;const pe=T.get(R,X,J,te,A);W+=pe*xe}}}S.set(W,R,E,N,P,A)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const sQ={kernelName:tw,backendName:"cpu",kernelFunc:nQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o,output:i}=e,a=o;fe([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=s,h=Js(a.shape,l,u,1,c,d),f=n.data.get(a.dataId).values,p=Ae(h.outShape,a.dtype,$P(f,a.shape,a.dtype,h).values),m=h.strideHeight,x=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,v=h.effectiveFilterHeight,b=h.effectiveFilterWidth,w=b-1-h.padInfo.left,$=v-1-h.padInfo.top,k=Ae(a.shape,"float32"),C=n.data.get(r.dataId).values,S=Ae(r.shape,"float32",C);for(let T=0;T<h.batchSize;++T)for(let R=0;R<h.inChannels;++R)for(let A=0;A<h.inHeight;++A)for(let E=0;E<h.inWidth;++E){const N=A-$,P=E-w;let _=0;for(let M=0;M<v;M+=g){const D=(N+M)/m;if(!(D<0||D>=h.outHeight||Math.floor(D)!==D))for(let W=0;W<b;W+=y){const H=(P+W)/x;if(H<0||H>=h.outWidth||Math.floor(H)!==H)continue;const X=v*b-1-p.get(T,D,H,R),Z=M*b+W,J=X===Z?1:0;if(J===0)continue;const se=S.get(T,D,H,R);_+=se*J}}k.set(_,T,A,E,R)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const oQ={kernelName:ew,backendName:"cpu",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(t,e,n,s,r){const o=ge(e),i=e$(t,e,n,o,r,"max"),a=$P(t,e,n,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aQ={kernelName:YN,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=n;fe(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,c=Js(s.shape,r,o,[1,1],i),[d,h]=iQ(u,s.shape,s.dtype,a,c),f=l.write(d,c.outShape,s.dtype),p=l.write(h,c.outShape,s.dtype);return[{dataId:f,shape:c.outShape,dtype:s.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=De(o,r.shape),u=ln(r.shape,a)[1],c=Q(u),d=[],h=n.makeTensorInfo([],"float32",new Float32Array([c]));d.push(h);const f=vi({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});d.push(f);const p=t$({inputs:{a:f,b:h},backend:n});d.push(p);const m=Gh({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:i}});return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),m}const uQ={kernelName:Pg,backendName:"cpu",kernelFunc:lQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;fe(r,"min");const a=De(o,r.shape);let l=a;const u=Tt(l,r.shape.length);let c=r;u!=null&&(c=Yn({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Pt(l.length,r.shape.length)),mn("min",l,c.shape.length);const[d,h]=ln(c.shape,l),f=Q(h),p=$n(Q(d),c.dtype),m=n.data.get(c.dataId).values;for(let g=0;g<p.length;++g){const y=g*f;let v=m[y];for(let b=0;b<f;++b){const w=m[y+b];(Number.isNaN(w)||w<v)&&(v=w)}p[g]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const x=n.makeTensorInfo(d,c.dtype,p);if(i){const g=Vt(d,a),y=dt({inputs:{x},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(x),y}return x}const dQ={kernelName:_g,backendName:"cpu",kernelFunc:cQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,mode:i}=s;fe(r,"mirrorPad");const a=o.map((v,b)=>v[0]+r.shape[b]+v[1]),l=o.map(v=>v[0]),u=o.map((v,b)=>v[0]+r.shape[b]),c=i==="reflect"?0:1,d=n.data.get(r.dataId).values,h=r.shape.length,f=ge(r.shape),p=Q(a),m=a.length,x=ge(a),g=Cn(r.dtype,p);for(let v=0;v<p;v++){let b=bu(v,m,x);for(let $=0;$<m;$++)b[$]<l[$]?b[$]=l[$]*2-b[$]-c:b[$]>=u[$]&&(b[$]=(u[$]-1)*2-b[$]+c);b=b.map(($,k)=>$-l[k]);const w=jr(b,h,f);g[v]=d[w]}return{dataId:n.write(g,a,r.dtype),shape:a,dtype:r.dtype}}const fQ={kernelName:Lg,backendName:"cpu",kernelFunc:hQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pQ=Lt((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),mQ=en(ah,pQ),gQ={kernelName:ah,backendName:"cpu",kernelFunc:mQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NP(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=De([a],r.shape),u=EP({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=Vt(u.shape,l),d=dt({inputs:{x:u},backend:n,attrs:{shape:c}}),h=JC({inputs:{a:r,b:d},backend:n}),f=FO({inputs:{x:h},backend:n}),p=Gh({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),m=dt({inputs:{x:p},backend:n,attrs:{shape:c}}),x=t$({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),x}const xQ={kernelName:t0,backendName:"cpu",kernelFunc:NP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;fe(r,"multinomial");const l=a?r:NP({inputs:{logits:r},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],d=n.data.get(l.dataId).values,h=[u,o],f=$n(Q(h),"int32");for(let p=0;p<u;++p){const m=p*c,x=new Float32Array(c-1);x[0]=d[m];for(let v=1;v<x.length;++v)x[v]=x[v-1]+d[m+v];const g=Vw.alea(i.toString()),y=p*o;for(let v=0;v<o;++v){const b=g();f[y+v]=x.length;for(let w=0;w<x.length;w++)if(b<x[w]){f[y+v]=w;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",f)}const vQ={kernelName:QN,backendName:"cpu",kernelFunc:yQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bQ=Yw;function wQ(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;fe(r,"NonMaxSuppression");const u=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,{selectedIndices:d}=bQ(u,c,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const CQ={kernelName:nw,backendName:"cpu",kernelFunc:wQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Q=Qw;function kQ(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;fe(r,"NonMaxSuppressionPadded");const c=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,{selectedIndices:h,validOutputs:f}=$Q(c,d,i,a,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const SQ={kernelName:sw,backendName:"cpu",kernelFunc:kQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IQ=Zw;function TQ(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;fe(r,"NonMaxSuppressionWithScore");const c=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,h=i,f=a,p=l,m=u,{selectedIndices:x,selectedScores:g}=IQ(c,d,h,f,p,m);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}const EQ={kernelName:rw,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s;fe(r,"oneHot");const u=Q(r.shape),c=new Float32Array(u*i);c.fill(l);const d=n.data.get(r.dataId).values;for(let h=0;h<u;++h)d[h]>=0&&d[h]<i&&(c[h*i+d[h]]=a);return n.makeTensorInfo([...r.shape,i],o,c)}const RQ={kernelName:Vg,backendName:"cpu",kernelFunc:NQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xm(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Da({inputs:{input:s},backend:n}),o=xm({inputs:{x:r},backend:n}),i=lu({inputs:{input:s},backend:n}),a=xm({inputs:{x:i},backend:n}),l=ns({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return n$({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const AQ={kernelName:r0,backendName:"cpu",kernelFunc:xm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RP(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Da({inputs:{input:s},backend:n}),o=RP({inputs:{x:r},backend:n}),i=lu({inputs:{input:s},backend:n}),a=xm({inputs:{x:i},backend:n}),l=ns({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return n$({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const DQ={kernelName:Bg,backendName:"cpu",kernelFunc:RP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AP(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return gm({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(c=>{Sb(o,c.shape,"All tensors passed to stack must have matching shapes"),I(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const d=gm({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(d),d}),u=uu({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const FQ={kernelName:Wg,backendName:"cpu",kernelFunc:AP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,constantValue:i}=s;fe(r,"pad");const a=o.map((y,v)=>y[0]+r.shape[v]+y[1]),l=o.map(y=>y[0]),u=n.data.get(r.dataId).values,c=Q(r.shape),d=r.shape.length,h=ge(r.shape),f=Q(a),p=a.length,m=ge(a),x=Cn(r.dtype,f);i!==0&&x.fill(i);for(let y=0;y<c;y++){const b=bu(y,d,h).map(($,k)=>$+l[k]),w=jr(b,p,m);x[w]=u[y]}return{dataId:n.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const DP={kernelName:Ug,backendName:"cpu",kernelFunc:OQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PQ=Lt((t,e)=>Math.pow(t,e)),_Q=en(uh,PQ),LQ={kernelName:uh,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MQ(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,a=r.map(x=>n.data.get(x.dataId).values),l=r.map(x=>x.shape),u=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values,[d,h,f]=QO(a,l,u,o.shape,o.dtype,c,i.shape),p=d.map(x=>n.makeTensorInfo([x.length],"int32",x)),m=n.makeTensorInfo(f,o.dtype,h);return p.concat([m])}const zQ={kernelName:ZN,backendName:"cpu",kernelFunc:MQ};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:o}=e,i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=ZO(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=n.makeTensorInfo([u.length],"int32",u),h=n.makeTensorInfo([c.length],s.dtype,c);return[d,h]}const VQ={kernelName:JN,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WQ(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,d=n.data.get(i.dataId).values,h=a.map(x=>n.data.get(x.dataId).values),f=a.map(x=>x.shape),[p,m]=JO(u,r.shape,c,o.shape,o.dtype,d,i.shape,h,f,l);return n.makeTensorInfo(p,o.dtype,m)}const UQ={kernelName:eR,backendName:"cpu",kernelFunc:WQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:o,step:i}=n,a=eP(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const HQ={kernelName:ow,backendName:"cpu",kernelFunc:GQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jQ=tt(ch,t=>1/t),KQ={kernelName:ch,backendName:"cpu",kernelFunc:jQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XQ(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;fe(r,"resizeBilinear");const l=ge(r.shape),[u,c]=a,[d,h,f,p]=r.shape,m=n.data.get(r.dataId).values,x=new Float32Array(Q([d,u,c,p])),g=[o&&u>1?h-1:h,o&&c>1?f-1:f],y=[o&&u>1?u-1:u,o&&c>1?c-1:c];let v=0;const b=g[0]/y[0],w=g[1]/y[1];for(let $=0;$<d;$++)for(let k=0;k<u;k++){let C;i?C=b*(k+.5)-.5:C=b*k;const S=Math.max(0,Math.floor(C)),T=C-S,R=Math.min(h-1,Math.ceil(C)),A=$*l[0]+S*l[1],E=$*l[0]+R*l[1];for(let N=0;N<c;N++){let P;i?P=w*(N+.5)-.5:P=w*N;const _=Math.max(0,Math.floor(P)),M=P-_,D=Math.min(f-1,Math.ceil(P)),W=A+_*l[2],H=E+_*l[2],X=A+D*l[2],Z=E+D*l[2];for(let J=0;J<p;J++){const se=m[W+J],te=m[H+J],oe=m[X+J],ce=m[Z+J],xe=se+(oe-se)*M,pe=te+(ce-te)*M,Se=xe+(pe-xe)*T;x[v++]=Se}}}return n.makeTensorInfo([d,u,c,p],"float32",x)}const qQ={kernelName:Xg,backendName:"cpu",kernelFunc:XQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s;fe([o,r],"resizeBilinearGrad");const a=ge(r.shape),[l,u,c,d]=r.shape,[,h,f]=o.shape,p=new Float32Array(l*u*c*d),m=[i&&h>1?u-1:u,i&&f>1?c-1:c],x=[i&&h>1?h-1:h,i&&f>1?f-1:f],g=m[0]/x[0],y=m[1]/x[1],v=n.data.get(o.dataId).values;let b=0;for(let w=0;w<l;w++){const $=w*a[0];for(let k=0;k<h;k++){const C=k*g,S=Math.floor(C),T=Math.min(Math.ceil(C),u-1),R=$+S*a[1],A=$+T*a[1],E=C-S,N=1-E;for(let P=0;P<f;P++){const _=P*y,M=Math.floor(_),D=Math.min(Math.ceil(_),c-1),W=_-M,H=1-W,X=R+M*a[2],Z=R+D*a[2],J=A+M*a[2],se=A+D*a[2],te=N*H,oe=N*W,ce=E*H,xe=E*W;for(let pe=0;pe<d;pe++){const Se=v[b++];p[X+pe]+=Se*te,p[Z+pe]+=Se*oe,p[J+pe]+=Se*ce,p[se+pe]+=Se*xe}}}}return n.makeTensorInfo([l,c,u,d],"float32",p)}const QQ={kernelName:lw,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZQ(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;fe(r,"resizeNearestNeighbor");const l=ge(r.shape),[u,c]=a,[d,h,f,p]=r.shape,m=n.data.get(r.dataId).values,x=new Float32Array(d*u*c*p),g=[o&&u>1?h-1:h,o&&c>1?f-1:f],y=[o&&u>1?u-1:u,o&&c>1?c-1:c],v=g[0]/y[0],b=g[1]/y[1];let w=0;for(let $=0;$<d;$++){const k=$*l[0];for(let C=0;C<u;C++){const S=i?v*(C+.5):v*C;let T=Math.min(h-1,o?Math.round(S):Math.floor(S));i&&(T=Math.max(0,T));const R=k+T*l[1];for(let A=0;A<c;A++){const E=i?b*(A+.5):b*A;let N=Math.min(f-1,o?Math.round(E):Math.floor(E));i&&(N=Math.max(0,N));const P=R+N*l[2];for(let _=0;_<p;_++){const M=m[P+_];x[w++]=M}}}}return n.makeTensorInfo([d,u,c,p],r.dtype,x)}const JQ={kernelName:Kg,backendName:"cpu",kernelFunc:ZQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eZ(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s;fe([o,r],"resizeNearestNeighborGrad");const a=ge(r.shape),l=ge(o.shape),[u,c,d,h]=r.shape,[,f,p]=o.shape,m=new Float32Array(u*c*d*h),x=n.data.get(o.dataId).values,g=[i&&f>1?c-1:c,i&&p>1?d-1:d],y=[i&&f>1?f-1:f,i&&p>1?p-1:p],v=g[0]/y[0],b=g[1]/y[1],w=1/v,$=1/b,k=Math.ceil(w)*2+2,C=Math.ceil($)*2+2;for(let S=0;S<u;S++){const T=S*a[0];for(let R=0;R<c;R++){const A=T+R*a[1],E=Math.floor(R*w),N=Math.floor(E-k/2);for(let P=0;P<d;P++){const _=A+P*a[2],M=Math.floor(P*$),D=Math.floor(M-C/2);for(let W=0;W<h;W++){let H=0;for(let X=0;X<k;X++){const Z=X+N;if(Z<0||Z>=f)continue;const J=T+Z*l[1],se=Z*v,te=Math.min(c-1,i?Math.round(se):Math.floor(se));if(R===te)for(let oe=0;oe<C;oe++){const ce=oe+D;if(ce<0||ce>=p)continue;const xe=J+ce*l[2],pe=ce*b,Se=Math.min(d-1,i?Math.round(pe):Math.floor(pe));P===Se&&(H+=x[xe+W])}}m[_+W]=H}}}}return n.makeTensorInfo(r.shape,r.dtype,m)}const tZ={kernelName:aw,backendName:"cpu",kernelFunc:eZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:o}=s;fe(r,"reverse");const i=r.shape.length,a=De(o,r.shape);if(i===0)return so({inputs:{x:r},backend:n});const l=new fn(r.shape,r.dtype),u=n.bufferSync(r);for(let c=0;c<l.size;c++){const d=l.indexToLoc(c),h=d.slice();a.forEach(f=>h[f]=r.shape[f]-1-h[f]),l.set(u.get(...h),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const sZ={kernelName:qg,backendName:"cpu",kernelFunc:nZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rZ={kernelName:mw,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:o,center:i}=e,a=n,l=Cn(s.dtype,Q(s.shape)),[u,c,d,h]=s.shape,[f,p]=uC(i,c,d),m=255,x=Math.sin(r),g=Math.cos(r),y=a.data.get(s.dataId).values;for(let b=0;b<u;b++){const w=b*d*c*h;for(let $=0;$<c;$++){const k=$*(d*h);for(let C=0;C<d;C++){const S=C*h;for(let T=0;T<h;T++){const R=[u,$,C,T],A=R[2],E=R[1];let N=(A-f)*g-(E-p)*x,P=(A-f)*x+(E-p)*g;N=Math.round(N+f),P=Math.round(P+p);let _=o;if(typeof o!="number"&&(T===3?_=m:_=o[T]),N>=0&&N<d&&P>=0&&P<c){const D=P*(d*h),W=N*h,H=w+D+W+T;_=y[H]}const M=w+k+S+T;l[M]=_}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oZ=tt(fh,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),iZ={kernelName:fh,backendName:"cpu",kernelFunc:oZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aZ(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=Ka(o,r,i),h=!0,f=n.bufferSync(r),p=n.bufferSync(o),m=ta(f,p,i,d,u,l,a,c,0,h);return n.makeTensorInfo(i,m.dtype,m.values)}const lZ={kernelName:tR,backendName:"cpu",kernelFunc:aZ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function cZ(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function dZ(t,e,n,s,r,o){const i=Dt("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),u=a*r;for(let c=0;c<r;++c)i[u+c]=o==="left"?uZ(l,e[c+u]):cZ(l,e[c+u])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hZ(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:o}=e,{side:i}=s,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,u=dZ(a,l,r.shape[0],r.shape[1],o.shape[1],i);return n.makeTensorInfo(o.shape,"int32",u)}const fZ={kernelName:sR,backendName:"cpu",kernelFunc:hZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pZ(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:o}=e;fe([s,r,o],"select");const i=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=us(r.dtype,o.dtype),d=$n(Q(r.shape),c);let h=0;const f=i===0||i>1||r.shape.length===1?1:Q(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<f;m++)a[p]===1?d[h++]=l[p]:d[h++]=u[p];return n.makeTensorInfo(r.shape,c,d)}const mZ={kernelName:Yg,backendName:"cpu",kernelFunc:pZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gZ=g0,xZ=x0,yZ=tt(mh,t=>t>=0?xZ*t:gZ*(Math.exp(t)-1)),vZ={kernelName:mh,backendName:"cpu",kernelFunc:yZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bZ=tt(yh,t=>t<0?-1:t>0?1:0),wZ={kernelName:yh,backendName:"cpu",kernelFunc:bZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CZ=tt(gh,t=>Math.sin(t)),$Z={kernelName:gh,backendName:"cpu",kernelFunc:CZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kZ=tt(xh,t=>Math.sinh(t)),SZ={kernelName:xh,backendName:"cpu",kernelFunc:kZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IZ=11920928955078125e-23,yI=Math.log(IZ)+2,TZ=tt(bh,t=>{const e=t>-yI,n=t<yI,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),EZ={kernelName:bh,backendName:"cpu",kernelFunc:TZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,paddings:i}=s;fe([r],"spaceToBatchND");const a=Q(o),l=[[0,0]];l.push(...i);for(let $=1+o.length;$<r.shape.length;++$)l.push([0,0]);const u=DP.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),c=Fh(u.shape,o,a,!1),d=Oh(c.length,o.length,!1),h=Ph(u.shape,o,a,!1),m=dt({inputs:{x:u},backend:n,attrs:{shape:c}}),y=Yn({inputs:{x:m},backend:n,attrs:{perm:d}}),w=dt({inputs:{x:y},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),w}const RZ={kernelName:Jg,backendName:"cpu",kernelFunc:NZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AZ(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values[0],[d,h,f,p,m]=rP(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(x=>Number(x)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const DZ={kernelName:rR,backendName:"cpu",kernelFunc:AZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(o.dataId).values),[u,c,d]=oP(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const OZ={kernelName:oR,backendName:"cpu",kernelFunc:FZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=ZC(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const _Z={kernelName:iR,backendName:"cpu",kernelFunc:PZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LZ(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=ZC(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const MZ={kernelName:aR,backendName:"cpu",kernelFunc:LZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:d,outputSize:h}=Ka(o,r,a),f=!1,p=n.bufferSync(r);let m;switch(o.dtype){case"bool":{const x=n.bufferSync(o),g=!!n.data.get(i.dataId).values[0];m=ta(p,x,a,h,c,u,l,d,g,f);break}case"float32":{const x=n.bufferSync(o),g=n.data.get(i.dataId).values[0];m=ta(p,x,a,h,c,u,l,d,g,f);break}case"int32":{const x=n.bufferSync(o),g=n.data.get(i.dataId).values[0];m=ta(p,x,a,h,c,u,l,d,g,f);break}case"string":{const x=n.bufferSync(o),g=pi(n.data.get(i.dataId).values[0]);m=ta(p,x,a,h,c,u,l,d,g,f);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const BZ={kernelName:lR,backendName:"cpu",kernelFunc:zZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=De(i,r.shape)[0],l=kC(r,o,a),u=new Array(r.shape.length).fill(0),c=r.shape.slice();return l.map(d=>{const h=[...c];h[a]=d;const f=Fa({inputs:{x:r},backend:n,attrs:{begin:u,size:h}});return u[a]+=d,f})}const WZ={kernelName:e0,backendName:"cpu",kernelFunc:VZ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UZ={kernelName:uw,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;fe(n,"square");const r=s.data.get(n.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];o[a]=l*l}return{dataId:s.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GZ=tt(Th,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),HZ={kernelName:Th,backendName:"cpu",kernelFunc:GZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=s;fe(r,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:x,isSimpleSlice:g,begin:y,end:v,strides:b}=iC(r.shape,o,i,a,l,u,c,d,h);let w;if(m)w=dt({inputs:{x:r},backend:n,attrs:{shape:p}});else if(x||g){I(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const $=sC(y,v,b),k=Fa({inputs:{x:r},backend:n,attrs:{begin:y,size:$}});w=dt({inputs:{x:k},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(k)}else{const $=n.bufferSync(r),k=lP(f,$,b,y);w=n.makeTensorInfo(p,k.dtype,k.values)}return w}const KZ={kernelName:dw,backendName:"cpu",kernelFunc:jZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:d}=e,h=n.data.get(c.dataId).values,f=n.data.get(d.dataId).values,[p,m]=uP(h,f,r,o,i,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const qZ={kernelName:uR,backendName:"cpu",kernelFunc:XZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values[0],[u,c,d]=cP(a,l,r),h=c.length;return[n.makeTensorInfo([h,2],"int32",u),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const QZ={kernelName:cR,backendName:"cpu",kernelFunc:YZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZZ(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.data.get(o.dataId).values,a=dP(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const JZ={kernelName:dR,backendName:"cpu",kernelFunc:ZZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eJ=tt(kh,t=>Math.tan(t)),tJ={kernelName:kh,backendName:"cpu",kernelFunc:eJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nJ=tt(Sh,t=>Math.tanh(t)),sJ={kernelName:Sh,backendName:"cpu",kernelFunc:nJ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rJ(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=Ka(o,r,s.shape),d=!1,h=n.bufferSync(r),f=n.bufferSync(o),p=n.bufferSync(s),m=ta(h,f,s.shape,c,l,a,i,u,p,d);return n.makeTensorInfo(s.shape,m.dtype,m.values)}const oJ={kernelName:nR,backendName:"cpu",kernelFunc:rJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:o}=s;fe(r,"tile");const i=fP(n.bufferSync(r),o);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const aJ={kernelName:Ih,backendName:"cpu",kernelFunc:iJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:o,sorted:i}=s;fe(r,"topk");const a=n.data.get(r.dataId).values,[l,u]=mP(a,r.shape,r.dtype,o,i);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const uJ={kernelName:hw,backendName:"cpu",kernelFunc:lJ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cJ(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=n,[c,d,h,f]=r.shape,[p,m]=u??[d,h],x=[c,p,m,f],g=ge(r.shape),y=g[0],v=g[1],b=g[2],w=ge(x),$=w[0],k=w[1],C=w[2],S=Cn(r.dtype,Q(x));S.fill(l);const T=s.data.get(r.dataId).values,R=s.data.get(o.dataId).values;for(let E=0;E<c;++E){const N=o.shape[0]===1?R:R.subarray(E*8,E*8+8);for(let P=0;P<p;++P)for(let _=0;_<m;++_)for(let M=0;M<f;++M){let D;const W=N[6]*_+N[7]*P+1;if(W===0)continue;const H=(N[0]*_+N[1]*P+N[2])/W,X=(N[3]*_+N[4]*P+N[5])/W,Z=vI(H,h,a),J=vI(X,d,a);switch(i){case"nearest":D=gJ(T,d,h,y,v,b,E,J,Z,M,l);break;case"bilinear":D=xJ(T,d,h,y,v,b,E,J,Z,M,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const se=E*$+P*k+_*C+M;S[se]=D}return s.makeTensorInfo(x,r.dtype,S)}return{dataId:s.write(S,x,r.dtype),shape:r.shape,dtype:r.dtype}}const dJ={kernelName:fw,backendName:"cpu",kernelFunc:cJ};function vI(t,e,n){switch(n){case"reflect":return hJ(t,e);case"wrap":return fJ(t,e);case"nearest":return mJ(t,e);case"constant":default:return pJ(t)}}function hJ(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return wa(0,n,e-1)}function fJ(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return wa(0,n,e-1)}function pJ(t,e){return t}function mJ(t,e){return wa(0,t,e-1)}function mc(t,e,n,s,r,o,i,a,l,u,c){const d=i*s+a*r+l*o+u;return 0<=a&&a<e&&0<=l&&l<n?t[d]:c}function gJ(t,e,n,s,r,o,i,a,l,u,c){const d=Math.round(a),h=Math.round(l);return mc(t,e,n,s,r,o,i,d,h,u,c)}function xJ(t,e,n,s,r,o,i,a,l,u,c){const d=Math.floor(a),h=Math.floor(l),f=d+1,p=h+1,m=(p-l)*mc(t,e,n,s,r,o,i,d,h,u,c)+(l-h)*mc(t,e,n,s,r,o,i,d,p,u,c),x=(p-l)*mc(t,e,n,s,r,o,i,f,h,u,c)+(l-h)*mc(t,e,n,s,r,o,i,f,p,u,c);return(f-a)*m+(a-d)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yJ(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:o}=e;fe(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:u}=gP(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const vJ={kernelName:pw,backendName:"cpu",kernelFunc:yJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bJ(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],l=new Array(i-1);let u=0;for(let f=0;f<i;f++)f!==o&&(l[u++]=r.shape[f]);const c=new Array(i).fill(0),d=r.shape.slice();d[o]=1;const h=new Array(a);for(let f=0;f<h.length;f++){c[o]=f;const p=Fa({inputs:{x:r},backend:n,attrs:{begin:c,size:d}});h[f]=dt({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return h}const wJ={kernelName:n0,backendName:"cpu",kernelFunc:bJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:o}=e,{numSegments:i}=s;fe(r,"unsortedSegmentSum");const a=r.shape.length,l=o.shape.length,u=[],c=[],d=a-l;let h=o;for(let p=0;p<d;++p){const m=gm({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=m,c.push(m)}for(let p=0;p<i;++p){const m=Ii(p,"int32"),x=n.makeTensorInfo([],"int32",m),g=AO({inputs:{a:x,b:h},backend:n}),y=vi({inputs:{x:g},backend:n,attrs:{dtype:"float32"}}),v=N0({inputs:{a:y,b:r},backend:n}),b=Gh({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});u.push(b),c.push(x),c.push(g),c.push(y),c.push(v),c.push(b)}const f=AP({inputs:u,backend:n,attrs:{axis:0}});return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const $J={kernelName:s0,backendName:"cpu",kernelFunc:CJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kJ=[yX,ZK,bX,CX,r9,kX,IX,EX,RX,DX,OX,_X,MX,VX,UX,jX,XX,YX,ZX,gX,eq,nq,rq,i9,iq,n9,l9,lq,JK,cq,hq,fq,mq,xq,vq,wq,$q,Sq,Tq,Nq,Aq,Fq,Pq,Lq,Mq,Bq,Wq,Gq,Hq,jq,Kq,qq,Zq,uX,eY,u9,lY,c9,uY,h9,mY,gY,yY,p9,g9,bY,CY,kY,IY,y9,b9,e9,EY,dq,RY,DY,OY,cX,C9,k9,_Y,I9,MY,VY,UY,jY,XY,YY,QY,E9,JY,tQ,sQ,oQ,aQ,uQ,dQ,R9,fQ,gQ,vQ,D9,O9,CQ,SQ,EQ,_9,RQ,DQ,FQ,DP,LQ,hX,z9,zQ,VQ,UQ,HQ,t9,Pv,KQ,fX,pX,mX,qQ,QQ,JQ,tZ,sZ,rZ,iZ,K9,lZ,fZ,mZ,vZ,q9,wZ,$Z,SZ,Y9,xQ,EZ,RZ,DZ,OZ,_Z,MZ,BZ,WZ,J9,UZ,tX,sX,HZ,KZ,qZ,QZ,JZ,aX,Yq,tJ,sJ,oJ,aJ,uJ,dJ,L9,vJ,wJ,$J,AQ];for(const t of kJ)fR(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qi={},If={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function SJ(t,e){qi[t]=e}function Ir(t,e){if(!(t in qi)||e!=null){const s=TJ(t,e);if(s!==null)qi[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=qi[t];return n==null||n.isContextLost()?(delete qi[t],Ir(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),qi[t])}function IJ(t){if(!K().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function TJ(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??IJ(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete qi[t]},!1),K().getBool("SOFTWARE_WEBGL_ENABLED")&&(If.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",If)||n.getContext("experimental-webgl",If):n.getContext("webgl2",If)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xd;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(xd||(xd={}));var vs;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(vs||(vs={}));var dn;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(dn||(dn={}));function Hh(t,e){return[e,t]}function EJ(t,e){return t*e}function Tf(t){const e=Q(t),n=Math.ceil(e/4);return sv(n)}function Eu(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function NJ(t,e){const[n,s]=Eu(t,e);return n*s*4}function s$(t,e){const n=t;let s,r,o,i,a,l,u,c,d,h;return K().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,o=n.RGBA16F,i=n.RGBA32F,a=n.RED,u=4,c=1,d=n.HALF_FLOAT,h=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,o=t.RGBA,i=n.RGBA,a=t.RGBA,u=4,c=4,d=e!=null?e.HALF_FLOAT_OES:null,h=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function le(t,e){const n=e();return K().getBool("DEBUG")&&RJ(t),n}function RJ(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+OJ(t,e))}const AJ=596e-10,DJ=65504;function FJ(t){return!!(K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||AJ<Math.abs(t)&&Math.abs(t)<DJ)}function OJ(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Ef(t,e){return Oo(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function PJ(t,e){const n=Oo(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(le(t,()=>t.shaderSource(n,e)),le(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function _J(t,e){const n=Oo(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(le(t,()=>t.shaderSource(n,e)),le(t,()=>t.compileShader(n)),K().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw FP(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const LJ=/ERROR: [0-9]+:([0-9]+):/g;function FP(t,e){const n=LJ.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),o=r.length.toString().length+2,i=r.map((d,h)=>Ml((h+1).toString(),o)+d);let a=0;for(let d=0;d<i.length;d++)a=Math.max(i[d].length,a);const l=i.slice(0,s-1),u=i.slice(s-1,s),c=i.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Ml(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function MJ(t){return Oo(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function zJ(t,e){if(le(t,()=>t.linkProgram(e)),!K().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Fx(t,e){if(le(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function BJ(t,e){const n=Oo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return le(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),le(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function VJ(t,e){const n=Oo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return le(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),le(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function WJ(t){return Oo(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function UJ(t,e){const n=K().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function GJ(t){return Oo(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function bI(t,e,n,s,r,o,i){const a=t.getAttribLocation(e,n);return a===-1?!1:(le(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),le(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,o,i)),le(t,()=>t.enableVertexAttribArray(a)),!0)}function HJ(t,e,n){YJ(t,n),le(t,()=>t.activeTexture(t.TEXTURE0+n)),le(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function jJ(t,e,n){return Oo(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function KJ(t,e,n){return t.getUniformLocation(e,n)}function XJ(t,e,n,s){le(t,()=>HJ(t,e,s)),le(t,()=>t.uniform1i(n,s))}function Ox(t,e,n){le(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),le(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function wI(t,e){le(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),le(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Nf(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+qJ(t,e))}function qJ(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Oo(t,e,n){const s=le(t,()=>e());if(s==null)throw new Error(n);return s}function YJ(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function cu(t,e=2){return Q(t.slice(0,t.length-e))}function du(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Rf(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[cu(t),...du(t)]),e}function QJ(t,e=!1){let n=K().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=K().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&K().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?kb(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Si(t).newShape);let r=Q(t),o=null;t.length<=1&&r<=n?o=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?o=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?o=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?o=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?o=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(o=[t[0],t[1]*t[2]*t[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=cu(t);let l=2,u=2;t.length&&([l,u]=du(t)),r=a*(l/2)*(u/2),o=sv(r).map(c=>c*2)}else o=sv(r);return o}function Af(t){return t%2===0}function ym(t,e){if(t=t.slice(-2),e=e.slice(-2),qe(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||Af(n)&&Af(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Af(t[0])&&Af(e[0])}let Px,_x;function ZJ(t){if(Px==null){const e=Ir(t);Px=e.getParameter(e.MAX_TEXTURE_SIZE)}return Px}function JJ(t){if(_x==null){const e=Ir(t);_x=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,_x)}function eee(t){if(t===0)return 0;let e;const n=Ir(t);return js(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:js(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function js(t,e){return t.getExtension(e)!=null}function CI(t){try{if(Ir(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function tee(t){if(t===0)return!1;const e=Ir(t);if(t===1){if(!js(e,"OES_texture_float"))return!1}else if(!js(e,"EXT_color_buffer_float"))return!1;return Lv(e)}function nee(t){if(t===0)return!1;const e=Ir(t);if(t===1){if(!js(e,"OES_texture_float")||!js(e,"WEBGL_color_buffer_float"))return!1}else{if(js(e,"EXT_color_buffer_float"))return Lv(e);const s="EXT_color_buffer_half_float";if(js(e,s)){const r=e.getExtension(s);return see(e,r)}return!1}return Lv(e)}function Lv(t){const e=s$(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(o),i}function see(t,e){const n=s$(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(i),a}function ree(t){return t!==2?!1:Ir(t).fenceSync!=null}function jh(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&I(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const me=K();me.registerFlag("HAS_WEBGL",()=>me.getNumber("WEBGL_VERSION")>0);me.registerFlag("WEBGL_VERSION",()=>CI(2)?2:CI(1)?1:0);me.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);me.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>me.get("WEBGL_VERSION")===2);me.registerFlag("WEBGL_CPU_FORWARD",()=>!0);me.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);me.registerFlag("WEBGL_PACK",()=>me.getBool("HAS_WEBGL"));me.registerFlag("WEBGL_PACK_NORMALIZATION",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_CLIP",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_REDUCE",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_LAZILY_UNPACK",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_CONV_IM2COL",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>me.getBool("WEBGL_PACK"));me.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>ZJ(me.getNumber("WEBGL_VERSION")));me.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>JJ(me.getNumber("WEBGL_VERSION")));me.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=me.getNumber("WEBGL_VERSION");return t===0?0:eee(t)});me.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>me.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!RR());me.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>tee(me.getNumber("WEBGL_VERSION")));me.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>me.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:me.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));me.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>nee(me.getNumber("WEBGL_VERSION")));me.registerFlag("WEBGL_FENCE_API_ENABLED",()=>ree(me.getNumber("WEBGL_VERSION")));me.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>me.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);me.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});me.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>RR()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});me.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);me.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);me.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);me.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);me.registerFlag("WEBGL_EXP_CONV",()=>!1);me.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>me.getBool("IS_TEST"));me.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);me.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);me.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);me.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bn(){let t,e,n,s,r,o,i,a,l,u;return K().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=K().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ya(t,e,n="index"){const s=ge(e);return s.map((r,o)=>{const i=`int ${t[o]} = ${n} / ${r}`,a=o===s.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r}`:`index -= ${t[o]} * ${r}`;return`${i}; ${a};`}).join("")}function R0(t,e,n="index"){const s=ge(e);return s.map((r,o)=>{const i=`int ${t[o]} = ${n} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * outShapeStrides[${o}]`:`index -= ${t[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function oee(t,e){const n=t.length,s=t.map(o=>`${e}[${o}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let o=n-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function iee(t,e,n="index"){const s=t.map((o,i)=>i),r=oee(s,e);return r.map((o,i)=>{const a=`int ${t[i]} = ${n} / ${r[i]}`,l=i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r[i]}`:`index -= ${t[i]} * ${r[i]}`;return`${a}; ${l};`}).join("")}function r$(t){const e=ge(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function o$(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const OP=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:PP}=YH;function aee(t,e,n){const s=[];if(t.forEach(f=>{const p=Q(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),n.enableShapeUniforms){const{uniformShape:m}=i$(n.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),o=t.map(f=>lee(f,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=e.texShape,a=Bn(),l=dee(a);let u,c,d=pee(a);return e.isPacked?(u=uee(e.logicalShape,i,n.enableShapeUniforms),c=fee(a)):(u=cee(e.logicalShape,i,n.enableShapeUniforms),c=hee(a)),n.packedInputs&&(d+=yee),[d,l,c,r,u,o,n.userCode].join(`
`)}function Nu(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return Ree(t,e);case 1:return Dee(t,e);case 2:return Oee(t,e);case 3:return _ee(t,e);case 4:return Mee(t,e);case 5:return zee(t);case 6:return Bee(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function _P(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return Nee(t);case 1:return Aee(t,e);case 2:return Fee(t,e);case 3:return Pee(t,e);default:return Lee(t,e)}}function lee(t,e,n=!1,s){let r="";n?r+=_P(t,s):r+=Nu(t,s);const o=t.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(n?r+=Vee(t,e):r+=Wee(t,e)),r}function uee(t,e,n){switch(t.length){case 0:return LP();case 1:return vee(t,e,n);case 2:return Tee(t,e,n);case 3:return wee(t,e,n);default:return $ee(t,e,n)}}function cee(t,e,n){switch(t.length){case 0:return LP();case 1:return bee(t,e,n);case 2:return Eee(t,e,n);case 3:return Cee(t,e,n);case 4:return kee(t,e,n);case 5:return See(t,e);case 6:return Iee(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function dee(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function hee(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function fee(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function pee(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${mee}
    ${gee}
    ${xee}
  `}const mee=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gee=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xee=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yee=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function LP(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function vee(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function bee(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function wee(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Cee(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${R0(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Ya(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function $ee(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2);let i=o,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)i*=t[t.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function kee(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${R0(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Ya(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function See(t,e){const n=Ya(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Iee(t,e){const n=Ya(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Tee(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(qe(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function Eee(t,e,n){return qe(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Qa(t){return`offset${t}`}function Nee(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Bn();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function Ree(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const i=Qa(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function Aee(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=Bn();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${n}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${n}, uv);
    }
  `}function Dee(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Ru(t)}
      }
    `;const r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Qa(n);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function Fee(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],l=Bn();if(o!=null&&qe(n,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function Oee(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape;if(o!=null&&qe(n,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const h=o[0],f=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Si(n),l=i;if(l.length<n.length){const h=Au(t,l),f=["row","col"];return`
      ${Nu(h,e)}
      float ${r}(int row, int col) {
        return ${r}(${Du(f,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Ru(t)}
      }
    `;const u=o[0],c=o[1],d=Qa(s);return c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${s}, uv);
  }
`}function Pee(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){const h=n.slice(1),f=[1,2],p=Au(t,h),m=["b","row","col"];return`
        ${_P(p,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Du(m,f)});
        }
      `}const a=Bn();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],u=i[1],c=Math.ceil(n[2]/2),d=c*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${d}, ${c}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function _ee(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[1]*n[2],i=n[2],{newShape:a,keptDims:l}=Si(n),u=a;if(u.length<n.length){const m=Au(t,u),x=["row","col","depth"];return`
        ${Nu(m,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Du(x,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Ru(t)}
      }
    `;const c=t.shapeInfo.texShape,d=c[0],h=c[1],f=t.shapeInfo.flatOffset;if(h===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(h===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=Qa(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${p};
        vec2 uv = uvFromFlat(${d}, ${h}, index);
        return sampleTexture(${s}, uv);
      }
  `}function Lee(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Bn();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const o=t.shapeInfo.logicalShape,i=o.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],d=Math.ceil(o[i-1]/2);let h=d*Math.ceil(o[i-2]/2),f="int b, int row, int col",p=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<i-1;m++)f=`int b${m}, `+f,h*=o[i-m-1],p=`b${m} * ${h} + `+p;return`
    vec4 ${s}(${f}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${r.texture2D}(${n}, uv);
    }
  `}function Mee(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[3],i=n[2]*o,a=n[1]*i,{newShape:l,keptDims:u}=Si(n);if(l.length<n.length){const y=Au(t,l),v=["row","col","depth","depth2"];return`
      ${Nu(y,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Du(v,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Ru(t)}
      }
    `;const c=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1],p=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===o&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;const g=Qa(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${g});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${h}, ${f}, index + ${g});
      return sampleTexture(${s}, uv);
    }
  `}function zee(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:l,keptDims:u}=Si(e);if(l.length<e.length){const m=Au(t,l),x=["row","col","depth","depth2","depth3"];return`
      ${Nu(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Du(x,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Ru(t)}
      }
    `;const c=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1];if(f===a&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===r&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=Qa(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${h}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Bee(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:o}=Si(e);if(r.length<e.length){const x=Au(t,r),g=["row","col","depth","depth2","depth3","depth4"];return`
      ${Nu(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Du(g,o)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Ru(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1];if(p===c&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===i&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=Qa(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Ru(t){const e=t.name,n=Q(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Vee(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=PP(t.shapeInfo.logicalShape,e.logicalShape),l=st(i),u=i-o;let c;const d=["x","y","z","w","u","v"];o===0?c="":i<2&&a.length>=1?c="coords = 0;":c=a.map(y=>`coords.${d[y+u]} = 0;`).join(`
`);let h="";i<2&&o>0?h="coords":h=t.shapeInfo.logicalShape.map((y,v)=>`coords.${d[v+u]}`).join(", ");let f="return outputValue;";const m=Q(t.shapeInfo.logicalShape)===1,g=Q(e.logicalShape)===1;if(o===1&&!m&&!g)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)i===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const y=o-2,v=o-1;a.indexOf(y)>-1&&a.indexOf(v)>-1?f="return vec4(outputValue.x);":a.indexOf(y)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${s}(${h});
      ${f}
    }
  `}function Wee(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&qe(i,o))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const u=st(l),c=PP(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let h;const f=["x","y","z","w","u","v"];a===0?h="":l<2&&c.length>=1?h="coords = 0;":h=c.map(m=>`coords.${f[m+d]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,x)=>`coords.${f[x+d]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${h}
      return get${s}(${p});
    }
  `}function st(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function i$(t,e,n){const{newShape:s,keptDims:r}=Si(e),o=e.length,i=t&&o===3&&e[0]===1,a=i?e.slice(1):s,l=!t&&o>1&&!qe(e,n)&&s.length<o||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Au(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Du(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uee(t,e,n,s){const r=n.map((c,d)=>{const h={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(h.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:h}}),o=r.map(c=>c.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=aee(r,i,e),l=_J(t.gl,a),u=t.createProgram(l);return K().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i},MP(t,e,u)))}function MP(t,e,n){const s=[],r=[];let o,i,a,l=null,u=null;u=t.getUniformLocation(n,"NAN",!1),K().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const d of e.variableNames){const h={name:d,uniform:t.getUniformLocation(n,d,c),offset:t.getUniformLocation(n,`offset${d}`,c)};e.enableShapeUniforms&&(h.shape=t.getUniformLocation(n,`${d}Shape`,c),h.texShape=t.getUniformLocation(n,`${d}TexShape`,c)),s.push(h)}if(e.enableShapeUniforms&&(o=t.getUniformLocation(n,"outShape",c),a=t.getUniformLocation(n,"outShapeStrides",c),i=t.getUniformLocation(n,"outTexShape",c)),e.customUniforms)for(const d of e.customUniforms)r.push(t.getUniformLocation(n,d.name,c));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function $I(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,o=e[s],i=o.shape;if(!qe(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(n.isUniform&&o.isUniform)return;const a=n.texShape,l=o.isUniform?null:o.texData.texShape;if(!qe(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Gee(t,e,n,s,r){e.program.enableShapeUniforms||($I(e.inShapeInfos,n),$I([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):t.setOutputMatrixTexture(o.texture,i[0],i[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),K().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const u=n[l],{uniform:c,offset:d,shape:h,texShape:f}=e.variablesLocations[l];if(h){const{uniformShape:p}=i$(e.program.packedInputs,u.shape,u.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(h,new Int32Array(p));break;case 2:t.gl.uniform2iv(h,new Int32Array(p));break;case 3:t.gl.uniform3iv(h,new Int32Array(p));break;case 4:t.gl.uniform4iv(h,new Int32Array(p));break}}if(f&&t.gl.uniform2i(f,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(Q(u.shape)<2)t.gl.uniform1f(c,u.uniformValues[0]);else{let p=u.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(c,p)}continue}u.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,c,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=ge(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],c=e.customUniformLocations[l],d=r[l];if(u.type==="float")t.gl.uniform1fv(c,d);else if(u.type==="vec2")t.gl.uniform2fv(c,d);else if(u.type==="vec3")t.gl.uniform3fv(c,d);else if(u.type==="vec4")t.gl.uniform4fv(c,d);else if(u.type==="int")t.gl.uniform1iv(c,d);else if(u.type==="ivec2")t.gl.uniform2iv(c,d);else if(u.type==="ivec3")t.gl.uniform3iv(c,d);else if(u.type==="ivec4")t.gl.uniform4iv(c,d);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function Hee(t,e,n){let s="";e.concat(n).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:d}=i$(t.packedInputs,i.shape,l);let h="",f="",p="";if(c.length===1&&t.packedInputs){const w=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];h=`${w[0]>1}_${w[1]>1}`}else if(c.length===2&&!t.packedInputs)f=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){const w=ge(c);p=`${w[0]===l[1]}_${w[w.length-1]===l[1]}`}const m=i.shape.length,x=c.length===2&&qe(i.shape,l),g=Q(i.shape)===1,y=ru(i.shape,n.shape),v=!t.packedInputs&&m===n.shape.length&&qe(l,n.texData.texShape),b=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${m}_${v}_${u?d:""}_${c.length}_${g}_${y}_${x}_${h}_${f}_${p}_${b}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const r=t.userCode;let o=t.constructor.name;return o+="_"+s+"_"+r+`${K().getNumber("WEBGL_VERSION")}`,o}function Tn(t){return K().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jee{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=xd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Bn();this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?R0(["r","c","d"],e):Ya(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kee{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=xd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Bn();this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?R0(["r","c","d"],e):Ya(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xee{constructor(e){this.variableNames=["A"],this.outTexUsage=vs.DOWNLOAD;const n=Bn();this.outputShape=e,this.userCode=`
      ${OP}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qee{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=vs.DOWNLOAD;const n=Bn();this.outputShape=e,this.userCode=`
      ${OP}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yee={R:0,G:1,B:2,A:3};class kI{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Bn();this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length);let o="result";n&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${Yee[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?o$():r$(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qee{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Bn();this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length);let r="",o="result";n&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?o$():r$(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zee(t){const e=Bn(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return PJ(t,n)}function Jee(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return BJ(t,e)}function ete(t){const e=new Uint16Array([0,1,2,2,1,3]);return VJ(t,e)}function Kh(t,e,n,s,r,o){UJ(e,n);const i=WJ(t),a=t.TEXTURE_2D;return le(t,()=>t.bindTexture(a,i)),le(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),le(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),le(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),le(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),K().getNumber("WEBGL_VERSION")===1?le(t,()=>t.texImage2D(a,0,s,e,n,0,r,o,null)):le(t,()=>t.texStorage2D(a,1,s,e,n)),le(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:i,texShape:[n,e]}}function zP(t){return t.internalFormatFloat}function tte(t,e,n,s){const[r,o]=Hh(e,n);return Kh(t,r,o,zP(s),s.textureFormatFloat,t.FLOAT)}function BP(t){return t.internalFormatHalfFloat}function nte(t,e,n,s){const[r,o]=Hh(e,n);return Kh(t,r,o,BP(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function VP(t){return t.downloadTextureFormat}function ste(t,e,n,s){const[r,o]=Hh(e,n);return Kh(t,r,o,VP(s),t.RGBA,t.UNSIGNED_BYTE)}function WP(t){return t.internalFormatPackedFloat}function rte(t,e,n,s){const[r,o]=Eu(e,n);return Kh(t,r,o,WP(s),t.RGBA,t.FLOAT)}function UP(t){return t.internalFormatPackedHalfFloat}function ote(t,e,n,s){const[r,o]=Eu(e,n);return Kh(t,r,o,UP(s),t.RGBA,s.textureTypeHalfFloat)}function ite(t,e,n){return le(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),bI(t,e,"clipSpacePos",n,3,20,0)&&bI(t,e,"uv",n,2,20,12)}function ate(t,e,n,s,r,o){le(t,()=>t.bindTexture(t.TEXTURE_2D,e));let i,a,l;r instanceof Uint8Array?(i=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(i=new Float32Array(n*s*4),a=t.FLOAT,l=o.internalFormatPackedFloat),i.set(r),K().getNumber("WEBGL_VERSION")===2?le(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,i)):le(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,i)),le(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function lte(t,e,n){le(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?K().getNumber("WEBGL_VERSION")===2?le(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):le(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):K().getNumber("WEBGL_VERSION")===2?le(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):le(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),le(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function ute(t,e,n,s){const r=t.createBuffer();le(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return le(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),le(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),le(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function cte(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function dte(t,e,n,s){const[r,o]=Hh(e,n),i=4,a=new Uint8Array(EJ(e*n,i));return le(t,()=>t.readPixels(0,0,r,o,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function hte(t,e,n,s,r,o,i,a){const l=t,u=new Float32Array(NJ(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function fte(t,e,n){const s=new Float32Array(e*n*4);return le(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lx{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=K().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,SJ(n,e)):this.gl=Ir(n),e=this.gl,K().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>le(o,()=>o.createVertexArray()),this.bindVertexArray=i=>le(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>le(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>le(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>le(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>le(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>le(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>le(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),K().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Ef(this.gl,o),js(this.gl,i))this.textureHalfFloatExtension=Ef(this.gl,i);else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),js(this.gl,r))this.colorBufferHalfFloatExtension=Ef(this.gl,r);else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",js(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(js(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Jee(this.gl),this.indexBuffer=ete(this.gl),this.framebuffer=GJ(this.gl),this.textureConfig=s$(this.gl,this.textureHalfFloatExtension)}get debug(){return K().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;le(e,()=>e.finish()),le(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),le(e,()=>e.deleteFramebuffer(this.framebuffer)),le(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),le(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),le(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),tte(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),nte(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),ste(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),lte(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),ate(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),ote(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),rte(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(wI(this.gl,this.framebuffer),this.outputTexture=null),le(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>dte(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,o,i){return hte(this.gl,e,n,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return cte(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=ute(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(K().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},n=o}else K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>fte(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=Zee(n));const s=MJ(n);le(n,()=>n.attachShader(s,this.vertexShader)),le(n,()=>n.attachShader(s,e)),zJ(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Fx(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;le(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),ite(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(le(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Fx(this.gl,this.program),le(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?jJ(this.gl,e,n):KJ(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),le(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),XJ(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,o]=Eu(n,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Fx(this.gl,this.program),Nf(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}le(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),le(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ef(this.gl,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await cS(()=>this.disposed||this.isQueryAvailable(e,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=pte(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in K().platform&&(s=K().platform.setTimeoutCustom.bind(K().platform)),cS(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Ox(this.gl,e,this.framebuffer),this.debug&&Nf(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Ox(this.gl,this.outputTexture,this.framebuffer),this.debug&&Nf(this.gl)):wI(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;Ox(r,e,this.framebuffer),this.debug&&Nf(r),this.outputTexture=e,le(r,()=>r.viewport(0,0,n,s)),le(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),le(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function pte(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:mte,bincountImpl:GP,bincountReduceImpl:gte,bitwiseAndImpl:xte,castImpl:yte,ceilImpl:vte,concatImpl:bte,equalImpl:wte,expImpl:Cte,expm1Impl:$te,floorImpl:kte,gatherNdImpl:Ste,gatherV2Impl:Ite,greaterImpl:Tte,greaterEqualImpl:Ete,lessImpl:Nte,lessEqualImpl:Rte,linSpaceImpl:Ate,logImpl:Dte,maxImpl:Fte,maximumImpl:Ote,minimumImpl:Pte,multiplyImpl:_te,negImpl:Lte,notEqualImpl:Mte,prodImpl:zte,raggedGatherImpl:Bte,raggedRangeImpl:Vte,raggedTensorToTensorImpl:Wte,rangeImpl:Ute,rsqrtImpl:Gte,scatterImpl:Hte,sigmoidImpl:jte,simpleAbsImpl:HP,sliceImpl:Kte,sparseFillEmptyRowsImpl:Xte,sparseReshapeImpl:qte,sparseSegmentReductionImpl:jP,sqrtImpl:Yte,staticRegexReplaceImpl:Qte,stridedSliceImpl:Zte,stringNGramsImpl:Jte,stringSplitImpl:ene,stringToHashBucketFastImpl:tne,subImpl:nne,tileImpl:sne,topKImpl:rne,transposeImpl:a$,uniqueImpl:one}=lX;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KP(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function Pn(t,e){return e===1?[t]:KP(t,e)}function ine(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ane{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Tn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=Pn("rc",this.rank),s=st(this.rank),r=this.getOutOfBoundsCondition(n),o=this.getSetup(n),i=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;n.push(o)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XP{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${lne(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?o$():r$(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function lne(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?iee(["r","c","d"],"inputShape"):Ya(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class une{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=II(n,s),o=TI(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=SI(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return r===dn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===dn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===dn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===dn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===dn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const o=II(s,r),i=TI(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=SI(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=K().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[i],c=u&&u.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function cne(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function SI(t,e,n,s,r){const o=dne(e,s);let i;if(r){const[l,u]=Eu(t[0],t[1]);i=l*u}else{const[l,u]=Hh(t[0],t[1]);i=l*u}const a=cne(n,o);return i*a}function dne(t,e){switch(t){case dn.PACKED_2X2_FLOAT32:return WP(e);case dn.PACKED_2X2_FLOAT16:return UP(e);case dn.UNPACKED_FLOAT32:return zP(e);case dn.UNPACKED_FLOAT16:return BP(e);case dn.PACKED_4X1_UNSIGNED_BYTE:return VP(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function hne(t){return K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?dn.PACKED_2X2_FLOAT32:dn.UNPACKED_FLOAT32:t?dn.PACKED_2X2_FLOAT16:dn.UNPACKED_FLOAT16}function II(t,e){if(t===vs.UPLOAD)return dn.PACKED_2X2_FLOAT32;if(t===vs.RENDER||t==null)return hne(e);if(t===vs.DOWNLOAD||t===vs.PIXELS)return dn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function TI(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wr{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const tr="if (isnan(x)) return x;",fne="return x;",EI="return abs(x);",pne="return (x >= 0.0) ? x : (exp(x) - 1.0);",mne=tr+`
  return (x < 0.0) ? 0.0 : x;
`,gne=tr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Uo="return x;",xne="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yne="return x;",vne=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,bne=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wne=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Cne="return 1.0 / (1.0 + exp(-1.0 * x));";class Yo{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ne{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length);const n=e.length,s=Pn("rc",n),r=st(n),o=ine(n,s),i=s.slice(-2),a=n<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kne=yA,Sne=1e-7,Ine=1e-4,Df={};function Tne(t){return t in Df||(Df[t]={}),Df[t]}const Ene=K().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Nne=600;function Rne(){return K().global.screen==null?1024:K().global.screen.height*K().global.screen.width*window.devicePixelRatio*Nne/1024/1024}class A0 extends $b{nextDataId(){return A0.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!K().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof Lx)n=e;else{const s=Ir(K().getNumber("WEBGL_VERSION"),e);n=new Lx(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Ir(K().getNumber("WEBGL_VERSION"));n=new Lx(s),this.binaryCache=Tne(K().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new une(this.gpgpu),this.numMBBeforeWarning=Rne(),this.texData=new MN(this,Fr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,o,i){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const u=Rf(n),c=new kI(u,!1,i),d=this.runWebGLProgram(c,[a],s,[[r,o]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((K().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||K().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:vs.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,o){if(K().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:vs.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:l}=n;if(i!=null){let h;l?h=new Yo(a,Uo):h=new Wr(a,Uo);const f=this.runWebGLProgram(h,[{dataId:e,shape:a,dtype:r}],r),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let c;u&&(c=Un());let d;if(r==="complex64"){const h=this.readSync(o.real.dataId),f=this.readSync(o.imag.dataId);d=To(h,f)}else d=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Un()-c),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:l}=n;if(o!=null){let p;l?p=new Yo(r,Uo):p=new Wr(r,Uo);const m=this.runWebGLProgram(p,[{dataId:e,shape:r,dtype:i}],i),x=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(K().getBool("DEBUG")&&!K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&K().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(i!=="complex64"&&K().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const p=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(p.texture.texture,...Tf(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(i==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],x=p[1];d=To(m,x)}else if(u==null)d=this.getValuesFromTexture(e);else{const p=Q(r);d=this.gpgpu.downloadFloat32MatrixFromBuffer(u,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){const p=this.gpgpu.gl;le(p,()=>p.deleteBuffer(u))}const h=this.convertAndCacheOnCPU(e,d),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(p=>p(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Fr().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let f;l?f=new Yo(o,Uo):f=new Wr(o,Uo);const p=this.runWebGLProgram(f,[{dataId:e,shape:o,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,n.customTexShape),d=Fr().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>pi(r));return Ae(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ae(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!FJ(s))throw K().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),o=Q(n);if(K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(e),f=this.texData.get(h.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...Tf(n)).subarray(0,o);return this.disposeIntermediateTensorInfo(h),p}const i=K().getBool("WEBGL_PACK")&&r===!0,a=i?Rf(n):n,l=i?new qee(a):new Xee(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),c=this.texData.get(u.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(u),d}timerAvailable(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=Ca(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=Ca(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=gV(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:i[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Un(),endMs:null}}endTimer(e){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Un(),e)}async getQueryTime(e){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,o,i)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=Ene){return K().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&Q(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){xs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return kne(e.shape,n)}packedUnaryOp(e,n,s){const r=new Yo(e.shape,n),o=this.compileAndRun(r,[e],s);return Fr().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=HP(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,EI,e.dtype);const n=new Wr(e.shape,EI),s=this.compileAndRun(n,[e]);return Fr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Dd(s[0])){const o=s.map(i=>ai(i));r=this.write(o,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return Fr().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new $ne(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new ane(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[cu(e.shape),...du(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[cu(n),...du(n)],i=new XP(o,s),a=!0,l=[s],u=this.runWebGLProgram(i,[r],e.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(n!=null){const h=Q(o),f=n[0]*n[1]*4;I(h<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Rf(o);let l;r?l=new Kee(a):l=new jee(a);const u=!0,c=[n??Tf(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,c,u,n);return{dtype:i,shape:o,dataId:d.dataId}}runWebGLProgram(e,n,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===xd.DENSE){const g=i??Tf(e.outputShape);l.texShape=g.map(y=>y*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),Q(a.shape)===0)return l.values=Cn(a.dtype,0),a;const u=[],c=n.map(g=>{if(g.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(g.dataId);if(y.texture==null){if(!e.packedInputs&&Q(g.shape)<=K().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:g.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=g.shape)}if(this.uploadToGPU(g.dataId),!!y.isPacked!=!!e.packedInputs)g=y.isPacked?this.unpackTensor(g):this.packTensor(g),u.push(g),y=this.texData.get(g.dataId);else if(y.isPacked&&!ym(y.shape,g.shape)){const v=g,b=g.shape;g.shape=y.shape,g=this.packedReshape(g,b),u.push(g),y=this.texData.get(g.dataId),v.shape=b}return{shape:g.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},h=Hee(e,c,d),f=this.getAndSaveBinary(h,()=>Uee(this.gpgpu,e,c,d)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),K().get("ENGINE_COMPILE_ONLY")||Gee(this.gpgpu,f,c,d,r),u.forEach(g=>this.disposeIntermediateTensorInfo(g)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const x=K().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const g=Un();g-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=g)}if(!K().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const g=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),g}return a}compileAndRun(e,n,s,r,o=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,o)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(K().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=j(()=>{if(!K().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=K().getBool("DEBUG");K().set("DEBUG",!1);const n=this.abs(Xe(1e-8)).dataSync()[0];if(K().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Sne:Ine}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:l}=n;if(i!=null)return;const u=this.activeTimers!=null;let c;u&&(c=Un());let d=n.texShape;if(d==null&&(d=QJ(s,l),n.texShape=d),o!=null){const h=Rf(s);let f,p=d[1],m=d[0];const x=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!x)&&([p,m]=Eu(d[0],d[1])),l?f=new Qee(h,x):f=new kI(h,x);const g=x?[m,p]:d,y=this.makeTensorInfo(g,r),v=this.texData.get(y.dataId);x?v.usage=vs.PIXELS:v.usage=vs.UPLOAD,v.texShape=g,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),p,m,o);const b=[[m,p]],$=this.runWebGLProgram(f,[y],r,b,!0),k=this.texData.get($.dataId);n.texShape=k.texShape,n.isPacked=k.isPacked,n.usage=k.usage,K().get("ENGINE_COMPILE_ONLY")?this.disposeData($.dataId):(n.texture=k.texture,n.values=null,this.texData.delete($.dataId)),this.disposeIntermediateTensorInfo(y),u&&(this.uploadWaitMs+=Un()-c)}else{const h=this.acquireTexture(d,a,r,l);n.texture=h}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=Ane(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*Kp(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await PA(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(FP(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=MP(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,l=Fr().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,n,s,o,i,a);return Fr().makeTensorFromDataId(u,n,s,l)}}A0.nextDataId=0;function Ane(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */AR()&&OR("webgl",()=>new A0,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l$=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Oa{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Ie(n,s),this.enableShapeUniforms=Tn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Za=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Fu{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ie(n,s);const o=this.outputShape.length;this.enableShapeUniforms=Tn(o);let i="";if(r)if(o===0||Q(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${st(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Pn("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ds(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Dne={kernelName:Jd,backendName:"webgl",kernelFunc:ds};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fi(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,o=n.makeTensorInfo(s.shape,"complex64"),i=n.texData.get(o.dataId),a=ds({inputs:{x:s},backend:n}),l=ds({inputs:{x:r},backend:n});return i.complexTensorInfos={real:a,imag:l},o}const Fne={kernelName:_b,backendName:"webgl",kernelFunc:Fi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qP="return (a < 0.) ? b * a : a;",YP=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function One(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:o}=s,i=n.makeTensorInfo([],"float32",Ii(o,"float32")),a=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fu(YP,r.shape,i.shape):new Oa(qP,r.shape,i.shape),l=n.runWebGLProgram(a,[r,i],"float32");return n.disposeIntermediateTensorInfo(i),l}const Pne={kernelName:Sg,backendName:"webgl",kernelFunc:One};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QP="return (a < 0.) ? b * a : a;",ZP=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function _ne(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fu(ZP,s.shape,r.shape):new Oa(QP,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],"float32")}const Lne={kernelName:Gg,backendName:"webgl",kernelFunc:_ne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ou="if (isnan(x)) return x;";function Ve({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&n!=null){const d=a.texData.get(i.dataId),h=n(d.values,l);return a.makeTensorInfo(i.shape,l,h)}const u=K().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return u?c=new Yo(i.shape,e):c=new Wr(i.shape,t),a.runWebGLProgram(c,[i],l)}}function gn({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:l,b:u}=i,c=a;if(s&&l.dtype==="complex64"){const p=c.texData.get(l.dataId),m=c.texData.get(u.dataId),[x,g]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(v=>{const[b,w]=v,$={dataId:b.dataId,dtype:b.dtype,shape:l.shape},k={dataId:w.dataId,dtype:w.dtype,shape:u.shape},C=new Oa(t,l.shape,u.shape);return c.runWebGLProgram(C,[$,k],us(b.dtype,w.dtype))}),y=Fi({inputs:{real:x,imag:g},backend:c});return c.disposeIntermediateTensorInfo(x),c.disposeIntermediateTensorInfo(g),y}const d=o||us(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&r!=null){const p=c.texData.get(l.dataId).values,m=c.texData.get(u.dataId).values,x=l.dtype==="string"?Eo(p):p,g=l.dtype==="string"?Eo(m):m,[y,v]=r(l.shape,u.shape,x,g,d),b=c.makeTensorInfo(v,d),w=c.texData.get(b.dataId);return w.values=y,b}const h=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return h?f=new Fu(e,l.shape,u.shape,n):f=new Oa(t,l.shape,u.shape),c.runWebGLProgram(f,[l,u],d)}}function yd(t,e=!1){if(t==="linear")return e?yne:fne;if(t==="relu")return e?bne:mne;if(t==="elu")return e?vne:pne;if(t==="relu6")return e?wne:gne;if(t==="prelu")return e?ZP:QP;if(t==="leakyrelu")return e?YP:qP;if(t==="sigmoid")return e?Cne:xne;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JP{constructor(e,n,s,r=!1,o=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Tn(this.outputShape.length);const c=r?e[1]:e[2],d=Math.ceil(c/2),h=r?"i * 2, rc.y":"rc.y, i * 2",f=o?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",g="";a&&(l?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,g="result = activation(result);");const y=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let v="rc.x",b="rc.x";e[0]<n[0]?v=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(b=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${b};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${g}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NI={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class RI{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ie(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AI="return a * b;";function u$(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,o=us(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),u=new RI(NI.REAL,s.shape,r.shape),c=new RI(NI.IMAG,s.shape,r.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],h=n.runWebGLProgram(u,d,"float32"),f=n.runWebGLProgram(c,d,"float32"),p=Fi({inputs:{real:h,imag:f},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[u,c]=_te(s.shape,r.shape,a.values,l.values,o),d=n.makeTensorInfo(c,o),h=n.texData.get(d.dataId);return h.values=u,d}let i;return K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Fu(AI,s.shape,r.shape):i=new Oa(AI,s.shape,r.shape),n.runWebGLProgram(i,[s,r],o)}const Mne={kernelName:lh,backendName:"webgl",kernelFunc:u$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zne(t,e,n){const s=[cu(t.shape),...du(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},o=[cu(e),...du(e)],i=new XP(o,s),a=!0,l=[s],u=n.runWebGLProgram(i,[r],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:o}=s,i=n,a=Q(r.shape),l=BN(o,a),u=Q(l);I(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=i.texData.get(r.dataId);return c.isPacked&&!ym(r.shape,l)&&!(c.texture!==null&&ym(c.shape,l))?zne(r,l,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const Bne={kernelName:jg,backendName:"webgl",kernelFunc:ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DI{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(n!=null){const d=1/n;u=`sumValue += dot(values * ${eu(d)?d.toPrecision(2):d}, ones);`}let c="";o%s>0&&(c=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vne{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");const c=Math.floor(s/4)*4,d=s%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wne(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=m0(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function Ja(t,e,n,s){const r=Wne(t.shape);let o=t;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:l,outSize:u}=r[i];let c,d;n==="mean"?c=i===0?new DI({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new DI({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new Vne({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},n),d=o,o=s.runWebGLProgram(c,[o],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Une{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[n[i]];this.outputShape=s,this.rank=s.length;const r=st(this.rank),o=Gne(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function Gne(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hne{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let c=0;c<s.length;c++)s[c]=e[n[c]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=st(this.rank),o=KP("rc",this.rank),i=new Array(this.rank);for(let c=0;c<n.length;c++)i[n[c]]=o[c];const a=`vec2(${i.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0(t,e,n){const s=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hne(t.shape,e):new Une(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jne(t,e,n,s){const r=e,o=t.shape.length,i=De(r,t.shape);let a=i;const l=Tt(a,o),u=l!=null;let c=t;u&&(c=D0(t,l,s),a=Pt(a.length,o)),mn("sum",a,o);const[d,h]=ln(c.shape,a);let f=d;n&&(f=Vt(d,i));const p=Q(h),x=Q(t.shape)/p,g=ie({inputs:{x:c},attrs:{shape:[x,p]},backend:s}),y=xw(t.dtype),v=Ja(g,y,"sum",s),b=ie({inputs:{x:v},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(g),s.disposeIntermediateTensorInfo(v),u&&s.disposeIntermediateTensorInfo(c),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F0(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;return jne(r,o,i,n)}const Kne={kernelName:Zg,backendName:"webgl",kernelFunc:F0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:o}=s,i=n,a=r.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=r.shape[o[c]];let u;if(i.shouldExecuteOnCPU([r])){const d=i.texData.get(r.dataId).values,h=a$(d,r.shape,r.dtype,o,l);u=i.makeTensorInfo(l,r.dtype);const f=i.texData.get(u.dataId);f.values=h}else u=D0(r,o,i);return u}const Xne={kernelName:zl,backendName:"webgl",kernelFunc:zn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e_=1e3;function vm({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,c=e.shape.length,d=n?t.shape[u-2]:t.shape[u-1],h=s?e.shape[c-1]:e.shape[c-2],f=n?t.shape[u-1]:t.shape[u-2],p=s?e.shape[c-2]:e.shape[c-1],m=t.shape.slice(0,-2),x=e.shape.slice(0,-2),g=Q(m),y=Q(x),b=Ie(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,p]);I(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const w=n?[g,d,f]:[g,f,d],$=s?[y,p,h]:[y,h,p],k=ie({inputs:{x:t},backend:r,attrs:{shape:w}}),C=ie({inputs:{x:e},backend:r,attrs:{shape:$}}),S=[k,C],T=Math.max(g,y),R=n?k.shape[1]:k.shape[2],A=o!=null,E=i!=null,N=l==="leakyrelu",P=l!=null?yd(l,!0):null,_=A||E||N||P!=null;let M;if((f===1||p===1)&&R>e_&&_===!1){let W=k,H=C;n&&(W=zn({inputs:{x:k},backend:r,attrs:{perm:[0,2,1]}}),S.push(W)),s&&(H=zn({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),S.push(H));const X=p!==1,Z=p===1;let J=W;X&&(J=ie({inputs:{x:W},backend:r,attrs:{shape:[T,R,1]}}),S.push(J));const se=p===1?2:1;let te=H;Z&&(te=ie({inputs:{x:H},backend:r,attrs:{shape:[T,1,R]}}),S.push(te));const oe=u$({inputs:{a:J,b:te},backend:r});M=F0({inputs:{x:oe},backend:r,attrs:{axis:se,keepDims:!0}}),S.push(oe)}else{const W=us(t.dtype,e.dtype),H=new JP(w,$,[T,f,p],n,s,A,P,E,N),X=[k,C];if(o!=null&&X.push(o),E&&X.push(i),N){const Z=r.makeTensorInfo([],"float32",Ii(a,"float32"));X.push(Z),S.push(Z)}M=r.runWebGLProgram(H,X,W)}const D=ie({inputs:{x:M},backend:r,attrs:{shape:b}});S.push(M);for(const W of S)r.disposeIntermediateTensorInfo(W);return D}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qne(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=s;return vm({a:r,b:o,transposeA:l,transposeB:u,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:c})}const Yne={kernelName:Xp,backendName:"webgl",kernelFunc:qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FI="return abs(x);";function Qne(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=n.texData.get(s.dataId),i=HP(o.values);return n.makeTensorInfo(s.shape,s.dtype,i)}let r;return K().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Yo(s.shape,FI):r=new Wr(s.shape,FI),n.runWebGLProgram(r,[s],s.dtype)}const Zne={kernelName:og,backendName:"webgl",kernelFunc:Qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jne=tr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ese=Ve({opSnippet:Jne}),tse={kernelName:Fd,backendName:"webgl",kernelFunc:ese};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nse=tr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,sse=Ve({opSnippet:nse}),rse={kernelName:Od,backendName:"webgl",kernelFunc:sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OI="return a + b;",ose=gn({opSnippet:OI,packedOpSnippet:OI,supportsComplex:!0,cpuKernelImpl:mte}),ise={kernelName:wu,backendName:"webgl",kernelFunc:ose};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ase{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lse{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hp(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return ds({inputs:{x:s[0]},backend:n});if(s.length>K().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=hp({inputs:s.slice(0,l),backend:n}),c=hp({inputs:s.slice(l),backend:n});return hp({inputs:[u,c],backend:n})}const r=s.map(l=>l.dtype).reduce((l,u)=>us(l,u)),o=s.map(l=>l.shape),a=K().getBool("WEBGL_PACK")?new lse(s[0].shape,o):new ase(s[0].shape,o);return n.runWebGLProgram(a,s,r)}const use={kernelName:Nb,backendName:"webgl",kernelFunc:hp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=De(o,r.shape);let u=l;const c=Tt(u,a);let d=r;c!=null&&(d=zn({inputs:{x:r},backend:n,attrs:{perm:c}}),u=Pt(u.length,a)),mn("all",u,a);const[h,f]=ln(d.shape,u),p=Q(f),m=ie({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),x=Ja(m,m.dtype,"all",n);let g;if(i){const y=Vt(h,l);g=ie({inputs:{x},backend:n,attrs:{shape:y}})}else g=ie({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(d),g}const dse={kernelName:Rb,backendName:"webgl",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=De(o,r.shape);let u=l;const c=Tt(u,a);let d=r;c!=null&&(d=zn({inputs:{x:r},backend:n,attrs:{perm:c}}),u=Pt(u.length,a)),mn("any",u,a);const[h,f]=ln(d.shape,u),p=Q(f),m=ie({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),x=Ja(m,m.dtype,"any",n);let g;if(i){const y=Vt(h,l);g=ie({inputs:{x},backend:n,attrs:{shape:y}})}else g=ie({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(d),g}const fse={kernelName:Ab,backendName:"webgl",kernelFunc:hse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pse{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mse{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,I(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/n);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=st(l),c=Pn("coords",l);let d,h;if(i===1){h=l+1;const C=st(h);d=`
        ${C} sourceLocR = ${C}(${c.join()}, 0);
        ++${c[l-1]};
        ${C} sourceLocG = ${C}(${c.join()}, 0);
        ++${c[l-2]};
        ${C} sourceLocA = ${C}(${c.join()}, 0);
        --${c[l-1]};
        ${C} sourceLocB = ${C}(${c.join()}, 0);
        --${c[l-2]};`}else h=l,d=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;const f=["x","y","z","w","u","v"].slice(0,h),p="."+f[h-1],m=f.map(C=>"int "+C),x=Pn("sourceLocR",h-1).concat("inIdx.r"),g=Pn("sourceLocG",h-1).concat("inIdx.g"),y=Pn("sourceLocB",h-1).concat("inIdx.b"),v=Pn("sourceLocA",h-1).concat("inIdx.a"),b=s==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${v.join()})));`,$=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${g.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,k=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${k}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${$};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${$};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_(t,e,n,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=m0(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},l=new pse(a,n,s==null),u=[e];s!=null&&u.push(s);const c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;const d=t_(t,e,n,c);return t.disposeIntermediateTensorInfo(c),d}function n_(t,e,n,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=m0(o),a=new mse(r,i,n,s==null),l=s==null?[e]:[e,s],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const c=n_(t,e,n,u);return t.disposeIntermediateTensorInfo(u),c}return u}function s_(t,e,n,s){const r=[n];if(mn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!K().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=t.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=t.unpackTensor(e),o.push(l));const[u,c]=ln(l.shape,r),d=Q(c),h=ie({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});o.push(h);const f=t_(t,h,s);o.push(f);const p=ie({inputs:{x:f},backend:t,attrs:{shape:u}});return o.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return n_(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=De(o,r.shape);const a=Tt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=zn({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=Pt(i.length,l.shape.length)),mn("argMax",[i[0]],l.shape.length);const c=s_(n,l,i[0],"max");return u.forEach(d=>n.disposeIntermediateTensorInfo(d)),c}const xse={kernelName:ig,backendName:"webgl",kernelFunc:gse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=De(o,r.shape);const a=Tt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=zn({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=Pt(i.length,l.shape.length)),mn("argMin",[i[0]],l.shape.length);const c=s_(n,l,i[0],"min");return u.forEach(d=>n.disposeIntermediateTensorInfo(d)),c}const vse={kernelName:ag,backendName:"webgl",kernelFunc:yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bse=tr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,wse=Ve({opSnippet:bse}),Cse={kernelName:Pd,backendName:"webgl",kernelFunc:wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $se=tr+"return log(x + sqrt(x * x + 1.0));",kse=Ve({opSnippet:$se}),Sse={kernelName:_d,backendName:"webgl",kernelFunc:kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ise=tr+`
  return atan(x);
`,Tse=Ve({opSnippet:Ise}),Ese={kernelName:Ld,backendName:"webgl",kernelFunc:Tse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nse=l$+`
  return atan(a, b);
`,Rse=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Za+`
  return result;
`,Ase=gn({opSnippet:Nse,packedOpSnippet:Rse}),Dse={kernelName:zd,backendName:"webgl",kernelFunc:Ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fse=tr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ose=Ve({opSnippet:Fse}),Pse={kernelName:Md,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vd{constructor(e,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(m||(y="-1.0 / 1e-20"),s){const C=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${C} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?x:g:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let b=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(b="avgValue / max(count, 1.0)");const w=Math.floor(i/4)*4,$=i%4,k=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${k}
          }

          int xC = xCCorner + ${w};
          if (${$===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${$===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${$===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${k}
          }
        }
        setOutput(${b});
      }
    `}}class c${constructor(e,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,d=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,x=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const v=n==="avg";let b="0.0";if(v||(b="-1.0 / 1e-20"),s){const T=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${x}, ${g}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${T} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let $=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&($="avgValue / max(count, 1.0)");const k=Math.floor(i/4)*4,C=i%4,S=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${x}, ${g}, ${y});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${k}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${S}
            }

            int xC = xCCorner + ${k};
            if (${C===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${S}
            } else if (${C===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${S}
            } else if (${C===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${S}
            }
          }
        }
        setOutput(${$});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _se(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;jh(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;I(Sn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=Js(r.shape,o,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&qe(c.inShape,c.outShape))return ds({inputs:{x:r},backend:n});const d=new vd(c,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const Lse={kernelName:lg,backendName:"webgl",kernelFunc:_se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s,c=[1,1,1],d=Ao(r.shape,o,i,c,a,l,u),h=new c$(d,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const zse={kernelName:ug,backendName:"webgl",kernelFunc:Mse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bse{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,d=u-1-e.padInfo.left,h=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${d});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Vse{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=h-1-e.padInfo.top,x=f-1-e.padInfo.left,g=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${x});
      const float avgMultiplier = float(${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wse(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,d=[1,1,1],h=Ao(i.shape,a,l,d,u,c),f=new Vse(h);return n.runWebGLProgram(f,[r],i.dtype)}const Use={kernelName:Fb,backendName:"webgl",kernelFunc:Wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o;jh([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=Js(i.shape,a,l,1,u),d=new Bse(c);return n.runWebGLProgram(d,[r],i.dtype)}const Hse={kernelName:Db,backendName:"webgl",kernelFunc:Gse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return vm({a:r,b:o,transposeA:i,transposeB:a,backend:n})}const Kse={kernelName:cg,backendName:"webgl",kernelFunc:jse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xse{constructor(e,n,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ie(e,n),Ie(e,s);let a="0.0";r!=null&&(Ie(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(Ie(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qse{constructor(e,n,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ie(e,n),Ie(e,s);let a="vec4(0.0)";r!=null&&(Ie(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(Ie(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yse=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=t;I(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),I(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),I(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const u=[s,r,o];let c=null;i!=null&&(c=i.shape,u.push(i));let d=null;a!=null&&(d=a.shape,u.push(a));const h=K().getBool("WEBGL_PACK_NORMALIZATION")?new qse(s.shape,r.shape,o.shape,c,d,l):new Xse(s.shape,r.shape,o.shape,c,d,l);return e.runWebGLProgram(h,u,u[0].dtype)},Qse={kernelName:Cg,backendName:"webgl",kernelFunc:Yse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zse{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=st(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Jse(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${Mv[a]} = start[${a}] + coords.${Mv[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Mv=["x","y","z","w","u","v"];function Jse(t){if(t===1)return"sourceLoc";if(t<=6)return Mv.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ere{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=st(this.rank),s=Pn("coords",this.rank),r=Pn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((c,d)=>`start[${d}]`).join()});`:e.map((c,d)=>`${r[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(t,e,n,s){const r=s.texData.get(t.dataId),o=s.makeTensorInfo(n,t.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=n,i.dtype=t.dtype;let a=oC(e,ge(t.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),o}function Pu(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,size:i}=s,[a,l]=p0(r,o,i);if(nC(r,a,l),Q(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=n.texData.get(r.dataId),h=Kte(d.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,h)}const{isPacked:u}=n.texData.get(r.dataId),c=rC(r.shape,a,l);if(u||!c){const d=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ere(l):new Zse(l),h=[a];return n.runWebGLProgram(d,[r],r.dtype,h)}return n.uploadToGPU(r.dataId),tre(r,a,l,n)}const nre={kernelName:Qg,backendName:"webgl",kernelFunc:Pu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sre=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,crops:i}=s;I(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,v)=>y*v),l=Fh(r.shape,o,a),u=Oh(l.length,o.length),c=Ph(r.shape,o,a),d=cC(i,o.length),h=dC(c,i,o.length),f=[],p=ie({inputs:{x:r},backend:n,attrs:{shape:l}}),m=zn({inputs:{x:p},backend:n,attrs:{perm:u}}),x=ie({inputs:{x:m},backend:n,attrs:{shape:c}}),g=Pu({inputs:{x},backend:n,attrs:{begin:d,size:h}});return f.push(p),f.push(m),f.push(x),f.forEach(y=>n.disposeIntermediateTensorInfo(y)),g},rre={kernelName:dg,backendName:"webgl",kernelFunc:sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ore(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i}=s,a=n.readSync(r.dataId),l=n.readSync(o.dataId),u=GP(a,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}const ire={kernelName:Ob,backendName:"webgl",kernelFunc:ore};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const are=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,lre=`
  return float(int(a.r) & int(b.r));
`;function ure(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=K().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||i===1){const l=n.texData.get(s.dataId).values,u=n.texData.get(r.dataId).values,[c,d]=xte(s.shape,r.shape,l,u,s.dtype),h=n.makeTensorInfo(d,s.dtype),f=n.texData.get(h.dataId);return f.values=c,h}let a;return o?a=new Fu(are,s.shape,r.shape,!1):a=new Oa(lre,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const cre={kernelName:Pb,backendName:"webgl",kernelFunc:ure};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dre(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,o=n.readSync(s.dataId),i=n.readSync(r.dataId),a=Ie(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const hre={kernelName:jN,backendName:"webgl",kernelFunc:dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fre="return float(a != b);",r_=gn({opSnippet:fre,cpuKernelImpl:Mte,dtype:"bool"}),pre={kernelName:zg,backendName:"webgl",kernelFunc:r_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return ds({inputs:{x:r.complexTensorInfos.real},backend:n})}const mre={kernelName:iw,backendName:"webgl",kernelFunc:Xh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gre="return float(int(x));";function xre(t,e){const n=new Wr(t.shape,gre),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zv(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return ds({inputs:{x:r},backend:n});const i=kt(r.shape),a=zv({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Fi({inputs:{real:a,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const i=Xh({inputs:{input:r},backend:n}),a=zv({inputs:{x:i},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(i),a}if(!VN(r.dtype,o)){const i=ds({inputs:{x:r},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(n.shouldExecuteOnCPU([r])){const i=n.texData.get(r.dataId).values,[a,l,u]=yte(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,l,u)}if(o==="int32")return xre(r,n);if(o==="bool"){const i=n.makeTensorInfo([],"bool",Cn("bool",1)),l=r_({inputs:{a:r,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const yre={kernelName:Bd,backendName:"webgl",kernelFunc:zv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PI="return ceil(x);",vre=Ve({opSnippet:PI,packedOpSnippet:PI,cpuKernelImpl:vte}),bre={kernelName:Vd,backendName:"webgl",kernelFunc:vre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wre{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cre{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $re(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;K().getBool("WEBGL_PACK_CLIP")?a=new Cre(r.shape):a=new wre(r.shape);const l=[[o],[i]];return n.runWebGLProgram(a,[r],r.dtype,l)}const kre={kernelName:Wd,backendName:"webgl",kernelFunc:$re};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sre{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _I(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function Ire(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),o=new Sre(s.shape),i=[_I(s,r.complexTensorInfos.real),_I(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(o,i,i[0].dtype)}const Tre={kernelName:hg,backendName:"webgl",kernelFunc:Ire};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ere{constructor(e){this.outputShape=[],this.outputShape=Xr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let i=1;i<n.length;i++)n[i]=n[i-1]+e[i][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<n.length;i++){const a=n[i-1];s.push(`else if (yC < ${n[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=n.length,o=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nre{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Xr(e,n);const s=this.outputShape,r=s.length,o=st(r),i=Pn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((m,x)=>`T${x}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const u=a[n],c=a.slice(-2),d=a.join();let h=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${c.join()}));
        }`;for(let m=1;m<l.length;m++){const x=l[m-1];h+=`
        if (${u} < ${l[m]}  && ${u} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${Ff(a,u,x)}),
            vec2(${Ff(c,u,x)}));
        }`}const f=l.length,p=l[l.length-1];h+=`
        return getChannel(
          getT${f}(${Ff(a,u,p)}),
          vec2(${Ff(c,u,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${h}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Ff(t,e,n){const s=t.indexOf(e);return t.map((o,i)=>i===s?`${o} - ${n}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O0(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return ds({inputs:{x:r.complexTensorInfos.imag},backend:n})}const Rre={kernelName:Zb,backendName:"webgl",kernelFunc:O0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gc(t,e,n){const s=t[0].dtype;if(s==="complex64"){const f=t.map(y=>Xh({inputs:{input:y},backend:n})),p=t.map(y=>O0({inputs:{input:y},backend:n})),m=gc(f,e,n),x=gc(p,e,n),g=Fi({inputs:{real:m,imag:x},backend:n});return f.forEach(y=>n.disposeIntermediateTensorInfo(y)),p.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),g}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const f=t.map(b=>{const $=[-1,Q(b.shape.slice(e))];return ie({inputs:{x:b},backend:n,attrs:{shape:$}})}),p=f.map(b=>({vals:n.readSync(b.dataId),shape:b.shape})),m=Xr(f.map(b=>b.shape),1),x=f[0].shape[0]===1,g=bte(p,m,s,x),y=Xr(t.map(b=>b.shape),e),v=n.makeTensorInfo(y,s,g);return f.forEach(b=>n.disposeIntermediateTensorInfo(b)),v}const o=t.filter(f=>Q(f.shape)>0),i=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const f=i?new Wr(t[0].shape,Uo):new Yo(t[0].shape,Uo);return n.runWebGLProgram(f,t,s)}const a=K().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const f=[];for(let m=0;m<o.length;m+=a){const x=o.slice(m,m+a);f.push(gc(x,e,n))}const p=gc(f,e,n);for(const m of f)n.disposeIntermediateTensorInfo(m);return p}if(i){const f=new Nre(o.map(p=>p.shape),e);return n.runWebGLProgram(f,o,s)}const{tensors2D:l,outShape:u}=Are(o,e,n),c=new Ere(l.map(f=>f.shape)),d=n.runWebGLProgram(c,l,s);l.forEach(f=>n.disposeIntermediateTensorInfo(f));const h=ie({inputs:{x:d},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(d),h}function Are(t,e,n){const s=Xr(t.map(o=>o.shape),e);return{tensors2D:t.map(o=>ie({inputs:{x:o},attrs:{shape:[-1,Q(o.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,o=De(r,e[0].shape)[0],i=e.map(u=>u.shape);aC(i,o);const a=Xr(e.map(u=>u.shape),o);if(Q(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>Q(u.shape)>0);return l.length===1?ds({inputs:{x:l[0]},backend:n}):gc(l,o,n)}const Dre={kernelName:fg,backendName:"webgl",kernelFunc:o_};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i_{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,x=e.dataFormat==="channelsLast",g=x?1:2,y=x?2:3,v=x?3:1;let b="",w="";s&&(r?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:b=`
          float activation(float x) {
            ${s}
          }
        `,w="result = activation(result);");const $=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${g}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${$}
        ${w}
        setOutput(result);
      }
    `}}class Fre{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a_{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Tn(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,d=c;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<c;x++)h+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;h+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<c;x++)h+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(d+1)/2;x++){const g=x*2;if(h+=`
           xC = xCCorner + ${g*l};
           `,a===1){if(g<c&&(i%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }
               `,l===1&&g>0?h+=`
                 xC${g} = vec4(xTexelC${g-2}.zw, xTexelC${g}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${g} = vec4(previous.zw, xTexelC${g}.xy);
                   } else {
                     xC${g} = vec4(0.0, 0.0, xTexelC${g}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xC${g} = xTexelC${g};
                 `,g+1<c)){const y=i%2===0?kb(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                     xTexelC${g+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${g+1}.zw = vec2(0.0);
                     }
                     xTexelC${g+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${g+1} = vec4(previous.zw, xTexelC${g+1}.xy);
                     } else {
                      xC${g+1} = vec4(0.0, 0.0, xTexelC${g+1}.xy);
                     }
                     `:h+=`
                     xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.xy);
                     `):y===1?h+=`
                     xC${g+1} = xTexelC${g};
                     `:h+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                       xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${g+1}.zw = vec2(0.0);
                       }
                       xTexelC${g+1}Ready = 1;
                     }

                     xC${g+1} = xTexelC${g+1};
                     `}}else g<c&&(i%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.0);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
               `,g+1<c&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${g+1} = vec4(xTexelC${g+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(
                   xTexelC${g}.xy, xTexelC${g+1}.xy);
               `,g+1<c&&(h+=`
                   xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
                 `)));g<c&&(h+=`
             wTexel = getW(r, ${g}, d1, d2);
             dotProd += xC${g}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${g}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,g+1<c&&(h+=`
               wTexel = getW(r, ${g+1}, d1, d2);
               dotProd += xC${g+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${g+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let f="",p="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ore{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Tn(this.outputShape.length);const{dataFormat:s}=n,r=Bn(),o=s==="channelsLast",i=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let c=0;c<=1;c++)for(let d=0;d<=1;d++)u+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bm(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function l_({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=t.shape,u=s.texData.get(t.dataId),c=n.inChannels,d=l[0]*l[1]*l[2],h=n.outChannels,f=n.dataFormat==="channelsLast",p=!1,m=!1;let x;const g=[];if(o!=null){const b=bm(o.shape,f);b!=null&&(o=ie({inputs:{x:o},backend:s,attrs:{shape:b}}),g.push(o))}if(r!=null){const b=bm(r.shape,f);b!=null&&(r=ie({inputs:{x:r},backend:s,attrs:{shape:b}}),g.push(r))}if(!((d===1||h===1)&&c>e_)&&u.isPacked&&f&&u.texture!=null&&l[2]%2!==0&&qe(u.shape.slice(-3),l.slice(-3))){const b=l[0]*l[1]*(l[2]+1),w={dataId:t.dataId,shape:[1,b,n.inChannels],dtype:t.dtype},$=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,I(ym(u.shape,w.shape),()=>`packed reshape ${u.shape} to ${w.shape} isn't free`);const k=ie({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});g.push(k);const C=vm({a:w,b:k,backend:s,transposeA:p,transposeB:m,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),S=s.texData.get(C.dataId);I(S.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=$,S.shape=n.outShape,x=ds({inputs:{x:C},backend:s}),x.shape=n.outShape,g.push(C)}else{const b=n.outHeight*n.outWidth,w=ie({inputs:{x:t},backend:s,attrs:{shape:f?[n.batchSize,b,n.inChannels]:[n.batchSize,n.inChannels,b]}}),$=ie({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),k=vm({a:f?w:$,b:f?$:w,transposeA:!f,transposeB:m,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});x=ie({inputs:{x:k},backend:s,attrs:{shape:n.outShape}}),g.push(w),g.push($),g.push(k)}for(const b of g)s.disposeIntermediateTensorInfo(b);return x}function u_({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:d,outHeight:h,dataFormat:f}=n,p=f==="channelsLast",m=l*u*c,x=h*d,g=[n.batchSize,m,x],y=!0,v=!1,b=[];if(o!=null){const D=bm(o.shape,p);D!=null&&(o=ie({inputs:{x:o},backend:s,attrs:{shape:D}}),b.push(o))}if(r!=null){const D=bm(r.shape,p);D!=null&&(r=ie({inputs:{x:r},backend:s,attrs:{shape:D}}),b.push(r))}const w=ie({inputs:{x:e},backend:s,attrs:{shape:[1,m,Q(e.shape)/m]}});b.push(w);const $=new Ore(g,n),k=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],C=s.runWebGLProgram($,[t],"float32",k),S=ie({inputs:{x:C},backend:s,attrs:{shape:g}});b.push(C),b.push(S);const T=r!=null,R=o!=null,A=a==="leakyrelu",E=a?yd(a,!0):null,N=new JP(p?S.shape:w.shape,p?w.shape:S.shape,p?[n.batchSize,x,n.outChannels]:[n.batchSize,n.outChannels,x],y,v,T,E,R,A),P=p?[S,w]:[w,S];if(r&&P.push(r),R&&P.push(o),A){const D=s.makeTensorInfo([],"float32",Ii(i,"float32"));P.push(D),b.push(D)}const _=s.runWebGLProgram(N,P,"float32"),M=ie({inputs:{x:_},backend:s,attrs:{shape:n.outShape}});b.push(_);for(const D of b)s.disposeIntermediateTensorInfo(D);return M}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s,d=Do(l),h=pn(r.shape,o.shape,i,u,a,c,!1,d);let f;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))f=l_({x:r,filter:o,convInfo:h,backend:n});else if(h.strideWidth<=2&&d==="channelsLast"&&K().getBool("WEBGL_EXP_CONV")){const m=new a_(h),x=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];f=n.runWebGLProgram(m,[r,o],"float32",x)}else if(K().getBool("WEBGL_CONV_IM2COL"))f=u_({x:r,filter:o,convInfo:h,backend:n});else{const m=new i_(h);f=n.runWebGLProgram(m,[r,o],"float32")}const p=ie({inputs:{x:f},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(f),p}const _re={kernelName:pg,backendName:"webgl",kernelFunc:Pre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lre{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Mre{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,u=i?1:2,c=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class zre{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Bre{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,u=s-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s,d=Do(l),h=pn(r.shape,c,i,1,a,u,!1,d),f=new Lre(h);return n.runWebGLProgram(f,[r,o],"float32")}const Wre={kernelName:Lb,backendName:"webgl",kernelFunc:Vre};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ure{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Tn(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s,d=Do(u),h=pn(i,o.shape,a,1,l,c,!1,d);if(K().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const f=[[h.strideHeight,h.strideWidth]],p=new Ure(h);return n.runWebGLProgram(p,[r,o],"float32",f)}else{const f=new Mre(h);return n.runWebGLProgram(f,[r,o],"float32")}}const Hre={kernelName:mg,backendName:"webgl",kernelFunc:Gre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=Ti(r.shape,o.shape,i,l,a),c=new Fre(u);return n.runWebGLProgram(c,[r,o],"float32")}const Kre={kernelName:gg,backendName:"webgl",kernelFunc:jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s,u=Ti(r.shape,l,i,1,a),c=new zre(u);return n.runWebGLProgram(c,[r,o],"float32")}const qre={kernelName:Mb,backendName:"webgl",kernelFunc:Xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yre(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s,u=Ti(l,o.shape,a,1,i),c=new Bre(u);return n.runWebGLProgram(c,[r,o],"float32")}const Qre={kernelName:zb,backendName:"webgl",kernelFunc:Yre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zre=Ou+`
  return cos(x);
`,Jre=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Za}
  return result;
`,eoe=Ve({opSnippet:Zre,packedOpSnippet:Jre}),toe={kernelName:Ud,backendName:"webgl",kernelFunc:eoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const noe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,soe=Ve({opSnippet:noe}),roe={kernelName:Gd,backendName:"webgl",kernelFunc:soe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ooe{constructor(e,n,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,u]=e,[c]=n,[d,h]=s;this.outputShape=[c,d,h,u];const f=r==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[x,g,y]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,b,w]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${g};
        float width_scale = ${b};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ioe=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,c=new ooe(r.shape,o.shape,a,l,u);return n.runWebGLProgram(c,[r,o,i],"float32")},aoe={kernelName:Vb,backendName:"webgl",kernelFunc:ioe};var bd;(function(t){t.Prod="*",t.Sum="+"})(bd||(bd={}));class LI{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===bd.Prod?"1.0":"0.0",a=s?i:`getX(${MI(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",c="";s?(u=r?`end != ${l-1}`:"end != 0",c=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${st(o)} coords = getOutputCoords();
        int end = ${zI(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${zI(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${MI(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function MI(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function zI(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_(t,e,n,s,r,o){const i=e.shape.length,a=Tt([s],i);let l=e;a!=null&&(l=zn({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=Pt(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const c=l.shape[u];let d=ds({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(c))-1;h++){const f=new LI(t,l.shape,!1,o),p=[[h]],m=d;d=n.runWebGLProgram(f,[d],d.dtype,p),n.disposeIntermediateTensorInfo(m)}if(r){const h=new LI(t,l.shape,r,o),f=d;d=n.runWebGLProgram(h,[d],d.dtype),n.disposeIntermediateTensorInfo(f)}if(a!=null){const h=Ei(a),f=zn({inputs:{x:d},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),f}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return c_(bd.Prod,r,n,o,i,a)}const uoe={kernelName:Bb,backendName:"webgl",kernelFunc:loe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function coe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return c_(bd.Sum,r,n,o,i,a)}const doe={kernelName:xg,backendName:"webgl",kernelFunc:coe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),u=n.readSync(o.dataId),c=GP(l,u,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(o),c=gte(l,u,i,a);return n.makeTensorInfo(c.shape,o.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const foe={kernelName:Wb,backendName:"webgl",kernelFunc:hoe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class poe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function moe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],l=i==="NHWC"?r.shape[1]:r.shape[2],u=i==="NHWC"?r.shape[2]:r.shape[3],c=i==="NHWC"?r.shape[3]:r.shape[1],d=l*o,h=u*o,f=c/(o*o),p=i==="NHWC"?[a,d,h,f]:[a,f,d,h],m=new poe(p,o,i);return n.runWebGLProgram(m,[r],r.dtype)}const goe={kernelName:Ub,backendName:"webgl",kernelFunc:moe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d_{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Tn(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,c="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h_{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Tn(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,h=d;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<d;g++)f+=`
          vec4 xTexelC${g*2};
          int xTexelC${g*2}Ready;
          vec4 xTexelC${g*2+1};
          int xTexelC${g*2+1}Ready;
          vec4 xC${g};`;f+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let g=0;g<d;g++)f+=`
          xTexelC${g*2} = vec4(0.0);
          xTexelC${g*2}Ready = 0;
          xTexelC${g*2+1} = vec4(0.0);
          xTexelC${g*2+1}Ready = 0;
          xC${g} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let g=0;g<(h+1)/2;g++){const y=g*2;if(f+=`
          xC = xCCorner + ${y*u};
          `,l===1){if(y<d&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,u===1&&y>0?f+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<d)){const v=a%2===0?kb(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,u>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:f+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):v===1?f+=`
                    xC${y+1} = xTexelC${y};
                    `:f+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<d&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<d&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<d&&(f+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<d&&(f+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<d&&(f+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;let c=l;c==null&&(c=[1,1]),I(Sn(i,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const d=pn(r.shape,o.shape,i,c,a,u,!0);let h;K().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?h=new h_(d):h=new d_(d);const f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[r,o],"float32",f)}const yoe={kernelName:yg,backendName:"webgl",kernelFunc:xoe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class voe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class boe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s,d=pn(r.shape,c,i,a,l,u,!0),h=new voe(d);return n.runWebGLProgram(h,[r,o],"float32")}const Coe={kernelName:Gb,backendName:"webgl",kernelFunc:woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s,d=pn(c,o.shape,i,a,l,u,!0),h=new boe(d);return n.runWebGLProgram(h,[r,o],"float32")}const koe={kernelName:Hb,backendName:"webgl",kernelFunc:$oe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Soe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],o=Q(s.shape),i=ie({inputs:{x:s},backend:n,attrs:{shape:[o]}}),a=new Soe(o),l=n.runWebGLProgram(a,[i],i.dtype),u=ie({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),u}const Toe={kernelName:KN,backendName:"webgl",kernelFunc:Ioe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eoe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:d,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${d}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Noe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=Eh(r.shape,o.shape,i,a,"NHWC",l);let c;const d=new Eoe(u);c=n.runWebGLProgram(d,[r,o],"float32");const h=ie({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),h}const Roe={kernelName:vg,backendName:"webgl",kernelFunc:Noe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aoe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=vC(r,o.length);wC(i.length,l,o);const{path:u,steps:c}=CC(a,l),d=c.length;let h=null,f=i.length;const p=[];for(let m=0;m<d;++m){for(const x of c[m]){const{permutationIndices:g,expandDims:y}=bC(f,l[x]);let v;$C(g)?v=o[x]:(v=zn({inputs:{x:o[x]},backend:n,attrs:{perm:g}}),p.push(v));const b=v.shape.slice();for(let w=0;w<y.length;++w)b.splice(y[w],0,1);qe(v.shape,b)||(v=ie({inputs:{x:v},backend:n,attrs:{shape:b}}),p.push(v)),h===null?h=v:(h=u$({inputs:{a:v,b:h},backend:n}),p.push(h))}m<d-1&&(u[m]>=0&&(h=F0({inputs:{x:h},backend:n,attrs:{axis:u[m]-(i.length-f),keepDims:!1}}),p.push(h)),f--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const Doe={kernelName:jb,backendName:"webgl",kernelFunc:Aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Foe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ooe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Poe=Ve({opSnippet:Foe,packedOpSnippet:Ooe}),_oe={kernelName:jd,backendName:"webgl",kernelFunc:Poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe="return (b >= 0.0) ? a : a * (b + 1.0);",Moe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,zoe=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fu(Moe,s.shape,r.shape):new Oa(Loe,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],s.dtype)},Boe={kernelName:Kb,backendName:"webgl",kernelFunc:zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Voe=`
  return vec4(equal(a, b));
`,Woe="return float(a == b);",Uoe=gn({opSnippet:Woe,packedOpSnippet:Voe,dtype:"bool",cpuKernelImpl:wte}),Goe={kernelName:bg,backendName:"webgl",kernelFunc:Uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hoe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${hC};
  float a1 = ${fC};
  float a2 = ${pC};
  float a3 = ${mC};
  float a4 = ${gC};
  float a5 = ${xC};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,joe=Ve({opSnippet:Hoe}),Koe={kernelName:Kd,backendName:"webgl",kernelFunc:joe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xoe=Ou+`
  return exp(x);
`,qoe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,f_=Ve({opSnippet:Xoe,packedOpSnippet:qoe,cpuKernelImpl:Cte,dtype:"float32"}),Yoe={kernelName:Xd,backendName:"webgl",kernelFunc:f_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bv(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:o}=e,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(I(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),ie({inputs:{x:o},backend:s,attrs:{shape:a}})}const Qoe={kernelName:wg,backendName:"webgl",kernelFunc:Bv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BI="return exp(x) - 1.0;",Zoe=Ve({opSnippet:BI,packedOpSnippet:BI,cpuKernelImpl:$te}),Joe={kernelName:qd,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VI{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_(t,e,n){const s=n.texData.get(t.dataId),r=Q(t.shape),o=t.shape[t.shape.length-1],i=r/o,a=ie({inputs:{x:t},backend:n,attrs:{shape:[i,o]}}),l=a.shape,u=new VI("real",l,e),c=new VI("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],h=n.runWebGLProgram(u,d,"float32"),f=n.runWebGLProgram(c,d,"float32"),p=Fi({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);const m=ie({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eie(t){const{inputs:e,backend:n}=t,{input:s}=e;return p_(s,!1,n)}const tie={kernelName:Xb,backendName:"webgl",kernelFunc:eie};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nie{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qh(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:o}=n;if(o=o||vu(r),o==="string"){const i=Dt(o,Q(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new nie(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const sie={kernelName:qb,backendName:"webgl",kernelFunc:qh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rie{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oie={kernelName:Yb,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new rie(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WI="return floor(x);",iie=Ve({opSnippet:WI,packedOpSnippet:WI,cpuKernelImpl:kte}),aie={kernelName:Yd,backendName:"webgl",kernelFunc:iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lie=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,uie=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,cie=gn({opSnippet:lie,packedOpSnippet:uie,dtype:"int32"}),die={kernelName:Qd,backendName:"webgl",kernelFunc:cie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hie{constructor(e){this.variableNames=["A"];const n=Bn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fie{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Bn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pie={kernelName:AV,backendName:"webgl",kernelFunc:mie};let ol,Mx=K().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function mie(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=[u,l],d=[u,l,o];if(a||i){const m=K().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ol==null||m!==Mx)&&(Mx=m,ol=document.createElement("canvas").getContext("2d",{willReadFrequently:Mx})),ol.canvas.width=l,ol.canvas.height=u,ol.drawImage(r,0,0,l,u),r=ol.canvas}const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=vs.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),r);const f=K().getBool("WEBGL_PACK")?new fie(d):new hie(d),p=n.runWebGLProgram(f,[h],"int32");return n.disposeData(h.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s,m=Do(c),x=pn(r.shape,o.shape,l,d,u,h,!1,m);let g;const y=[],v=i!=null,b=a!=null,w=f==="leakyrelu",$=()=>{const C=[r,o],S=(T,R)=>{if(R==="NCHW"&&T.shape.length===1&&T.shape[0]!==1){const A=ie({inputs:{x:T},backend:n,attrs:{shape:[T.shape[0],1,1]}});return y.push(A),A}return T};if(v&&C.push(S(i,c)),b&&C.push(S(a,c)),w){const T=n.makeTensorInfo([],"float32",Ii(p,"float32"));C.push(T),y.push(T)}return C};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))g=l_({x:r,filter:o,convInfo:x,backend:n,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(x.strideWidth<=2&&m==="channelsLast"&&K().getBool("WEBGL_EXP_CONV")){const C=f?yd(f,!0):null,S=new a_(x,v,C,b,w),T=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],R=$();g=n.runWebGLProgram(S,R,"float32",T)}else if(K().getBool("WEBGL_CONV_IM2COL"))g=u_({x:r,filter:o,convInfo:x,backend:n,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const C=f?yd(f,!1):null,S=new i_(x,v,C,b,w),T=$();g=n.runWebGLProgram(S,T,"float32")}const k=ie({inputs:{x:g},backend:n,attrs:{shape:x.outShape}});return y.push(g),y.forEach(C=>n.disposeIntermediateTensorInfo(C)),k}const xie={kernelName:qp,backendName:"webgl",kernelFunc:gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=s,p=[];let m=c;m==null&&(m=[1,1]),I(Sn(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const x=pn(r.shape,o.shape,l,m,u,d,!0),g=K().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,y=h?yd(h,g):null,v=[r,o],b=i!=null,w=a!=null,$=h==="leakyrelu";if(b&&v.push(i),w&&v.push(a),$){const T=n.makeTensorInfo([],"float32",Ii(f,"float32"));v.push(T),p.push(T)}let k;g?k=new h_(x,b,y,w,$):k=new d_(x,b,y,w,$);const C=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],S=n.runWebGLProgram(k,v,"float32",C);return p.forEach(T=>n.disposeIntermediateTensorInfo(T)),S}const vie={kernelName:hR,backendName:"webgl",kernelFunc:yie};class bie{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=st(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wie(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=Q(s.shape),[l,u,c,d]=tC(s,r),h=ie({inputs:{x:r},backend:n,attrs:{shape:[u,i]}}),f=ie({inputs:{x:s},backend:n,attrs:{shape:[Q(s.shape)/c,c]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const g=n.readSync(r.dataId),y=n.bufferSync(s),v=Ste(g,y,s.dtype,u,i,c,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,v.values)}const p=new bie(i,d,[u,c],s.shape),m=n.runWebGLProgram(p,[f,h],f.dtype),x=ie({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),x}const Cie={kernelName:XN,backendName:"webgl",kernelFunc:wie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ie{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=st(this.rank),r=kie(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function kie(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,l=De(i,r.shape)[0];if(K().get("DEBUG")){const y=n.readSync(o.dataId),v=r.shape[l];for(let b=0;b<y.length;++b){const w=y[b];I(w<=v-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${v-1}]`)}}const u=SC(r,o,l,a),c=Q(o.shape),d=[],h=ie({inputs:{x:r},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),f=ie({inputs:{x:o},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});d.push(h),d.push(f);const p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const y=n.bufferSync(f),v=n.bufferSync(h),b=Ite(v,y,p);return d.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(u.outputShape,b.dtype,b.values)}const m=new $ie(h.shape,p),x=n.runWebGLProgram(m,[h,f],h.dtype);d.push(x);const g=ie({inputs:{x},backend:n,attrs:{shape:u.outputShape}});return d.forEach(y=>n.disposeIntermediateTensorInfo(y)),g}const Sie={kernelName:$g,backendName:"webgl",kernelFunc:m_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iie="return float(a > b);",Tie=`
  return vec4(greaterThan(a, b));
`,Eie=gn({opSnippet:Iie,packedOpSnippet:Tie,cpuKernelImpl:Tte,dtype:"bool"}),Nie={kernelName:kg,backendName:"webgl",kernelFunc:Eie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rie="return float(a >= b);",Aie=`
  return vec4(greaterThanEqual(a, b));
`,Die=gn({opSnippet:Rie,packedOpSnippet:Aie,dtype:"bool",cpuKernelImpl:Ete}),Fie={kernelName:Zd,backendName:"webgl",kernelFunc:Die};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oie(t){const{inputs:e,backend:n}=t,{input:s}=e;return p_(s,!0,n)}const Pie={kernelName:Qb,backendName:"webgl",kernelFunc:Oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ie="return float(!isnan(x) && !isinf(x));",Lie=Ve({opSnippet:_ie,dtype:"bool"}),Mie={kernelName:eh,backendName:"webgl",kernelFunc:Lie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zie="return float(isinf(x));",Bie=Ve({opSnippet:zie,dtype:"bool"}),Vie={kernelName:th,backendName:"webgl",kernelFunc:Bie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wie="return float(isnan(x));",Uie=Ve({opSnippet:Wie,dtype:"bool"}),Gie={kernelName:nh,backendName:"webgl",kernelFunc:Uie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hie="return float(a < b);",jie=`
  return vec4(lessThan(a, b));
`,Kie=gn({opSnippet:Hie,packedOpSnippet:jie,cpuKernelImpl:Nte,dtype:"bool"}),Xie={kernelName:Ig,backendName:"webgl",kernelFunc:Kie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qie="return float(a <= b);",Yie=`
  return vec4(lessThanEqual(a, b));
`,Qie=gn({opSnippet:qie,packedOpSnippet:Yie,cpuKernelImpl:Rte,dtype:"bool"}),Zie={kernelName:Tg,backendName:"webgl",kernelFunc:Qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:o}=n,i=Ate(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const eae={kernelName:qN,backendName:"webgl",kernelFunc:Jie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tae=Ou+`
  return x < 0.0 ? 0./0. : log(x);
`,nae=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,sae=Ve({opSnippet:tae,packedOpSnippet:nae,cpuKernelImpl:Dte}),rae={kernelName:sh,backendName:"webgl",kernelFunc:sae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oae=Ou+`
  return log(1.0 + x);
`,iae=Ve({opSnippet:oae}),aae={kernelName:rh,backendName:"webgl",kernelFunc:iae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lae="return float(a >= 1.0 && b >= 1.0);",uae=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,cae=gn({opSnippet:lae,packedOpSnippet:uae,dtype:"bool"}),dae={kernelName:Eg,backendName:"webgl",kernelFunc:cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hae="return float(!(x >= 1.0));",fae=Ve({opSnippet:hae}),pae={kernelName:Ng,backendName:"webgl",kernelFunc:fae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mae="return float(a >= 1.0 || b >= 1.0);",gae=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,xae=gn({opSnippet:mae,packedOpSnippet:gae,dtype:"bool"}),yae={kernelName:Rg,backendName:"webgl",kernelFunc:xae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vae{constructor(e,n,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bae{constructor(e,n,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wae=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s,u=K().getBool("WEBGL_PACK_NORMALIZATION")?new bae(r.shape,o,i,a,l):new vae(r.shape,o,i,a,l);return n.runWebGLProgram(u,[r],r.dtype)},Cae={kernelName:Ag,backendName:"webgl",kernelFunc:wae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ae{constructor(e,n,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kae=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s,d=new $ae(r.shape,a,l,u,c);return n.runWebGLProgram(d,[r,o,i],r.dtype)},Sae={kernelName:Jb,backendName:"webgl",kernelFunc:kae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iae(t,e,n,s){const r=Q(e),i=Q(t.shape)/r,a=ie({inputs:{x:t},attrs:{shape:[i,r]},backend:s}),l=Ja(a,t.dtype,"max",s),u=ie({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,l=De(o,r.shape);let u=l;const c=Tt(u,a),d=c!=null,h=n.shouldExecuteOnCPU([r]);let f=r;if(d){if(h){const v=n.texData.get(f.dataId).values,b=new Array(a);for(let k=0;k<b.length;k++)b[k]=r.shape[c[k]];const w=a$(v,r.shape,r.dtype,c,b);f=n.makeTensorInfo(b,r.dtype);const $=n.texData.get(f.dataId);$.values=w}else f=D0(r,c,n);u=Pt(u.length,a)}mn("max",u,a);const[p,m]=ln(f.shape,u);let x=p;i&&(x=Vt(p,l));let g;if(h){const v=n.texData.get(f.dataId).values,b=Fte(v,Q(m),x,r.dtype);g=n.makeTensorInfo(x,r.dtype);const w=n.texData.get(g.dataId);w.values=b}else g=Iae(f,m,x,n);return d&&n.disposeIntermediateTensorInfo(f),g}const Tae={kernelName:Dg,backendName:"webgl",kernelFunc:g_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae=l$+`
  return max(a, b);
`,Nae=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Za+`
  return result;
`,Rae=gn({opSnippet:Eae,packedOpSnippet:Nae,cpuKernelImpl:Ote}),Aae={kernelName:oh,backendName:"webgl",kernelFunc:Rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dae(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;jh(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;I(Sn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=Js(r.shape,o,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&qe(c.inShape,c.outShape))return ds({inputs:{x:r},backend:n});const d=new vd(c,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const Fae={kernelName:Fg,backendName:"webgl",kernelFunc:Dae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oae(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,c=[1,1,1],d=Ao(r.shape,o,i,c,a,u,l),h=new c$(d,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const Pae={kernelName:Og,backendName:"webgl",kernelFunc:Oae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ae{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Lae{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=u-1-e.padInfo.top,f=c-1-e.padInfo.left,p=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${h}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mae(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,d=[1,1,1],h=Ao(i.shape,a,l,d,u,c),f=new c$(h,"max",!0),p=n.runWebGLProgram(f,[i],i.dtype),m=new Lae(h),x=n.runWebGLProgram(m,[r,p],i.dtype);return n.disposeIntermediateTensorInfo(p),x}const zae={kernelName:tw,backendName:"webgl",kernelFunc:Mae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bae(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o,output:i}=e,a=o;jh([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=s,h=Js(a.shape,l,u,1,c,d),f=!0,p=new vd(h,"max",f),m=n.runWebGLProgram(p,[a],a.dtype),x=new _ae(h),g=n.runWebGLProgram(x,[r,m],a.dtype);return n.disposeIntermediateTensorInfo(m),g}const Vae={kernelName:ew,backendName:"webgl",kernelFunc:Bae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t,e,n,s){let r=new vd(n,"max",!1);const o=s.runWebGLProgram(r,[t],"float32");r=new vd(n,"max",!0,!0,e);const i=s.runWebGLProgram(r,[t],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uae={kernelName:YN,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=n;I(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];I(Sn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=Js(s.shape,r,o,u,i),[d,h]=Wae(s,a,c,l);return[d,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(t,e,n,s){const r=Q(e),i=Q(t.shape)/r,a=ie({inputs:{x:t},attrs:{shape:[i,r]},backend:s}),l=Ja(a,"float32","mean",s),u=ie({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hae={kernelName:Pg,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:o}=e,i=n,a=s.shape.length,l=De(o,s.shape);let u=l;const c=Tt(u,a),d=c!=null,h=i.shouldExecuteOnCPU([s]),f=[];let p=s;if(d){if(h){const b=i.texData.get(p.dataId).values,w=new Array(a);for(let C=0;C<w.length;C++)w[C]=s.shape[c[C]];const $=a$(b,s.shape,s.dtype,c,w);p=i.makeTensorInfo(w,s.dtype);const k=i.texData.get(p.dataId);k.values=$}else p=D0(s,c,i);f.push(p),u=Pt(u.length,a)}mn("sum",u,a);const[m,x]=ln(p.shape,u);let g=m;r&&(g=Vt(m,l));const y=Gae(p,x,g,i);for(const v of f)i.disposeIntermediateTensorInfo(v);return y}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=De(o,r.shape);let u=l;const c=Tt(u,a);let d=r;c!=null&&(d=zn({inputs:{x:r},backend:n,attrs:{perm:c}}),u=Pt(u.length,r.shape.length)),mn("min",u,a);const[h,f]=ln(d.shape,u),p=Q(f),m=ie({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),x=Ja(m,m.dtype,"min",n);let g;if(i){const y=Vt(h,l);g=ie({inputs:{x},backend:n,attrs:{shape:y}})}else g=ie({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(d),g}const Kae={kernelName:_g,backendName:"webgl",kernelFunc:jae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xae=l$+`
  return min(a, b);
`,qae=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Za+`
  return result;
`,Yae=gn({opSnippet:Xae,packedOpSnippet:qae,cpuKernelImpl:Pte}),Qae={kernelName:ih,backendName:"webgl",kernelFunc:Yae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zae{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((c,d)=>c[0]+e[d]+c[1]);const r=e.length,o=st(r),i=n.map(c=>c[0]).join(","),a=n.map((c,d)=>c[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jae{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const r=e.length,o=st(r),i=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),l=Pn("rc",r),u=Pn("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${u.slice(-2).join()})`,h=s==="reflect"?0:1;let f="";if(r===1){const p=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
      `}else{const p=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${u.join()}), ${d});
          ${l[r-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${u.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ele=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:o}=n,i=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jae(s.shape,r,o):new Zae(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},tle={kernelName:Lg,backendName:"webgl",kernelFunc:ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nle=`if (b == 0.0) return NAN;
  return mod(a, b);`,sle=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Za+`
  return result;
`,rle=gn({opSnippet:nle,packedOpSnippet:sle}),ole={kernelName:ah,backendName:"webgl",kernelFunc:rle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ile{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ale=`
if (a == b) {
  return 1.0;
};
return a / b;`,lle=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,x_=gn({opSnippet:ale,packedOpSnippet:lle,checkOutOfBounds:!0}),ule={kernelName:Hd,backendName:"webgl",kernelFunc:x_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UI="return a - b;",y_=gn({opSnippet:UI,packedOpSnippet:UI,supportsComplex:!0,cpuKernelImpl:nne}),cle={kernelName:$h,backendName:"webgl",kernelFunc:y_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:o}=s,i=De([o],r.shape),a=g_({inputs:{x:r},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),l=Vt(a.shape,i),u=ie({inputs:{x:a},backend:n,attrs:{shape:l}}),c=y_({inputs:{a:r,b:u},backend:n}),d=f_({inputs:{x:c},backend:n}),h=F0({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:!1}}),f=ie({inputs:{x:h},backend:n,attrs:{shape:l}}),p=x_({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}const dle={kernelName:t0,backendName:"webgl",kernelFunc:v_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hle(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,l=a?r:v_({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),u=l.shape[0],c=l.shape[1],d=new ile(u,c,o),h=[[i]],f=n.runWebGLProgram(d,[l],"int32",h);return a||n.disposeIntermediateTensorInfo(l),f}const fle={kernelName:QN,backendName:"webgl",kernelFunc:hle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ple=tr+`
  return -x;
`,mle=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function gle(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const o=n.texData.get(s.dataId),[i,a]=Lte(o.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,i)}let r;return K().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Yo(s.shape,mle):r=new Wr(s.shape,ple),n.runWebGLProgram(r,[s],s.dtype)}const xle={kernelName:Mg,backendName:"webgl",kernelFunc:gle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yle=Yw;function vle(t){xs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,u=n.readSync(r.dataId),c=n.readSync(o.dataId),{selectedIndices:d}=yle(u,c,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const ble={kernelName:nw,backendName:"webgl",kernelFunc:vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wle=Qw;function Cle(t){xs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,c=n.readSync(r.dataId),d=n.readSync(o.dataId),{selectedIndices:h,validOutputs:f}=wle(c,d,i,a,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const $le={kernelName:sw,backendName:"webgl",kernelFunc:Cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kle=Zw;function Sle(t){xs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,c=n.readSync(r.dataId),d=n.readSync(o.dataId),h=i,f=a,p=l,m=u,{selectedIndices:x,selectedScores:g}=kle(c,d,h,f,p,m);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}const Ile={kernelName:rw,backendName:"webgl",kernelFunc:Sle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tle{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ele=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s,u=Q(r.shape),c=new Tle(u,i,a,l),d=ie({inputs:{x:r},backend:n,attrs:{shape:[u]}}),h=n.runWebGLProgram(c,[d],o);n.disposeIntermediateTensorInfo(d);const f=[...r.shape,i],p=ie({inputs:{x:h},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(h),p},Nle={kernelName:Vg,backendName:"webgl",kernelFunc:Ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wm(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=Xh({inputs:{input:s},backend:n}),o=wm({inputs:{x:r},backend:n}),i=O0({inputs:{input:s},backend:n}),a=wm({inputs:{x:i},backend:n}),l=Fi({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return qh({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const Rle={kernelName:r0,backendName:"webgl",kernelFunc:wm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Xh({inputs:{input:s},backend:n}),o=b_({inputs:{x:r},backend:n}),i=O0({inputs:{input:s},backend:n}),a=wm({inputs:{x:i},backend:n}),l=Fi({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return qh({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const Ale={kernelName:Bg,backendName:"webgl",kernelFunc:b_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dle(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return Bv({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(c=>{Sb(o,c.shape,"All tensors passed to stack must have matching shapes"),I(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const d=Bv({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(d),d}),u=o_({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const Fle={kernelName:Wg,backendName:"webgl",kernelFunc:Dle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ole{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((u,c)=>u[0]+e[c]+u[1]);const r=e.length,o=st(r),i=n.map(u=>u[0]).join(","),a=n.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ple{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,x)=>m[0]+e[x]+m[1]);const r=e.length,o=st(r),i=n.map(m=>m[0]).join(","),a=n.map((m,x)=>m[0]+e[x]).join(","),l=Pn("rc",r),u=Pn("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${u.slice(-2).join()})`,h=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${c}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${c}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,x=r===1?2:4;m<x;m++)p+=`
        ${h[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${m}] = getChannel(getX(${u.join()}), ${d});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w_=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,constantValue:i}=s;if(Q(r.shape)===0){const u=o.map((c,d)=>c[0]+r.shape[d]+c[1]);return qh({backend:n,attrs:{shape:u,value:i,dtype:r.dtype}})}const a=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ple(r.shape,o,i):new Ole(r.shape,o,i),l=[[i]];return n.runWebGLProgram(a,[r],r.dtype,l)},_le={kernelName:Ug,backendName:"webgl",kernelFunc:w_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lle=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Mle=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Za+`
  return result;
`,zle=gn({opSnippet:Lle,packedOpSnippet:Mle}),Ble={kernelName:uh,backendName:"webgl",kernelFunc:zle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=[],u=De(o,r.shape);let c=u;const d=Tt(c,a);let h=r;d!=null&&(h=zn({inputs:{x:r},backend:n,attrs:{perm:d}}),c=Pt(c.length,a),l.push(h)),mn("prod",c,a);let f;if(n.shouldExecuteOnCPU([h])){const p=n.texData.get(h.dataId).values,{outVals:m,outShape:x,outDtype:g}=zte(h.shape,h.dtype,p,c);f=n.makeTensorInfo(x,g,m)}else{const[p,m]=ln(h.shape,c),x=Q(m),g=ie({inputs:{x:h},backend:n,attrs:{shape:[-1,x]}}),y=xw(r.dtype),v=Ja(g,y,"prod",n);f=ie({inputs:{x:v},backend:n,attrs:{shape:p}}),l.push(g),l.push(v)}if(i){l.push(f);const p=Vt(f.shape,u);f=ie({inputs:{x:f},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const Wle={kernelName:Hg,backendName:"webgl",kernelFunc:Vle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ule(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,l=r.map(g=>n.readSync(g.dataId)),u=r.map(g=>g.shape),c=n.readSync(o.dataId),d=n.readSync(i.dataId),[h,f,p]=Bte(l,u,c,o.shape,o.dtype,d,i.shape,a),m=h.map(g=>n.makeTensorInfo([g.length],"int32",g)),x=n.makeTensorInfo(p,o.dtype,f);return m.concat([x])}const Gle={kernelName:ZN,backendName:"webgl",kernelFunc:Ule};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hle(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:o}=e,i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=Vte(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=n.makeTensorInfo([u.length],"int32",u),h=n.makeTensorInfo([c.length],s.dtype,c);return[d,h]}const jle={kernelName:JN,backendName:"webgl",kernelFunc:Hle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kle(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.readSync(r.dataId),c=n.readSync(o.dataId),d=n.readSync(i.dataId),h=a.map(x=>n.readSync(x.dataId)),f=a.map(x=>x.shape),[p,m]=Wte(u,r.shape,c,o.shape,o.dtype,d,i.shape,h,f,l);return n.makeTensorInfo(p,o.dtype,m)}const Xle={kernelName:eR,backendName:"webgl",kernelFunc:Kle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C_=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:o,dtype:i}=n,a=Ute(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},qle={kernelName:ow,backendName:"webgl",kernelFunc:C_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yle="return 1.0 / x;",Qle=Ve({opSnippet:Yle}),Zle={kernelName:ch,backendName:"webgl",kernelFunc:Qle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jle=tr+`
  return (x < 0.0) ? 0.0 : x;
`,eue=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tue=Ve({opSnippet:Jle,packedOpSnippet:eue}),nue={kernelName:dh,backendName:"webgl",kernelFunc:tue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sue=tr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,rue=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,oue=Ve({opSnippet:sue,packedOpSnippet:rue}),iue={kernelName:hh,backendName:"webgl",kernelFunc:oue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aue{constructor(e,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;o?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/d[0]},
          ${c[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lue{constructor(e,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;o?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/d[0]},
          ${c[1]/d[1]},
          ${c[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,c=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new lue(r.shape,l,u,o,i):new aue(r.shape,l,u,o,i);return n.runWebGLProgram(c,[r],"float32")}const cue={kernelName:Xg,backendName:"webgl",kernelFunc:uue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class due{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],c=l[0]/u[0],d=l[1]/u[1],h=1/c,f=1/d,p=Math.ceil(h)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hue(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,a=new due(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const fue={kernelName:lw,backendName:"webgl",kernelFunc:hue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pue{constructor(e,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let f;o?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/d[0]},
          ${c[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mue{constructor(e,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let f;o?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/d[0]},
          ${c[1]/d[1]},
          ${c[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gue(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,c=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new mue(r.shape,l,u,o,i):new pue(r.shape,l,u,o,i);return n.runWebGLProgram(c,[r],r.dtype)}const xue={kernelName:Kg,backendName:"webgl",kernelFunc:gue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yue{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],c=l[0]/u[0],d=l[1]/u[1],h=1/c,f=1/d,p=Math.ceil(h)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,a=new yue(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const bue={kernelName:aw,backendName:"webgl",kernelFunc:vue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wue{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>r(l)).join(","),i=st(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cue{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Pn("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=st(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${u(r.slice())};
          }
          if(${i}) {
            result.b = ${c(r.slice())};
            if(${o}) {
              result.a = ${d(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return h(p)}function u(p){return p[s-1]="("+p[s-1]+" + 1)",h(p)}function c(p){return p[s-2]="("+p[s-2]+" + 1)",h(p)}function d(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",h(p)}function h(p){const m=e.map((y,v)=>f(v,p)),x=m.join(","),g=m.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${g}))`}function f(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:o}=s,i=r.shape.length,a=De(o,r.shape);if(i===0)return ds({inputs:{x:r},backend:n});const l=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Cue(r.shape,a):new wue(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const kue={kernelName:qg,backendName:"webgl",kernelFunc:$ue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sue{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof n=="number"?o=`float outputValue = ${n.toFixed(2)};`:o=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iue={kernelName:mw,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:o,center:i}=e,a=n,l=new Sue(s.shape,o),[u,c]=uC(i,s.shape[1],s.shape[2]),d=[[u,c,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tue=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Eue=Ve({opSnippet:Tue}),Nue={kernelName:fh,backendName:"webgl",kernelFunc:Eue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rue="return inversesqrt(x);",Aue=Ve({opSnippet:Rue,cpuKernelImpl:Gte}),Due={kernelName:ph,backendName:"webgl",kernelFunc:Aue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d${constructor(e,n,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const u=st(o.length),c=st(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const x=`getDefaultValue(${m})`,g=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${g};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fue{constructor(e,n,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const u=st(o.length),c=st(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const x=`getDefaultValue(${m})`,g=n>1?"strides[j]":"strides",y=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${g};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oue(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=Ka(o,r,i),h=[d/u,u];if(d===0)return n.makeTensorInfo(i,r.dtype);const f=ie({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),p=ie({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let x;K().getBool("WEBGL_PACK")?x=new Fue(l,a,f.shape.length,p.shape.length,c,h):x=new d$(l,a,f.shape.length,p.shape.length,c,h);const g=n.runWebGLProgram(x,[p,f,m],p.dtype),y=ie({inputs:{x:g},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),y}const Pue={kernelName:tR,backendName:"webgl",kernelFunc:Oue};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ue{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=K().getNumber("WEBGL_VERSION")===2?o:i,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lue(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:o}=e,{side:i}=s,a=new _ue(r.shape[0],r.shape[1],o.shape[1],i),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,o],"int32",l)}const Mue={kernelName:sR,backendName:"webgl",kernelFunc:Lue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zue{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<n.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);r=l.join(),o=u.join()}const i=st(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bue(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:o}=e,i=new zue(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(i,[s,r,o],us(r.dtype,o.dtype))}const Vue={kernelName:Yg,backendName:"webgl",kernelFunc:Bue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wue=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${g0};
  float scale = ${x0};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Uue=Ve({opSnippet:Wue}),Gue={kernelName:mh,backendName:"webgl",kernelFunc:Uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hue=Ou+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,jue=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Kue=Ve({opSnippet:Hue,packedOpSnippet:jue,cpuKernelImpl:jte}),Xue={kernelName:vh,backendName:"webgl",kernelFunc:Kue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const que=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Yue=Ve({opSnippet:que}),Que={kernelName:yh,backendName:"webgl",kernelFunc:Yue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue=Ou+`
  return sin(x);
`,Jue=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Za}
  return result;
`,ece=Ve({opSnippet:Zue,packedOpSnippet:Jue}),tce={kernelName:gh,backendName:"webgl",kernelFunc:ece};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,sce=Ve({opSnippet:nce}),rce={kernelName:xh,backendName:"webgl",kernelFunc:sce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,ice=Ve({opSnippet:oce}),ace={kernelName:bh,backendName:"webgl",kernelFunc:ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lce=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,paddings:i}=s;I(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((g,y)=>g*y),l=[[0,0]];l.push(...i);for(let g=1+o.length;g<r.shape.length;++g)l.push([0,0]);const u=[],c=w_({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),d=Fh(c.shape,o,a,!1),h=Oh(d.length,o.length,!1),f=Ph(c.shape,o,a,!1),p=ie({inputs:{x:c},backend:n,attrs:{shape:d}}),m=zn({inputs:{x:p},backend:n,attrs:{perm:h}}),x=ie({inputs:{x:m},backend:n,attrs:{shape:f}});return u.push(c),u.push(p),u.push(m),u.forEach(g=>n.disposeIntermediateTensorInfo(g)),x},uce={kernelName:Jg,backendName:"webgl",kernelFunc:lce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),u=n.readSync(o.dataId),c=n.readSync(i.dataId)[0],[d,h,f,p,m]=Xte(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(x=>Number(x)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const dce={kernelName:rR,backendName:"webgl",kernelFunc:cce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(o.dataId)),[u,c,d]=qte(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const fce={kernelName:oR,backendName:"webgl",kernelFunc:hce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pce(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=jP(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const mce={kernelName:iR,backendName:"webgl",kernelFunc:pce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=jP(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const xce={kernelName:aR,backendName:"webgl",kernelFunc:gce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yce(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:d,outputSize:h}=Ka(o,r,a),f=!1;if(o.dtype==="string"){const g=n.bufferSync(r),y=n.bufferSync(o),v=pi(n.readSync(i.dataId)[0]),b=Hte(g,y,a,h,c,u,l,d,v,f);return n.makeTensorInfo(a,b.dtype,b.values)}const p=new d$(u,l,r.shape.length,o.shape.length,d,[h,1],f),m=n.runWebGLProgram(p,[o,r,i],o.dtype),x=ie({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),x}const vce={kernelName:lR,backendName:"webgl",kernelFunc:yce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=De(i,r.shape)[0],l=kC(r,o,a),u=r.shape.length,c=new Array(u).fill(0),d=r.shape.slice();return l.map(h=>{const f=[...d];f[a]=h;const p=Pu({inputs:{x:r},backend:n,attrs:{begin:c,size:f}});return c[a]+=h,p})}const wce={kernelName:e0,backendName:"webgl",kernelFunc:bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GI="return sqrt(x);",Cce=Ve({opSnippet:GI,packedOpSnippet:GI,cpuKernelImpl:Yte}),$ce={kernelName:wh,backendName:"webgl",kernelFunc:Cce};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kce="return x * x;",Sce=Ve({opSnippet:kce}),Ice={kernelName:uw,backendName:"webgl",kernelFunc:Sce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HI="return (a - b) * (a - b);",Tce=gn({opSnippet:HI,packedOpSnippet:HI}),Ece={kernelName:Ch,backendName:"webgl",kernelFunc:Tce};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=n.readSync(r.dataId),i=Eo(o),a=Qte(i,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const Rce={kernelName:cw,backendName:"webgl",kernelFunc:Nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=tr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Wr(s.shape,r);return n.runWebGLProgram(o,[s],s.dtype)}const Dce={kernelName:Th,backendName:"webgl",kernelFunc:Ace};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fce{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=st(s.length),i=st(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,c)=>(l++,s.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${n});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=s,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:x,isSimpleSlice:g,begin:y,end:v,strides:b}=iC(r.shape,o,i,a,l,u,c,d,h);let w;if(m)w=ie({inputs:{x:r},backend:n,attrs:{shape:p}});else if(x||g){I(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const k=sC(y,v,b),C=Pu({inputs:{x:r},backend:n,attrs:{begin:y,size:k}});w=ie({inputs:{x:C},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(C)}else if(n.shouldExecuteOnCPU([r])){const C=n.readSync(r.dataId),S=Ae(r.shape,r.dtype,C),T=Zte(f,S,b,y);w=n.makeTensorInfo(p,r.dtype,T.values)}else{const C=new Fce(y,b,f);w=n.runWebGLProgram(C,[r],r.dtype)}const $=ie({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),$}const Pce={kernelName:dw,backendName:"webgl",kernelFunc:Oce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ce(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:d}=e,h=n.readSync(c.dataId),f=n.readSync(d.dataId),[p,m]=Jte(h,f,r,o,i,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const Lce={kernelName:uR,backendName:"webgl",kernelFunc:_ce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mce(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(o.dataId),l=n.readSync(i.dataId)[0],[u,c,d]=ene(a,l,r),h=c.length;return[n.makeTensorInfo([h,2],"int32",u),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const zce={kernelName:cR,backendName:"webgl",kernelFunc:Mce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bce(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(o.dataId),a=tne(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const Vce={kernelName:dR,backendName:"webgl",kernelFunc:Bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wce="return tan(x);",Uce=Ve({opSnippet:Wce}),Gce={kernelName:kh,backendName:"webgl",kernelFunc:Uce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hce=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,jce=Ve({opSnippet:Hce}),Kce={kernelName:Sh,backendName:"webgl",kernelFunc:jce};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xce(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=Ka(i,o,r.shape),h=[d/u,u];if(d===0)return n.makeTensorInfo(r.shape,o.dtype);const f=ie({inputs:{x:o},backend:n,attrs:{shape:[l,a]}}),p=ie({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),m=ie({inputs:{x:r},backend:n,attrs:{shape:h}}),x=new d$(l,a,f.shape.length,p.shape.length,c,h,!1,!0),g=n.runWebGLProgram(x,[p,f,m],m.dtype),y=ie({inputs:{x:g},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}const qce={kernelName:nR,backendName:"webgl",kernelFunc:Xce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yce{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*n[i];this.outputShape=s,this.rank=s.length;const r=st(this.rank),o=Qce(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function Qce(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),u=r.dtype==="string"?l.map(h=>pi(h)):l,c=Ae(r.shape,r.dtype,u),d=sne(c,o);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new Yce(r.shape,o);return n.runWebGLProgram(i,[r],r.dtype)}const Zce={kernelName:Ih,backendName:"webgl",kernelFunc:$_};class Jce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class ede{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Li(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function jI(t){let e=1;for(;e<t;)e*=2;return e}function tde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:o,sorted:i}=s,a=K().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=K().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([r])||c<a||o>l){const T=n.readSync(r.dataId),[R,A]=rne(T,u,r.dtype,o,i);return[n.makeTensorInfo(R.shape,R.dtype,R.values),n.makeTensorInfo(A.shape,A.dtype,A.values)]}if(o===0)return u[u.length-1]=0,[n.makeTensorInfo(u,r.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(c===1)return[r,qh({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const d=n.texData.get(r.dataId),h=d!==null&&d.isPacked,f=h?n.unpackTensor(r):r,m=Q(u)/c,x=ie({inputs:{x:f},attrs:{shape:[m,c]},backend:n});h&&Li(n,f);const g=jI(o),y=jI(c);let v=null;const b=()=>v===null?[x,x]:[x,v],w=(T,R,A)=>{const E=b(),N=new Jce(A),_=[[c],[v===null?1:0],[Number.NEGATIVE_INFINITY],[T],[R]],M=v;v=n.runWebGLProgram(N,E,"int32",_),Li(n,M)};for(let T=1;T<g;T*=2){const R=T*2;for(let A=T;A>=1;A/=2)w(R,A,[m,y])}for(let T=y;T>g;T/=2){const R=b(),A=new ede([m,T/2]),N=[[c],[v===null?1:0],[g]],P=v;v=n.runWebGLProgram(A,R,"int32",N),Li(n,P);const _=g/2,M=_*2;for(let D=_;D>=1;D/=2)w(M,D,v.shape)}let $=v;v=Pu({inputs:{x:v},backend:n,attrs:{begin:0,size:[m,o]}}),Li(n,$);let k=m_({inputs:{x,indices:v},backend:n,attrs:{axis:1,batchDims:1}});Li(n,x);const C=u.slice(0,-1);C.push(o),$=v,v=ie({inputs:{x:v},attrs:{shape:C},backend:n}),Li(n,$);const S=k;return k=ie({inputs:{x:k},attrs:{shape:C},backend:n}),Li(n,S),[k,v]}const nde={kernelName:hw,backendName:"webgl",kernelFunc:tde};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sde{constructor(e,n,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rde(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=s,[c,d,h,f]=r.shape,[p,m]=u??[d,h],x=[c,p,m,f],g=new sde(d,h,i,a,l,x);return n.runWebGLProgram(g,[r,o],"float32")}const ode={kernelName:fw,backendName:"webgl",kernelFunc:rde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ide(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:o}=e;jh(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:l,indices:u}=one(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const ade={kernelName:pw,backendName:"webgl",kernelFunc:ide};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lde(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,l=r.shape[o],u=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==o&&(u[c++]=i.shape[m]);const d=[],h=new Array(a).fill(0),f=i.shape.slice();f[o]=1;const p=new Array(l);for(let m=0;m<p.length;m++){h[o]=m;const x=Pu({inputs:{x:i},backend:n,attrs:{begin:h,size:f}}),g=ie({inputs:{x},backend:n,attrs:{shape:u}});p[m]=g,d.push(x)}return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const ude={kernelName:n0,backendName:"webgl",kernelFunc:lde};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cde{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const l="0.0",u="sumValue",c=Math.floor(s/4)*4,d=s%4,h=`
        sumValue += dot(values, segFilter);
    `;let f="";o%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,l=[];let u=0;const c=Tt([u],a);let d=r;c!=null&&(d=zn({inputs:{x:r},backend:n,attrs:{perm:c}}),l.push(d),u=Pt(1,a)[0]);const h=rD(d.shape,u,i),f=Q([d.shape[u]]),p=ie({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});l.push(p);const m=xw(r.dtype),x=(b,w,$,k,C)=>{const S=b.shape[0],T=b.shape[1],R=sD(T,C),A={windowSize:R,inSize:T,batchSize:S,numSegments:C},E=new cde(A,w),N=n.compileAndRun(E,[b,$],k);if(l.push(N),N.shape[1]===C)return N;const P=C_({backend:n,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),_=$_({inputs:{x:P},backend:n,attrs:{reps:[T/R]}});return l.push(P),l.push(_),x(N,w,_,k,C)},g=x(p,"unsortedSegmentSum",o,m,i),y=ie({inputs:{x:g},backend:n,attrs:{shape:h}});let v=y;if(c!=null){l.push(y);const b=Ei(c);v=zn({inputs:{x:v},backend:n,attrs:{perm:b}})}return l.forEach(b=>n.disposeIntermediateTensorInfo(b)),v}const hde={kernelName:s0,backendName:"webgl",kernelFunc:dde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fde=[Yne,Zne,tse,rse,ise,use,dse,fse,xse,vse,Cse,Sse,Ese,Dse,Pse,Lse,zse,Use,Hse,Kse,Qse,rre,ire,cre,hre,yre,bre,kre,Fne,Tre,Dre,_re,Wre,Hre,Kre,qre,Qre,toe,roe,aoe,uoe,doe,foe,goe,yoe,Coe,koe,Toe,Roe,Doe,_oe,Boe,Goe,Koe,Yoe,Qoe,Joe,tie,sie,oie,aie,die,pie,xie,vie,Cie,Sie,Nie,Fie,Dne,Pie,Rre,Mie,Vie,Gie,Pne,Xie,Zie,eae,rae,aae,dae,pae,yae,Cae,Sae,Tae,Aae,Fae,Pae,zae,Vae,Uae,Hae,Kae,Qae,tle,ole,fle,Mne,xle,ble,$le,Ile,pre,Nle,Ale,Fle,_le,Ble,Lne,Wle,Gle,jle,Xle,qle,mre,ule,Zle,nue,iue,Bne,cue,fue,xue,bue,kue,Iue,Nue,Due,Pue,Mue,Vue,Gue,Xue,Que,tce,rce,nre,dle,ace,uce,dce,fce,mce,xce,vce,wce,$ce,Ice,Ece,Rce,Dce,Pce,Lce,zce,Vce,cle,Kne,Gce,Kce,qce,Zce,nde,ode,Xne,ade,ude,hde,Rle];for(const t of fde)fR(t);oW("webgl").then(()=>{console.log("WebGL backend initialized")});const KI=.2,pde=20,xc=t=>{switch(t){case na:return"Easy";case _c:return"Medium";case Lc:return"Hard";default:return"Unknown"}},mde=t=>t>999?(t/1e3).toFixed(0)+"K":t.toString(),na="level-0",_c="level-1",Lc="level-2",XI={[na]:{initialIslands:5,initialSteps:0,minInitialVirusArea:0},[_c]:{initialIslands:4,initialSteps:5,minInitialVirusArea:0},[Lc]:{initialIslands:2,initialSteps:12,minInitialVirusArea:50}};class gde extends EventTarget{}const Or=new gde,Of=(t,e,n=33,s=150)=>{let r,o,i=!1;const a=(u,c)=>{t.includes(u)&&!i&&(c==null||c.preventDefault(),e(c),i=!0,o=setTimeout(()=>{r=setInterval(e.bind(void 0,c),n)},s))},l=u=>{t.includes(u)&&(i=!1,clearInterval(r),clearTimeout(o))};window.addEventListener("keydown",u=>{a(u.key,u)}),window.addEventListener("keyup",u=>{l(u.key)}),Or.addEventListener("keydown",u=>{a(u.detail)}),Or.addEventListener("keyup",u=>{l(u.detail)})},xde=180,yde=window.innerWidth,vde=window.innerHeight-xde,je=22,bde=yde/je,wde=vde/je;class Cm{constructor(){tn(this,"difficulty",na);tn(this,"HEIGHT",Math.floor(Math.min(25,wde)));tn(this,"WIDTH",Math.floor(Math.min(30,bde)));tn(this,"grid",kt([this.HEIGHT,this.WIDTH]));tn(this,"activeCells",kt([this.HEIGHT,this.WIDTH]));tn(this,"virusCells",kt([this.HEIGHT,this.WIDTH]));tn(this,"focusedCell",[0,0]);tn(this,"actionQueue",[]);tn(this,"generation",0);tn(this,"hasWon",!1);tn(this,"hasLost",!1);tn(this,"virusMoveRate",KI);tn(this,"trailSize",0);tn(this,"replay",[]);tn(this,"onUpdateCallback",()=>{});tn(this,"onGeneratedImageCallback",e=>{});tn(this,"resultCanvas",document.createElement("canvas"));tn(this,"stats",{activeCellCount:0,virusCellCount:0,wasFocusedCellEaten:!1});this.resetGame()}setTrailSize(e){this.trailSize=e,this.onUpdateCallback()}resetGame(){this.grid=Fo([this.HEIGHT,this.WIDTH]).mul(-1),this.activeCells=kt([this.HEIGHT,this.WIDTH]),this.virusCells=kt([this.HEIGHT,this.WIDTH]);const e=[Math.floor(Math.random()*this.HEIGHT),Math.floor(Math.random()*this.WIDTH)];this.focusedCell=e,this.actionQueue=[],this.generation=0,this.hasWon=!1,this.hasLost=!1,this.virusMoveRate=KI;const n=this.activeCells.arraySync(),s=this.grid.arraySync(),r=this.virusCells.arraySync();for(let i=0;i<XI[this.difficulty].initialIslands;i++){const a=[Math.floor(Math.random()*this.HEIGHT),Math.floor(Math.random()*this.WIDTH)];r[a[0]][a[1]]=1,s[a[0]][a[1]]=1}n[this.focusedCell[0]][this.focusedCell[1]]=1,s[this.focusedCell[0]][this.focusedCell[1]]=50,this.activeCells=Vn(n),this.grid=Vn(s),this.virusCells=Vn(r);const o=XI[this.difficulty];for(let i=0;i<o.initialSteps;i++)this.step();for(;this.stats.virusCellCount<o.minInitialVirusArea;)this.step();this.generation=0,this.replay=[]}bindEvents(){Of(["w","W","ArrowUp"],e=>{e!=null&&e.shiftKey?this.autoSweep([-1,0]):this.moveTo({initialCellPosition:this.focusedCell,destinationCellPosition:[this.focusedCell[0]-1,this.focusedCell[1]]})}),Of(["s","S","ArrowDown"],e=>{e!=null&&e.shiftKey?this.autoSweep([1,0]):this.moveTo({initialCellPosition:this.focusedCell,destinationCellPosition:[this.focusedCell[0]+1,this.focusedCell[1]]})}),Of(["a","A","ArrowLeft"],e=>{e!=null&&e.shiftKey?this.autoSweep([0,-1]):this.moveTo({initialCellPosition:this.focusedCell,destinationCellPosition:[this.focusedCell[0],this.focusedCell[1]-1]})}),Of(["d","D","ArrowRight"],e=>{e!=null&&e.shiftKey?this.autoSweep([0,1]):this.moveTo({initialCellPosition:this.focusedCell,destinationCellPosition:[this.focusedCell[0],this.focusedCell[1]+1]})})}queueAction(e){this.actionQueue.push(e)}checkBounds([e,n]){return e>=0&&e<this.HEIGHT&&n>=0&&n<this.WIDTH}async autoSweep(e,n=1/0){let s=this.focusedCell[0],r=this.focusedCell[1],o=0,i=0,a=!1;const l=[];for(;o<n&&this.checkBounds([s,r]);){const u=s,c=r;l.push(new Promise(d=>{setTimeout(()=>{if(a){d();return}this.moveTo({initialCellPosition:[u,c],destinationCellPosition:[u+e[0],c+e[1]]})||(a=!0),d()},i)})),s+=e[0],r+=e[1],i+=pde,o++}await Promise.all(l)}moveToMeta({initialCellPosition:e,destinationCellPosition:n,grid:s,playerCells:r,enemyCells:o,trailSize:i}){i=i||0;const a=n,l=e;if(!this.checkBounds(l)||!this.checkBounds(a)||l[0]!==a[0]&&l[1]!==a[1]||Math.abs(l[0]-a[0])>1||Math.abs(l[1]-a[1])>1)return!1;const u=s[l[0]][l[1]];let c=0;if(o[a[0]][a[1]]===1?c=s[a[0]][a[1]]:(r[a[0]][a[1]]>0&&r[l[0]][l[1]]>0,c=-s[a[0]][a[1]]),u<=c||r[l[0]][l[1]]!==1)return!1;s[l[0]][l[1]]=0,s[a[0]][a[1]]=u-c;{let d=!1;for(let h=-1;h<=1;h++)for(let f=-1;f<=1;f++)this.checkBounds([l[0]+h,l[1]+f])&&o[l[0]+h][l[1]+f]===1&&(d=!0);if(d){const h=i>0?i-s[l[0]][l[1]]:0;i>0&&s[a[0]][a[1]]>i&&h>0&&(s[l[0]][l[1]]=h,s[a[0]][a[1]]-=h)}}return r[a[0]][a[1]]=1,o[a[0]][a[1]]=0,this.onUpdateCallback(),!0}moveTo({initialCellPosition:e,destinationCellPosition:n}){const s=this.grid.arraySync(),r=this.activeCells.arraySync(),o=this.virusCells.arraySync(),i=this.moveToMeta({initialCellPosition:e,destinationCellPosition:n,grid:s,playerCells:r,enemyCells:o,trailSize:this.trailSize});return i&&(this.activeCells=Vn(r),this.grid=Vn(s),this.virusCells=Vn(o),this.focusedCell=structuredClone(n),this.onUpdateCallback(),!0)}moveVirusTo({initialCellPosition:e,destinationCellPosition:n}){const s=this.grid.arraySync(),r=this.activeCells.arraySync(),o=this.virusCells.arraySync();this.moveToMeta({initialCellPosition:e,destinationCellPosition:n,grid:s,enemyCells:r,playerCells:o})&&(this.activeCells=Vn(r),this.grid=Vn(s),this.virusCells=Vn(o),this.onUpdateCallback())}focusCell([e,n]){this.activeCells.arraySync()[e][n]===1&&(this.focusedCell=[e,n]),this.onUpdateCallback()}async autoSweepTo([e,n]){const s=this.activeCells.arraySync(),r=this.focusedCell[0],o=this.focusedCell[1],i=Math.abs(e-r);await this.autoSweep([Math.sign(e-r),0],i);const a=Math.abs(n-o);await this.autoSweep([0,Math.sign(n-o)],a),s[e][n]===1&&(this.focusedCell=[e,n]),this.onUpdateCallback()}step(){if(!(this.hasWon||this.hasLost)){for(;this.actionQueue.length>0;)this.actionQueue.shift().call(this);this.queueAction(()=>{if(this.hasWon)return;const e=structuredClone(this.grid.arraySync()),n=this.activeCells.arraySync(),s=this.virusCells.arraySync();for(let r=0;r<this.grid.shape[0];r++)for(let o=0;o<this.grid.shape[1];o++)if(n[r][o]===1&&this.generation%5===0)e[r][o]++;else if(s[r][o]===1&&(e[r][o]++,Math.random()<this.virusMoveRate)){const i=[[r-1,o],[r+1,o],[r,o-1],[r,o+1]],a=i[Math.floor(Math.random()*i.length)];this.queueAction(()=>{this.moveVirusTo({initialCellPosition:[r,o],destinationCellPosition:a})})}this.grid=Vn(e),this.detectGameStatus()||this.generation++,this.storeReplay()})}}saveState(){return{WIDTH:this.WIDTH,HEIGHT:this.HEIGHT,grid:this.grid.arraySync(),activeCells:this.activeCells.arraySync(),virusCells:this.virusCells.arraySync(),focusedCell:structuredClone(this.focusedCell),generation:this.generation,stats:structuredClone(this.stats)}}storeReplay(){this.replay.push(this.saveState())}restoreReplayState(e){this.WIDTH=e.WIDTH,this.HEIGHT=e.HEIGHT,this.grid=Vn(e.grid),this.activeCells=Vn(e.activeCells),this.virusCells=Vn(e.virusCells),this.focusedCell=structuredClone(e.focusedCell),this.generation=e.generation,this.stats=structuredClone(e.stats)}async generateShareImage(){if(window.innerWidth<768)return;this.onGeneratedImageCallback(null);const e=new Cm,n=this.resultCanvas,s=n.getContext("2d"),r=240,o=20,i=4,a=[];for(let c=0;c<i;c++)a.push(Math.floor(c/i*this.replay.length));const l=[0,...a,this.replay.length-1];s.shadowColor="black",s.shadowBlur=7;for(let c=0;c<l.length;c++){const d=l[c];e.restoreReplayState(this.replay[d]);const h=document.createElement("canvas");e.drawCanvas(h);const f=3;c===0&&(n.width=h.width*f+o*(f+1),n.height=r+o+(h.height+o)*Math.ceil(l.length/f)+o,s.fillStyle="#242424",s.fillRect(0,0,n.width,n.height));const p=o+(h.width+o)*(c%f),m=r+(h.height+o)*Math.floor(c/f);s.drawImage(h,p,m),s.font="bold 20px Arial",s.textAlign="left",s.fillStyle="#ffffff";const x=`Generation: ${e.generation}`;s.fillText(x,p+20,m+40);const g=`You: ${e.stats.activeCellCount}`;s.fillText(g,p+20,m+60);const y=`Virus: ${e.stats.virusCellCount}`;s.fillText(y,p+20,m+80)}s.fillStyle="#ffffff";const u=this.hasWon?"You won!":"Virus Won!";s.textAlign="center",s.font="bold 60px Arial",s.fillText(u,n.width/2,r/2-30),s.font="bold 20px Arial",s.fillText("Level: "+xc(this.difficulty),n.width/2,r/2+30),s.font="bold 20px Arial",s.fillText("Play at https://antoinemopa.github.io/grid/",n.width/2,r-40),this.onGeneratedImageCallback(n)}async generateShareVideo(){let n=await(await window.showSaveFilePicker({suggestedName:"video.mp4",types:[{description:"Video File",accept:{"video/mp4":[".mp4"]}}]})).createWritable();const s=new Cm,r=document.createElement("canvas");r.width=this.WIDTH*je,r.height=this.HEIGHT*je;const o=new hV({target:new TN(n),video:{codec:"avc",width:r.width,height:r.height},fastStart:!1}),i=new VideoEncoder({output:(a,l)=>o.addVideoChunk(a,l),error:a=>console.error(a)});i.configure({codec:"avc1.42001f",width:r.width,height:r.height,framerate:30,bitrate:1e6});for(let a=0;a<this.replay.length;a++){s.restoreReplayState(this.replay[a]),s.drawCanvas(r);const l=a*30*1e3,u=new VideoFrame(r,{timestamp:l});i.encode(u),u.close()}await i.flush(),o.finalize(),await n.close()}detectGameStatus(){if(this.hasWon||this.hasLost)return!0;const e=this.activeCells.mul(this.grid).sum().arraySync(),n=this.virusCells.mul(this.grid).sum().arraySync();return this.stats.activeCellCount=e,this.stats.virusCellCount=n,this.stats.wasFocusedCellEaten=this.virusCells.arraySync()[this.focusedCell[0]][this.focusedCell[1]]===1,this.onUpdateCallback(),n===0?(this.hasWon=!0,this.storeReplay(),this.generateShareImage(),!0):e===0?(this.hasLost=!0,this.storeReplay(),this.generateShareImage(),!0):!1}screenCoordsToTableCoords([e,n]){const s=Math.floor(n/je),r=Math.floor(e/je);return[s,r]}drawCanvas(e){const n=e.getContext("2d"),s=this.WIDTH*je,r=this.HEIGHT*je;e.width=s*window.devicePixelRatio,e.height=r*window.devicePixelRatio,e.style.width=s+"px",e.style.height=r+"px",n.scale(window.devicePixelRatio,window.devicePixelRatio);const o=this.grid.arraySync(),i=this.activeCells.arraySync(),a=this.virusCells.arraySync();n.fillStyle="#242424",n.fillRect(0,0,e.width,e.height);for(let l=0;l<this.HEIGHT;l++)for(let u=0;u<this.WIDTH;u++){let c="#ffffff",d=!1;if(n.fillStyle="#222222",n.fillRect(u*je,l*je,je,je),this.focusedCell[0]===l&&this.focusedCell[1]===u?(n.beginPath(),n.roundRect(u*je+1,l*je+1,je-2,je-2,3),n.fillStyle="#3300ff",n.fill(),n.strokeStyle="#eee",n.lineWidth=2,n.stroke(),d=!0):i[l][u]===1?(n.fillStyle="#aaa",n.fillRect(u*je+1,l*je+1,je-2,je-2),c="#000000",d=!0):a[l][u]===1?(n.fillStyle="#ff0000",n.fillRect(u*je+1,l*je+1,je-2,je-2),d=!0):(n.fillStyle="#333333",n.fillRect(u*je+1,l*je+1,je-2,je-2)),d){n.fillStyle=c,n.font="8px Sans-serif",n.textAlign="center";const h=mde(o[l][u]);n.fillText(h,u*je+je/2,l*je+je/2+3)}}}}function h$(t={}){const{strict:e=!0,errorMessage:n="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:s}=t,r=O.createContext(void 0);r.displayName=s;function o(){var i;const a=O.useContext(r);if(!a&&e){const l=new Error(n);throw l.name="ContextError",(i=Error.captureStackTrace)==null||i.call(Error,l,o),l}return a}return[r.Provider,o,r]}function _u(t){const e=O.useRef(null);return O.useImperativeHandle(t,()=>e.current),e}function k_(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=k_(t[e]))&&(s&&(s+=" "),s+=n);else for(e in t)t[e]&&(s&&(s+=" "),s+=e);return s}function hu(...t){for(var e=0,n,s,r="";e<t.length;)(n=t[e++])&&(s=k_(n))&&(r&&(r+=" "),r+=s);return r}function Cde(t){return`${t}-${Math.floor(Math.random()*1e6)}`}function f$(t){if(!t||typeof t!="object")return"";try{return JSON.stringify(t)}catch{return""}}function $de(t,e,n){return Math.min(Math.max(t,e),n)}var Br=t=>t?"true":void 0,kde=new Set(["id","type","style","title","role","tabIndex","htmlFor","width","height","abbr","accept","acceptCharset","accessKey","action","allowFullScreen","allowTransparency","alt","async","autoComplete","autoFocus","autoPlay","cellPadding","cellSpacing","challenge","charset","checked","cite","class","className","cols","colSpan","command","content","contentEditable","contextMenu","controls","coords","crossOrigin","data","dateTime","default","defer","dir","disabled","download","draggable","dropzone","encType","enterKeyHint","for","form","formAction","formEncType","formMethod","formNoValidate","formTarget","frameBorder","headers","hidden","high","href","hrefLang","httpEquiv","icon","inputMode","isMap","itemId","itemProp","itemRef","itemScope","itemType","kind","label","lang","list","loop","manifest","max","maxLength","media","mediaGroup","method","min","minLength","multiple","muted","name","noValidate","open","optimum","pattern","ping","placeholder","poster","preload","radioGroup","referrerPolicy","readOnly","rel","required","rows","rowSpan","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","slot","sortable","span","spellCheck","src","srcDoc","srcSet","start","step","target","translate","typeMustMatch","useMap","value","wmode","wrap"]),Sde=new Set(["onCopy","onCut","onPaste","onLoad","onError","onWheel","onScroll","onCompositionEnd","onCompositionStart","onCompositionUpdate","onKeyDown","onKeyPress","onKeyUp","onFocus","onBlur","onChange","onInput","onSubmit","onClick","onContextMenu","onDoubleClick","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onPointerDown","onPointerEnter","onPointerLeave","onPointerUp","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionEnd"]),qI=/^(data-.*)$/,Ide=/^(aria-.*)$/,Pf=/^(on[A-Z].*)$/;function YI(t,e={}){let{labelable:n=!0,enabled:s=!0,propNames:r,omitPropNames:o,omitEventNames:i,omitDataProps:a,omitEventProps:l}=e,u={};if(!s)return t;for(const c in t)o!=null&&o.has(c)||i!=null&&i.has(c)&&Pf.test(c)||Pf.test(c)&&!Sde.has(c)||a&&qI.test(c)||l&&Pf.test(c)||(Object.prototype.hasOwnProperty.call(t,c)&&(kde.has(c)||n&&Ide.test(c)||r!=null&&r.has(c)||qI.test(c))||Pf.test(c))&&(u[c]=t[c]);return u}var[Bxe,p$]=h$({name:"ProviderContext",strict:!1});const $m={prefix:String(Math.round(Math.random()*1e10)),current:0},S_=ct.createContext($m),Tde=ct.createContext(!1);let Ede=!!(typeof window<"u"&&window.document&&window.document.createElement),zx=new WeakMap;function Nde(t=!1){let e=O.useContext(S_),n=O.useRef(null);if(n.current===null&&!t){var s,r;let o=(r=ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)===null||r===void 0||(s=r.ReactCurrentOwner)===null||s===void 0?void 0:s.current;if(o){let i=zx.get(o);i==null?zx.set(o,{id:e.current,state:o.memoizedState}):o.memoizedState!==i.state&&(e.current=i.id,zx.delete(o))}n.current=++e.current}return n.current}function Rde(t){let e=O.useContext(S_);e===$m&&!Ede&&console.warn("When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server.");let n=Nde(!!t),s=`react-aria${e.prefix}`;return t||`${s}-${n}`}function Ade(t){let e=ct.useId(),[n]=O.useState(m$()),s=n?"react-aria":`react-aria${$m.prefix}`;return t||`${s}-${e}`}const Dde=typeof ct.useId=="function"?Ade:Rde;function Fde(){return!1}function Ode(){return!0}function Pde(t){return()=>{}}function m$(){return typeof ct.useSyncExternalStore=="function"?ct.useSyncExternalStore(Pde,Fde,Ode):O.useContext(Tde)}const _de=Symbol.for("react-aria.i18n.locale"),Lde=Symbol.for("react-aria.i18n.strings");let il;class P0{getStringForLocale(e,n){let r=this.getStringsForLocale(n)[e];if(!r)throw new Error(`Could not find intl message ${e} in ${n} locale`);return r}getStringsForLocale(e){let n=this.strings[e];return n||(n=Mde(e,this.strings,this.defaultLocale),this.strings[e]=n),n}static getGlobalDictionaryForPackage(e){if(typeof window>"u")return null;let n=window[_de];if(il===void 0){let r=window[Lde];if(!r)return null;il={};for(let o in r)il[o]=new P0({[n]:r[o]},n)}let s=il==null?void 0:il[e];if(!s)throw new Error(`Strings for package "${e}" were not included by LocalizedStringProvider. Please add it to the list passed to createLocalizedStringDictionary.`);return s}constructor(e,n="en-US"){this.strings=Object.fromEntries(Object.entries(e).filter(([,s])=>s)),this.defaultLocale=n}}function Mde(t,e,n="en-US"){if(e[t])return e[t];let s=zde(t);if(e[s])return e[s];for(let r in e)if(r.startsWith(s+"-"))return e[r];return e[n]}function zde(t){return Intl.Locale?new Intl.Locale(t).language:t.split("-")[0]}const QI=new Map,ZI=new Map;class Bde{format(e,n){let s=this.strings.getStringForLocale(e,this.locale);return typeof s=="function"?s(n,this):s}plural(e,n,s="cardinal"){let r=n["="+e];if(r)return typeof r=="function"?r():r;let o=this.locale+":"+s,i=QI.get(o);i||(i=new Intl.PluralRules(this.locale,{type:s}),QI.set(o,i));let a=i.select(e);return r=n[a]||n.other,typeof r=="function"?r():r}number(e){let n=ZI.get(this.locale);return n||(n=new Intl.NumberFormat(this.locale),ZI.set(this.locale,n)),n.format(e)}select(e,n){let s=e[n]||e.other;return typeof s=="function"?s():s}constructor(e,n){this.locale=e,this.strings=n}}function Vde(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Wde(t,e,n){Vde(t,e),e.set(t,n)}const Xt=typeof document<"u"?ct.useLayoutEffect:()=>{};function pr(t){const e=O.useRef(null);return Xt(()=>{e.current=t},[t]),O.useCallback((...n)=>{const s=e.current;return s==null?void 0:s(...n)},[])}function Ude(t){let[e,n]=O.useState(t),s=O.useRef(null),r=pr(()=>{if(!s.current)return;let i=s.current.next();if(i.done){s.current=null;return}e===i.value?r():n(i.value)});Xt(()=>{s.current&&r()});let o=pr(i=>{s.current=i(e),r()});return[e,o]}let Gde=!!(typeof window<"u"&&window.document&&window.document.createElement),km=new Map;function I_(t){let[e,n]=O.useState(t),s=O.useRef(null),r=Dde(e),o=O.useCallback(i=>{s.current=i},[]);return Gde&&km.set(r,o),Xt(()=>{let i=r;return()=>{km.delete(i)}},[r]),O.useEffect(()=>{let i=s.current;i&&(s.current=null,n(i))}),r}function Hde(t,e){if(t===e)return t;let n=km.get(t);if(n)return n(e),e;let s=km.get(e);return s?(s(t),t):e}function jde(t=[]){let e=I_(),[n,s]=Ude(e),r=O.useCallback(()=>{s(function*(){yield e,yield document.getElementById(e)?e:void 0})},[e,s]);return Xt(r,[e,r,...t]),n}function bi(...t){return(...e)=>{for(let n of t)typeof n=="function"&&n(...e)}}const Me=t=>{var e;return(e=t==null?void 0:t.ownerDocument)!==null&&e!==void 0?e:document},qt=t=>t&&"window"in t&&t.window===t?t:Me(t).defaultView||window;function T_(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=T_(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function Kde(){for(var t,e,n=0,s="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=T_(t))&&(s&&(s+=" "),s+=e);return s}function Zs(...t){let e={...t[0]};for(let n=1;n<t.length;n++){let s=t[n];for(let r in s){let o=e[r],i=s[r];typeof o=="function"&&typeof i=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=bi(o,i):(r==="className"||r==="UNSAFE_className")&&typeof o=="string"&&typeof i=="string"?e[r]=Kde(o,i):r==="id"&&o&&i?e.id=Hde(o,i):e[r]=i!==void 0?i:o}}return e}function Xde(...t){return t.length===1?t[0]:e=>{for(let n of t)typeof n=="function"?n(e):n!=null&&(n.current=e)}}const qde=new Set(["id"]),Yde=new Set(["aria-label","aria-labelledby","aria-describedby","aria-details"]),Qde=new Set(["href","hrefLang","target","rel","download","ping","referrerPolicy"]),Zde=/^(data-.*)$/;function E_(t,e={}){let{labelable:n,isLink:s,propNames:r}=e,o={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(qde.has(i)||n&&Yde.has(i)||s&&Qde.has(i)||r!=null&&r.has(i)||Zde.test(i))&&(o[i]=t[i]);return o}function xr(t){if(Jde())t.focus({preventScroll:!0});else{let e=ehe(t);t.focus(),the(e)}}let _f=null;function Jde(){if(_f==null){_f=!1;try{document.createElement("div").focus({get preventScroll(){return _f=!0,!0}})}catch{}}return _f}function ehe(t){let e=t.parentNode,n=[],s=document.scrollingElement||document.documentElement;for(;e instanceof HTMLElement&&e!==s;)(e.offsetHeight<e.scrollHeight||e.offsetWidth<e.scrollWidth)&&n.push({element:e,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),e=e.parentNode;return s instanceof HTMLElement&&n.push({element:s,scrollTop:s.scrollTop,scrollLeft:s.scrollLeft}),n}function the(t){for(let{element:e,scrollTop:n,scrollLeft:s}of t)e.scrollTop=n,e.scrollLeft=s}function _0(t){var e;return typeof window>"u"||window.navigator==null?!1:((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.brands.some(n=>t.test(n.brand)))||t.test(window.navigator.userAgent)}function g$(t){var e;return typeof window<"u"&&window.navigator!=null?t.test(((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.platform)||window.navigator.platform):!1}function wi(){return g$(/^Mac/i)}function nhe(){return g$(/^iPhone/i)}function N_(){return g$(/^iPad/i)||wi()&&navigator.maxTouchPoints>1}function x$(){return nhe()||N_()}function she(){return _0(/AppleWebKit/i)&&!rhe()}function rhe(){return _0(/Chrome/i)}function R_(){return _0(/Android/i)}function ohe(){return _0(/Firefox/i)}function wd(t,e,n=!0){var s,r;let{metaKey:o,ctrlKey:i,altKey:a,shiftKey:l}=e;ohe()&&(!((r=window.event)===null||r===void 0||(s=r.type)===null||s===void 0)&&s.startsWith("key"))&&t.target==="_blank"&&(wi()?o=!0:i=!0);let u=she()&&wi()&&!N_()?new KeyboardEvent("keydown",{keyIdentifier:"Enter",metaKey:o,ctrlKey:i,altKey:a,shiftKey:l}):new MouseEvent("click",{metaKey:o,ctrlKey:i,altKey:a,shiftKey:l,bubbles:!0,cancelable:!0});wd.isOpening=n,xr(t),t.dispatchEvent(u),wd.isOpening=!1}wd.isOpening=!1;let fl=new Map,Vv=new Set;function JI(){if(typeof window>"u")return;function t(s){return"propertyName"in s}let e=s=>{if(!t(s)||!s.target)return;let r=fl.get(s.target);r||(r=new Set,fl.set(s.target,r),s.target.addEventListener("transitioncancel",n,{once:!0})),r.add(s.propertyName)},n=s=>{if(!t(s)||!s.target)return;let r=fl.get(s.target);if(r&&(r.delete(s.propertyName),r.size===0&&(s.target.removeEventListener("transitioncancel",n),fl.delete(s.target)),fl.size===0)){for(let o of Vv)o();Vv.clear()}};document.body.addEventListener("transitionrun",e),document.body.addEventListener("transitionend",n)}typeof document<"u"&&(document.readyState!=="loading"?JI():document.addEventListener("DOMContentLoaded",JI));function L0(t){requestAnimationFrame(()=>{fl.size===0?t():Vv.add(t)})}function ihe(){let t=O.useRef(new Map),e=O.useCallback((r,o,i,a)=>{let l=a!=null&&a.once?(...u)=>{t.current.delete(i),i(...u)}:i;t.current.set(i,{type:o,eventTarget:r,fn:l,options:a}),r.addEventListener(o,i,a)},[]),n=O.useCallback((r,o,i,a)=>{var l;let u=((l=t.current.get(i))===null||l===void 0?void 0:l.fn)||i;r.removeEventListener(o,u,a),t.current.delete(i)},[]),s=O.useCallback(()=>{t.current.forEach((r,o)=>{n(r.eventTarget,r.type,o,r.options)})},[n]);return O.useEffect(()=>s,[s]),{addGlobalListener:e,removeGlobalListener:n,removeAllGlobalListeners:s}}function ahe(t,e){let{id:n,"aria-label":s,"aria-labelledby":r}=t;return n=I_(n),r&&s?r=[...new Set([n,...r.trim().split(/\s+/)])].join(" "):r&&(r=r.trim().split(/\s+/).join(" ")),!s&&!r&&e&&(s=e),{id:n,"aria-label":s,"aria-labelledby":r}}function A_(t,e){Xt(()=>{if(t&&t.ref&&e)return t.ref.current=e.current,()=>{t.ref&&(t.ref.current=null)}})}function e2(t,e){let n=window.getComputedStyle(t),s=/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY);return s&&e&&(s=t.scrollHeight!==t.clientHeight||t.scrollWidth!==t.clientWidth),s}function D_(t,e){let n=t;for(e2(n,e)&&(n=n.parentElement);n&&!e2(n,e);)n=n.parentElement;return n||document.scrollingElement||document.documentElement}function fu(t){return t.mozInputSource===0&&t.isTrusted?!0:R_()&&t.pointerType?t.type==="click"&&t.buttons===1:t.detail===0&&!t.pointerType}function lhe(t){return!R_()&&t.width===0&&t.height===0||t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"}function uhe(t,e,n){let[s,r]=O.useState(t||e),o=O.useRef(t!==void 0),i=t!==void 0;O.useEffect(()=>{let u=o.current;u!==i&&console.warn(`WARN: A component changed from ${u?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}.`),o.current=i},[i]);let a=i?t:s,l=O.useCallback((u,...c)=>{let d=(h,...f)=>{n&&(Object.is(a,h)||n(h,...f)),i||(a=h)};typeof u=="function"?(console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),r((f,...p)=>{let m=u(i?a:f,...p);return d(m,...c),i?f:m})):(i||r(u),d(u,...c))},[i,a,n]);return[a,l]}var F_={};F_={dismiss:"تجاهل"};var O_={};O_={dismiss:"Отхвърляне"};var P_={};P_={dismiss:"Odstranit"};var __={};__={dismiss:"Luk"};var L_={};L_={dismiss:"Schließen"};var M_={};M_={dismiss:"Απόρριψη"};var z_={};z_={dismiss:"Dismiss"};var B_={};B_={dismiss:"Descartar"};var V_={};V_={dismiss:"Lõpeta"};var W_={};W_={dismiss:"Hylkää"};var U_={};U_={dismiss:"Rejeter"};var G_={};G_={dismiss:"התעלם"};var H_={};H_={dismiss:"Odbaci"};var j_={};j_={dismiss:"Elutasítás"};var K_={};K_={dismiss:"Ignora"};var X_={};X_={dismiss:"閉じる"};var q_={};q_={dismiss:"무시"};var Y_={};Y_={dismiss:"Atmesti"};var Q_={};Q_={dismiss:"Nerādīt"};var Z_={};Z_={dismiss:"Lukk"};var J_={};J_={dismiss:"Negeren"};var e3={};e3={dismiss:"Zignoruj"};var t3={};t3={dismiss:"Descartar"};var n3={};n3={dismiss:"Dispensar"};var s3={};s3={dismiss:"Revocare"};var r3={};r3={dismiss:"Пропустить"};var o3={};o3={dismiss:"Zrušiť"};var i3={};i3={dismiss:"Opusti"};var a3={};a3={dismiss:"Odbaci"};var l3={};l3={dismiss:"Avvisa"};var u3={};u3={dismiss:"Kapat"};var c3={};c3={dismiss:"Скасувати"};var d3={};d3={dismiss:"取消"};var h3={};h3={dismiss:"關閉"};const che=new Set(["Arab","Syrc","Samr","Mand","Thaa","Mend","Nkoo","Adlm","Rohg","Hebr"]),dhe=new Set(["ae","ar","arc","bcc","bqi","ckb","dv","fa","glk","he","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"]);function hhe(t){if(Intl.Locale){let n=new Intl.Locale(t).maximize(),s=typeof n.getTextInfo=="function"?n.getTextInfo():n.textInfo;if(s)return s.direction==="rtl";if(n.script)return che.has(n.script)}let e=t.split("-")[0];return dhe.has(e)}const fhe=Symbol.for("react-aria.i18n.locale");function f3(){let t=typeof window<"u"&&window[fhe]||typeof navigator<"u"&&(navigator.language||navigator.userLanguage)||"en-US";try{Intl.DateTimeFormat.supportedLocalesOf([t])}catch{t="en-US"}return{locale:t,direction:hhe(t)?"rtl":"ltr"}}let Wv=f3(),yc=new Set;function t2(){Wv=f3();for(let t of yc)t(Wv)}function phe(){let t=m$(),[e,n]=O.useState(Wv);return O.useEffect(()=>(yc.size===0&&window.addEventListener("languagechange",t2),yc.add(n),()=>{yc.delete(n),yc.size===0&&window.removeEventListener("languagechange",t2)}),[]),t?{locale:"en-US",direction:"ltr"}:e}const mhe=ct.createContext(null);function ghe(){let t=phe();return O.useContext(mhe)||t}const n2=new WeakMap;function xhe(t){let e=n2.get(t);return e||(e=new P0(t),n2.set(t,e)),e}function yhe(t,e){return e&&P0.getGlobalDictionaryForPackage(e)||xhe(t)}function vhe(t,e){let{locale:n}=ghe(),s=yhe(t,e);return O.useMemo(()=>new Bde(n,s),[n,s])}const p3=ct.createContext({register:()=>{}});p3.displayName="PressResponderContext";function bhe(t,e){return e.get?e.get.call(t):e.value}function m3(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function whe(t,e){var n=m3(t,e,"get");return bhe(t,n)}function Che(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}function s2(t,e,n){var s=m3(t,e,"set");return Che(t,s,n),n}function $he({children:t}){let e=O.useMemo(()=>({register:()=>{}}),[]);return ct.createElement(p3.Provider,{value:e},t)}let khe=class{isDefaultPrevented(){return this.nativeEvent.defaultPrevented}preventDefault(){this.defaultPrevented=!0,this.nativeEvent.preventDefault()}stopPropagation(){this.nativeEvent.stopPropagation(),this.isPropagationStopped=()=>!0}isPropagationStopped(){return!1}persist(){}constructor(e,n){this.nativeEvent=n,this.target=n.target,this.currentTarget=n.currentTarget,this.relatedTarget=n.relatedTarget,this.bubbles=n.bubbles,this.cancelable=n.cancelable,this.defaultPrevented=n.defaultPrevented,this.eventPhase=n.eventPhase,this.isTrusted=n.isTrusted,this.timeStamp=n.timeStamp,this.type=e}};function She(t){let e=O.useRef({isFocused:!1,observer:null});Xt(()=>{const s=e.current;return()=>{s.observer&&(s.observer.disconnect(),s.observer=null)}},[]);let n=pr(s=>{t==null||t(s)});return O.useCallback(s=>{if(s.target instanceof HTMLButtonElement||s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement||s.target instanceof HTMLSelectElement){e.current.isFocused=!0;let r=s.target,o=i=>{e.current.isFocused=!1,r.disabled&&n(new khe("blur",i)),e.current.observer&&(e.current.observer.disconnect(),e.current.observer=null)};r.addEventListener("focusout",o,{once:!0}),e.current.observer=new MutationObserver(()=>{if(e.current.isFocused&&r.disabled){var i;(i=e.current.observer)===null||i===void 0||i.disconnect();let a=r===document.activeElement?null:document.activeElement;r.dispatchEvent(new FocusEvent("blur",{relatedTarget:a})),r.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:a}))}}),e.current.observer.observe(r,{attributes:!0,attributeFilter:["disabled"]})}},[n])}let Yh=null,Ihe=new Set,Mc=new Map,Pa=!1,Uv=!1;function y$(t,e){for(let n of Ihe)n(t,e)}function The(t){return!(t.metaKey||!wi()&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}function Sm(t){Pa=!0,The(t)&&(Yh="keyboard",y$("keyboard",t))}function _s(t){Yh="pointer",(t.type==="mousedown"||t.type==="pointerdown")&&(Pa=!0,y$("pointer",t))}function g3(t){fu(t)&&(Pa=!0,Yh="virtual")}function x3(t){t.target===window||t.target===document||(!Pa&&!Uv&&(Yh="virtual",y$("virtual",t)),Pa=!1,Uv=!1)}function y3(){Pa=!1,Uv=!0}function r2(t){if(typeof window>"u"||Mc.get(qt(t)))return;const e=qt(t),n=Me(t);let s=e.HTMLElement.prototype.focus;e.HTMLElement.prototype.focus=function(){Pa=!0,s.apply(this,arguments)},n.addEventListener("keydown",Sm,!0),n.addEventListener("keyup",Sm,!0),n.addEventListener("click",g3,!0),e.addEventListener("focus",x3,!0),e.addEventListener("blur",y3,!1),typeof PointerEvent<"u"?(n.addEventListener("pointerdown",_s,!0),n.addEventListener("pointermove",_s,!0),n.addEventListener("pointerup",_s,!0)):(n.addEventListener("mousedown",_s,!0),n.addEventListener("mousemove",_s,!0),n.addEventListener("mouseup",_s,!0)),e.addEventListener("beforeunload",()=>{v3(t)},{once:!0}),Mc.set(e,{focus:s})}const v3=(t,e)=>{const n=qt(t),s=Me(t);e&&s.removeEventListener("DOMContentLoaded",e),Mc.has(n)&&(n.HTMLElement.prototype.focus=Mc.get(n).focus,s.removeEventListener("keydown",Sm,!0),s.removeEventListener("keyup",Sm,!0),s.removeEventListener("click",g3,!0),n.removeEventListener("focus",x3,!0),n.removeEventListener("blur",y3,!1),typeof PointerEvent<"u"?(s.removeEventListener("pointerdown",_s,!0),s.removeEventListener("pointermove",_s,!0),s.removeEventListener("pointerup",_s,!0)):(s.removeEventListener("mousedown",_s,!0),s.removeEventListener("mousemove",_s,!0),s.removeEventListener("mouseup",_s,!0)),Mc.delete(n))};function Ehe(t){const e=Me(t);let n;return e.readyState!=="loading"?r2(t):(n=()=>{r2(t)},e.addEventListener("DOMContentLoaded",n)),()=>v3(t,n)}typeof document<"u"&&Ehe();function Nhe(){return Yh}function b3(t){let{isDisabled:e,onBlurWithin:n,onFocusWithin:s,onFocusWithinChange:r}=t,o=O.useRef({isFocusWithin:!1}),i=O.useCallback(u=>{o.current.isFocusWithin&&!u.currentTarget.contains(u.relatedTarget)&&(o.current.isFocusWithin=!1,n&&n(u),r&&r(!1))},[n,r,o]),a=She(i),l=O.useCallback(u=>{!o.current.isFocusWithin&&document.activeElement===u.target&&(s&&s(u),r&&r(!0),o.current.isFocusWithin=!0,a(u))},[s,r,a]);return e?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:l,onBlur:i}}}function Rhe(t){let{ref:e,onInteractOutside:n,isDisabled:s,onInteractOutsideStart:r}=t,o=O.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),i=pr(l=>{n&&Lf(l,e)&&(r&&r(l),o.current.isPointerDown=!0)}),a=pr(l=>{n&&n(l)});O.useEffect(()=>{let l=o.current;if(s)return;const u=e.current,c=Me(u);if(typeof PointerEvent<"u"){let d=h=>{l.isPointerDown&&Lf(h,e)&&a(h),l.isPointerDown=!1};return c.addEventListener("pointerdown",i,!0),c.addEventListener("pointerup",d,!0),()=>{c.removeEventListener("pointerdown",i,!0),c.removeEventListener("pointerup",d,!0)}}else{let d=f=>{l.ignoreEmulatedMouseEvents?l.ignoreEmulatedMouseEvents=!1:l.isPointerDown&&Lf(f,e)&&a(f),l.isPointerDown=!1},h=f=>{l.ignoreEmulatedMouseEvents=!0,l.isPointerDown&&Lf(f,e)&&a(f),l.isPointerDown=!1};return c.addEventListener("mousedown",i,!0),c.addEventListener("mouseup",d,!0),c.addEventListener("touchstart",i,!0),c.addEventListener("touchend",h,!0),()=>{c.removeEventListener("mousedown",i,!0),c.removeEventListener("mouseup",d,!0),c.removeEventListener("touchstart",i,!0),c.removeEventListener("touchend",h,!0)}}},[e,s,i,a])}function Lf(t,e){if(t.button>0)return!1;if(t.target){const n=t.target.ownerDocument;if(!n||!n.documentElement.contains(t.target)||t.target.closest("[data-react-aria-top-layer]"))return!1}return e.current&&!e.current.contains(t.target)}function Ahe(t){const e=Me(t);if(Nhe()==="virtual"){let n=e.activeElement;L0(()=>{e.activeElement===n&&t.isConnected&&xr(t)})}else xr(t)}function Dhe(t){const e=qt(t);if(!(t instanceof e.HTMLElement)&&!(t instanceof e.SVGElement))return!1;let{display:n,visibility:s}=t.style,r=n!=="none"&&s!=="hidden"&&s!=="collapse";if(r){const{getComputedStyle:o}=t.ownerDocument.defaultView;let{display:i,visibility:a}=o(t);r=i!=="none"&&a!=="hidden"&&a!=="collapse"}return r}function Fhe(t,e){return!t.hasAttribute("hidden")&&!t.hasAttribute("data-react-aria-prevent-focus")&&(t.nodeName==="DETAILS"&&e&&e.nodeName!=="SUMMARY"?t.hasAttribute("open"):!0)}function w3(t,e){return t.nodeName!=="#comment"&&Dhe(t)&&Fhe(t,e)&&(!t.parentElement||w3(t.parentElement,t))}const o2=ct.createContext(null);let ft=null;function Ohe(t){let{children:e,contain:n,restoreFocus:s,autoFocus:r}=t,o=O.useRef(null),i=O.useRef(null),a=O.useRef([]),{parentNode:l}=O.useContext(o2)||{},u=O.useMemo(()=>new Gv({scopeRef:a}),[a]);Xt(()=>{let h=l||Ut.root;if(Ut.getTreeNode(h.scopeRef)&&ft&&!Tm(ft,h.scopeRef)){let f=Ut.getTreeNode(ft);f&&(h=f)}h.addChild(u),Ut.addNode(u)},[u,l]),Xt(()=>{let h=Ut.getTreeNode(a);h&&(h.contain=!!n)},[n]),Xt(()=>{var h;let f=(h=o.current)===null||h===void 0?void 0:h.nextSibling,p=[];for(;f&&f!==i.current;)p.push(f),f=f.nextSibling;a.current=p},[e]),Vhe(a,s,n),Mhe(a,n),Uhe(a,s,n),Bhe(a,r),O.useEffect(()=>{const h=Me(a.current?a.current[0]:void 0).activeElement;let f=null;if(_n(h,a.current)){for(let p of Ut.traverse())p.scopeRef&&_n(h,p.scopeRef.current)&&(f=p);f===Ut.getTreeNode(a)&&(ft=f.scopeRef)}},[a]),Xt(()=>()=>{var h,f,p;let m=(p=(f=Ut.getTreeNode(a))===null||f===void 0||(h=f.parent)===null||h===void 0?void 0:h.scopeRef)!==null&&p!==void 0?p:null;(a===ft||Tm(a,ft))&&(!m||Ut.getTreeNode(m))&&(ft=m),Ut.removeTreeNode(a)},[a]);let c=O.useMemo(()=>Phe(a),[]),d=O.useMemo(()=>({focusManager:c,parentNode:u}),[u,c]);return ct.createElement(o2.Provider,{value:d},ct.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:o}),e,ct.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:i}))}function Phe(t){return{focusNext(e={}){let n=t.current,{from:s,tabbable:r,wrap:o,accept:i}=e,a=s||Me(n[0]).activeElement,l=n[0].previousElementSibling,u=sa(n),c=Qo(u,{tabbable:r,accept:i},n);c.currentNode=_n(a,n)?a:l;let d=c.nextNode();return!d&&o&&(c.currentNode=l,d=c.nextNode()),d&&yo(d,!0),d},focusPrevious(e={}){let n=t.current,{from:s,tabbable:r,wrap:o,accept:i}=e,a=s||Me(n[0]).activeElement,l=n[n.length-1].nextElementSibling,u=sa(n),c=Qo(u,{tabbable:r,accept:i},n);c.currentNode=_n(a,n)?a:l;let d=c.previousNode();return!d&&o&&(c.currentNode=l,d=c.previousNode()),d&&yo(d,!0),d},focusFirst(e={}){let n=t.current,{tabbable:s,accept:r}=e,o=sa(n),i=Qo(o,{tabbable:s,accept:r},n);i.currentNode=n[0].previousElementSibling;let a=i.nextNode();return a&&yo(a,!0),a},focusLast(e={}){let n=t.current,{tabbable:s,accept:r}=e,o=sa(n),i=Qo(o,{tabbable:s,accept:r},n);i.currentNode=n[n.length-1].nextElementSibling;let a=i.previousNode();return a&&yo(a,!0),a}}}const v$=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],_he=v$.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";v$.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const Lhe=v$.join(':not([hidden]):not([tabindex="-1"]),');function sa(t){return t[0].parentElement}function vc(t){let e=Ut.getTreeNode(ft);for(;e&&e.scopeRef!==t;){if(e.contain)return!1;e=e.parent}return!0}function Mhe(t,e){let n=O.useRef(),s=O.useRef();Xt(()=>{let r=t.current;if(!e){s.current&&(cancelAnimationFrame(s.current),s.current=void 0);return}const o=Me(r?r[0]:void 0);let i=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!vc(t)||u.isComposing)return;let c=o.activeElement,d=t.current;if(!d||!_n(c,d))return;let h=sa(d),f=Qo(h,{tabbable:!0},d);if(!c)return;f.currentNode=c;let p=u.shiftKey?f.previousNode():f.nextNode();p||(f.currentNode=u.shiftKey?d[d.length-1].nextElementSibling:d[0].previousElementSibling,p=u.shiftKey?f.previousNode():f.nextNode()),u.preventDefault(),p&&yo(p,!0)},a=u=>{(!ft||Tm(ft,t))&&_n(u.target,t.current)?(ft=t,n.current=u.target):vc(t)&&!Im(u.target,t)?n.current?n.current.focus():ft&&ft.current&&Em(ft.current):vc(t)&&(n.current=u.target)},l=u=>{s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{if(o.activeElement&&vc(t)&&!Im(o.activeElement,t))if(ft=t,o.body.contains(u.target)){var c;n.current=u.target,(c=n.current)===null||c===void 0||c.focus()}else ft.current&&Em(ft.current)})};return o.addEventListener("keydown",i,!1),o.addEventListener("focusin",a,!1),r==null||r.forEach(u=>u.addEventListener("focusin",a,!1)),r==null||r.forEach(u=>u.addEventListener("focusout",l,!1)),()=>{o.removeEventListener("keydown",i,!1),o.removeEventListener("focusin",a,!1),r==null||r.forEach(u=>u.removeEventListener("focusin",a,!1)),r==null||r.forEach(u=>u.removeEventListener("focusout",l,!1))}},[t,e]),Xt(()=>()=>{s.current&&cancelAnimationFrame(s.current)},[s])}function C3(t){return Im(t)}function _n(t,e){return!t||!e?!1:e.some(n=>n.contains(t))}function Im(t,e=null){if(t instanceof Element&&t.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:n}of Ut.traverse(Ut.getTreeNode(e)))if(n&&_n(t,n.current))return!0;return!1}function zhe(t){return Im(t,ft)}function Tm(t,e){var n;let s=(n=Ut.getTreeNode(e))===null||n===void 0?void 0:n.parent;for(;s;){if(s.scopeRef===t)return!0;s=s.parent}return!1}function yo(t,e=!1){if(t!=null&&!e)try{Ahe(t)}catch{}else if(t!=null)try{t.focus()}catch{}}function Em(t,e=!0){let n=t[0].previousElementSibling,s=sa(t),r=Qo(s,{tabbable:e},t);r.currentNode=n;let o=r.nextNode();e&&!o&&(s=sa(t),r=Qo(s,{tabbable:!1},t),r.currentNode=n,o=r.nextNode()),yo(o)}function Bhe(t,e){const n=ct.useRef(e);O.useEffect(()=>{if(n.current){ft=t;const s=Me(t.current?t.current[0]:void 0);!_n(s.activeElement,ft.current)&&t.current&&Em(t.current)}n.current=!1},[t])}function Vhe(t,e,n){Xt(()=>{if(e||n)return;let s=t.current;const r=Me(s?s[0]:void 0);let o=i=>{let a=i.target;_n(a,t.current)?ft=t:C3(a)||(ft=null)};return r.addEventListener("focusin",o,!1),s==null||s.forEach(i=>i.addEventListener("focusin",o,!1)),()=>{r.removeEventListener("focusin",o,!1),s==null||s.forEach(i=>i.removeEventListener("focusin",o,!1))}},[t,e,n])}function Whe(t){let e=Ut.getTreeNode(ft);for(;e&&e.scopeRef!==t;){if(e.nodeToRestore)return!1;e=e.parent}return(e==null?void 0:e.scopeRef)===t}function Uhe(t,e,n){const s=O.useRef(typeof document<"u"?Me(t.current?t.current[0]:void 0).activeElement:null);Xt(()=>{let r=t.current;const o=Me(r?r[0]:void 0);if(!e||n)return;let i=()=>{(!ft||Tm(ft,t))&&_n(o.activeElement,t.current)&&(ft=t)};return o.addEventListener("focusin",i,!1),r==null||r.forEach(a=>a.addEventListener("focusin",i,!1)),()=>{o.removeEventListener("focusin",i,!1),r==null||r.forEach(a=>a.removeEventListener("focusin",i,!1))}},[t,n]),Xt(()=>{const r=Me(t.current?t.current[0]:void 0);if(!e)return;let o=i=>{if(i.key!=="Tab"||i.altKey||i.ctrlKey||i.metaKey||!vc(t)||i.isComposing)return;let a=r.activeElement;if(!_n(a,t.current))return;let l=Ut.getTreeNode(t);if(!l)return;let u=l.nodeToRestore,c=Qo(r.body,{tabbable:!0});c.currentNode=a;let d=i.shiftKey?c.previousNode():c.nextNode();if((!u||!r.body.contains(u)||u===r.body)&&(u=void 0,l.nodeToRestore=void 0),(!d||!_n(d,t.current))&&u){c.currentNode=u;do d=i.shiftKey?c.previousNode():c.nextNode();while(_n(d,t.current));i.preventDefault(),i.stopPropagation(),d?yo(d,!0):C3(u)?yo(u,!0):a.blur()}};return n||r.addEventListener("keydown",o,!0),()=>{n||r.removeEventListener("keydown",o,!0)}},[t,e,n]),Xt(()=>{const r=Me(t.current?t.current[0]:void 0);if(!e)return;let o=Ut.getTreeNode(t);if(o){var i;return o.nodeToRestore=(i=s.current)!==null&&i!==void 0?i:void 0,()=>{let a=Ut.getTreeNode(t);if(!a)return;let l=a.nodeToRestore;if(e&&l&&(_n(r.activeElement,t.current)||r.activeElement===r.body&&Whe(t))){let u=Ut.clone();requestAnimationFrame(()=>{if(r.activeElement===r.body){let c=u.getTreeNode(t);for(;c;){if(c.nodeToRestore&&c.nodeToRestore.isConnected){yo(c.nodeToRestore);return}c=c.parent}for(c=u.getTreeNode(t);c;){if(c.scopeRef&&c.scopeRef.current&&Ut.getTreeNode(c.scopeRef)){Em(c.scopeRef.current,!0);return}c=c.parent}}})}}}},[t,e])}function Qo(t,e,n){let s=e!=null&&e.tabbable?Lhe:_he,r=Me(t).createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode(o){var i;return!(e==null||(i=e.from)===null||i===void 0)&&i.contains(o)?NodeFilter.FILTER_REJECT:o.matches(s)&&w3(o)&&(!n||_n(o,n))&&(!(e!=null&&e.accept)||e.accept(o))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return e!=null&&e.from&&(r.currentNode=e.from),r}let Ghe=class $3{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,n,s){let r=this.fastMap.get(n??null);if(!r)return;let o=new Gv({scopeRef:e});r.addChild(o),o.parent=r,this.fastMap.set(e,o),s&&(o.nodeToRestore=s)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let n=this.fastMap.get(e);if(!n)return;let s=n.parent;for(let o of this.traverse())o!==n&&n.nodeToRestore&&o.nodeToRestore&&n.scopeRef&&n.scopeRef.current&&_n(o.nodeToRestore,n.scopeRef.current)&&(o.nodeToRestore=n.nodeToRestore);let r=n.children;s&&(s.removeChild(n),r.size>0&&r.forEach(o=>s&&s.addChild(o))),this.fastMap.delete(n.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let n of e.children)yield*this.traverse(n)}clone(){var e;let n=new $3;var s;for(let r of this.traverse())n.addTreeNode(r.scopeRef,(s=(e=r.parent)===null||e===void 0?void 0:e.scopeRef)!==null&&s!==void 0?s:null,r.nodeToRestore);return n}constructor(){this.fastMap=new Map,this.root=new Gv({scopeRef:null}),this.fastMap.set(null,this.root)}},Gv=class{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}},Ut=new Ghe;const i2={border:0,clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"};function Hhe(t={}){let{style:e,isFocusable:n}=t,[s,r]=O.useState(!1),{focusWithinProps:o}=b3({isDisabled:!n,onFocusWithinChange:a=>r(a)}),i=O.useMemo(()=>s?e:e?{...i2,...e}:i2,[s]);return{visuallyHiddenProps:{...o,style:i}}}function jhe(t){let{children:e,elementType:n="div",isFocusable:s,style:r,...o}=t,{visuallyHiddenProps:i}=Hhe(t);return ct.createElement(n,Zs(o,i),e)}function Khe(t){return t&&t.__esModule?t.default:t}const io=[];function Xhe(t,e){let{onClose:n,shouldCloseOnBlur:s,isOpen:r,isDismissable:o=!1,isKeyboardDismissDisabled:i=!1,shouldCloseOnInteractOutside:a}=t;O.useEffect(()=>(r&&io.push(e),()=>{let p=io.indexOf(e);p>=0&&io.splice(p,1)}),[r,e]);let l=()=>{io[io.length-1]===e&&n&&n()},u=p=>{(!a||a(p.target))&&io[io.length-1]===e&&(p.stopPropagation(),p.preventDefault())},c=p=>{(!a||a(p.target))&&(io[io.length-1]===e&&(p.stopPropagation(),p.preventDefault()),l())},d=p=>{p.key==="Escape"&&!i&&(p.stopPropagation(),p.preventDefault(),l())};Rhe({ref:e,onInteractOutside:o&&r?c:null,onInteractOutsideStart:u});let{focusWithinProps:h}=b3({isDisabled:!s,onBlurWithin:p=>{!p.relatedTarget||zhe(p.relatedTarget)||(!a||a(p.relatedTarget))&&n()}}),f=p=>{p.target===p.currentTarget&&p.preventDefault()};return{overlayProps:{onKeyDown:d,...h},underlayProps:{onPointerDown:f}}}const Bx=typeof document<"u"&&window.visualViewport,qhe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Mf=0,Vx;function Yhe(t={}){let{isDisabled:e}=t;Xt(()=>{if(!e)return Mf++,Mf===1&&(x$()?Vx=Zhe():Vx=Qhe()),()=>{Mf--,Mf===0&&Vx()}},[e])}function Qhe(){return bi(El(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`),El(document.documentElement,"overflow","hidden"))}function Zhe(){let t,e,n=u=>{t=D_(u.target,!0),!(t===document.documentElement&&t===document.body)&&t instanceof HTMLElement&&window.getComputedStyle(t).overscrollBehavior==="auto"&&(e=El(t,"overscrollBehavior","contain"))},s=u=>{if(!t||t===document.documentElement||t===document.body){u.preventDefault();return}t.scrollHeight===t.clientHeight&&t.scrollWidth===t.clientWidth&&u.preventDefault()},r=u=>{let c=u.target;l2(c)&&c!==document.activeElement&&(u.preventDefault(),a(),c.style.transform="translateY(-2000px)",c.focus(),requestAnimationFrame(()=>{c.style.transform=""})),e&&e()},o=u=>{let c=u.target;l2(c)&&(a(),c.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{c.style.transform="",Bx&&(Bx.height<window.innerHeight?requestAnimationFrame(()=>{a2(c)}):Bx.addEventListener("resize",()=>a2(c),{once:!0}))}))},i=null,a=()=>{if(i)return;let u=()=>{window.scrollTo(0,0)},c=window.pageXOffset,d=window.pageYOffset;i=bi(tc(window,"scroll",u),El(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`),El(document.documentElement,"overflow","hidden"),El(document.body,"marginTop",`-${d}px`),()=>{window.scrollTo(c,d)}),window.scrollTo(0,0)},l=bi(tc(document,"touchstart",n,{passive:!1,capture:!0}),tc(document,"touchmove",s,{passive:!1,capture:!0}),tc(document,"touchend",r,{passive:!1,capture:!0}),tc(document,"focus",o,!0));return()=>{e==null||e(),i==null||i(),l()}}function El(t,e,n){let s=t.style[e];return t.style[e]=n,()=>{t.style[e]=s}}function tc(t,e,n,s){return t.addEventListener(e,n,s),()=>{t.removeEventListener(e,n,s)}}function a2(t){let e=document.scrollingElement||document.documentElement;for(;t&&t!==e;){let n=D_(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let s=n.getBoundingClientRect().top,r=t.getBoundingClientRect().top;r>s+t.clientHeight&&(n.scrollTop+=r-s)}t=n.parentElement}}function l2(t){return t instanceof HTMLInputElement&&!qhe.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}var k3={};k3={"ar-AE":F_,"bg-BG":O_,"cs-CZ":P_,"da-DK":__,"de-DE":L_,"el-GR":M_,"en-US":z_,"es-ES":B_,"et-EE":V_,"fi-FI":W_,"fr-FR":U_,"he-IL":G_,"hr-HR":H_,"hu-HU":j_,"it-IT":K_,"ja-JP":X_,"ko-KR":q_,"lt-LT":Y_,"lv-LV":Q_,"nb-NO":Z_,"nl-NL":J_,"pl-PL":e3,"pt-BR":t3,"pt-PT":n3,"ro-RO":s3,"ru-RU":r3,"sk-SK":o3,"sl-SI":i3,"sr-SP":a3,"sv-SE":l3,"tr-TR":u3,"uk-UA":c3,"zh-CN":d3,"zh-TW":h3};function u2(t){let{onDismiss:e,...n}=t,s=vhe(Khe(k3),"@react-aria/overlays"),r=ahe(n,s.format("dismiss")),o=()=>{e&&e()};return ct.createElement(jhe,null,ct.createElement("button",{...r,tabIndex:-1,onClick:o,style:{width:1,height:1}}))}let nc=new WeakMap,Rs=[];function Jhe(t,e=document.body){let n=new Set(t),s=new Set,r=l=>{for(let h of l.querySelectorAll("[data-live-announcer], [data-react-aria-top-layer]"))n.add(h);let u=h=>{if(n.has(h)||s.has(h.parentElement)&&h.parentElement.getAttribute("role")!=="row")return NodeFilter.FILTER_REJECT;for(let f of n)if(h.contains(f))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_ACCEPT},c=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,{acceptNode:u}),d=u(l);if(d===NodeFilter.FILTER_ACCEPT&&o(l),d!==NodeFilter.FILTER_REJECT){let h=c.nextNode();for(;h!=null;)o(h),h=c.nextNode()}},o=l=>{var u;let c=(u=nc.get(l))!==null&&u!==void 0?u:0;l.getAttribute("aria-hidden")==="true"&&c===0||(c===0&&l.setAttribute("aria-hidden","true"),s.add(l),nc.set(l,c+1))};Rs.length&&Rs[Rs.length-1].disconnect(),r(e);let i=new MutationObserver(l=>{for(let u of l)if(!(u.type!=="childList"||u.addedNodes.length===0)&&![...n,...s].some(c=>c.contains(u.target))){for(let c of u.removedNodes)c instanceof Element&&(n.delete(c),s.delete(c));for(let c of u.addedNodes)(c instanceof HTMLElement||c instanceof SVGElement)&&(c.dataset.liveAnnouncer==="true"||c.dataset.reactAriaTopLayer==="true")?n.add(c):c instanceof Element&&r(c)}});i.observe(e,{childList:!0,subtree:!0});let a={observe(){i.observe(e,{childList:!0,subtree:!0})},disconnect(){i.disconnect()}};return Rs.push(a),()=>{i.disconnect();for(let l of s){let u=nc.get(l);u===1?(l.removeAttribute("aria-hidden"),nc.delete(l)):nc.set(l,u-1)}a===Rs[Rs.length-1]?(Rs.pop(),Rs.length&&Rs[Rs.length-1].observe()):Rs.splice(Rs.indexOf(a),1)}}const S3=ct.createContext(null);function efe(t){let e=m$(),{portalContainer:n=e?null:document.body,isExiting:s}=t,[r,o]=O.useState(!1),i=O.useMemo(()=>({contain:r,setContain:o}),[r,o]);if(!n)return null;let a=t.children;return t.disableFocusManagement||(a=ct.createElement(Ohe,{restoreFocus:!0,contain:r&&!s},a)),a=ct.createElement(S3.Provider,{value:i},ct.createElement($he,null,a)),lB.createPortal(a,n)}function tfe(){let t=O.useContext(S3),e=t==null?void 0:t.setContain;Xt(()=>{e==null||e(!0)},[e])}const b$=O.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),M0=O.createContext({}),w$=O.createContext(null),C$=typeof document<"u",$$=C$?O.useLayoutEffect:O.useEffect,k$=O.createContext({strict:!1}),S$=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),nfe="framerAppearId",I3="data-"+S$(nfe),sfe={skipAnimations:!1,useManualTiming:!1};class c2{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const n=this.order.indexOf(e);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function rfe(t){let e=new c2,n=new c2,s=0,r=!1,o=!1;const i=new WeakSet,a={schedule:(l,u=!1,c=!1)=>{const d=c&&r,h=d?e:n;return u&&i.add(l),h.add(l)&&d&&r&&(s=e.order.length),l},cancel:l=>{n.remove(l),i.delete(l)},process:l=>{if(r){o=!0;return}if(r=!0,[e,n]=[n,e],n.clear(),s=e.order.length,s)for(let u=0;u<s;u++){const c=e.order[u];i.has(c)&&(a.schedule(c),t()),c(l)}r=!1,o&&(o=!1,a.process(l))}};return a}const zf=["read","resolveKeyframes","update","preRender","render","postRender"],ofe=40;function T3(t,e){let n=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=zf.reduce((d,h)=>(d[h]=rfe(()=>n=!0),d),{}),i=d=>{o[d].process(r)},a=()=>{const d=performance.now();n=!1,r.delta=s?1e3/60:Math.max(Math.min(d-r.timestamp,ofe),1),r.timestamp=d,r.isProcessing=!0,zf.forEach(i),r.isProcessing=!1,n&&e&&(s=!1,t(a))},l=()=>{n=!0,s=!0,r.isProcessing||t(a)};return{schedule:zf.reduce((d,h)=>{const f=o[h];return d[h]=(p,m=!1,x=!1)=>(n||l(),f.schedule(p,m,x)),d},{}),cancel:d=>zf.forEach(h=>o[h].cancel(d)),state:r,steps:o}}const{schedule:ife,cancel:Uxe}=T3(queueMicrotask,!1);function afe(t,e,n,s){const{visualElement:r}=O.useContext(M0),o=O.useContext(k$),i=O.useContext(w$),a=O.useContext(b$).reducedMotion,l=O.useRef();s=s||o.renderer,!l.current&&s&&(l.current=s(t,{visualState:e,parent:r,props:n,presenceContext:i,blockInitialAnimation:i?i.initial===!1:!1,reducedMotionConfig:a}));const u=l.current;O.useInsertionEffect(()=>{u&&u.update(n,i)});const c=O.useRef(!!(n[I3]&&!window.HandoffComplete));return $$(()=>{u&&(ife.render(u.render),c.current&&u.animationState&&u.animationState.animateChanges())}),O.useEffect(()=>{u&&(u.updateFeatures(),!c.current&&u.animationState&&u.animationState.animateChanges(),c.current&&(c.current=!1,window.HandoffComplete=!0))}),u}function E3(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function lfe(t,e,n){return O.useCallback(s=>{s&&t.mount&&t.mount(s),e&&(s?e.mount(s):e.unmount()),n&&(typeof n=="function"?n(s):E3(n)&&(n.current=s))},[e])}function Cd(t){return typeof t=="string"||Array.isArray(t)}function z0(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const I$=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],T$=["initial",...I$];function B0(t){return z0(t.animate)||T$.some(e=>Cd(t[e]))}function N3(t){return!!(B0(t)||t.variants)}function ufe(t,e){if(B0(t)){const{initial:n,animate:s}=t;return{initial:n===!1||Cd(n)?n:void 0,animate:Cd(s)?s:void 0}}return t.inherit!==!1?e:{}}function cfe(t){const{initial:e,animate:n}=ufe(t,O.useContext(M0));return O.useMemo(()=>({initial:e,animate:n}),[d2(e),d2(n)])}function d2(t){return Array.isArray(t)?t.join(" "):t}const h2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},$d={};for(const t in h2)$d[t]={isEnabled:e=>h2[t].some(n=>!!e[n])};function Hv(t){for(const e in t)$d[e]={...$d[e],...t[e]}}const R3=O.createContext({}),dfe=O.createContext({}),hfe=Symbol.for("motionComponentSymbol");function ffe({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:s,Component:r}){t&&Hv(t);function o(a,l){let u;const c={...O.useContext(b$),...a,layoutId:pfe(a)},{isStatic:d}=c,h=cfe(a),f=s(a,d);if(!d&&C$){h.visualElement=afe(r,f,c,e);const p=O.useContext(dfe),m=O.useContext(k$).strict;h.visualElement&&(u=h.visualElement.loadFeatures(c,m,t,p))}return q.jsxs(M0.Provider,{value:h,children:[u&&h.visualElement?q.jsx(u,{visualElement:h.visualElement,...c}):null,n(r,a,lfe(f,h.visualElement,l),f,d,h.visualElement)]})}const i=O.forwardRef(o);return i[hfe]=r,i}function pfe({layoutId:t}){const e=O.useContext(R3).id;return e&&t!==void 0?e+"-"+t:t}function mfe(t){function e(s,r={}){return ffe(t(s,r))}if(typeof Proxy>"u")return e;const n=new Map;return new Proxy(e,{get:(s,r)=>(n.has(r)||n.set(r,e(r)),n.get(r))})}const gfe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function E$(t){return typeof t!="string"||t.includes("-")?!1:!!(gfe.indexOf(t)>-1||/[A-Z]/u.test(t))}const xfe={},Qh=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],el=new Set(Qh);function A3(t,{layout:e,layoutId:n}){return el.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!xfe[t]||t==="opacity")}const jn=t=>!!(t&&t.getVelocity),yfe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},vfe=Qh.length;function bfe(t,{enableHardwareAcceleration:e=!0,allowTransformNone:n=!0},s,r){let o="";for(let i=0;i<vfe;i++){const a=Qh[i];if(t[a]!==void 0){const l=yfe[a]||a;o+=`${l}(${t[a]}) `}}return e&&!t.z&&(o+="translateZ(0)"),o=o.trim(),r?o=r(t,s?"":o):n&&s&&(o="none"),o}const D3=t=>e=>typeof e=="string"&&e.startsWith(t),F3=D3("--"),wfe=D3("var(--"),N$=t=>wfe(t)?Cfe.test(t.split("/*")[0].trim()):!1,Cfe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,$fe=(t,e)=>e&&typeof t=="number"?e.transform(t):t,pu=(t,e,n)=>n>e?e:n<t?t:n,Lu={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},zc={...Lu,transform:t=>pu(0,1,t)},Bf={...Lu,default:1},Bc=t=>Math.round(t*1e5)/1e5,R$=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,kfe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,Sfe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function Zh(t){return typeof t=="string"}const Jh=t=>({test:e=>Zh(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Bo=Jh("deg"),Ul=Jh("%"),$e=Jh("px"),Ife=Jh("vh"),Tfe=Jh("vw"),f2={...Ul,parse:t=>Ul.parse(t)/100,transform:t=>Ul.transform(t*100)},p2={...Lu,transform:Math.round},O3={borderWidth:$e,borderTopWidth:$e,borderRightWidth:$e,borderBottomWidth:$e,borderLeftWidth:$e,borderRadius:$e,radius:$e,borderTopLeftRadius:$e,borderTopRightRadius:$e,borderBottomRightRadius:$e,borderBottomLeftRadius:$e,width:$e,maxWidth:$e,height:$e,maxHeight:$e,size:$e,top:$e,right:$e,bottom:$e,left:$e,padding:$e,paddingTop:$e,paddingRight:$e,paddingBottom:$e,paddingLeft:$e,margin:$e,marginTop:$e,marginRight:$e,marginBottom:$e,marginLeft:$e,rotate:Bo,rotateX:Bo,rotateY:Bo,rotateZ:Bo,scale:Bf,scaleX:Bf,scaleY:Bf,scaleZ:Bf,skew:Bo,skewX:Bo,skewY:Bo,distance:$e,translateX:$e,translateY:$e,translateZ:$e,x:$e,y:$e,z:$e,perspective:$e,transformPerspective:$e,opacity:zc,originX:f2,originY:f2,originZ:$e,zIndex:p2,backgroundPositionX:$e,backgroundPositionY:$e,fillOpacity:zc,strokeOpacity:zc,numOctaves:p2};function A$(t,e,n,s){const{style:r,vars:o,transform:i,transformOrigin:a}=t;let l=!1,u=!1,c=!0;for(const d in e){const h=e[d];if(F3(d)){o[d]=h;continue}const f=O3[d],p=$fe(h,f);if(el.has(d)){if(l=!0,i[d]=p,!c)continue;h!==(f.default||0)&&(c=!1)}else d.startsWith("origin")?(u=!0,a[d]=p):r[d]=p}if(e.transform||(l||s?r.transform=bfe(t.transform,n,c,s):r.transform&&(r.transform="none")),u){const{originX:d="50%",originY:h="50%",originZ:f=0}=a;r.transformOrigin=`${d} ${h} ${f}`}}const D$=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function P3(t,e,n){for(const s in e)!jn(e[s])&&!A3(s,n)&&(t[s]=e[s])}function Efe({transformTemplate:t},e,n){return O.useMemo(()=>{const s=D$();return A$(s,e,{enableHardwareAcceleration:!n},t),Object.assign({},s.vars,s.style)},[e])}function Nfe(t,e,n){const s=t.style||{},r={};return P3(r,s,t),Object.assign(r,Efe(t,e,n)),r}function Rfe(t,e,n){const s={},r=Nfe(t,e,n);return t.drag&&t.dragListener!==!1&&(s.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(s.tabIndex=0),s.style=r,s}const Afe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Nm(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Afe.has(t)}let _3=t=>!Nm(t);function Dfe(t){t&&(_3=e=>e.startsWith("on")?!Nm(e):t(e))}try{Dfe(require("@emotion/is-prop-valid").default)}catch{}function Ffe(t,e,n){const s={};for(const r in t)r==="values"&&typeof t.values=="object"||(_3(r)||n===!0&&Nm(r)||!e&&!Nm(r)||t.draggable&&r.startsWith("onDrag"))&&(s[r]=t[r]);return s}function m2(t,e,n){return typeof t=="string"?t:$e.transform(e+n*t)}function Ofe(t,e,n){const s=m2(e,t.x,t.width),r=m2(n,t.y,t.height);return`${s} ${r}`}const Pfe={offset:"stroke-dashoffset",array:"stroke-dasharray"},_fe={offset:"strokeDashoffset",array:"strokeDasharray"};function Lfe(t,e,n=1,s=0,r=!0){t.pathLength=1;const o=r?Pfe:_fe;t[o.offset]=$e.transform(-s);const i=$e.transform(e),a=$e.transform(n);t[o.array]=`${i} ${a}`}function F$(t,{attrX:e,attrY:n,attrScale:s,originX:r,originY:o,pathLength:i,pathSpacing:a=1,pathOffset:l=0,...u},c,d,h){if(A$(t,u,c,h),d){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:p,dimensions:m}=t;f.transform&&(m&&(p.transform=f.transform),delete f.transform),m&&(r!==void 0||o!==void 0||p.transform)&&(p.transformOrigin=Ofe(m,r!==void 0?r:.5,o!==void 0?o:.5)),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),s!==void 0&&(f.scale=s),i!==void 0&&Lfe(f,i,a,l,!1)}const L3=()=>({...D$(),attrs:{}}),O$=t=>typeof t=="string"&&t.toLowerCase()==="svg";function Mfe(t,e,n,s){const r=O.useMemo(()=>{const o=L3();return F$(o,e,{enableHardwareAcceleration:!1},O$(s),t.transformTemplate),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};P3(o,t.style,t),r.style={...o,...r.style}}return r}function zfe(t=!1){return(n,s,r,{latestValues:o},i)=>{const l=(E$(n)?Mfe:Rfe)(s,o,i,n),u=Ffe(s,typeof n=="string",t),c=n!==O.Fragment?{...u,...l,ref:r}:{},{children:d}=s,h=O.useMemo(()=>jn(d)?d.get():d,[d]);return O.createElement(n,{...c,children:h})}}function M3(t,{style:e,vars:n},s,r){Object.assign(t.style,e,r&&r.getProjectionStyles(s));for(const o in n)t.style.setProperty(o,n[o])}const z3=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function B3(t,e,n,s){M3(t,e,void 0,s);for(const r in e.attrs)t.setAttribute(z3.has(r)?r:S$(r),e.attrs[r])}function P$(t,e,n){var s;const{style:r}=t,o={};for(const i in r)(jn(r[i])||e.style&&jn(e.style[i])||A3(i,t)||((s=n==null?void 0:n.getValue(i))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(o[i]=r[i]);return o}function V3(t,e,n){const s=P$(t,e,n);for(const r in t)if(jn(t[r])||jn(e[r])){const o=Qh.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[o]=t[r]}return s}function g2(t){const e=[{},{}];return t==null||t.values.forEach((n,s)=>{e[0][s]=n.get(),e[1][s]=n.getVelocity()}),e}function _$(t,e,n,s){if(typeof e=="function"){const[r,o]=g2(s);e=e(n!==void 0?n:t.custom,r,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,o]=g2(s);e=e(n!==void 0?n:t.custom,r,o)}return e}function W3(t){const e=O.useRef(null);return e.current===null&&(e.current=t()),e.current}const jv=t=>Array.isArray(t),Bfe=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),Vfe=t=>jv(t)?t[t.length-1]||0:t;function Wfe(t){const e=jn(t)?t.get():t;return Bfe(e)?e.toValue():e}function Ufe({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:n},s,r,o){const i={latestValues:Gfe(s,r,o,t),renderState:e()};return n&&(i.mount=a=>n(s,a,i)),i}const U3=t=>(e,n)=>{const s=O.useContext(M0),r=O.useContext(w$),o=()=>Ufe(t,e,s,r);return n?o():W3(o)};function Gfe(t,e,n,s){const r={},o=s(t,{});for(const h in o)r[h]=Wfe(o[h]);let{initial:i,animate:a}=t;const l=B0(t),u=N3(t);e&&u&&!l&&t.inherit!==!1&&(i===void 0&&(i=e.initial),a===void 0&&(a=e.animate));let c=n?n.initial===!1:!1;c=c||i===!1;const d=c?a:i;return d&&typeof d!="boolean"&&!z0(d)&&(Array.isArray(d)?d:[d]).forEach(f=>{const p=_$(t,f);if(!p)return;const{transitionEnd:m,transition:x,...g}=p;for(const y in g){let v=g[y];if(Array.isArray(v)){const b=c?v.length-1:0;v=v[b]}v!==null&&(r[y]=v)}for(const y in m)r[y]=m[y]}),r}const Qr=t=>t,{schedule:an,cancel:Rm,state:Am,steps:Gxe}=T3(typeof requestAnimationFrame<"u"?requestAnimationFrame:Qr,!0),Hfe={useVisualState:U3({scrapeMotionValuesFromProps:V3,createRenderState:L3,onMount:(t,e,{renderState:n,latestValues:s})=>{an.read(()=>{try{n.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),an.render(()=>{F$(n,s,{enableHardwareAcceleration:!1},O$(e.tagName),t.transformTemplate),B3(e,n)})}})},jfe={useVisualState:U3({scrapeMotionValuesFromProps:P$,createRenderState:D$})};function Kfe(t,{forwardMotionProps:e=!1},n,s){return{...E$(t)?Hfe:jfe,preloadedFeatures:n,useRender:zfe(e),createVisualElement:s,Component:t}}function ra(t,e,n,s={passive:!0}){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n)}const Xfe=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function G3(t,e="page"){return{point:{x:t[`${e}X`],y:t[`${e}Y`]}}}const qfe=t=>e=>Xfe(e)&&t(e,G3(e));function fp(t,e,n,s){return ra(t,e,qfe(n),s)}const Yfe=(t,e)=>n=>e(t(n)),ci=(...t)=>t.reduce(Yfe);function H3(t){let e=null;return()=>{const n=()=>{e=null};return e===null?(e=t,n):!1}}const Qfe=H3("dragHorizontal"),Zfe=H3("dragVertical");function Jfe(t){let e=!1;{const n=Qfe(),s=Zfe();n&&s?e=()=>{n(),s()}:(n&&n(),s&&s())}return e}function j3(){const t=Jfe();return t?(t(),!1):!0}class Mu{constructor(e){this.isMounted=!1,this.node=e}update(){}}function x2(t,e){const n=e?"pointerenter":"pointerleave",s=e?"onHoverStart":"onHoverEnd",r=(o,i)=>{if(o.pointerType==="touch"||j3())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",e);const l=a[s];l&&an.postRender(()=>l(o,i))};return fp(t.current,n,r,{passive:!t.getProps()[s]})}class epe extends Mu{mount(){this.unmount=ci(x2(this.node,!0),x2(this.node,!1))}unmount(){}}class tpe extends Mu{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ci(ra(this.node.current,"focus",()=>this.onFocus()),ra(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const K3=(t,e)=>e?t===e?!0:K3(t,e.parentElement):!1;function Wx(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,G3(n))}class npe extends Mu{constructor(){super(...arguments),this.removeStartListeners=Qr,this.removeEndListeners=Qr,this.removeAccessibleListeners=Qr,this.startPointerPress=(e,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),o=fp(window,"pointerup",(a,l)=>{if(!this.checkPressEnd())return;const{onTap:u,onTapCancel:c,globalTapTarget:d}=this.node.getProps(),h=!d&&!K3(this.node.current,a.target)?c:u;h&&an.update(()=>h(a,l))},{passive:!(s.onTap||s.onPointerUp)}),i=fp(window,"pointercancel",(a,l)=>this.cancelPress(a,l),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=ci(o,i),this.startPress(e,n)},this.startAccessiblePress=()=>{const e=o=>{if(o.key!=="Enter"||this.isPressing)return;const i=a=>{a.key!=="Enter"||!this.checkPressEnd()||Wx("up",(l,u)=>{const{onTap:c}=this.node.getProps();c&&an.postRender(()=>c(l,u))})};this.removeEndListeners(),this.removeEndListeners=ra(this.node.current,"keyup",i),Wx("down",(a,l)=>{this.startPress(a,l)})},n=ra(this.node.current,"keydown",e),s=()=>{this.isPressing&&Wx("cancel",(o,i)=>this.cancelPress(o,i))},r=ra(this.node.current,"blur",s);this.removeAccessibleListeners=ci(n,r)}}startPress(e,n){this.isPressing=!0;const{onTapStart:s,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&an.postRender(()=>s(e,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!j3()}cancelPress(e,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&an.postRender(()=>s(e,n))}mount(){const e=this.node.getProps(),n=fp(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),s=ra(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=ci(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Kv=new WeakMap,Ux=new WeakMap,spe=t=>{const e=Kv.get(t.target);e&&e(t)},rpe=t=>{t.forEach(spe)};function ope({root:t,...e}){const n=t||document;Ux.has(n)||Ux.set(n,{});const s=Ux.get(n),r=JSON.stringify(e);return s[r]||(s[r]=new IntersectionObserver(rpe,{root:t,...e})),s[r]}function ipe(t,e,n){const s=ope(e);return Kv.set(t,n),s.observe(t),()=>{Kv.delete(t),s.unobserve(t)}}const ape={some:0,all:1};class lpe extends Mu{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:s,amount:r="some",once:o}=e,i={root:n?n.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:ape[r]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,o&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:c,onViewportLeave:d}=this.node.getProps(),h=u?c:d;h&&h(l)};return ipe(this.node.current,i,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(upe(e,n))&&this.startObserver()}unmount(){}}function upe({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const cpe={inView:{Feature:lpe},tap:{Feature:npe},focus:{Feature:tpe},hover:{Feature:epe}};function X3(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}function V0(t,e,n){const s=t.getProps();return _$(s,e,n!==void 0?n:s.custom,t)}const fa=t=>t*1e3,di=t=>t/1e3,dpe={type:"spring",stiffness:500,damping:25,restSpeed:10},hpe=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),fpe={type:"keyframes",duration:.8},ppe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},mpe=(t,{keyframes:e})=>e.length>2?fpe:el.has(t)?t.startsWith("scale")?hpe(e[1]):dpe:ppe;function gpe({when:t,delay:e,delayChildren:n,staggerChildren:s,staggerDirection:r,repeat:o,repeatType:i,repeatDelay:a,from:l,elapsed:u,...c}){return!!Object.keys(c).length}function q3(t,e){return t[e]||t.default||t}const xpe=t=>t!==null;function W0(t,{repeat:e,repeatType:n="loop"},s){const r=t.filter(xpe),o=e&&n!=="loop"&&e%2===1?0:r.length-1;return!o||s===void 0?r[o]:s}let pp;function ype(){pp=void 0}const Gl={now:()=>(pp===void 0&&Gl.set(Am.isProcessing||sfe.useManualTiming?Am.timestamp:performance.now()),pp),set:t=>{pp=t,queueMicrotask(ype)}},Y3=t=>/^0[^.\s]+$/u.test(t);function vpe(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||Y3(t):!0}let Xv=Qr;const Q3=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),bpe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function wpe(t){const e=bpe.exec(t);if(!e)return[,];const[,n,s,r]=e;return[`--${n??s}`,r]}function Z3(t,e,n=1){const[s,r]=wpe(t);if(!s)return;const o=window.getComputedStyle(e).getPropertyValue(s);if(o){const i=o.trim();return Q3(i)?parseFloat(i):i}return N$(r)?Z3(r,e,n+1):r}const Cpe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),y2=t=>t===Lu||t===$e,v2=(t,e)=>parseFloat(t.split(", ")[e]),b2=(t,e)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const r=s.match(/^matrix3d\((.+)\)$/u);if(r)return v2(r[1],e);{const o=s.match(/^matrix\((.+)\)$/u);return o?v2(o[1],t):0}},$pe=new Set(["x","y","z"]),kpe=Qh.filter(t=>!$pe.has(t));function Spe(t){const e=[];return kpe.forEach(n=>{const s=t.getValue(n);s!==void 0&&(e.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),e}const mu={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:b2(4,13),y:b2(5,14)};mu.translateX=mu.x;mu.translateY=mu.y;const J3=t=>e=>e.test(t),Ipe={test:t=>t==="auto",parse:t=>t},eL=[Lu,$e,Ul,Bo,Tfe,Ife,Ipe],w2=t=>eL.find(J3(t)),pa=new Set;let qv=!1,Yv=!1;function tL(){if(Yv){const t=Array.from(pa).filter(s=>s.needsMeasurement),e=new Set(t.map(s=>s.element)),n=new Map;e.forEach(s=>{const r=Spe(s);r.length&&(n.set(s,r),s.render())}),t.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const r=n.get(s);r&&r.forEach(([o,i])=>{var a;(a=s.getValue(o))===null||a===void 0||a.set(i)})}),t.forEach(s=>s.measureEndState()),t.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}Yv=!1,qv=!1,pa.forEach(t=>t.complete()),pa.clear()}function nL(){pa.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Yv=!0)})}function Tpe(){nL(),tL()}class L${constructor(e,n,s,r,o,i=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=s,this.motionValue=r,this.element=o,this.isAsync=i}scheduleResolve(){this.isScheduled=!0,this.isAsync?(pa.add(this),qv||(qv=!0,an.read(nL),an.resolveKeyframes(tL))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:s,motionValue:r}=this;for(let o=0;o<e.length;o++)if(e[o]===null)if(o===0){const i=r==null?void 0:r.get(),a=e[e.length-1];if(i!==void 0)e[0]=i;else if(s&&n){const l=s.readValue(n,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&i===void 0&&r.set(e[0])}else e[o]=e[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),pa.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,pa.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const M$=(t,e)=>n=>!!(Zh(n)&&Sfe.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),sL=(t,e,n)=>s=>{if(!Zh(s))return s;const[r,o,i,a]=s.match(R$);return{[t]:parseFloat(r),[e]:parseFloat(o),[n]:parseFloat(i),alpha:a!==void 0?parseFloat(a):1}},Epe=t=>pu(0,255,t),Gx={...Lu,transform:t=>Math.round(Epe(t))},oa={test:M$("rgb","red"),parse:sL("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:s=1})=>"rgba("+Gx.transform(t)+", "+Gx.transform(e)+", "+Gx.transform(n)+", "+Bc(zc.transform(s))+")"};function Npe(t){let e="",n="",s="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),s=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),s=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,s+=s,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const Qv={test:M$("#"),parse:Npe,transform:oa.transform},Nl={test:M$("hsl","hue"),parse:sL("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:s=1})=>"hsla("+Math.round(t)+", "+Ul.transform(Bc(e))+", "+Ul.transform(Bc(n))+", "+Bc(zc.transform(s))+")"},An={test:t=>oa.test(t)||Qv.test(t)||Nl.test(t),parse:t=>oa.test(t)?oa.parse(t):Nl.test(t)?Nl.parse(t):Qv.parse(t),transform:t=>Zh(t)?t:t.hasOwnProperty("red")?oa.transform(t):Nl.transform(t)};function Rpe(t){var e,n;return isNaN(t)&&Zh(t)&&(((e=t.match(R$))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(kfe))===null||n===void 0?void 0:n.length)||0)>0}const rL="number",oL="color",Ape="var",Dpe="var(",C2="${}",Fpe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function kd(t){const e=t.toString(),n=[],s={color:[],number:[],var:[]},r=[];let o=0;const a=e.replace(Fpe,l=>(An.test(l)?(s.color.push(o),r.push(oL),n.push(An.parse(l))):l.startsWith(Dpe)?(s.var.push(o),r.push(Ape),n.push(l)):(s.number.push(o),r.push(rL),n.push(parseFloat(l))),++o,C2)).split(C2);return{values:n,split:a,indexes:s,types:r}}function iL(t){return kd(t).values}function aL(t){const{split:e,types:n}=kd(t),s=e.length;return r=>{let o="";for(let i=0;i<s;i++)if(o+=e[i],r[i]!==void 0){const a=n[i];a===rL?o+=Bc(r[i]):a===oL?o+=An.transform(r[i]):o+=r[i]}return o}}const Ope=t=>typeof t=="number"?0:t;function Ppe(t){const e=iL(t);return aL(t)(e.map(Ope))}const zu={test:Rpe,parse:iL,createTransformer:aL,getAnimatableNone:Ppe},_pe=new Set(["brightness","contrast","saturate","opacity"]);function Lpe(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=n.match(R$)||[];if(!s)return t;const r=n.replace(s,"");let o=_pe.has(e)?1:0;return s!==n&&(o*=100),e+"("+o+r+")"}const Mpe=/\b([a-z-]*)\(.*?\)/gu,Zv={...zu,getAnimatableNone:t=>{const e=t.match(Mpe);return e?e.map(Lpe).join(" "):t}},zpe={...O3,color:An,backgroundColor:An,outlineColor:An,fill:An,stroke:An,borderColor:An,borderTopColor:An,borderRightColor:An,borderBottomColor:An,borderLeftColor:An,filter:Zv,WebkitFilter:Zv},z$=t=>zpe[t];function lL(t,e){let n=z$(t);return n!==Zv&&(n=zu),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const Bpe=new Set(["auto","none","0"]);function Vpe(t,e,n){let s=0,r;for(;s<t.length&&!r;){const o=t[s];typeof o=="string"&&!Bpe.has(o)&&kd(o).values.length&&(r=t[s]),s++}if(r&&n)for(const o of e)t[o]=lL(n,r)}class uL extends L${constructor(e,n,s,r){super(e,n,s,r,r==null?void 0:r.owner,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:s}=this;if(!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),N$(u))){const c=Z3(u,n.current);c!==void 0&&(e[l]=c),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!Cpe.has(s)||e.length!==2)return;const[r,o]=e,i=w2(r),a=w2(o);if(i!==a)if(y2(i)&&y2(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,s=[];for(let r=0;r<e.length;r++)vpe(e[r])&&s.push(r);s.length&&Vpe(e,s,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:s}=this;if(!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=mu[s](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(s,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:s,unresolvedKeyframes:r}=this;if(!n.current)return;const o=n.getValue(s);o&&o.jump(this.measuredOrigin,!1);const i=r.length-1,a=r[i];r[i]=mu[s](n.measureViewportBox(),window.getComputedStyle(n.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,u])=>{n.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function cL(t){let e;return()=>(e===void 0&&(e=t()),e)}const $2=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(zu.test(t)||t==="0")&&!t.startsWith("url("));function Wpe(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function Upe(t,e,n,s){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],i=$2(r,e),a=$2(o,e);return!i||!a?!1:Wpe(t)||n==="spring"&&s}class dL{constructor({autoplay:e=!0,delay:n=0,type:s="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:i="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:e,delay:n,type:s,repeat:r,repeatDelay:o,repeatType:i,...a},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Tpe(),this._resolved}onKeyframesResolved(e,n){this.hasAttemptedResolve=!0;const{name:s,type:r,velocity:o,delay:i,onComplete:a,onUpdate:l,isGenerator:u}=this.options;if(!u&&!Upe(e,s,r,o))if(i)this.options.duration=0;else{l==null||l(W0(e,this.options,n)),a==null||a(),this.resolveFinishedPromise();return}const c=this.initPlayback(e,n);c!==!1&&(this._resolved={keyframes:e,finalKeyframe:n,...c},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}function hL(t,e){return e?t*(1e3/e):0}const Gpe=5;function fL(t,e,n){const s=Math.max(e-Gpe,0);return hL(n-t(s),e-s)}const Hx=.001,Hpe=.01,jpe=10,Kpe=.05,Xpe=1;function qpe({duration:t=800,bounce:e=.25,velocity:n=0,mass:s=1}){let r,o,i=1-e;i=pu(Kpe,Xpe,i),t=pu(Hpe,jpe,di(t)),i<1?(r=u=>{const c=u*i,d=c*t,h=c-n,f=Jv(u,i),p=Math.exp(-d);return Hx-h/f*p},o=u=>{const d=u*i*t,h=d*n+n,f=Math.pow(i,2)*Math.pow(u,2)*t,p=Math.exp(-d),m=Jv(Math.pow(u,2),i);return(-r(u)+Hx>0?-1:1)*((h-f)*p)/m}):(r=u=>{const c=Math.exp(-u*t),d=(u-n)*t+1;return-Hx+c*d},o=u=>{const c=Math.exp(-u*t),d=(n-u)*(t*t);return c*d});const a=5/t,l=Qpe(r,o,a);if(t=fa(t),isNaN(l))return{stiffness:100,damping:10,duration:t};{const u=Math.pow(l,2)*s;return{stiffness:u,damping:i*2*Math.sqrt(s*u),duration:t}}}const Ype=12;function Qpe(t,e,n){let s=n;for(let r=1;r<Ype;r++)s=s-t(s)/e(s);return s}function Jv(t,e){return t*Math.sqrt(1-e*e)}const Zpe=["duration","bounce"],Jpe=["stiffness","damping","mass"];function k2(t,e){return e.some(n=>t[n]!==void 0)}function eme(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!k2(t,Jpe)&&k2(t,Zpe)){const n=qpe(t);e={...e,...n,mass:1},e.isResolvedFromDuration=!0}return e}function pL({keyframes:t,restDelta:e,restSpeed:n,...s}){const r=t[0],o=t[t.length-1],i={done:!1,value:r},{stiffness:a,damping:l,mass:u,duration:c,velocity:d,isResolvedFromDuration:h}=eme({...s,velocity:-di(s.velocity||0)}),f=d||0,p=l/(2*Math.sqrt(a*u)),m=o-r,x=di(Math.sqrt(a/u)),g=Math.abs(m)<5;n||(n=g?.01:2),e||(e=g?.005:.5);let y;if(p<1){const v=Jv(x,p);y=b=>{const w=Math.exp(-p*x*b);return o-w*((f+p*x*m)/v*Math.sin(v*b)+m*Math.cos(v*b))}}else if(p===1)y=v=>o-Math.exp(-x*v)*(m+(f+x*m)*v);else{const v=x*Math.sqrt(p*p-1);y=b=>{const w=Math.exp(-p*x*b),$=Math.min(v*b,300);return o-w*((f+p*x*m)*Math.sinh($)+v*m*Math.cosh($))/v}}return{calculatedDuration:h&&c||null,next:v=>{const b=y(v);if(h)i.done=v>=c;else{let w=f;v!==0&&(p<1?w=fL(y,v,b):w=0);const $=Math.abs(w)<=n,k=Math.abs(o-b)<=e;i.done=$&&k}return i.value=i.done?o:b,i}}}function S2({keyframes:t,velocity:e=0,power:n=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:i,min:a,max:l,restDelta:u=.5,restSpeed:c}){const d=t[0],h={done:!1,value:d},f=C=>a!==void 0&&C<a||l!==void 0&&C>l,p=C=>a===void 0?l:l===void 0||Math.abs(a-C)<Math.abs(l-C)?a:l;let m=n*e;const x=d+m,g=i===void 0?x:i(x);g!==x&&(m=g-d);const y=C=>-m*Math.exp(-C/s),v=C=>g+y(C),b=C=>{const S=y(C),T=v(C);h.done=Math.abs(S)<=u,h.value=h.done?g:T};let w,$;const k=C=>{f(h.value)&&(w=C,$=pL({keyframes:[h.value,p(h.value)],velocity:fL(v,C,h.value),damping:r,stiffness:o,restDelta:u,restSpeed:c}))};return k(0),{calculatedDuration:null,next:C=>{let S=!1;return!$&&w===void 0&&(S=!0,b(C),k(C)),w!==void 0&&C>=w?$.next(C-w):(!S&&b(C),h)}}}const mL=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,tme=1e-7,nme=12;function sme(t,e,n,s,r){let o,i,a=0;do i=e+(n-e)/2,o=mL(i,s,r)-t,o>0?n=i:e=i;while(Math.abs(o)>tme&&++a<nme);return i}function ef(t,e,n,s){if(t===e&&n===s)return Qr;const r=o=>sme(o,0,1,t,n);return o=>o===0||o===1?o:mL(r(o),e,s)}const rme=ef(.42,0,1,1),ome=ef(0,0,.58,1),gL=ef(.42,0,.58,1),ime=t=>Array.isArray(t)&&typeof t[0]!="number",xL=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,yL=t=>e=>1-t(1-e),B$=t=>1-Math.sin(Math.acos(t)),ame=yL(B$),lme=xL(B$),vL=ef(.33,1.53,.69,.99),V$=yL(vL),ume=xL(V$),cme=t=>(t*=2)<1?.5*V$(t):.5*(2-Math.pow(2,-10*(t-1))),I2={linear:Qr,easeIn:rme,easeInOut:gL,easeOut:ome,circIn:B$,circInOut:lme,circOut:ame,backIn:V$,backInOut:ume,backOut:vL,anticipate:cme},T2=t=>{if(Array.isArray(t)){Xv(t.length===4);const[e,n,s,r]=t;return ef(e,n,s,r)}else if(typeof t=="string")return Xv(I2[t]!==void 0),I2[t];return t},bL=(t,e,n)=>{const s=e-t;return s===0?1:(n-t)/s},U0=(t,e,n)=>t+(e-t)*n;function jx(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function dme({hue:t,saturation:e,lightness:n,alpha:s}){t/=360,e/=100,n/=100;let r=0,o=0,i=0;if(!e)r=o=i=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=jx(l,a,t+1/3),o=jx(l,a,t),i=jx(l,a,t-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(i*255),alpha:s}}function Dm(t,e){return n=>n>0?e:t}const Kx=(t,e,n)=>{const s=t*t,r=n*(e*e-s)+s;return r<0?0:Math.sqrt(r)},hme=[Qv,oa,Nl],fme=t=>hme.find(e=>e.test(t));function E2(t){const e=fme(t);if(!e)return!1;let n=e.parse(t);return e===Nl&&(n=dme(n)),n}const N2=(t,e)=>{const n=E2(t),s=E2(e);if(!n||!s)return Dm(t,e);const r={...n};return o=>(r.red=Kx(n.red,s.red,o),r.green=Kx(n.green,s.green,o),r.blue=Kx(n.blue,s.blue,o),r.alpha=U0(n.alpha,s.alpha,o),oa.transform(r))},e1=new Set(["none","hidden"]);function pme(t,e){return e1.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function mme(t,e){return n=>U0(t,e,n)}function W$(t){return typeof t=="number"?mme:typeof t=="string"?N$(t)?Dm:An.test(t)?N2:yme:Array.isArray(t)?wL:typeof t=="object"?An.test(t)?N2:gme:Dm}function wL(t,e){const n=[...t],s=n.length,r=t.map((o,i)=>W$(o)(o,e[i]));return o=>{for(let i=0;i<s;i++)n[i]=r[i](o);return n}}function gme(t,e){const n={...t,...e},s={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(s[r]=W$(t[r])(t[r],e[r]));return r=>{for(const o in s)n[o]=s[o](r);return n}}function xme(t,e){var n;const s=[],r={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const i=e.types[o],a=t.indexes[i][r[i]],l=(n=t.values[a])!==null&&n!==void 0?n:0;s[o]=l,r[i]++}return s}const yme=(t,e)=>{const n=zu.createTransformer(e),s=kd(t),r=kd(e);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?e1.has(t)&&!r.values.length||e1.has(e)&&!s.values.length?pme(t,e):ci(wL(xme(s,r),r.values),n):Dm(t,e)};function CL(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?U0(t,e,n):W$(t)(t,e)}function vme(t,e,n){const s=[],r=n||CL,o=t.length-1;for(let i=0;i<o;i++){let a=r(t[i],t[i+1]);if(e){const l=Array.isArray(e)?e[i]||Qr:e;a=ci(l,a)}s.push(a)}return s}function bme(t,e,{clamp:n=!0,ease:s,mixer:r}={}){const o=t.length;if(Xv(o===e.length),o===1)return()=>e[0];if(o===2&&t[0]===t[1])return()=>e[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const i=vme(e,s,r),a=i.length,l=u=>{let c=0;if(a>1)for(;c<t.length-2&&!(u<t[c+1]);c++);const d=bL(t[c],t[c+1],u);return i[c](d)};return n?u=>l(pu(t[0],t[o-1],u)):l}function wme(t,e){const n=t[t.length-1];for(let s=1;s<=e;s++){const r=bL(0,e,s);t.push(U0(n,1,r))}}function Cme(t){const e=[0];return wme(e,t.length-1),e}function $me(t,e){return t.map(n=>n*e)}function kme(t,e){return t.map(()=>e||gL).splice(0,t.length-1)}function Fm({duration:t=300,keyframes:e,times:n,ease:s="easeInOut"}){const r=ime(s)?s.map(T2):T2(s),o={done:!1,value:e[0]},i=$me(n&&n.length===e.length?n:Cme(e),t),a=bme(i,e,{ease:Array.isArray(r)?r:kme(e,r)});return{calculatedDuration:t,next:l=>(o.value=a(l),o.done=l>=t,o)}}const R2=2e4;function Sme(t){let e=0;const n=50;let s=t.next(e);for(;!s.done&&e<R2;)e+=n,s=t.next(e);return e>=R2?1/0:e}const Ime=t=>{const e=({timestamp:n})=>t(n);return{start:()=>an.update(e,!0),stop:()=>Rm(e),now:()=>Am.isProcessing?Am.timestamp:Gl.now()}},Tme={decay:S2,inertia:S2,tween:Fm,keyframes:Fm,spring:pL},Eme=t=>t/100;class U$ extends dL{constructor({KeyframeResolver:e=L$,...n}){super(n),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:a}=this.options;a&&a()};const{name:s,motionValue:r,keyframes:o}=this.options,i=(a,l)=>this.onKeyframesResolved(a,l);s&&r&&r.owner?this.resolver=r.owner.resolveKeyframes(o,i,s,r):this.resolver=new e(o,i,s,r),this.resolver.scheduleResolve()}initPlayback(e){const{type:n="keyframes",repeat:s=0,repeatDelay:r=0,repeatType:o,velocity:i=0}=this.options,a=Tme[n]||Fm;let l,u;a!==Fm&&typeof e[0]!="number"&&(l=ci(Eme,CL(e[0],e[1])),e=[0,100]);const c=a({...this.options,keyframes:e});o==="mirror"&&(u=a({...this.options,keyframes:[...e].reverse(),velocity:-i})),c.calculatedDuration===null&&(c.calculatedDuration=Sme(c));const{calculatedDuration:d}=c,h=d+r,f=h*(s+1)-r;return{generator:c,mirroredGenerator:u,mapPercentToKeyframes:l,calculatedDuration:d,resolvedDuration:h,totalDuration:f}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,n=!1){const{resolved:s}=this;if(!s){const{keyframes:C}=this.options;return{done:!0,value:C[C.length-1]}}const{finalKeyframe:r,generator:o,mirroredGenerator:i,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:u,totalDuration:c,resolvedDuration:d}=s;if(this.startTime===null)return o.next(0);const{delay:h,repeat:f,repeatType:p,repeatDelay:m,onUpdate:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),n?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const g=this.currentTime-h*(this.speed>=0?1:-1),y=this.speed>=0?g<0:g>c;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let v=this.currentTime,b=o;if(f){const C=Math.min(this.currentTime,c)/d;let S=Math.floor(C),T=C%1;!T&&C>=1&&(T=1),T===1&&S--,S=Math.min(S,f+1),!!(S%2)&&(p==="reverse"?(T=1-T,m&&(T-=m/d)):p==="mirror"&&(b=i)),v=pu(0,1,T)*d}const w=y?{done:!1,value:l[0]}:b.next(v);a&&(w.value=a(w.value));let{done:$}=w;!y&&u!==null&&($=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const k=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&$);return k&&r!==void 0&&(w.value=W0(l,this.options,r)),x&&x(w.value),k&&this.finish(),w}get duration(){const{resolved:e}=this;return e?di(e.calculatedDuration):0}get time(){return di(this.currentTime)}set time(e){e=fa(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=di(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=Ime,onPlay:n}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),n&&n();const s=this.driver.now();this.holdTime!==null?this.startTime=s-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=s),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const $L=t=>Array.isArray(t)&&typeof t[0]=="number";function kL(t){return!!(!t||typeof t=="string"&&t in G$||$L(t)||Array.isArray(t)&&t.every(kL))}const bc=([t,e,n,s])=>`cubic-bezier(${t}, ${e}, ${n}, ${s})`,G$={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:bc([0,.65,.55,1]),circOut:bc([.55,0,1,.45]),backIn:bc([.31,.01,.66,-.59]),backOut:bc([.33,1.53,.69,.99])};function Nme(t){return SL(t)||G$.easeOut}function SL(t){if(t)return $L(t)?bc(t):Array.isArray(t)?t.map(Nme):G$[t]}function Rme(t,e,n,{delay:s=0,duration:r=300,repeat:o=0,repeatType:i="loop",ease:a,times:l}={}){const u={[e]:n};l&&(u.offset=l);const c=SL(a);return Array.isArray(c)&&(u.easing=c),t.animate(u,{delay:s,duration:r,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:o+1,direction:i==="reverse"?"alternate":"normal"})}const Ame=cL(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Dme=new Set(["opacity","clipPath","filter","transform"]),Om=10,Fme=2e4;function Ome(t){return t.type==="spring"||t.name==="backgroundColor"||!kL(t.ease)}function Pme(t,e){const n=new U$({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:t[0]};const r=[];let o=0;for(;!s.done&&o<Fme;)s=n.sample(o),r.push(s.value),o+=Om;return{times:void 0,keyframes:r,duration:o-Om,ease:"linear"}}class A2 extends dL{constructor(e){super(e);const{name:n,motionValue:s,keyframes:r}=this.options;this.resolver=new uL(r,(o,i)=>this.onKeyframesResolved(o,i),n,s),this.resolver.scheduleResolve()}initPlayback(e,n){var s;let{duration:r=300,times:o,ease:i,type:a,motionValue:l,name:u}=this.options;if(!(!((s=l.owner)===null||s===void 0)&&s.current))return!1;if(Ome(this.options)){const{onComplete:d,onUpdate:h,motionValue:f,...p}=this.options,m=Pme(e,p);e=m.keyframes,e.length===1&&(e[1]=e[0]),r=m.duration,o=m.times,i=m.ease,a="keyframes"}const c=Rme(l.owner.current,u,e,{...this.options,duration:r,times:o,ease:i});return c.startTime=Gl.now(),this.pendingTimeline?(c.timeline=this.pendingTimeline,this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:d}=this.options;l.set(W0(e,this.options,n)),d&&d(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:r,times:o,type:a,ease:i,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return di(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return di(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=fa(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:n}=this;if(!n)return Qr;const{animation:s}=n;s.timeline=e,s.onfinish=null}return Qr}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:s,duration:r,type:o,ease:i,times:a}=e;if(!(n.playState==="idle"||n.playState==="finished")){if(this.time){const{motionValue:l,onUpdate:u,onComplete:c,...d}=this.options,h=new U$({...d,keyframes:s,duration:r,type:o,ease:i,times:a,isGenerator:!0}),f=fa(this.time);l.setWithVelocity(h.sample(f-Om).value,h.sample(f).value,Om)}this.cancel()}}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:s,repeatDelay:r,repeatType:o,damping:i,type:a}=e;return Ame()&&s&&Dme.has(s)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!r&&o!=="mirror"&&i!==0&&a!=="inertia"}}function _me(t,e){let n;const s=()=>{const{currentTime:r}=e,i=(r===null?0:r.value)/100;n!==i&&t(i),n=i};return an.update(s,!0),()=>Rm(s)}const Lme=cL(()=>window.ScrollTimeline!==void 0);class Mme{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}then(e,n){return Promise.all(this.animations).then(e).catch(n)}getAll(e){return this.animations[0][e]}setAll(e,n){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=n}attachTimeline(e){const n=this.animations.map(s=>{if(Lme()&&s.attachTimeline)s.attachTimeline(e);else return s.pause(),_me(r=>{s.time=s.duration*r},e)});return()=>{n.forEach((s,r)=>{s&&s(),this.animations[r].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}const zme=(t,e,n,s={},r,o)=>i=>{const a=q3(s,t)||{},l=a.delay||s.delay||0;let{elapsed:u=0}=s;u=u-fa(l);let c={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{i(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:o?void 0:r};gpe(a)||(c={...c,...mpe(t,c)}),c.duration&&(c.duration=fa(c.duration)),c.repeatDelay&&(c.repeatDelay=fa(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let d=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(c.duration=0,c.delay===0&&(d=!0)),d&&!o&&e.get()!==void 0){const h=W0(c.keyframes,a);if(h!==void 0)return an.update(()=>{c.onUpdate(h),c.onComplete()}),new Mme([])}return!o&&A2.supports(c)?new A2(c):new U$(c)};function Pm(t){return!!(jn(t)&&t.add)}function Bme(t,e){t.indexOf(e)===-1&&t.push(e)}function Vme(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class IL{constructor(){this.subscriptions=[]}add(e){return Bme(this.subscriptions,e),()=>Vme(this.subscriptions,e)}notify(e,n,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,s);else for(let o=0;o<r;o++){const i=this.subscriptions[o];i&&i(e,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const D2=30,Wme=t=>!isNaN(parseFloat(t));class Ume{constructor(e,n={}){this.version="11.2.10",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,r=!0)=>{const o=Gl.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=Gl.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Wme(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new IL);const s=this.events[e].add(n);return e==="change"?()=>{s(),an.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Gl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>D2)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,D2);return hL(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function _m(t,e){return new Ume(t,e)}function Gme(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,_m(n))}function Hme(t,e){const n=V0(t,e);let{transitionEnd:s={},transition:r={},...o}=n||{};o={...o,...s};for(const i in o){const a=Vfe(o[i]);Gme(t,i,a)}}function jme(t){return t.getProps()[I3]}function Kme({protectedKeys:t,needsAnimating:e},n){const s=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,s}function TL(t,e,{delay:n=0,transitionOverride:s,type:r}={}){var o;let{transition:i=t.getDefaultTransition(),transitionEnd:a,...l}=e;const u=t.getValue("willChange");s&&(i=s);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const h in l){const f=t.getValue(h,(o=t.latestValues[h])!==null&&o!==void 0?o:null),p=l[h];if(p===void 0||d&&Kme(d,h))continue;const m={delay:n,elapsed:0,...q3(i||{},h)};let x=!1;if(window.HandoffAppearAnimations){const y=jme(t);if(y){const v=window.HandoffAppearAnimations(y,h,f,an);v!==null&&(m.elapsed=v,x=!0)}}f.start(zme(h,f,p,t.shouldReduceMotion&&el.has(h)?{type:!1}:m,t,x));const g=f.animation;g&&(Pm(u)&&(u.add(h),g.then(()=>u.remove(h))),c.push(g))}return a&&Promise.all(c).then(()=>{an.update(()=>{a&&Hme(t,a)})}),c}function t1(t,e,n={}){var s;const r=V0(t,e,n.type==="exit"?(s=t.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:o=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(o=n.transitionOverride);const i=r?()=>Promise.all(TL(t,r,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:c=0,staggerChildren:d,staggerDirection:h}=o;return Xme(t,e,c+u,d,h,n)}:()=>Promise.resolve(),{when:l}=o;if(l){const[u,c]=l==="beforeChildren"?[i,a]:[a,i];return u().then(()=>c())}else return Promise.all([i(),a(n.delay)])}function Xme(t,e,n=0,s=0,r=1,o){const i=[],a=(t.variantChildren.size-1)*s,l=r===1?(u=0)=>u*s:(u=0)=>a-u*s;return Array.from(t.variantChildren).sort(qme).forEach((u,c)=>{u.notify("AnimationStart",e),i.push(t1(u,e,{...o,delay:n+l(c)}).then(()=>u.notify("AnimationComplete",e)))}),Promise.all(i)}function qme(t,e){return t.sortNodePosition(e)}function Yme(t,e,n={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const r=e.map(o=>t1(t,o,n));s=Promise.all(r)}else if(typeof e=="string")s=t1(t,e,n);else{const r=typeof e=="function"?V0(t,e,n.custom):e;s=Promise.all(TL(t,r,n))}return s.then(()=>{an.postRender(()=>{t.notify("AnimationComplete",e)})})}const Qme=[...I$].reverse(),Zme=I$.length;function Jme(t){return e=>Promise.all(e.map(({animation:n,options:s})=>Yme(t,n,s)))}function ege(t){let e=Jme(t);const n=nge();let s=!0;const r=l=>(u,c)=>{var d;const h=V0(t,c,l==="exit"?(d=t.presenceContext)===null||d===void 0?void 0:d.custom:void 0);if(h){const{transition:f,transitionEnd:p,...m}=h;u={...u,...m,...p}}return u};function o(l){e=l(t)}function i(l){const u=t.getProps(),c=t.getVariantContext(!0)||{},d=[],h=new Set;let f={},p=1/0;for(let x=0;x<Zme;x++){const g=Qme[x],y=n[g],v=u[g]!==void 0?u[g]:c[g],b=Cd(v),w=g===l?y.isActive:null;w===!1&&(p=x);let $=v===c[g]&&v!==u[g]&&b;if($&&s&&t.manuallyAnimateOnMount&&($=!1),y.protectedKeys={...f},!y.isActive&&w===null||!v&&!y.prevProp||z0(v)||typeof v=="boolean")continue;let C=tge(y.prevProp,v)||g===l&&y.isActive&&!$&&b||x>p&&b,S=!1;const T=Array.isArray(v)?v:[v];let R=T.reduce(r(g),{});w===!1&&(R={});const{prevResolvedValues:A={}}=y,E={...A,...R},N=P=>{C=!0,h.has(P)&&(S=!0,h.delete(P)),y.needsAnimating[P]=!0;const _=t.getValue(P);_&&(_.liveStyle=!1)};for(const P in E){const _=R[P],M=A[P];if(f.hasOwnProperty(P))continue;let D=!1;jv(_)&&jv(M)?D=!X3(_,M):D=_!==M,D?_!=null?N(P):h.add(P):_!==void 0&&h.has(P)?N(P):y.protectedKeys[P]=!0}y.prevProp=v,y.prevResolvedValues=R,y.isActive&&(f={...f,...R}),s&&t.blockInitialAnimation&&(C=!1),C&&(!$||S)&&d.push(...T.map(P=>({animation:P,options:{type:g}})))}if(h.size){const x={};h.forEach(g=>{const y=t.getBaseTarget(g),v=t.getValue(g);v&&(v.liveStyle=!0),x[g]=y??null}),d.push({animation:x})}let m=!!d.length;return s&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(m=!1),s=!1,m?e(d):Promise.resolve()}function a(l,u){var c;if(n[l].isActive===u)return Promise.resolve();(c=t.variantChildren)===null||c===void 0||c.forEach(h=>{var f;return(f=h.animationState)===null||f===void 0?void 0:f.setActive(l,u)}),n[l].isActive=u;const d=i(l);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:i,setActive:a,setAnimateFunction:o,getState:()=>n}}function tge(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!X3(e,t):!1}function Mi(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function nge(){return{animate:Mi(!0),whileInView:Mi(),whileHover:Mi(),whileTap:Mi(),whileDrag:Mi(),whileFocus:Mi(),exit:Mi()}}class sge extends Mu{constructor(e){super(e),e.animationState||(e.animationState=ege(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),z0(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let rge=0;class oge extends Mu{constructor(){super(...arguments),this.id=rge++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const ige={animation:{Feature:sge},exit:{Feature:oge}},F2=()=>({min:0,max:0}),EL=()=>({x:F2(),y:F2()});function age({top:t,left:e,right:n,bottom:s}){return{x:{min:e,max:n},y:{min:t,max:s}}}function lge(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function uge(t,e){return age(lge(t.getBoundingClientRect(),e))}const n1={current:null},NL={current:!1};function cge(){if(NL.current=!0,!!C$)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>n1.current=t.matches;t.addListener(e),e()}else n1.current=!1}function dge(t,e,n){const{willChange:s}=e;for(const r in e){const o=e[r],i=n[r];if(jn(o))t.addValue(r,o),Pm(s)&&s.add(r);else if(jn(i))t.addValue(r,_m(o,{owner:t})),Pm(s)&&s.remove(r);else if(i!==o)if(t.hasValue(r)){const a=t.getValue(r);a.liveStyle===!0?a.jump(o):a.hasAnimated||a.set(o)}else{const a=t.getStaticValue(r);t.addValue(r,_m(a!==void 0?a:o,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const O2=new WeakMap,hge=[...eL,An,zu],fge=t=>hge.find(J3(t)),RL=Object.keys($d),pge=RL.length,P2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],mge=T$.length;function AL(t){if(t)return t.options.allowProjection!==!1?t.projection:AL(t.parent)}class gge{scrapeMotionValuesFromProps(e,n,s){return{}}constructor({parent:e,props:n,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:o,visualState:i},a={}){this.resolveKeyframes=(h,f,p,m)=>new this.KeyframeResolver(h,f,p,m,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=L$,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>an.render(this.render,!1,!0);const{latestValues:l,renderState:u}=i;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!o,this.isControllingVariants=B0(n),this.isVariantNode=N3(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in d){const f=d[h];l[h]!==void 0&&jn(f)&&(f.set(l[h],!1),Pm(c)&&c.add(h))}}mount(e){this.current=e,O2.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),NL.current||cge(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:n1.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var e;O2.delete(this.current),this.projection&&this.projection.unmount(),Rm(this.notifyUpdate),Rm(this.render),this.valueSubscriptions.forEach(n=>n()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const n in this.events)this.events[n].clear();for(const n in this.features)(e=this.features[n])===null||e===void 0||e.unmount();this.current=null}bindToMotionValue(e,n){const s=el.has(e),r=n.on("change",i=>{this.latestValues[e]=i,this.props.onUpdate&&an.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{r(),o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...n},s,r,o){let i,a;for(let l=0;l<pge;l++){const u=RL[l],{isEnabled:c,Feature:d,ProjectionNode:h,MeasureLayout:f}=$d[u];h&&(i=h),c(n)&&(!this.features[u]&&d&&(this.features[u]=new d(this)),f&&(a=f))}if((this.type==="html"||this.type==="svg")&&!this.projection&&i){const{layoutId:l,layout:u,drag:c,dragConstraints:d,layoutScroll:h,layoutRoot:f}=n;this.projection=new i(this.latestValues,n["data-framer-portal-id"]?void 0:AL(this.parent)),this.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!c||d&&E3(d),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof u=="string"?u:"both",initialPromotionConfig:o,layoutScroll:h,layoutRoot:f})}return a}updateFeatures(){for(const e in this.features){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):EL()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<P2.length;s++){const r=P2[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,i=e[o];i&&(this.propEventSubscriptions[r]=this.on(r,i))}this.prevMotionValues=dge(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const s=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(s.initial=this.props.initial),s}const n={};for(let s=0;s<mge;s++){const r=T$[s],o=this.props[r];(Cd(o)||o===!1)&&(n[r]=o)}return n}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const s=this.values.get(e);n!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&n!==void 0&&(s=_m(n===null?void 0:n,{owner:this}),this.addValue(e,s)),s}readValue(e,n){var s;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(s=this.getBaseTargetFromProps(this.props,e))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(Q3(r)||Y3(r))?r=parseFloat(r):!fge(r)&&zu.test(n)&&(r=lL(e,n)),this.setBaseTarget(e,jn(r)?r.get():r)),jn(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:s}=this.props;let r;if(typeof s=="string"||typeof s=="object"){const i=_$(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);i&&(r=i[e])}if(s&&r!==void 0)return r;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!jn(o)?o:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new IL),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class DL extends gge{constructor(){super(...arguments),this.KeyframeResolver=uL}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:s}){delete n[e],delete s[e]}}function xge(t){return window.getComputedStyle(t)}class yge extends DL{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,n){if(el.has(n)){const s=z$(n);return s&&s.default||0}else{const s=xge(e),r=(F3(n)?s.getPropertyValue(n):s[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return uge(e,n)}build(e,n,s,r){A$(e,n,s,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,s){return P$(e,n,s)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;jn(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(e,n,s,r){M3(e,n,s,r)}}class vge extends DL{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(el.has(n)){const s=z$(n);return s&&s.default||0}return n=z3.has(n)?n:S$(n),e.getAttribute(n)}measureInstanceViewportBox(){return EL()}scrapeMotionValuesFromProps(e,n,s){return V3(e,n,s)}build(e,n,s,r){F$(e,n,s,this.isSVGTag,r.transformTemplate)}renderInstance(e,n,s,r){B3(e,n,s,r)}mount(e){this.isSVGTag=O$(e.tagName),super.mount(e)}}const bge=(t,e)=>E$(t)?new vge(e,{enableHardwareAcceleration:!1}):new yge(e,{allowProjection:t!==O.Fragment,enableHardwareAcceleration:!0}),s1=mfe(Kfe);function FL(){const t=O.useRef(!1);return $$(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function wge(){const t=FL(),[e,n]=O.useState(0),s=O.useCallback(()=>{t.current&&n(e+1)},[e]);return[O.useCallback(()=>an.postRender(s),[s]),e]}class Cge extends O.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function $ge({children:t,isPresent:e}){const n=O.useId(),s=O.useRef(null),r=O.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=O.useContext(b$);return O.useInsertionEffect(()=>{const{width:i,height:a,top:l,left:u}=r.current;if(e||!s.current||!i||!a)return;s.current.dataset.motionPopId=n;const c=document.createElement("style");return o&&(c.nonce=o),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${a}px !important;
            top: ${l}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[e]),q.jsx(Cge,{isPresent:e,childRef:s,sizeRef:r,children:O.cloneElement(t,{ref:s})})}const Xx=({children:t,initial:e,isPresent:n,onExitComplete:s,custom:r,presenceAffectsLayout:o,mode:i})=>{const a=W3(kge),l=O.useId(),u=O.useMemo(()=>({id:l,initial:e,isPresent:n,custom:r,onExitComplete:c=>{a.set(c,!0);for(const d of a.values())if(!d)return;s&&s()},register:c=>(a.set(c,!1),()=>a.delete(c))}),o?[Math.random()]:[n]);return O.useMemo(()=>{a.forEach((c,d)=>a.set(d,!1))},[n]),O.useEffect(()=>{!n&&!a.size&&s&&s()},[n]),i==="popLayout"&&(t=q.jsx($ge,{isPresent:n,children:t})),q.jsx(w$.Provider,{value:u,children:t})};function kge(){return new Map}function Sge(t){return O.useEffect(()=>()=>t(),[])}const ji=t=>t.key||"";function Ige(t,e){t.forEach(n=>{const s=ji(n);e.set(s,n)})}function Tge(t){const e=[];return O.Children.forEach(t,n=>{O.isValidElement(n)&&e.push(n)}),e}const OL=({children:t,custom:e,initial:n=!0,onExitComplete:s,exitBeforeEnter:r,presenceAffectsLayout:o=!0,mode:i="sync"})=>{const a=O.useContext(R3).forceRender||wge()[0],l=FL(),u=Tge(t);let c=u;const d=O.useRef(new Map).current,h=O.useRef(c),f=O.useRef(new Map).current,p=O.useRef(!0);if($$(()=>{p.current=!1,Ige(u,f),h.current=c}),Sge(()=>{p.current=!0,f.clear(),d.clear()}),p.current)return q.jsx(q.Fragment,{children:c.map(y=>q.jsx(Xx,{isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:o,mode:i,children:y},ji(y)))});c=[...c];const m=h.current.map(ji),x=u.map(ji),g=m.length;for(let y=0;y<g;y++){const v=m[y];x.indexOf(v)===-1&&!d.has(v)&&d.set(v,void 0)}return i==="wait"&&d.size&&(c=[]),d.forEach((y,v)=>{if(x.indexOf(v)!==-1)return;const b=f.get(v);if(!b)return;const w=m.indexOf(v);let $=y;if(!$){const k=()=>{d.delete(v);const C=Array.from(f.keys()).filter(S=>!x.includes(S));if(C.forEach(S=>f.delete(S)),h.current=u.filter(S=>{const T=ji(S);return T===v||C.includes(T)}),!d.size){if(l.current===!1)return;a(),s&&s()}};$=q.jsx(Xx,{isPresent:!1,onExitComplete:k,custom:e,presenceAffectsLayout:o,mode:i,children:b},ji(b)),d.set(v,$)}c.splice(w,0,$)}),c=c.map(y=>{const v=y.key;return d.has(v)?y:q.jsx(Xx,{isPresent:!0,presenceAffectsLayout:o,mode:i,children:y},ji(y))}),q.jsx(q.Fragment,{children:d.size?c:c.map(y=>O.cloneElement(y))})};function r1({children:t,features:e,strict:n=!1}){const[,s]=O.useState(!qx(e)),r=O.useRef(void 0);if(!qx(e)){const{renderer:o,...i}=e;r.current=o,Hv(i)}return O.useEffect(()=>{qx(e)&&e().then(({renderer:o,...i})=>{Hv(i),r.current=o,s(!0)})},[]),q.jsx(k$.Provider,{value:{renderer:r.current,strict:n},children:t})}function qx(t){return typeof t=="function"}const o1={renderer:bge,...ige,...cpe};function Oi(t){return O.forwardRef(t)}var H$=(t,e,n=!0)=>{if(!e)return[t,{}];const s=e.reduce((r,o)=>o in t?{...r,[o]:t[o]}:r,{});return n?[Object.keys(t).filter(o=>!e.includes(o)).reduce((o,i)=>({...o,[i]:t[i]}),{}),s]:[t,s]},Ege={default:"bg-default text-default-foreground",primary:"bg-primary text-primary-foreground",secondary:"bg-secondary text-secondary-foreground",success:"bg-success text-success-foreground",warning:"bg-warning text-warning-foreground",danger:"bg-danger text-danger-foreground",foreground:"bg-foreground text-background"},Nge={default:"shadow-lg shadow-default/50 bg-default text-default-foreground",primary:"shadow-lg shadow-primary/40 bg-primary text-primary-foreground",secondary:"shadow-lg shadow-secondary/40 bg-secondary text-secondary-foreground",success:"shadow-lg shadow-success/40 bg-success text-success-foreground",warning:"shadow-lg shadow-warning/40 bg-warning text-warning-foreground",danger:"shadow-lg shadow-danger/40 bg-danger text-danger-foreground",foreground:"shadow-lg shadow-foreground/40 bg-foreground text-background"},Rge={default:"bg-transparent border-default text-foreground",primary:"bg-transparent border-primary text-primary",secondary:"bg-transparent border-secondary text-secondary",success:"bg-transparent border-success text-success",warning:"bg-transparent border-warning text-warning",danger:"bg-transparent border-danger text-danger",foreground:"bg-transparent border-foreground text-foreground"},Age={default:"bg-default/40 text-default-foreground",primary:"bg-primary/20 text-primary",secondary:"bg-secondary/20 text-secondary",success:"bg-success/20 text-success-600 dark:text-success",warning:"bg-warning/20 text-warning-600 dark:text-warning",danger:"bg-danger/20 text-danger dark:text-danger-500",foreground:"bg-foreground/10 text-foreground"},Dge={default:"border-default bg-default-100 text-default-foreground",primary:"border-default bg-default-100 text-primary",secondary:"border-default bg-default-100 text-secondary",success:"border-default bg-default-100 text-success",warning:"border-default bg-default-100 text-warning",danger:"border-default bg-default-100 text-danger",foreground:"border-default bg-default-100 text-foreground"},Fge={default:"bg-transparent text-default-foreground",primary:"bg-transparent text-primary",secondary:"bg-transparent text-secondary",success:"bg-transparent text-success",warning:"bg-transparent text-warning",danger:"bg-transparent text-danger",foreground:"bg-transparent text-foreground"},Oge={default:"border-default text-default-foreground hover:!bg-default",primary:"border-primary text-primary hover:!text-primary-foreground hover:!bg-primary",secondary:"border-secondary text-secondary hover:text-secondary-foreground hover:!bg-secondary",success:"border-success text-success hover:!text-success-foreground hover:!bg-success",warning:"border-warning text-warning hover:!text-warning-foreground hover:!bg-warning",danger:"border-danger text-danger hover:!text-danger-foreground hover:!bg-danger",foreground:"border-foreground text-foreground hover:!bg-foreground"},Ee={solid:Ege,shadow:Nge,bordered:Rge,flat:Age,faded:Dge,light:Fge,ghost:Oge},Vf=["small","medium","large"],_2={theme:{opacity:["disabled"],spacing:["divider"],borderWidth:Vf,borderRadius:Vf},classGroups:{shadow:[{shadow:Vf}],"font-size":[{text:["tiny",...Vf]}],"bg-image":["bg-stripe-gradient"]}},L2=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,fs=t=>!t||typeof t!="object"||Object.keys(t).length===0,Pge=(t,e)=>JSON.stringify(t)===JSON.stringify(e);function PL(t,e){t.forEach(function(n){Array.isArray(n)?PL(n,e):e.push(n)})}function _L(t){let e=[];return PL(t,e),e}var LL=(...t)=>_L(t).filter(Boolean),ML=(t,e)=>{let n={},s=Object.keys(t),r=Object.keys(e);for(let o of s)if(r.includes(o)){let i=t[o],a=e[o];typeof i=="object"&&typeof a=="object"?n[o]=ML(i,a):Array.isArray(i)||Array.isArray(a)?n[o]=LL(a,i):n[o]=a+" "+i}else n[o]=t[o];for(let o of r)s.includes(o)||(n[o]=e[o]);return n},M2=t=>!t||typeof t!="string"?t:t.replace(/\s+/g," ").trim();function _ge(){for(var t=0,e,n,s="";t<arguments.length;)(e=arguments[t++])&&(n=zL(e))&&(s&&(s+=" "),s+=n);return s}function zL(t){if(typeof t=="string")return t;for(var e,n="",s=0;s<t.length;s++)t[s]&&(e=zL(t[s]))&&(n&&(n+=" "),n+=e);return n}var j$="-";function Lge(t){var e=zge(t),n=t.conflictingClassGroups,s=t.conflictingClassGroupModifiers,r=s===void 0?{}:s;function o(a){var l=a.split(j$);return l[0]===""&&l.length!==1&&l.shift(),BL(l,e)||Mge(a)}function i(a,l){var u=n[a]||[];return l&&r[a]?[].concat(u,r[a]):u}return{getClassGroupId:o,getConflictingClassGroupIds:i}}function BL(t,e){var i;if(t.length===0)return e.classGroupId;var n=t[0],s=e.nextPart.get(n),r=s?BL(t.slice(1),s):void 0;if(r)return r;if(e.validators.length!==0){var o=t.join(j$);return(i=e.validators.find(function(a){var l=a.validator;return l(o)}))==null?void 0:i.classGroupId}}var z2=/^\[(.+)\]$/;function Mge(t){if(z2.test(t)){var e=z2.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}}function zge(t){var e=t.theme,n=t.prefix,s={nextPart:new Map,validators:[]},r=Vge(Object.entries(t.classGroups),n);return r.forEach(function(o){var i=o[0],a=o[1];i1(a,s,i,e)}),s}function i1(t,e,n,s){t.forEach(function(r){if(typeof r=="string"){var o=r===""?e:B2(e,r);o.classGroupId=n;return}if(typeof r=="function"){if(Bge(r)){i1(r(s),e,n,s);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(function(i){var a=i[0],l=i[1];i1(l,B2(e,a),n,s)})})}function B2(t,e){var n=t;return e.split(j$).forEach(function(s){n.nextPart.has(s)||n.nextPart.set(s,{nextPart:new Map,validators:[]}),n=n.nextPart.get(s)}),n}function Bge(t){return t.isThemeGetter}function Vge(t,e){return e?t.map(function(n){var s=n[0],r=n[1],o=r.map(function(i){return typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(function(a){var l=a[0],u=a[1];return[e+l,u]})):i});return[s,o]}):t}function Wge(t){if(t<1)return{get:function(){},set:function(){}};var e=0,n=new Map,s=new Map;function r(o,i){n.set(o,i),e++,e>t&&(e=0,s=n,n=new Map)}return{get:function(i){var a=n.get(i);if(a!==void 0)return a;if((a=s.get(i))!==void 0)return r(i,a),a},set:function(i,a){n.has(i)?n.set(i,a):r(i,a)}}}var VL="!";function Uge(t){var e=t.separator||":",n=e.length===1,s=e[0],r=e.length;return function(i){for(var a=[],l=0,u=0,c,d=0;d<i.length;d++){var h=i[d];if(l===0){if(h===s&&(n||i.slice(d,d+r)===e)){a.push(i.slice(u,d)),u=d+r;continue}if(h==="/"){c=d;continue}}h==="["?l++:h==="]"&&l--}var f=a.length===0?i:i.substring(u),p=f.startsWith(VL),m=p?f.substring(1):f,x=c&&c>u?c-u:void 0;return{modifiers:a,hasImportantModifier:p,baseClassName:m,maybePostfixModifierPosition:x}}}function Gge(t){if(t.length<=1)return t;var e=[],n=[];return t.forEach(function(s){var r=s[0]==="[";r?(e.push.apply(e,n.sort().concat([s])),n=[]):n.push(s)}),e.push.apply(e,n.sort()),e}function Hge(t){return{cache:Wge(t.cacheSize),splitModifiers:Uge(t),...Lge(t)}}var jge=/\s+/;function Kge(t,e){var n=e.splitModifiers,s=e.getClassGroupId,r=e.getConflictingClassGroupIds,o=new Set;return t.trim().split(jge).map(function(i){var a=n(i),l=a.modifiers,u=a.hasImportantModifier,c=a.baseClassName,d=a.maybePostfixModifierPosition,h=s(d?c.substring(0,d):c),f=!!d;if(!h){if(!d)return{isTailwindClass:!1,originalClassName:i};if(h=s(c),!h)return{isTailwindClass:!1,originalClassName:i};f=!1}var p=Gge(l).join(":"),m=u?p+VL:p;return{isTailwindClass:!0,modifierId:m,classGroupId:h,originalClassName:i,hasPostfixModifier:f}}).reverse().filter(function(i){if(!i.isTailwindClass)return!0;var a=i.modifierId,l=i.classGroupId,u=i.hasPostfixModifier,c=a+l;return o.has(c)?!1:(o.add(c),r(l,u).forEach(function(d){return o.add(a+d)}),!0)}).reverse().map(function(i){return i.originalClassName}).join(" ")}function a1(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s,r,o,i=a;function a(u){var c=e[0],d=e.slice(1),h=d.reduce(function(f,p){return p(f)},c());return s=Hge(h),r=s.cache.get,o=s.cache.set,i=l,l(u)}function l(u){var c=r(u);if(c)return c;var d=Kge(u,s);return o(u,d),d}return function(){return i(_ge.apply(null,arguments))}}function yt(t){var e=function(s){return s[t]||[]};return e.isThemeGetter=!0,e}var WL=/^\[(?:([a-z-]+):)?(.+)\]$/i,Xge=/^\d+\/\d+$/,qge=new Set(["px","full","screen"]),Yge=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Qge=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Zge=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function ir(t){return ia(t)||qge.has(t)||Xge.test(t)||l1(t)}function l1(t){return tl(t,"length",r0e)}function Jge(t){return tl(t,"size",UL)}function e0e(t){return tl(t,"position",UL)}function t0e(t){return tl(t,"url",o0e)}function Wf(t){return tl(t,"number",ia)}function ia(t){return!Number.isNaN(Number(t))}function n0e(t){return t.endsWith("%")&&ia(t.slice(0,-1))}function sc(t){return V2(t)||tl(t,"number",V2)}function _e(t){return WL.test(t)}function rc(){return!0}function zo(t){return Yge.test(t)}function s0e(t){return tl(t,"",i0e)}function tl(t,e,n){var s=WL.exec(t);return s?s[1]?s[1]===e:n(s[2]):!1}function r0e(t){return Qge.test(t)}function UL(){return!1}function o0e(t){return t.startsWith("url(")}function V2(t){return Number.isInteger(Number(t))}function i0e(t){return Zge.test(t)}function u1(){var t=yt("colors"),e=yt("spacing"),n=yt("blur"),s=yt("brightness"),r=yt("borderColor"),o=yt("borderRadius"),i=yt("borderSpacing"),a=yt("borderWidth"),l=yt("contrast"),u=yt("grayscale"),c=yt("hueRotate"),d=yt("invert"),h=yt("gap"),f=yt("gradientColorStops"),p=yt("gradientColorStopPositions"),m=yt("inset"),x=yt("margin"),g=yt("opacity"),y=yt("padding"),v=yt("saturate"),b=yt("scale"),w=yt("sepia"),$=yt("skew"),k=yt("space"),C=yt("translate"),S=function(){return["auto","contain","none"]},T=function(){return["auto","hidden","clip","visible","scroll"]},R=function(){return["auto",_e,e]},A=function(){return[_e,e]},E=function(){return["",ir]},N=function(){return["auto",ia,_e]},P=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},_=function(){return["solid","dashed","dotted","double","none"]},M=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},D=function(){return["start","end","center","between","around","evenly","stretch"]},W=function(){return["","0",_e]},H=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},X=function(){return[ia,Wf]},Z=function(){return[ia,_e]};return{cacheSize:500,theme:{colors:[rc],spacing:[ir],blur:["none","",zo,_e],brightness:X(),borderColor:[t],borderRadius:["none","","full",zo,_e],borderSpacing:A(),borderWidth:E(),contrast:X(),grayscale:W(),hueRotate:Z(),invert:W(),gap:A(),gradientColorStops:[t],gradientColorStopPositions:[n0e,l1],inset:R(),margin:R(),opacity:X(),padding:A(),saturate:X(),scale:X(),sepia:W(),skew:Z(),space:A(),translate:A()},classGroups:{aspect:[{aspect:["auto","square","video",_e]}],container:["container"],columns:[{columns:[zo]}],"break-after":[{"break-after":H()}],"break-before":[{"break-before":H()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat(P(),[_e])}],overflow:[{overflow:T()}],"overflow-x":[{"overflow-x":T()}],"overflow-y":[{"overflow-y":T()}],overscroll:[{overscroll:S()}],"overscroll-x":[{"overscroll-x":S()}],"overscroll-y":[{"overscroll-y":S()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",sc]}],basis:[{basis:R()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",_e]}],grow:[{grow:W()}],shrink:[{shrink:W()}],order:[{order:["first","last","none",sc]}],"grid-cols":[{"grid-cols":[rc]}],"col-start-end":[{col:["auto",{span:["full",sc]},_e]}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":[rc]}],"row-start-end":[{row:["auto",{span:[sc]},_e]}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",_e]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",_e]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal"].concat(D())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(D(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(D(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[x]}],mx:[{mx:[x]}],my:[{my:[x]}],ms:[{ms:[x]}],me:[{me:[x]}],mt:[{mt:[x]}],mr:[{mr:[x]}],mb:[{mb:[x]}],ml:[{ml:[x]}],"space-x":[{"space-x":[k]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[k]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",_e,e]}],"min-w":[{"min-w":["min","max","fit",_e,ir]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[zo]},zo,_e]}],h:[{h:[_e,e,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",_e,ir]}],"max-h":[{"max-h":[_e,e,"min","max","fit"]}],"font-size":[{text:["base",zo,l1]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Wf]}],"font-family":[{font:[rc]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",_e]}],"line-clamp":[{"line-clamp":["none",ia,Wf]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",_e,ir]}],"list-image":[{"list-image":["none",_e]}],"list-style-type":[{list:["none","disc","decimal",_e]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(_(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",ir]}],"underline-offset":[{"underline-offset":["auto",_e,ir]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:A()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",_e]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",_e]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat(P(),[e0e])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Jge]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},t0e]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:[].concat(_(),["hidden"])}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:_()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:[""].concat(_())}],"outline-offset":[{"outline-offset":[_e,ir]}],"outline-w":[{outline:[ir]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:E()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[ir]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",zo,s0e]}],"shadow-color":[{shadow:[rc]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":M()}],"bg-blend":[{"bg-blend":M()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[s]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",zo,_e]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[d]}],saturate:[{saturate:[v]}],sepia:[{sepia:[w]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[w]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",_e]}],duration:[{duration:Z()}],ease:[{ease:["linear","in","out","in-out",_e]}],delay:[{delay:Z()}],animate:[{animate:["none","spin","ping","pulse","bounce",_e]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[sc,_e]}],"translate-x":[{"translate-x":[C]}],"translate-y":[{"translate-y":[C]}],"skew-x":[{"skew-x":[$]}],"skew-y":[{"skew-y":[$]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",_e]}],accent:[{accent:["auto",t]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",_e]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":A()}],"scroll-mx":[{"scroll-mx":A()}],"scroll-my":[{"scroll-my":A()}],"scroll-ms":[{"scroll-ms":A()}],"scroll-me":[{"scroll-me":A()}],"scroll-mt":[{"scroll-mt":A()}],"scroll-mr":[{"scroll-mr":A()}],"scroll-mb":[{"scroll-mb":A()}],"scroll-ml":[{"scroll-ml":A()}],"scroll-p":[{"scroll-p":A()}],"scroll-px":[{"scroll-px":A()}],"scroll-py":[{"scroll-py":A()}],"scroll-ps":[{"scroll-ps":A()}],"scroll-pe":[{"scroll-pe":A()}],"scroll-pt":[{"scroll-pt":A()}],"scroll-pr":[{"scroll-pr":A()}],"scroll-pb":[{"scroll-pb":A()}],"scroll-pl":[{"scroll-pl":A()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",_e]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[ir,Wf]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}function a0e(t,e){for(var n in e)GL(t,n,e[n]);return t}var l0e=Object.prototype.hasOwnProperty,u0e=new Set(["string","number","boolean"]);function GL(t,e,n){if(!l0e.call(t,e)||u0e.has(typeof n)||n===null){t[e]=n;return}if(Array.isArray(n)&&Array.isArray(t[e])){t[e]=t[e].concat(n);return}if(typeof n=="object"&&typeof t[e]=="object"){if(t[e]===null){t[e]=n;return}for(var s in n)GL(t[e],s,n[s])}}function c0e(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return typeof t=="function"?a1.apply(void 0,[u1,t].concat(n)):a1.apply(void 0,[function(){return a0e(u1(),t)}].concat(n))}var d0e=a1(u1),h0e={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},HL=t=>t||void 0,Sd=(...t)=>HL(_L(t).filter(Boolean).join(" ")),Yx=null,Lm={},c1=!1,oc=(...t)=>e=>e.twMerge?((!Yx||c1)&&(c1=!1,Yx=fs(Lm)?d0e:c0e(Lm)),HL(Yx(Sd(t)))):Sd(t),W2=(t,e)=>{for(let n in e)t.hasOwnProperty(n)?t[n]=Sd(t[n],e[n]):t[n]=e[n];return t},f0e=(t,e)=>{let{extend:n=null,slots:s={},variants:r={},compoundVariants:o=[],compoundSlots:i=[],defaultVariants:a={}}=t,l={...h0e,...e},u=n!=null&&n.base?Sd(n.base,t==null?void 0:t.base):t==null?void 0:t.base,c=n!=null&&n.variants&&!fs(n.variants)?ML(r,n.variants):r,d=n!=null&&n.defaultVariants&&!fs(n.defaultVariants)?{...n.defaultVariants,...a}:a;!fs(l.twMergeConfig)&&!Pge(l.twMergeConfig,Lm)&&(c1=!0,Lm=l.twMergeConfig);let h=fs(n==null?void 0:n.slots),f=fs(s)?{}:{base:Sd(t==null?void 0:t.base,h&&(n==null?void 0:n.base)),...s},p=h?f:W2({...n==null?void 0:n.slots},fs(f)?{base:t==null?void 0:t.base}:f),m=g=>{if(fs(c)&&fs(s)&&h)return oc(u,g==null?void 0:g.class,g==null?void 0:g.className)(l);if(o&&!Array.isArray(o))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof o}`);if(i&&!Array.isArray(i))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof i}`);let y=(A,E,N=[],P)=>{let _=N;if(typeof E=="string")_=_.concat(M2(E).split(" ").map(M=>`${A}:${M}`));else if(Array.isArray(E))_=_.concat(E.reduce((M,D)=>M.concat(`${A}:${D}`),[]));else if(typeof E=="object"&&typeof P=="string"){for(let M in E)if(E.hasOwnProperty(M)&&M===P){let D=E[M];if(D&&typeof D=="string"){let W=M2(D);_[P]?_[P]=_[P].concat(W.split(" ").map(H=>`${A}:${H}`)):_[P]=W.split(" ").map(H=>`${A}:${H}`)}else Array.isArray(D)&&D.length>0&&(_[P]=D.reduce((W,H)=>W.concat(`${A}:${H}`),[]))}}return _},v=(A,E=c,N=null,P=null)=>{var _;let M=E[A];if(!M||fs(M))return null;let D=(_=P==null?void 0:P[A])!=null?_:g==null?void 0:g[A];if(D===null)return null;let W=L2(D),H=Array.isArray(l.responsiveVariants)&&l.responsiveVariants.length>0||l.responsiveVariants===!0,X=d==null?void 0:d[A],Z=[];if(typeof W=="object"&&H)for(let[se,te]of Object.entries(W)){let oe=M[te];if(se==="initial"){X=te;continue}Array.isArray(l.responsiveVariants)&&!l.responsiveVariants.includes(se)||(Z=y(se,oe,Z,N))}let J=M[W]||M[L2(X)];return typeof Z=="object"&&typeof N=="string"&&Z[N]?W2(Z,J):Z.length>0?(Z.push(J),Z):J},b=()=>c?Object.keys(c).map(A=>v(A,c)):null,w=(A,E)=>{if(!c||typeof c!="object")return null;let N=new Array;for(let P in c){let _=v(P,c,A,E),M=A==="base"&&typeof _=="string"?_:_&&_[A];M&&(N[N.length]=M)}return N},$={};for(let A in g)g[A]!==void 0&&($[A]=g[A]);let k=(A,E)=>{var N;let P=typeof(g==null?void 0:g[A])=="object"?{[A]:(N=g[A])==null?void 0:N.initial}:{};return{...d,...$,...P,...E}},C=(A=[],E)=>{let N=[];for(let{class:P,className:_,...M}of A){let D=!0;for(let[W,H]of Object.entries(M)){let X=k(W,E);if(Array.isArray(H)){if(!H.includes(X[W])){D=!1;break}}else if(X[W]!==H){D=!1;break}}D&&(P&&N.push(P),_&&N.push(_))}return N},S=A=>{let E=C(o,A),N=C(n==null?void 0:n.compoundVariants,A);return LL(N,E)},T=A=>{let E=S(A);if(!Array.isArray(E))return E;let N={};for(let P of E)if(typeof P=="string"&&(N.base=oc(N.base,P)(l)),typeof P=="object")for(let[_,M]of Object.entries(P))N[_]=oc(N[_],M)(l);return N},R=A=>{if(i.length<1)return null;let E={};for(let{slots:N=[],class:P,className:_,...M}of i){if(!fs(M)){let D=!0;for(let W of Object.keys(M)){let H=k(W,A)[W];if(H===void 0||(Array.isArray(M[W])?!M[W].includes(H):M[W]!==H)){D=!1;break}}if(!D)continue}for(let D of N)E[D]=E[D]||[],E[D].push([P,_])}return E};if(!fs(s)||!h){let A={};if(typeof p=="object"&&!fs(p))for(let E of Object.keys(p))A[E]=N=>{var P,_;return oc(p[E],w(E,N),((P=T(N))!=null?P:[])[E],((_=R(N))!=null?_:[])[E],N==null?void 0:N.class,N==null?void 0:N.className)(l)};return A}return oc(u,b(),S(),g==null?void 0:g.class,g==null?void 0:g.className)(l)},x=()=>{if(!(!c||typeof c!="object"))return Object.keys(c)};return m.variantKeys=x(),m.extend=n,m.base=u,m.slots=p,m.variants=c,m.defaultVariants=d,m.compoundSlots=i,m.compoundVariants=o,m},G0=(t,e)=>{var n,s,r;return f0e(t,{...e,twMerge:(n=void 0)!=null?n:!0,twMergeConfig:{theme:{...(s=void 0)==null?void 0:s.theme,..._2.theme},classGroups:{...(r=void 0)==null?void 0:r.classGroups,..._2.classGroups}}})},jL=["outline-none","data-[focus-visible=true]:z-10","data-[focus-visible=true]:outline-2","data-[focus-visible=true]:outline-focus","data-[focus-visible=true]:outline-offset-2"],al={default:["[&+.border-medium.border-default]:ms-[calc(theme(borderWidth.medium)*-1)]"],primary:["[&+.border-medium.border-primary]:ms-[calc(theme(borderWidth.medium)*-1)]"],secondary:["[&+.border-medium.border-secondary]:ms-[calc(theme(borderWidth.medium)*-1)]"],success:["[&+.border-medium.border-success]:ms-[calc(theme(borderWidth.medium)*-1)]"],warning:["[&+.border-medium.border-warning]:ms-[calc(theme(borderWidth.medium)*-1)]"],danger:["[&+.border-medium.border-danger]:ms-[calc(theme(borderWidth.medium)*-1)]"]},U2=G0({slots:{base:"relative inline-flex flex-col gap-2 items-center justify-center",wrapper:"relative flex",circle1:["absolute","w-full","h-full","rounded-full","animate-spinner-ease-spin","border-2","border-solid","border-t-transparent","border-l-transparent","border-r-transparent"],circle2:["absolute","w-full","h-full","rounded-full","opacity-75","animate-spinner-linear-spin","border-2","border-dotted","border-t-transparent","border-l-transparent","border-r-transparent"],label:"text-foreground dark:text-foreground-dark font-regular"},variants:{size:{sm:{wrapper:"w-5 h-5",circle1:"border-2",circle2:"border-2",label:"text-small"},md:{wrapper:"w-8 h-8",circle1:"border-3",circle2:"border-3",label:"text-medium"},lg:{wrapper:"w-10 h-10",circle1:"border-3",circle2:"border-3",label:"text-large"}},color:{current:{circle1:"border-b-current",circle2:"border-b-current"},white:{circle1:"border-b-white",circle2:"border-b-white"},default:{circle1:"border-b-default",circle2:"border-b-default"},primary:{circle1:"border-b-primary",circle2:"border-b-primary"},secondary:{circle1:"border-b-secondary",circle2:"border-b-secondary"},success:{circle1:"border-b-success",circle2:"border-b-success"},warning:{circle1:"border-b-warning",circle2:"border-b-warning"},danger:{circle1:"border-b-danger",circle2:"border-b-danger"}},labelColor:{foreground:{label:"text-foreground"},primary:{label:"text-primary"},secondary:{label:"text-secondary"},success:{label:"text-success"},warning:{label:"text-warning"},danger:{label:"text-danger"}}},defaultVariants:{size:"md",color:"primary",labelColor:"foreground"}}),G2=G0({slots:{wrapper:["flex","w-screen","h-[100dvh]","fixed","inset-0","z-50","overflow-x-auto","justify-center"],base:["flex","flex-col","relative","bg-white","z-50","w-full","box-border","bg-content1","outline-none","mx-1","my-1","sm:mx-6","sm:my-16"],backdrop:"z-50",header:"flex py-4 px-6 flex-initial text-large font-semibold",body:"flex flex-1 flex-col gap-3 px-6 py-2",footer:"flex flex-row gap-2 px-6 py-4 justify-end",closeButton:["absolute","appearance-none","outline-none","select-none","top-1","right-1","rtl:left-1","rtl:right-[unset]","p-2","text-foreground-500","rounded-full","hover:bg-default-100","active:bg-default-200","tap-highlight-transparent",...jL]},variants:{size:{xs:{base:"max-w-xs"},sm:{base:"max-w-sm"},md:{base:"max-w-md"},lg:{base:"max-w-lg"},xl:{base:"max-w-xl"},"2xl":{base:"max-w-2xl"},"3xl":{base:"max-w-3xl"},"4xl":{base:"max-w-4xl"},"5xl":{base:"max-w-5xl"},full:{base:"my-0 mx-0 sm:mx-0 sm:my-0 max-w-full h-[100dvh] !rounded-none"}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"}},placement:{auto:{wrapper:"items-end sm:items-center"},center:{wrapper:"items-center sm:items-center"},top:{wrapper:"items-start sm:items-start"},"top-center":{wrapper:"items-start sm:items-center"},bottom:{wrapper:"items-end sm:items-end"},"bottom-center":{wrapper:"items-end sm:items-center"}},shadow:{sm:{base:"shadow-small"},md:{base:"shadow-medium"},lg:{base:"shadow-large"}},backdrop:{transparent:{backdrop:"hidden"},opaque:{backdrop:"bg-overlay/50 backdrop-opacity-disabled"},blur:{backdrop:"backdrop-blur-md backdrop-saturate-150 bg-overlay/30"}},scrollBehavior:{normal:{base:"overflow-y-hidden"},inside:{base:"max-h-[calc(100%_-_7.5rem)]",body:"overflow-y-auto"},outside:{wrapper:"items-start sm:items-start overflow-y-auto",base:"my-16"}},disableAnimation:{false:{wrapper:["[--scale-enter:100%]","[--scale-exit:100%]","[--slide-enter:0px]","[--slide-exit:80px]","sm:[--scale-enter:100%]","sm:[--scale-exit:103%]","sm:[--slide-enter:0px]","sm:[--slide-exit:0px]"]}}},defaultVariants:{size:"md",radius:"lg",shadow:"sm",placement:"auto",backdrop:"opaque",scrollBehavior:"normal"},compoundVariants:[{backdrop:["opaque","blur"],class:{backdrop:"w-screen h-screen fixed inset-0"}}]}),p0e=G0({base:["z-0","group","relative","inline-flex","items-center","justify-center","box-border","appearance-none","outline-none","select-none","whitespace-nowrap","min-w-max","font-normal","subpixel-antialiased","overflow-hidden","tap-highlight-transparent","data-[pressed=true]:scale-[0.97]",...jL],variants:{variant:{solid:"",bordered:"border-medium bg-transparent",light:"bg-transparent",flat:"",faded:"border-medium",shadow:"",ghost:"border-medium bg-transparent"},size:{sm:"px-3 min-w-16 h-8 text-tiny gap-2 rounded-small",md:"px-4 min-w-20 h-10 text-small gap-2 rounded-medium",lg:"px-6 min-w-24 h-12 text-medium gap-3 rounded-large"},color:{default:"",primary:"",secondary:"",success:"",warning:"",danger:""},radius:{none:"rounded-none",sm:"rounded-small",md:"rounded-medium",lg:"rounded-large",full:"rounded-full"},fullWidth:{true:"w-full"},isDisabled:{true:"opacity-disabled pointer-events-none"},isInGroup:{true:"[&:not(:first-child):not(:last-child)]:rounded-none"},isIconOnly:{true:"px-0 !gap-0",false:"[&>svg]:max-w-[theme(spacing.8)]"},disableAnimation:{true:"!transition-none",false:"transition-transform-colors-opacity motion-reduce:transition-none"}},defaultVariants:{size:"md",variant:"solid",color:"default",fullWidth:!1,isDisabled:!1,isInGroup:!1},compoundVariants:[{variant:"solid",color:"default",class:Ee.solid.default},{variant:"solid",color:"primary",class:Ee.solid.primary},{variant:"solid",color:"secondary",class:Ee.solid.secondary},{variant:"solid",color:"success",class:Ee.solid.success},{variant:"solid",color:"warning",class:Ee.solid.warning},{variant:"solid",color:"danger",class:Ee.solid.danger},{variant:"shadow",color:"default",class:Ee.shadow.default},{variant:"shadow",color:"primary",class:Ee.shadow.primary},{variant:"shadow",color:"secondary",class:Ee.shadow.secondary},{variant:"shadow",color:"success",class:Ee.shadow.success},{variant:"shadow",color:"warning",class:Ee.shadow.warning},{variant:"shadow",color:"danger",class:Ee.shadow.danger},{variant:"bordered",color:"default",class:Ee.bordered.default},{variant:"bordered",color:"primary",class:Ee.bordered.primary},{variant:"bordered",color:"secondary",class:Ee.bordered.secondary},{variant:"bordered",color:"success",class:Ee.bordered.success},{variant:"bordered",color:"warning",class:Ee.bordered.warning},{variant:"bordered",color:"danger",class:Ee.bordered.danger},{variant:"flat",color:"default",class:Ee.flat.default},{variant:"flat",color:"primary",class:Ee.flat.primary},{variant:"flat",color:"secondary",class:Ee.flat.secondary},{variant:"flat",color:"success",class:Ee.flat.success},{variant:"flat",color:"warning",class:Ee.flat.warning},{variant:"flat",color:"danger",class:Ee.flat.danger},{variant:"faded",color:"default",class:Ee.faded.default},{variant:"faded",color:"primary",class:Ee.faded.primary},{variant:"faded",color:"secondary",class:Ee.faded.secondary},{variant:"faded",color:"success",class:Ee.faded.success},{variant:"faded",color:"warning",class:Ee.faded.warning},{variant:"faded",color:"danger",class:Ee.faded.danger},{variant:"light",color:"default",class:[Ee.light.default,"data-[hover=true]:bg-default/40"]},{variant:"light",color:"primary",class:[Ee.light.primary,"data-[hover=true]:bg-primary/20"]},{variant:"light",color:"secondary",class:[Ee.light.secondary,"data-[hover=true]:bg-secondary/20"]},{variant:"light",color:"success",class:[Ee.light.success,"data-[hover=true]:bg-success/20"]},{variant:"light",color:"warning",class:[Ee.light.warning,"data-[hover=true]:bg-warning/20"]},{variant:"light",color:"danger",class:[Ee.light.danger,"data-[hover=true]:bg-danger/20"]},{variant:"ghost",color:"default",class:Ee.ghost.default},{variant:"ghost",color:"primary",class:Ee.ghost.primary},{variant:"ghost",color:"secondary",class:Ee.ghost.secondary},{variant:"ghost",color:"success",class:Ee.ghost.success},{variant:"ghost",color:"warning",class:Ee.ghost.warning},{variant:"ghost",color:"danger",class:Ee.ghost.danger},{isInGroup:!0,class:"rounded-none first:rounded-s-medium last:rounded-e-medium"},{isInGroup:!0,size:"sm",class:"rounded-none first:rounded-s-small last:rounded-e-small"},{isInGroup:!0,size:"md",class:"rounded-none first:rounded-s-medium last:rounded-e-medium"},{isInGroup:!0,size:"lg",class:"rounded-none first:rounded-s-large last:rounded-e-large"},{isInGroup:!0,isRounded:!0,class:"rounded-none first:rounded-s-full last:rounded-e-full"},{isInGroup:!0,radius:"none",class:"rounded-none first:rounded-s-none last:rounded-e-none"},{isInGroup:!0,radius:"sm",class:"rounded-none first:rounded-s-small last:rounded-e-small"},{isInGroup:!0,radius:"md",class:"rounded-none first:rounded-s-medium last:rounded-e-medium"},{isInGroup:!0,radius:"lg",class:"rounded-none first:rounded-s-large last:rounded-e-large"},{isInGroup:!0,radius:"full",class:"rounded-none first:rounded-s-full last:rounded-e-full"},{isInGroup:!0,variant:["ghost","bordered"],color:"default",className:al.default},{isInGroup:!0,variant:["ghost","bordered"],color:"primary",className:al.primary},{isInGroup:!0,variant:["ghost","bordered"],color:"secondary",className:al.secondary},{isInGroup:!0,variant:["ghost","bordered"],color:"success",className:al.success},{isInGroup:!0,variant:["ghost","bordered"],color:"warning",className:al.warning},{isInGroup:!0,variant:["ghost","bordered"],color:"danger",className:al.danger},{isIconOnly:!0,size:"sm",class:"min-w-8 w-8 h-8"},{isIconOnly:!0,size:"md",class:"min-w-10 w-10 h-10"},{isIconOnly:!0,size:"lg",class:"min-w-12 w-12 h-12"},{variant:["solid","faded","flat","bordered","shadow"],class:"data-[hover=true]:opacity-hover"}]}),H2=G0({base:"inline-flex items-center justify-center h-auto",variants:{fullWidth:{true:"w-full"}},defaultVariants:{fullWidth:!1}});class m0e{isDefaultPrevented(){return this.nativeEvent.defaultPrevented}preventDefault(){this.defaultPrevented=!0,this.nativeEvent.preventDefault()}stopPropagation(){this.nativeEvent.stopPropagation(),this.isPropagationStopped=()=>!0}isPropagationStopped(){return!1}persist(){}constructor(e,n){this.nativeEvent=n,this.target=n.target,this.currentTarget=n.currentTarget,this.relatedTarget=n.relatedTarget,this.bubbles=n.bubbles,this.cancelable=n.cancelable,this.defaultPrevented=n.defaultPrevented,this.eventPhase=n.eventPhase,this.isTrusted=n.isTrusted,this.timeStamp=n.timeStamp,this.type=e}}function KL(t){let e=O.useRef({isFocused:!1,observer:null});Xt(()=>{const s=e.current;return()=>{s.observer&&(s.observer.disconnect(),s.observer=null)}},[]);let n=pr(s=>{t==null||t(s)});return O.useCallback(s=>{if(s.target instanceof HTMLButtonElement||s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement||s.target instanceof HTMLSelectElement){e.current.isFocused=!0;let r=s.target,o=i=>{e.current.isFocused=!1,r.disabled&&n(new m0e("blur",i)),e.current.observer&&(e.current.observer.disconnect(),e.current.observer=null)};r.addEventListener("focusout",o,{once:!0}),e.current.observer=new MutationObserver(()=>{if(e.current.isFocused&&r.disabled){var i;(i=e.current.observer)===null||i===void 0||i.disconnect();let a=r===document.activeElement?null:document.activeElement;r.dispatchEvent(new FocusEvent("blur",{relatedTarget:a})),r.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:a}))}}),e.current.observer.observe(r,{attributes:!0,attributeFilter:["disabled"]})}},[n])}function XL(t){let{isDisabled:e,onFocus:n,onBlur:s,onFocusChange:r}=t;const o=O.useCallback(l=>{if(l.target===l.currentTarget)return s&&s(l),r&&r(!1),!0},[s,r]),i=KL(o),a=O.useCallback(l=>{const u=Me(l.target);l.target===l.currentTarget&&u.activeElement===l.target&&(n&&n(l),r&&r(!0),i(l))},[r,n,i]);return{focusProps:{onFocus:!e&&(n||r||s)?a:void 0,onBlur:!e&&(s||r)?o:void 0}}}let Bu=null,d1=new Set,Vc=new Map,_a=!1,h1=!1;const g0e={Tab:!0,Escape:!0};function K$(t,e){for(let n of d1)n(t,e)}function x0e(t){return!(t.metaKey||!wi()&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}function Mm(t){_a=!0,x0e(t)&&(Bu="keyboard",K$("keyboard",t))}function Ls(t){Bu="pointer",(t.type==="mousedown"||t.type==="pointerdown")&&(_a=!0,K$("pointer",t))}function qL(t){fu(t)&&(_a=!0,Bu="virtual")}function YL(t){t.target===window||t.target===document||(!_a&&!h1&&(Bu="virtual",K$("virtual",t)),_a=!1,h1=!1)}function QL(){_a=!1,h1=!0}function f1(t){if(typeof window>"u"||Vc.get(qt(t)))return;const e=qt(t),n=Me(t);let s=e.HTMLElement.prototype.focus;e.HTMLElement.prototype.focus=function(){_a=!0,s.apply(this,arguments)},n.addEventListener("keydown",Mm,!0),n.addEventListener("keyup",Mm,!0),n.addEventListener("click",qL,!0),e.addEventListener("focus",YL,!0),e.addEventListener("blur",QL,!1),typeof PointerEvent<"u"?(n.addEventListener("pointerdown",Ls,!0),n.addEventListener("pointermove",Ls,!0),n.addEventListener("pointerup",Ls,!0)):(n.addEventListener("mousedown",Ls,!0),n.addEventListener("mousemove",Ls,!0),n.addEventListener("mouseup",Ls,!0)),e.addEventListener("beforeunload",()=>{ZL(t)},{once:!0}),Vc.set(e,{focus:s})}const ZL=(t,e)=>{const n=qt(t),s=Me(t);e&&s.removeEventListener("DOMContentLoaded",e),Vc.has(n)&&(n.HTMLElement.prototype.focus=Vc.get(n).focus,s.removeEventListener("keydown",Mm,!0),s.removeEventListener("keyup",Mm,!0),s.removeEventListener("click",qL,!0),n.removeEventListener("focus",YL,!0),n.removeEventListener("blur",QL,!1),typeof PointerEvent<"u"?(s.removeEventListener("pointerdown",Ls,!0),s.removeEventListener("pointermove",Ls,!0),s.removeEventListener("pointerup",Ls,!0)):(s.removeEventListener("mousedown",Ls,!0),s.removeEventListener("mousemove",Ls,!0),s.removeEventListener("mouseup",Ls,!0)),Vc.delete(n))};function y0e(t){const e=Me(t);let n;return e.readyState!=="loading"?f1(t):(n=()=>{f1(t)},e.addEventListener("DOMContentLoaded",n)),()=>ZL(t,n)}typeof document<"u"&&y0e();function JL(){return Bu!=="pointer"}function v0e(){return Bu}const b0e=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function w0e(t,e,n){var s;const r=typeof window<"u"?qt(n==null?void 0:n.target).HTMLInputElement:HTMLInputElement,o=typeof window<"u"?qt(n==null?void 0:n.target).HTMLTextAreaElement:HTMLTextAreaElement,i=typeof window<"u"?qt(n==null?void 0:n.target).HTMLElement:HTMLElement,a=typeof window<"u"?qt(n==null?void 0:n.target).KeyboardEvent:KeyboardEvent;return t=t||(n==null?void 0:n.target)instanceof r&&!b0e.has(n==null||(s=n.target)===null||s===void 0?void 0:s.type)||(n==null?void 0:n.target)instanceof o||(n==null?void 0:n.target)instanceof i&&(n==null?void 0:n.target.isContentEditable),!(t&&e==="keyboard"&&n instanceof a&&!g0e[n.key])}function C0e(t,e,n){f1(),O.useEffect(()=>{let s=(r,o)=>{w0e(!!(n!=null&&n.isTextInput),r,o)&&t(JL())};return d1.add(s),()=>{d1.delete(s)}},e)}function $0e(t){let{isDisabled:e,onBlurWithin:n,onFocusWithin:s,onFocusWithinChange:r}=t,o=O.useRef({isFocusWithin:!1}),i=O.useCallback(u=>{o.current.isFocusWithin&&!u.currentTarget.contains(u.relatedTarget)&&(o.current.isFocusWithin=!1,n&&n(u),r&&r(!1))},[n,r,o]),a=KL(i),l=O.useCallback(u=>{!o.current.isFocusWithin&&document.activeElement===u.target&&(s&&s(u),r&&r(!0),o.current.isFocusWithin=!0,a(u))},[s,r,a]);return e?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:l,onBlur:i}}}function j2(t){if(!t)return;let e=!0;return n=>{let s={...n,preventDefault(){n.preventDefault()},isDefaultPrevented(){return n.isDefaultPrevented()},stopPropagation(){console.error("stopPropagation is now the default behavior for events in React Spectrum. You can use continuePropagation() to revert this behavior.")},continuePropagation(){e=!1}};t(s),e&&n.stopPropagation()}}function k0e(t){return{keyboardProps:t.isDisabled?{}:{onKeyDown:j2(t.onKeyDown),onKeyUp:j2(t.onKeyUp)}}}function S0e(t){const e=Me(t);if(v0e()==="virtual"){let n=e.activeElement;L0(()=>{e.activeElement===n&&t.isConnected&&xr(t)})}else xr(t)}function I0e(t,e){return!t||!e?!1:e.some(n=>n.contains(t))}class X${get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,n,s){let r=this.fastMap.get(n??null);if(!r)return;let o=new K2({scopeRef:e});r.addChild(o),o.parent=r,this.fastMap.set(e,o),s&&(o.nodeToRestore=s)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let n=this.fastMap.get(e);if(!n)return;let s=n.parent;for(let o of this.traverse())o!==n&&n.nodeToRestore&&o.nodeToRestore&&n.scopeRef&&n.scopeRef.current&&I0e(o.nodeToRestore,n.scopeRef.current)&&(o.nodeToRestore=n.nodeToRestore);let r=n.children;s&&(s.removeChild(n),r.size>0&&r.forEach(o=>s&&s.addChild(o))),this.fastMap.delete(n.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let n of e.children)yield*this.traverse(n)}clone(){var e;let n=new X$;var s;for(let r of this.traverse())n.addTreeNode(r.scopeRef,(s=(e=r.parent)===null||e===void 0?void 0:e.scopeRef)!==null&&s!==void 0?s:null,r.nodeToRestore);return n}constructor(){this.fastMap=new Map,this.root=new K2({scopeRef:null}),this.fastMap.set(null,this.root)}}class K2{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}new X$;function eM(t={}){let{autoFocus:e=!1,isTextInput:n,within:s}=t,r=O.useRef({isFocused:!1,isFocusVisible:e||JL()}),[o,i]=O.useState(!1),[a,l]=O.useState(()=>r.current.isFocused&&r.current.isFocusVisible),u=O.useCallback(()=>l(r.current.isFocused&&r.current.isFocusVisible),[]),c=O.useCallback(f=>{r.current.isFocused=f,i(f),u()},[u]);C0e(f=>{r.current.isFocusVisible=f,u()},[],{isTextInput:n});let{focusProps:d}=XL({isDisabled:s,onFocusChange:c}),{focusWithinProps:h}=$0e({isDisabled:!s,onFocusWithinChange:c});return{isFocused:o,isFocusVisible:a,focusProps:s?h:d}}let T0e=ct.createContext(null);function E0e(t){let e=O.useContext(T0e)||{};A_(e,t);let{ref:n,...s}=e;return s}function N0e(t,e){let{focusProps:n}=XL(t),{keyboardProps:s}=k0e(t),r=Zs(n,s),o=E0e(e),i=t.isDisabled?{}:o,a=O.useRef(t.autoFocus);return O.useEffect(()=>{a.current&&e.current&&S0e(e.current),a.current=!1},[e]),{focusableProps:Zs({...r,tabIndex:t.excludeFromTabOrder&&!t.isDisabled?-1:void 0},i)}}let Rl="default",p1="",mp=new WeakMap;function X2(t){if(x$()){if(Rl==="default"){const e=Me(t);p1=e.documentElement.style.webkitUserSelect,e.documentElement.style.webkitUserSelect="none"}Rl="disabled"}else(t instanceof HTMLElement||t instanceof SVGElement)&&(mp.set(t,t.style.userSelect),t.style.userSelect="none")}function Uf(t){if(x$()){if(Rl!=="disabled")return;Rl="restoring",setTimeout(()=>{L0(()=>{if(Rl==="restoring"){const e=Me(t);e.documentElement.style.webkitUserSelect==="none"&&(e.documentElement.style.webkitUserSelect=p1||""),p1="",Rl="default"}})},300)}else if((t instanceof HTMLElement||t instanceof SVGElement)&&t&&mp.has(t)){let e=mp.get(t);t.style.userSelect==="none"&&(t.style.userSelect=e),t.getAttribute("style")===""&&t.removeAttribute("style"),mp.delete(t)}}const tM=ct.createContext({register:()=>{}});tM.displayName="PressResponderContext";function R0e(t){let e=O.useContext(tM);if(e){let{register:n,...s}=e;t=Zs(s,t),n()}return A_(e,t.ref),t}var Gf=new WeakMap;class Hf{continuePropagation(){s2(this,Gf,!1)}get shouldStopPropagation(){return whe(this,Gf)}constructor(e,n,s){Wde(this,Gf,{writable:!0,value:void 0}),s2(this,Gf,!0),this.type=e,this.pointerType=n,this.target=s.currentTarget,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.ctrlKey=s.ctrlKey,this.altKey=s.altKey}}const q2=Symbol("linkClicked");function A0e(t){let{onPress:e,onPressChange:n,onPressStart:s,onPressEnd:r,onPressUp:o,isDisabled:i,isPressed:a,preventFocusOnPress:l,shouldCancelOnPointerExit:u,allowTextSelectionOnPress:c,ref:d,...h}=R0e(t),[f,p]=O.useState(!1),m=O.useRef({isPressed:!1,ignoreEmulatedMouseEvents:!1,ignoreClickAfterPress:!1,didFirePressStart:!1,isTriggeringEvent:!1,activePointerId:null,target:null,isOverTarget:!1,pointerType:null}),{addGlobalListener:x,removeAllGlobalListeners:g}=ihe(),y=pr((C,S)=>{let T=m.current;if(i||T.didFirePressStart)return!1;let R=!0;if(T.isTriggeringEvent=!0,s){let A=new Hf("pressstart",S,C);s(A),R=A.shouldStopPropagation}return n&&n(!0),T.isTriggeringEvent=!1,T.didFirePressStart=!0,p(!0),R}),v=pr((C,S,T=!0)=>{let R=m.current;if(!R.didFirePressStart)return!1;R.ignoreClickAfterPress=!0,R.didFirePressStart=!1,R.isTriggeringEvent=!0;let A=!0;if(r){let E=new Hf("pressend",S,C);r(E),A=E.shouldStopPropagation}if(n&&n(!1),p(!1),e&&T&&!i){let E=new Hf("press",S,C);e(E),A&&(A=E.shouldStopPropagation)}return R.isTriggeringEvent=!1,A}),b=pr((C,S)=>{let T=m.current;if(i)return!1;if(o){T.isTriggeringEvent=!0;let R=new Hf("pressup",S,C);return o(R),T.isTriggeringEvent=!1,R.shouldStopPropagation}return!0}),w=pr(C=>{let S=m.current;S.isPressed&&S.target&&(S.isOverTarget&&S.pointerType!=null&&v(ao(S.target,C),S.pointerType,!1),S.isPressed=!1,S.isOverTarget=!1,S.activePointerId=null,S.pointerType=null,g(),c||Uf(S.target))}),$=pr(C=>{u&&w(C)}),k=O.useMemo(()=>{let C=m.current,S={onKeyDown(R){if(Qx(R.nativeEvent,R.currentTarget)&&R.currentTarget.contains(R.target)){var A;Q2(R.target,R.key)&&R.preventDefault();let E=!0;if(!C.isPressed&&!R.repeat){C.target=R.currentTarget,C.isPressed=!0,E=y(R,"keyboard");let N=R.currentTarget,P=_=>{Qx(_,N)&&!_.repeat&&N.contains(_.target)&&C.target&&b(ao(C.target,_),"keyboard")};x(Me(R.currentTarget),"keyup",bi(P,T),!0)}E&&R.stopPropagation(),R.metaKey&&wi()&&((A=C.metaKeyEvents)===null||A===void 0||A.set(R.key,R.nativeEvent))}else R.key==="Meta"&&(C.metaKeyEvents=new Map)},onClick(R){if(!(R&&!R.currentTarget.contains(R.target))&&R&&R.button===0&&!C.isTriggeringEvent&&!wd.isOpening){let A=!0;if(i&&R.preventDefault(),!C.ignoreClickAfterPress&&!C.ignoreEmulatedMouseEvents&&!C.isPressed&&(C.pointerType==="virtual"||fu(R.nativeEvent))){!i&&!l&&xr(R.currentTarget);let E=y(R,"virtual"),N=b(R,"virtual"),P=v(R,"virtual");A=E&&N&&P}C.ignoreEmulatedMouseEvents=!1,C.ignoreClickAfterPress=!1,A&&R.stopPropagation()}}},T=R=>{var A;if(C.isPressed&&C.target&&Qx(R,C.target)){var E;Q2(R.target,R.key)&&R.preventDefault();let P=R.target;v(ao(C.target,R),"keyboard",C.target.contains(P)),g(),R.key!=="Enter"&&q$(C.target)&&C.target.contains(P)&&!R[q2]&&(R[q2]=!0,wd(C.target,R,!1)),C.isPressed=!1,(E=C.metaKeyEvents)===null||E===void 0||E.delete(R.key)}else if(R.key==="Meta"&&(!((A=C.metaKeyEvents)===null||A===void 0)&&A.size)){var N;let P=C.metaKeyEvents;C.metaKeyEvents=void 0;for(let _ of P.values())(N=C.target)===null||N===void 0||N.dispatchEvent(new KeyboardEvent("keyup",_))}};if(typeof PointerEvent<"u"){S.onPointerDown=N=>{if(N.button!==0||!N.currentTarget.contains(N.target))return;if(lhe(N.nativeEvent)){C.pointerType="virtual";return}Zx(N.currentTarget)&&N.preventDefault(),C.pointerType=N.pointerType;let P=!0;C.isPressed||(C.isPressed=!0,C.isOverTarget=!0,C.activePointerId=N.pointerId,C.target=N.currentTarget,!i&&!l&&xr(N.currentTarget),c||X2(C.target),P=y(N,C.pointerType),x(Me(N.currentTarget),"pointermove",R,!1),x(Me(N.currentTarget),"pointerup",A,!1),x(Me(N.currentTarget),"pointercancel",E,!1)),P&&N.stopPropagation()},S.onMouseDown=N=>{N.currentTarget.contains(N.target)&&N.button===0&&(Zx(N.currentTarget)&&N.preventDefault(),N.stopPropagation())},S.onPointerUp=N=>{!N.currentTarget.contains(N.target)||C.pointerType==="virtual"||N.button===0&&ll(N,N.currentTarget)&&b(N,C.pointerType||N.pointerType)};let R=N=>{N.pointerId===C.activePointerId&&(C.target&&ll(N,C.target)?!C.isOverTarget&&C.pointerType!=null&&(C.isOverTarget=!0,y(ao(C.target,N),C.pointerType)):C.target&&C.isOverTarget&&C.pointerType!=null&&(C.isOverTarget=!1,v(ao(C.target,N),C.pointerType,!1),$(N)))},A=N=>{N.pointerId===C.activePointerId&&C.isPressed&&N.button===0&&C.target&&(ll(N,C.target)&&C.pointerType!=null?v(ao(C.target,N),C.pointerType):C.isOverTarget&&C.pointerType!=null&&v(ao(C.target,N),C.pointerType,!1),C.isPressed=!1,C.isOverTarget=!1,C.activePointerId=null,C.pointerType=null,g(),c||Uf(C.target))},E=N=>{w(N)};S.onDragStart=N=>{N.currentTarget.contains(N.target)&&w(N)}}else{S.onMouseDown=E=>{if(E.button!==0||!E.currentTarget.contains(E.target))return;if(Zx(E.currentTarget)&&E.preventDefault(),C.ignoreEmulatedMouseEvents){E.stopPropagation();return}C.isPressed=!0,C.isOverTarget=!0,C.target=E.currentTarget,C.pointerType=fu(E.nativeEvent)?"virtual":"mouse",!i&&!l&&xr(E.currentTarget),y(E,C.pointerType)&&E.stopPropagation(),x(Me(E.currentTarget),"mouseup",R,!1)},S.onMouseEnter=E=>{if(!E.currentTarget.contains(E.target))return;let N=!0;C.isPressed&&!C.ignoreEmulatedMouseEvents&&C.pointerType!=null&&(C.isOverTarget=!0,N=y(E,C.pointerType)),N&&E.stopPropagation()},S.onMouseLeave=E=>{if(!E.currentTarget.contains(E.target))return;let N=!0;C.isPressed&&!C.ignoreEmulatedMouseEvents&&C.pointerType!=null&&(C.isOverTarget=!1,N=v(E,C.pointerType,!1),$(E)),N&&E.stopPropagation()},S.onMouseUp=E=>{E.currentTarget.contains(E.target)&&!C.ignoreEmulatedMouseEvents&&E.button===0&&b(E,C.pointerType||"mouse")};let R=E=>{if(E.button===0){if(C.isPressed=!1,g(),C.ignoreEmulatedMouseEvents){C.ignoreEmulatedMouseEvents=!1;return}C.target&&ll(E,C.target)&&C.pointerType!=null?v(ao(C.target,E),C.pointerType):C.target&&C.isOverTarget&&C.pointerType!=null&&v(ao(C.target,E),C.pointerType,!1),C.isOverTarget=!1}};S.onTouchStart=E=>{if(!E.currentTarget.contains(E.target))return;let N=D0e(E.nativeEvent);if(!N)return;C.activePointerId=N.identifier,C.ignoreEmulatedMouseEvents=!0,C.isOverTarget=!0,C.isPressed=!0,C.target=E.currentTarget,C.pointerType="touch",!i&&!l&&xr(E.currentTarget),c||X2(C.target),y(E,C.pointerType)&&E.stopPropagation(),x(qt(E.currentTarget),"scroll",A,!0)},S.onTouchMove=E=>{if(!E.currentTarget.contains(E.target))return;if(!C.isPressed){E.stopPropagation();return}let N=Y2(E.nativeEvent,C.activePointerId),P=!0;N&&ll(N,E.currentTarget)?!C.isOverTarget&&C.pointerType!=null&&(C.isOverTarget=!0,P=y(E,C.pointerType)):C.isOverTarget&&C.pointerType!=null&&(C.isOverTarget=!1,P=v(E,C.pointerType,!1),$(E)),P&&E.stopPropagation()},S.onTouchEnd=E=>{if(!E.currentTarget.contains(E.target))return;if(!C.isPressed){E.stopPropagation();return}let N=Y2(E.nativeEvent,C.activePointerId),P=!0;N&&ll(N,E.currentTarget)&&C.pointerType!=null?(b(E,C.pointerType),P=v(E,C.pointerType)):C.isOverTarget&&C.pointerType!=null&&(P=v(E,C.pointerType,!1)),P&&E.stopPropagation(),C.isPressed=!1,C.activePointerId=null,C.isOverTarget=!1,C.ignoreEmulatedMouseEvents=!0,C.target&&!c&&Uf(C.target),g()},S.onTouchCancel=E=>{E.currentTarget.contains(E.target)&&(E.stopPropagation(),C.isPressed&&w(E))};let A=E=>{C.isPressed&&E.target.contains(C.target)&&w({currentTarget:C.target,shiftKey:!1,ctrlKey:!1,metaKey:!1,altKey:!1})};S.onDragStart=E=>{E.currentTarget.contains(E.target)&&w(E)}}return S},[x,i,l,g,c,w,$,v,y,b]);return O.useEffect(()=>()=>{var C;c||Uf((C=m.current.target)!==null&&C!==void 0?C:void 0)},[c]),{isPressed:a||f,pressProps:Zs(h,k)}}function q$(t){return t.tagName==="A"&&t.hasAttribute("href")}function Qx(t,e){const{key:n,code:s}=t,r=e,o=r.getAttribute("role");return(n==="Enter"||n===" "||n==="Spacebar"||s==="Space")&&!(r instanceof qt(r).HTMLInputElement&&!nM(r,n)||r instanceof qt(r).HTMLTextAreaElement||r.isContentEditable)&&!((o==="link"||!o&&q$(r))&&n!=="Enter")}function D0e(t){const{targetTouches:e}=t;return e.length>0?e[0]:null}function Y2(t,e){const n=t.changedTouches;for(let s=0;s<n.length;s++){const r=n[s];if(r.identifier===e)return r}return null}function ao(t,e){return{currentTarget:t,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey}}function F0e(t){let e=0,n=0;return t.width!==void 0?e=t.width/2:t.radiusX!==void 0&&(e=t.radiusX),t.height!==void 0?n=t.height/2:t.radiusY!==void 0&&(n=t.radiusY),{top:t.clientY-n,right:t.clientX+e,bottom:t.clientY+n,left:t.clientX-e}}function O0e(t,e){return!(t.left>e.right||e.left>t.right||t.top>e.bottom||e.top>t.bottom)}function ll(t,e){let n=e.getBoundingClientRect(),s=F0e(t);return O0e(n,s)}function Zx(t){return!(t instanceof HTMLElement)||!t.hasAttribute("draggable")}function Q2(t,e){return t instanceof HTMLInputElement?!nM(t,e):t instanceof HTMLButtonElement?t.type!=="submit"&&t.type!=="reset":!q$(t)}const P0e=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function nM(t,e){return t.type==="checkbox"||t.type==="radio"?e===" ":P0e.has(t.type)}let _0e=new Set,Wc=new Map,La=!1,m1=!1;function Y$(t,e){for(let n of _0e)n(t,e)}function L0e(t){return!(t.metaKey||!wi()&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}function zm(t){La=!0,L0e(t)&&Y$("keyboard",t)}function Ms(t){(t.type==="mousedown"||t.type==="pointerdown")&&(La=!0,Y$("pointer",t))}function sM(t){fu(t)&&(La=!0)}function rM(t){t.target===window||t.target===document||(!La&&!m1&&Y$("virtual",t),La=!1,m1=!1)}function oM(){La=!1,m1=!0}function Z2(t){if(typeof window>"u"||Wc.get(qt(t)))return;const e=qt(t),n=Me(t);let s=e.HTMLElement.prototype.focus;e.HTMLElement.prototype.focus=function(){La=!0,s.apply(this,arguments)},n.addEventListener("keydown",zm,!0),n.addEventListener("keyup",zm,!0),n.addEventListener("click",sM,!0),e.addEventListener("focus",rM,!0),e.addEventListener("blur",oM,!1),typeof PointerEvent<"u"?(n.addEventListener("pointerdown",Ms,!0),n.addEventListener("pointermove",Ms,!0),n.addEventListener("pointerup",Ms,!0)):(n.addEventListener("mousedown",Ms,!0),n.addEventListener("mousemove",Ms,!0),n.addEventListener("mouseup",Ms,!0)),e.addEventListener("beforeunload",()=>{iM(t)},{once:!0}),Wc.set(e,{focus:s})}const iM=(t,e)=>{const n=qt(t),s=Me(t);e&&s.removeEventListener("DOMContentLoaded",e),Wc.has(n)&&(n.HTMLElement.prototype.focus=Wc.get(n).focus,s.removeEventListener("keydown",zm,!0),s.removeEventListener("keyup",zm,!0),s.removeEventListener("click",sM,!0),n.removeEventListener("focus",rM,!0),n.removeEventListener("blur",oM,!1),typeof PointerEvent<"u"?(s.removeEventListener("pointerdown",Ms,!0),s.removeEventListener("pointermove",Ms,!0),s.removeEventListener("pointerup",Ms,!0)):(s.removeEventListener("mousedown",Ms,!0),s.removeEventListener("mousemove",Ms,!0),s.removeEventListener("mouseup",Ms,!0)),Wc.delete(n))};function M0e(t){const e=Me(t);let n;return e.readyState!=="loading"?Z2(t):(n=()=>{Z2(t)},e.addEventListener("DOMContentLoaded",n)),()=>iM(t,n)}typeof document<"u"&&M0e();let Bm=!1,Jx=0;function g1(){Bm=!0,setTimeout(()=>{Bm=!1},50)}function J2(t){t.pointerType==="touch"&&g1()}function z0e(){if(!(typeof document>"u"))return typeof PointerEvent<"u"?document.addEventListener("pointerup",J2):document.addEventListener("touchend",g1),Jx++,()=>{Jx--,!(Jx>0)&&(typeof PointerEvent<"u"?document.removeEventListener("pointerup",J2):document.removeEventListener("touchend",g1))}}function B0e(t){let{onHoverStart:e,onHoverChange:n,onHoverEnd:s,isDisabled:r}=t,[o,i]=O.useState(!1),a=O.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;O.useEffect(z0e,[]);let{hoverProps:l,triggerHoverEnd:u}=O.useMemo(()=>{let c=(f,p)=>{if(a.pointerType=p,r||p==="touch"||a.isHovered||!f.currentTarget.contains(f.target))return;a.isHovered=!0;let m=f.currentTarget;a.target=m,e&&e({type:"hoverstart",target:m,pointerType:p}),n&&n(!0),i(!0)},d=(f,p)=>{if(a.pointerType="",a.target=null,p==="touch"||!a.isHovered)return;a.isHovered=!1;let m=f.currentTarget;s&&s({type:"hoverend",target:m,pointerType:p}),n&&n(!1),i(!1)},h={};return typeof PointerEvent<"u"?(h.onPointerEnter=f=>{Bm&&f.pointerType==="mouse"||c(f,f.pointerType)},h.onPointerLeave=f=>{!r&&f.currentTarget.contains(f.target)&&d(f,f.pointerType)}):(h.onTouchStart=()=>{a.ignoreEmulatedMouseEvents=!0},h.onMouseEnter=f=>{!a.ignoreEmulatedMouseEvents&&!Bm&&c(f,"mouse"),a.ignoreEmulatedMouseEvents=!1},h.onMouseLeave=f=>{!r&&f.currentTarget.contains(f.target)&&d(f,"mouse")}),{hoverProps:h,triggerHoverEnd:d}},[e,n,s,r,a]);return O.useEffect(()=>{r&&u({currentTarget:a.target},a.pointerType)},[r]),{hoverProps:l,isHovered:o}}var V0e=t=>q.jsx("svg",{"aria-hidden":"true",fill:"none",focusable:"false",height:"1em",role:"presentation",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:"1em",...t,children:q.jsx("path",{d:"M18 6L6 18M6 6l12 12"})}),fo={ease:[.36,.66,.4,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1],easeInOut:[.4,0,.2,1],spring:[.155,1.105,.295,1.12],springOut:[.57,-.15,.62,.07],softSpring:[.16,1.11,.3,1.02]},W0e={scaleSpring:{enter:{transform:"scale(1)",opacity:1,transition:{type:"spring",bounce:0,duration:.2}},exit:{transform:"scale(0.85)",opacity:0,transition:{type:"easeOut",duration:.15}}},scaleSpringOpacity:{initial:{opacity:0,transform:"scale(0.8)"},enter:{opacity:1,transform:"scale(1)",transition:{type:"spring",bounce:0,duration:.3}},exit:{opacity:0,transform:"scale(0.96)",transition:{type:"easeOut",bounce:0,duration:.15}}},scale:{enter:{scale:1},exit:{scale:.95}},scaleFadeIn:{enter:{transform:"scale(1)",opacity:1,transition:{duration:.25,ease:fo.easeIn}},exit:{transform:"scale(0.95)",opacity:0,transition:{duration:.2,ease:fo.easeOut}}},scaleInOut:{enter:{transform:"scale(1)",opacity:1,transition:{duration:.4,ease:fo.ease}},exit:{transform:"scale(1.03)",opacity:0,transition:{duration:.3,ease:fo.ease}}},fade:{enter:{opacity:1,transition:{duration:.4,ease:fo.ease}},exit:{opacity:0,transition:{duration:.3,ease:fo.ease}}},collapse:{enter:{opacity:1,height:"auto",transition:{height:{type:"spring",bounce:0,duration:.3},opacity:{easings:"ease",duration:.4}}},exit:{opacity:0,height:0,transition:{easings:"ease",duration:.3}}}},U0e=globalThis!=null&&globalThis.document?O.useLayoutEffect:O.useEffect;function G0e(t){var e,n;const s=p$(),[r,o]=H$(t,H2.variantKeys),{ref:i,as:a,children:l,color:u="default",size:c="md",variant:d="solid",radius:h,isDisabled:f=!1,isIconOnly:p=!1,disableRipple:m=(e=s==null?void 0:s.disableRipple)!=null?e:!1,disableAnimation:x=(n=s==null?void 0:s.disableAnimation)!=null?n:!1,className:g,...y}=r,v=a||"div",b=_u(i),w=O.useMemo(()=>H2({...o,className:g}),[f$(o),g]),$=O.useMemo(()=>({size:c,color:u,variant:d,radius:h,isIconOnly:p,isDisabled:f,disableAnimation:x,disableRipple:m,fullWidth:!!(t!=null&&t.fullWidth)}),[c,u,d,h,f,p,x,m,t==null?void 0:t.fullWidth]),k=O.useCallback(()=>({role:"group",...y}),[y]);return{Component:v,children:l,domRef:b,context:$,classNames:w,getButtonGroupProps:k}}var[H0e,j0e]=h$({name:"ButtonGroupContext",strict:!1}),aM=Oi((t,e)=>{const{Component:n,domRef:s,context:r,children:o,classNames:i,getButtonGroupProps:a}=G0e({...t,ref:e});return q.jsx(H0e,{value:r,children:q.jsx(n,{ref:s,className:i,...a(),children:o})})});aM.displayName="NextUI.ButtonGroup";var eT=aM;function lM(t,e){let{elementType:n="button",isDisabled:s,onPress:r,onPressStart:o,onPressEnd:i,onPressChange:a,preventFocusOnPress:l,allowFocusWhenDisabled:u,onClick:c,href:d,target:h,rel:f,type:p="button",allowTextSelectionOnPress:m}=t,x;n==="button"?x={type:p,disabled:s}:x={role:"button",tabIndex:s?void 0:0,href:n==="a"&&s?void 0:d,target:n==="a"?h:void 0,type:n==="input"?p:void 0,disabled:n==="input"?s:void 0,"aria-disabled":!s||n==="input"?void 0:s,rel:n==="a"?f:void 0};let{pressProps:g,isPressed:y}=A0e({onPressStart:o,onPressEnd:i,onPressChange:a,onPress:r,isDisabled:s,preventFocusOnPress:l,allowTextSelectionOnPress:m,ref:e}),{focusableProps:v}=N0e(t,e);u&&(v.tabIndex=s?-1:v.tabIndex);let b=Zs(v,g,E_(t,{labelable:!0}));return{isPressed:y,buttonProps:Zs(x,b,{"aria-haspopup":t["aria-haspopup"],"aria-expanded":t["aria-expanded"],"aria-controls":t["aria-controls"],"aria-pressed":t["aria-pressed"],onClick:w=>{c==null||c(w)}})}}var uM=t=>{const{ripples:e=[],motionProps:n,color:s="currentColor",style:r,onClear:o}=t;return q.jsx(q.Fragment,{children:e.map(i=>{const a=$de(.01*i.size,.2,i.size>100?.75:.5);return q.jsx(r1,{features:o1,children:q.jsx(OL,{mode:"popLayout",children:q.jsx(s1.span,{animate:{transform:"scale(2)",opacity:0},className:"nextui-ripple",exit:{opacity:0},initial:{transform:"scale(0)",opacity:.35},style:{position:"absolute",backgroundColor:s,borderRadius:"100%",transformOrigin:"center",pointerEvents:"none",overflow:"hidden",inset:0,zIndex:0,top:i.y,left:i.x,width:`${i.size}px`,height:`${i.size}px`,...r},transition:{duration:a},onAnimationComplete:()=>{o(i.key)},...n})})},i.key)})})};uM.displayName="NextUI.Ripple";var K0e=uM;function X0e(t={}){const[e,n]=O.useState([]),s=O.useCallback(o=>{const i=o.currentTarget,a=Math.max(i.clientWidth,i.clientHeight),l=i.getBoundingClientRect();n(u=>[...u,{key:Cde(u.length.toString()),size:a,x:o.clientX-l.left-a/2,y:o.clientY-l.top-a/2}])},[]),r=O.useCallback(o=>{n(i=>i.filter(a=>a.key!==o))},[]);return{ripples:e,onClick:s,onClear:r,...t}}function q0e(t){var e,n,s,r,o,i,a,l,u;const c=j0e(),d=p$(),h=!!c,{ref:f,as:p,children:m,startContent:x,endContent:g,autoFocus:y,className:v,spinner:b,isLoading:w=!1,disableRipple:$=!1,fullWidth:k=(e=c==null?void 0:c.fullWidth)!=null?e:!1,radius:C=c==null?void 0:c.radius,size:S=(n=c==null?void 0:c.size)!=null?n:"md",color:T=(s=c==null?void 0:c.color)!=null?s:"default",variant:R=(r=c==null?void 0:c.variant)!=null?r:"solid",disableAnimation:A=(i=(o=c==null?void 0:c.disableAnimation)!=null?o:d==null?void 0:d.disableAnimation)!=null?i:!1,isDisabled:E=(a=c==null?void 0:c.isDisabled)!=null?a:!1,isIconOnly:N=(l=c==null?void 0:c.isIconOnly)!=null?l:!1,spinnerPlacement:P="start",onPress:_,onClick:M,...D}=t,W=p||"button",H=typeof W=="string",X=_u(f),Z=(u=$||(d==null?void 0:d.disableRipple))!=null?u:A,{isFocusVisible:J,isFocused:se,focusProps:te}=eM({autoFocus:y}),oe=E||w,ce=O.useMemo(()=>p0e({size:S,color:T,variant:R,radius:C,fullWidth:k,isDisabled:oe,isInGroup:h,disableAnimation:A,isIconOnly:N,className:v}),[S,T,R,C,k,oe,h,N,A,v]),{onClick:xe,onClear:pe,ripples:Se}=X0e(),Te=O.useCallback(Mt=>{Z||oe||A||X.current&&xe(Mt)},[Z,oe,A,X,xe]),{buttonProps:Ge,isPressed:Qe}=lM({elementType:p,isDisabled:oe,onPress:_,onClick:bi(M,Te),...D},X),{isHovered:ht,hoverProps:Ze}=B0e({isDisabled:oe}),Ye=O.useCallback((Mt={})=>({"data-disabled":Br(oe),"data-focus":Br(se),"data-pressed":Br(Qe),"data-focus-visible":Br(J),"data-hover":Br(ht),"data-loading":Br(w),...Zs(Ge,te,Ze,YI(D,{enabled:H}),YI(Mt))}),[w,oe,se,Qe,H,J,ht,Ge,te,Ze,D]),ot=Mt=>O.isValidElement(Mt)?O.cloneElement(Mt,{"aria-hidden":!0,focusable:!1,tabIndex:-1}):null,it=ot(x),nr=ot(g),Wt=O.useMemo(()=>({sm:"sm",md:"sm",lg:"md"})[S],[S]),Nr=O.useCallback(()=>({ripples:Se,onClear:pe}),[Se,pe]);return{Component:W,children:m,domRef:X,spinner:b,styles:ce,startContent:it,endContent:nr,isLoading:w,spinnerPlacement:P,spinnerSize:Wt,disableRipple:Z,getButtonProps:Ye,getRippleProps:Nr,isIconOnly:N}}function Y0e(t){const[e,n]=H$(t,U2.variantKeys),{children:s,className:r,classNames:o,label:i,...a}=e,l=O.useMemo(()=>U2({...n}),[f$(n)]),u=hu(o==null?void 0:o.base,r),c=i||s,d=O.useMemo(()=>c&&typeof c=="string"?c:a["aria-label"]?"":"Loading",[s,c,a["aria-label"]]),h=O.useCallback(()=>({"aria-label":d,className:l.base({class:u}),...a}),[d,l,u,a]);return{label:c,slots:l,classNames:o,getSpinnerProps:h}}var cM=Oi((t,e)=>{const{slots:n,classNames:s,label:r,getSpinnerProps:o}=Y0e({...t});return q.jsxs("div",{ref:e,...o(),children:[q.jsxs("div",{className:n.wrapper({class:s==null?void 0:s.wrapper}),children:[q.jsx("i",{className:n.circle1({class:s==null?void 0:s.circle1})}),q.jsx("i",{className:n.circle2({class:s==null?void 0:s.circle2})})]}),r&&q.jsx("span",{className:n.label({class:s==null?void 0:s.label}),children:r})]})});cM.displayName="NextUI.Spinner";var Q0e=cM,dM=Oi((t,e)=>{const{Component:n,domRef:s,children:r,styles:o,spinnerSize:i,spinner:a=q.jsx(Q0e,{color:"current",size:i}),spinnerPlacement:l,startContent:u,endContent:c,isLoading:d,disableRipple:h,getButtonProps:f,getRippleProps:p,isIconOnly:m}=q0e({...t,ref:e});return q.jsxs(n,{ref:s,className:o,...f(),children:[u,d&&l==="start"&&a,d&&m?null:r,d&&l==="end"&&a,c,!h&&q.jsx(K0e,{...p()})]})});dM.displayName="NextUI.Button";var As=dM;function tT(t,e=[]){const n=O.useRef(t);return U0e(()=>{n.current=t}),O.useCallback((...s)=>{var r;return(r=n.current)==null?void 0:r.call(n,...s)},e)}let tf=null,Z0e=new Set,Uc=new Map,Ma=!1,x1=!1;function Q$(t,e){for(let n of Z0e)n(t,e)}function J0e(t){return!(t.metaKey||!wi()&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}function Vm(t){Ma=!0,J0e(t)&&(tf="keyboard",Q$("keyboard",t))}function zs(t){tf="pointer",(t.type==="mousedown"||t.type==="pointerdown")&&(Ma=!0,Q$("pointer",t))}function hM(t){fu(t)&&(Ma=!0,tf="virtual")}function fM(t){t.target===window||t.target===document||(!Ma&&!x1&&(tf="virtual",Q$("virtual",t)),Ma=!1,x1=!1)}function pM(){Ma=!1,x1=!0}function nT(t){if(typeof window>"u"||Uc.get(qt(t)))return;const e=qt(t),n=Me(t);let s=e.HTMLElement.prototype.focus;e.HTMLElement.prototype.focus=function(){Ma=!0,s.apply(this,arguments)},n.addEventListener("keydown",Vm,!0),n.addEventListener("keyup",Vm,!0),n.addEventListener("click",hM,!0),e.addEventListener("focus",fM,!0),e.addEventListener("blur",pM,!1),typeof PointerEvent<"u"?(n.addEventListener("pointerdown",zs,!0),n.addEventListener("pointermove",zs,!0),n.addEventListener("pointerup",zs,!0)):(n.addEventListener("mousedown",zs,!0),n.addEventListener("mousemove",zs,!0),n.addEventListener("mouseup",zs,!0)),e.addEventListener("beforeunload",()=>{mM(t)},{once:!0}),Uc.set(e,{focus:s})}const mM=(t,e)=>{const n=qt(t),s=Me(t);e&&s.removeEventListener("DOMContentLoaded",e),Uc.has(n)&&(n.HTMLElement.prototype.focus=Uc.get(n).focus,s.removeEventListener("keydown",Vm,!0),s.removeEventListener("keyup",Vm,!0),s.removeEventListener("click",hM,!0),n.removeEventListener("focus",fM,!0),n.removeEventListener("blur",pM,!1),typeof PointerEvent<"u"?(s.removeEventListener("pointerdown",zs,!0),s.removeEventListener("pointermove",zs,!0),s.removeEventListener("pointerup",zs,!0)):(s.removeEventListener("mousedown",zs,!0),s.removeEventListener("mousemove",zs,!0),s.removeEventListener("mouseup",zs,!0)),Uc.delete(n))};function exe(t){const e=Me(t);let n;return e.readyState!=="loading"?nT(t):(n=()=>{nT(t)},e.addEventListener("DOMContentLoaded",n)),()=>mM(t,n)}typeof document<"u"&&exe();function txe(){return tf}function sT(t){const e=Me(t);if(txe()==="virtual"){let n=e.activeElement;L0(()=>{e.activeElement===n&&t.isConnected&&xr(t)})}else xr(t)}const nxe=ct.createContext(null);function sxe(){let t=O.useContext(nxe),e=t==null?void 0:t.setContain;Xt(()=>{e==null||e(!0)},[e])}function rxe(t,e){let{role:n="dialog"}=t,s=jde();s=t["aria-label"]?void 0:s;let r=O.useRef(!1);return O.useEffect(()=>{if(e.current&&!e.current.contains(document.activeElement)){sT(e.current);let o=setTimeout(()=>{document.activeElement===e.current&&(r.current=!0,e.current&&(e.current.blur(),sT(e.current)),r.current=!1)},500);return()=>{clearTimeout(o)}}},[e]),sxe(),{dialogProps:{...E_(t,{labelable:!0}),role:n,tabIndex:-1,"aria-labelledby":t["aria-labelledby"]||s,onBlur:o=>{r.current&&o.stopPropagation()}},titleProps:{id:s}}}var[oxe,H0]=h$({name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Modal />`"}),gM=Oi((t,e)=>{const{as:n,children:s,className:r,...o}=t,{slots:i,classNames:a,bodyId:l,setBodyMounted:u}=H0(),c=_u(e),d=n||"div";return O.useEffect(()=>(u(!0),()=>u(!1)),[u]),q.jsx(d,{ref:c,className:i.body({class:hu(a==null?void 0:a.body,r)}),id:l,...o,children:s})});gM.displayName="NextUI.ModalBody";var Z$=gM,ixe={enter:{scale:"var(--scale-enter)",y:"var(--slide-enter)",opacity:1,transition:{scale:{duration:.4,ease:fo.ease},opacity:{duration:.4,ease:fo.ease},y:{type:"spring",bounce:0,duration:.6}}},exit:{scale:"var(--scale-exit)",y:"var(--slide-exit)",opacity:0,transition:{duration:.3,ease:fo.ease}}},xM=Oi((t,e)=>{const{as:n,children:s,role:r="dialog",...o}=t,{Component:i,domRef:a,slots:l,classNames:u,motionProps:c,backdrop:d,closeButton:h,hideCloseButton:f,disableAnimation:p,getDialogProps:m,getBackdropProps:x,getCloseButtonProps:g,onClose:y}=H0(),v=n||i||"div",{dialogProps:b}=rxe({role:r},a),w=O.isValidElement(h)?O.cloneElement(h,g()):q.jsx("button",{...g(),children:q.jsx(V0e,{})}),$=O.useCallback(R=>{R.key==="Tab"&&R.nativeEvent.isComposing&&(R.stopPropagation(),R.preventDefault())},[]),k=m(Zs(b,o)),C=q.jsxs(v,{...k,onKeyDown:bi(k.onKeyDown,$),children:[q.jsx(u2,{onDismiss:y}),!f&&w,typeof s=="function"?s(y):s,q.jsx(u2,{onDismiss:y})]}),S=O.useMemo(()=>d==="transparent"?null:p?q.jsx("div",{...x()}):q.jsx(r1,{features:o1,children:q.jsx(s1.div,{animate:"enter",exit:"exit",initial:"exit",variants:W0e.fade,...x()})}),[d,p,x]),T=p?q.jsx("div",{className:l.wrapper({class:u==null?void 0:u.wrapper}),"data-slot":"wrapper",children:C}):q.jsx(r1,{features:o1,children:q.jsx(s1.div,{animate:"enter",className:l.wrapper({class:u==null?void 0:u.wrapper}),"data-slot":"wrapper",exit:"exit",initial:"exit",variants:ixe,...c,children:C})});return q.jsxs("div",{tabIndex:-1,children:[S,T]})});xM.displayName="NextUI.ModalContent";var yM=xM,vM=Oi((t,e)=>{const{as:n,children:s,className:r,...o}=t,{slots:i,classNames:a}=H0(),l=_u(e),u=n||"footer";return q.jsx(u,{ref:l,className:i.footer({class:hu(a==null?void 0:a.footer,r)}),...o,children:s})});vM.displayName="NextUI.ModalFooter";var bM=vM,wM=Oi((t,e)=>{const{as:n,children:s,className:r,...o}=t,{slots:i,classNames:a,headerId:l,setHeaderMounted:u}=H0(),c=_u(e),d=n||"header";return O.useEffect(()=>(u(!0),()=>u(!1)),[u]),q.jsx(d,{ref:c,className:i.header({class:hu(a==null?void 0:a.header,r)}),id:l,...o,children:s})});wM.displayName="NextUI.ModalHeader";var J$=wM;function axe(t={shouldBlockScroll:!0},e,n){let{overlayProps:s,underlayProps:r}=Xhe({...t,isOpen:e.isOpen,onClose:e.close},n);return Yhe({isDisabled:!e.isOpen||!t.shouldBlockScroll}),tfe(),O.useEffect(()=>{if(e.isOpen&&n.current)return Jhe([n.current])},[e.isOpen,n]),{modalProps:Zs(s),underlayProps:r}}function lxe(t){let[e,n]=uhe(t.isOpen,t.defaultOpen||!1,t.onOpenChange);const s=O.useCallback(()=>{n(!0)},[n]),r=O.useCallback(()=>{n(!1)},[n]),o=O.useCallback(()=>{n(!e)},[n,e]);return{isOpen:e,setOpen:n,open:s,close:r,toggle:o}}function uxe(t){var e,n,s;const r=p$(),[o,i]=H$(t,G2.variantKeys),{ref:a,as:l,className:u,classNames:c,isOpen:d,defaultOpen:h,onOpenChange:f,motionProps:p,closeButton:m,isDismissable:x=!0,hideCloseButton:g=!1,shouldBlockScroll:y=!0,portalContainer:v,isKeyboardDismissDisabled:b=!1,onClose:w,...$}=o,k=l||"section",C=_u(a),S=O.useRef(null),[T,R]=O.useState(!1),[A,E]=O.useState(!1),N=(n=(e=t.disableAnimation)!=null?e:r==null?void 0:r.disableAnimation)!=null?n:!1,P=O.useId(),_=O.useId(),M=O.useId(),D=lxe({isOpen:d,defaultOpen:h,onOpenChange:pe=>{f==null||f(pe),pe||w==null||w()}}),{modalProps:W,underlayProps:H}=axe({isDismissable:x,shouldBlockScroll:y,isKeyboardDismissDisabled:b},D,C),{buttonProps:X}=lM({onPress:D.close},S),{isFocusVisible:Z,focusProps:J}=eM(),se=hu(c==null?void 0:c.base,u),te=O.useMemo(()=>G2({...i,disableAnimation:N}),[f$(i),N]),oe=(pe={},Se=null)=>({ref:Xde(Se,C),...Zs(W,$,pe),className:te.base({class:hu(se,pe.className)}),id:P,"data-open":Br(D.isOpen),"data-dismissable":Br(x),"aria-modal":Br(!0),"aria-labelledby":T?_:void 0,"aria-describedby":A?M:void 0}),ce=O.useCallback((pe={})=>({className:te.backdrop({class:c==null?void 0:c.backdrop}),onClick:()=>D.close(),...H,...pe}),[te,c,H]),xe=()=>({role:"button",tabIndex:0,"aria-label":"Close","data-focus-visible":Br(Z),className:te.closeButton({class:c==null?void 0:c.closeButton}),...Zs(X,J)});return{Component:k,slots:te,domRef:C,headerId:_,bodyId:M,motionProps:p,classNames:c,isDismissable:x,closeButton:m,hideCloseButton:g,portalContainer:v,shouldBlockScroll:y,backdrop:(s=t.backdrop)!=null?s:"opaque",isOpen:D.isOpen,onClose:D.close,disableAnimation:N,setBodyMounted:E,setHeaderMounted:R,getDialogProps:oe,getBackdropProps:ce,getCloseButtonProps:xe}}var CM=Oi((t,e)=>{const{children:n,...s}=t,r=uxe({...s,ref:e}),o=q.jsx(efe,{disableFocusManagement:!0,portalContainer:r.portalContainer,children:n});return q.jsx(oxe,{value:r,children:r.disableAnimation&&r.isOpen?o:q.jsx(OL,{children:r.isOpen?o:null})})});CM.displayName="NextUI.Modal";var $M=CM;function cxe(t,e,n){let[s,r]=O.useState(t||e),o=O.useRef(t!==void 0),i=t!==void 0;O.useEffect(()=>{let u=o.current;u!==i&&console.warn(`WARN: A component changed from ${u?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}.`),o.current=i},[i]);let a=i?t:s,l=O.useCallback((u,...c)=>{let d=(h,...f)=>{n&&(Object.is(a,h)||n(h,...f)),i||(a=h)};typeof u=="function"?(console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),r((f,...p)=>{let m=u(i?a:f,...p);return d(m,...c),i?f:m})):(i||r(u),d(u,...c))},[i,a,n]);return[a,l]}function kM(t={}){const{id:e,defaultOpen:n,isOpen:s,onClose:r,onOpen:o,onChange:i=()=>{}}=t,a=tT(o),l=tT(r),[u,c]=cxe(s,n||!1,i),d=O.useId(),h=e||d,f=s!==void 0,p=O.useCallback(()=>{f||c(!1),l==null||l()},[f,l]),m=O.useCallback(()=>{f||c(!0),a==null||a()},[f,a]),x=O.useCallback(()=>{(u?p:m)()},[u,m,p]);return{isOpen:!!u,onOpen:m,onClose:p,onOpenChange:x,isControlled:f,getButtonProps:(g={})=>({...g,"aria-expanded":u,"aria-controls":h,onClick:bi(g.onClick,x)}),getDisclosureProps:(g={})=>({...g,hidden:!u,id:h})}}function dxe({gameEngine:t}){const e=O.useRef(null),[n,s]=O.useState(null),r=O.useCallback(a=>{const l=[a.clientX-e.current.getBoundingClientRect().left,a.clientY-e.current.getBoundingClientRect().top];s(t.screenCoordsToTableCoords(l))},[t]),o=O.useCallback(a=>{const l=[a.clientX-e.current.getBoundingClientRect().left,a.clientY-e.current.getBoundingClientRect().top],u=t.screenCoordsToTableCoords(l);n&&t.focusCell(n),t.autoSweepTo(u)},[t,n]),i=O.useCallback(a=>{const l=[a.clientX-e.current.getBoundingClientRect().left,a.clientY-e.current.getBoundingClientRect().top],u=t.screenCoordsToTableCoords(l);t.autoSweepTo(u)},[t]);return e.current&&t.drawCanvas(e.current),q.jsx("div",{children:q.jsx("canvas",{className:"game-table",ref:e,onMouseDown:r,onMouseUp:o,onClick:i})})}/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var SM=fxe,rT=pxe,hxe=Object.prototype.toString,jf=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function fxe(t,e){if(typeof t!="string")throw new TypeError("argument str must be a string");for(var n={},s=e||{},r=s.decode||mxe,o=0;o<t.length;){var i=t.indexOf("=",o);if(i===-1)break;var a=t.indexOf(";",o);if(a===-1)a=t.length;else if(a<i){o=t.lastIndexOf(";",i-1)+1;continue}var l=t.slice(o,i).trim();if(n[l]===void 0){var u=t.slice(i+1,a).trim();u.charCodeAt(0)===34&&(u=u.slice(1,-1)),n[l]=yxe(u,r)}o=a+1}return n}function pxe(t,e,n){var s=n||{},r=s.encode||gxe;if(typeof r!="function")throw new TypeError("option encode is invalid");if(!jf.test(t))throw new TypeError("argument name is invalid");var o=r(e);if(o&&!jf.test(o))throw new TypeError("argument val is invalid");var i=t+"="+o;if(s.maxAge!=null){var a=s.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(s.domain){if(!jf.test(s.domain))throw new TypeError("option domain is invalid");i+="; Domain="+s.domain}if(s.path){if(!jf.test(s.path))throw new TypeError("option path is invalid");i+="; Path="+s.path}if(s.expires){var l=s.expires;if(!xxe(l)||isNaN(l.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+l.toUTCString()}if(s.httpOnly&&(i+="; HttpOnly"),s.secure&&(i+="; Secure"),s.partitioned&&(i+="; Partitioned"),s.priority){var u=typeof s.priority=="string"?s.priority.toLowerCase():s.priority;switch(u){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(s.sameSite){var c=typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite;switch(c){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function mxe(t){return t.indexOf("%")!==-1?decodeURIComponent(t):t}function gxe(t){return encodeURIComponent(t)}function xxe(t){return hxe.call(t)==="[object Date]"||t instanceof Date}function yxe(t,e){try{return e(t)}catch{return t}}function vxe(){const t=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof t=="boolean"?t:typeof document=="object"&&typeof document.cookie=="string"}function bxe(t){return typeof t=="string"?SM(t):typeof t=="object"&&t!==null?t:{}}function ey(t,e={}){const n=wxe(t);if(!e.doNotParse)try{return JSON.parse(n)}catch{}return t}function wxe(t){return t&&t[0]==="j"&&t[1]===":"?t.substr(2):t}class Cxe{constructor(e,n={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const r=this.cookies;this.cookies=SM(document.cookie),this._checkChanges(r)};const s=typeof document>"u"?"":document.cookie;this.cookies=bxe(e||s),this.defaultSetOptions=n,this.HAS_DOCUMENT_COOKIE=vxe()}_emitChange(e){for(let n=0;n<this.changeListeners.length;++n)this.changeListeners[n](e)}_checkChanges(e){new Set(Object.keys(e).concat(Object.keys(this.cookies))).forEach(s=>{e[s]!==this.cookies[s]&&this._emitChange({name:s,value:ey(this.cookies[s])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(e,n={}){return n.doNotUpdate||this.update(),ey(this.cookies[e],n)}getAll(e={}){e.doNotUpdate||this.update();const n={};for(let s in this.cookies)n[s]=ey(this.cookies[s],e);return n}set(e,n,s){s?s=Object.assign(Object.assign({},this.defaultSetOptions),s):s=this.defaultSetOptions;const r=typeof n=="string"?n:JSON.stringify(n);this.cookies=Object.assign(Object.assign({},this.cookies),{[e]:r}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=rT(e,r,s)),this._emitChange({name:e,value:n,options:s})}remove(e,n){const s=n=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),n),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=rT(e,"",s)),this._emitChange({name:e,value:void 0,options:n})}addChangeListener(e){this.changeListeners.push(e),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(e){const n=this.changeListeners.indexOf(e);n>=0&&this.changeListeners.splice(n,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}const $xe=O.createContext(new Cxe);var IM={exports:{}},Je={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oT;function kxe(){if(oT)return Je;oT=1;var t=typeof Symbol=="function"&&Symbol.for,e=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,s=t?Symbol.for("react.fragment"):60107,r=t?Symbol.for("react.strict_mode"):60108,o=t?Symbol.for("react.profiler"):60114,i=t?Symbol.for("react.provider"):60109,a=t?Symbol.for("react.context"):60110,l=t?Symbol.for("react.async_mode"):60111,u=t?Symbol.for("react.concurrent_mode"):60111,c=t?Symbol.for("react.forward_ref"):60112,d=t?Symbol.for("react.suspense"):60113,h=t?Symbol.for("react.suspense_list"):60120,f=t?Symbol.for("react.memo"):60115,p=t?Symbol.for("react.lazy"):60116,m=t?Symbol.for("react.block"):60121,x=t?Symbol.for("react.fundamental"):60117,g=t?Symbol.for("react.responder"):60118,y=t?Symbol.for("react.scope"):60119;function v(w){if(typeof w=="object"&&w!==null){var $=w.$$typeof;switch($){case e:switch(w=w.type,w){case l:case u:case s:case o:case r:case d:return w;default:switch(w=w&&w.$$typeof,w){case a:case c:case p:case f:case i:return w;default:return $}}case n:return $}}}function b(w){return v(w)===u}return Je.AsyncMode=l,Je.ConcurrentMode=u,Je.ContextConsumer=a,Je.ContextProvider=i,Je.Element=e,Je.ForwardRef=c,Je.Fragment=s,Je.Lazy=p,Je.Memo=f,Je.Portal=n,Je.Profiler=o,Je.StrictMode=r,Je.Suspense=d,Je.isAsyncMode=function(w){return b(w)||v(w)===l},Je.isConcurrentMode=b,Je.isContextConsumer=function(w){return v(w)===a},Je.isContextProvider=function(w){return v(w)===i},Je.isElement=function(w){return typeof w=="object"&&w!==null&&w.$$typeof===e},Je.isForwardRef=function(w){return v(w)===c},Je.isFragment=function(w){return v(w)===s},Je.isLazy=function(w){return v(w)===p},Je.isMemo=function(w){return v(w)===f},Je.isPortal=function(w){return v(w)===n},Je.isProfiler=function(w){return v(w)===o},Je.isStrictMode=function(w){return v(w)===r},Je.isSuspense=function(w){return v(w)===d},Je.isValidElementType=function(w){return typeof w=="string"||typeof w=="function"||w===s||w===u||w===o||w===r||w===d||w===h||typeof w=="object"&&w!==null&&(w.$$typeof===p||w.$$typeof===f||w.$$typeof===i||w.$$typeof===a||w.$$typeof===c||w.$$typeof===x||w.$$typeof===g||w.$$typeof===y||w.$$typeof===m)},Je.typeOf=v,Je}IM.exports=kxe();var Sxe=IM.exports,TM=Sxe,Ixe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Txe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},EM={};EM[TM.ForwardRef]=Ixe;EM[TM.Memo]=Txe;function Exe(){return typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"}function NM(t){const e=O.useContext($xe);if(!e)throw new Error("Missing <CookiesProvider>");const[n,s]=O.useState(()=>e.getAll({doNotUpdate:!0}));Exe()&&O.useLayoutEffect(()=>{function a(){const l=e.getAll({doNotUpdate:!0});Nxe(t||null,l,n)&&s(l)}return e.addChangeListener(a),()=>{e.removeChangeListener(a)}},[e,n]);const r=O.useMemo(()=>e.set.bind(e),[e]),o=O.useMemo(()=>e.remove.bind(e),[e]),i=O.useMemo(()=>e.update.bind(e),[e]);return[n,r,o,i]}function Nxe(t,e,n){if(!t)return!0;for(let s of t)if(e[s]!==n[s])return!0;return!1}const iT=1e3,Rxe=(t,e)=>q.jsxs(q.Fragment,{children:[q.jsx(J$,{className:"flex flex-col gap-1",children:"You Won!"}),q.jsxs(Z$,{children:[q.jsx("p",{children:"Congratulations!"}),q.jsxs("p",{children:["You have successfully eradicated the virus from the grid in ",t," generations."]}),q.jsxs("p",{children:["level: ",e]})]})]}),Axe=()=>q.jsxs(q.Fragment,{children:[q.jsx(J$,{className:"flex flex-col gap-1",children:"You Lost!"}),q.jsxs(Z$,{children:[q.jsx("p",{children:"Ouch!"}),q.jsx("p",{children:"The virus has destroyed you..."})]})]});function Dxe({gameEngine:t}){const[e,n]=NM(["shown-instructions"]),{isOpen:s,onOpen:r,onOpenChange:o}=kM(),[i,a]=O.useState(e["shown-instructions"]),l=O.useCallback(()=>{n("shown-instructions",!0),a(!0),t.resetGame()},[]);return!i&&!s&&r(),q.jsx(q.Fragment,{children:q.jsx($M,{isOpen:s,onOpenChange:o,onClose:l,children:q.jsx(yM,{children:u=>q.jsxs(q.Fragment,{children:[q.jsx(J$,{children:"Instructions"}),q.jsxs(Z$,{children:[q.jsx("p",{children:"Use mouse to change active cell."}),q.jsx("p",{children:"Use arrows to move around."}),q.jsx("p",{children:"Collect numbers and use these to fight the virus."}),q.jsx("p",{children:"Eradicate the virus to win!"})]}),q.jsx(bM,{children:q.jsx(As,{color:"primary",onPress:u,children:"Close"})})]})})})})}function Fxe(){const t=O.useRef(null),{isOpen:e,onOpen:n,onOpenChange:s}=kM(),r=O.useRef(null),[o,i]=NM(["difficulty"]),[a,l]=O.useState(o.difficulty||na),[u,c]=O.useState(null);t.current||(t.current=new Cm,t.current.bindEvents()),window.gameEngine=t.current;const[d,h]=O.useState(0);t.current.onUpdateCallback=()=>{h(d+1)},t.current.onGeneratedImageCallback=M=>{c(M)};const[f,p]=O.useState(!1),m=O.useCallback(()=>{p(!f)},[f]),x=t.current,[g,y]=O.useState(0),v=M=>{r.current&&clearInterval(r.current),r.current=setInterval(()=>{x.step(),y(g+1),(x.hasWon||x.hasLost)&&n()},M)};O.useEffect(()=>(v(iT),()=>{r.current&&clearInterval(r.current)}),[t.current]);const b=O.useCallback(()=>{var M;v(iT),p(!1),c(null),(M=t.current)==null||M.resetGame()},[]),w=O.useCallback(()=>{t.current&&(t.current.virusMoveRate=1),v(10)},[]);O.useEffect(()=>{document.querySelectorAll("canvas")[0].focus(),x.difficulty!==a&&(x.difficulty=a,x.resetGame(),i("difficulty",a))},[a,x,i]);const $=[0,10,20,50,100,200],k=O.useCallback(M=>{x.setTrailSize(M)},[x]),C=x.trailSize,S=O.useCallback(()=>{const M=new CustomEvent("keydown",{detail:"ArrowLeft"});Or.dispatchEvent(M)},[]),T=O.useCallback(()=>{const M=new CustomEvent("keyup",{detail:"ArrowLeft"});Or.dispatchEvent(M)},[]),R=O.useCallback(()=>{const M=new CustomEvent("keydown",{detail:"ArrowRight"});Or.dispatchEvent(M)},[]),A=O.useCallback(()=>{const M=new CustomEvent("keyup",{detail:"ArrowRight"});Or.dispatchEvent(M)},[]),E=O.useCallback(()=>{const M=new CustomEvent("keydown",{detail:"ArrowUp"});Or.dispatchEvent(M)},[]),N=O.useCallback(()=>{const M=new CustomEvent("keyup",{detail:"ArrowUp"});Or.dispatchEvent(M)},[]),P=O.useCallback(()=>{const M=new CustomEvent("keydown",{detail:"ArrowDown"});Or.dispatchEvent(M)},[]),_=O.useCallback(()=>{const M=new CustomEvent("keyup",{detail:"ArrowDown"});Or.dispatchEvent(M)},[]);return q.jsxs(q.Fragment,{children:[q.jsx("div",{className:"main-game-table",children:q.jsx(dxe,{gameEngine:x})}),q.jsx("div",{className:"mobile-ui",children:q.jsxs("div",{className:"arrow-keys mt-2",children:[q.jsx(As,{size:"md",onTouchStart:E,onTouchEnd:N,className:"up mt-3 m-1 mr-10",children:"↑"}),q.jsx("div",{className:"break"}),q.jsx(As,{size:"md",onTouchStart:S,onTouchEnd:T,className:"left mr-1",children:"←"}),q.jsx(As,{size:"md",onTouchStart:R,onTouchEnd:A,className:"right",children:"→"}),q.jsx("div",{className:"break"}),q.jsx(As,{size:"md",onTouchStart:P,onTouchEnd:_,className:"down mr-10 mt-1",children:"↓"})]})}),q.jsxs("div",{className:"top-left-bar",children:[q.jsxs("p",{className:"generation",children:["Generation ",x.generation]}),x.stats.wasFocusedCellEaten&&q.jsxs("p",{children:["Your active cell was eaten!",q.jsx("br",{}),"Click one of your other cells to continue."]}),q.jsxs("div",{className:"difficulty mt-4",children:[q.jsx("p",{className:"mb-2",children:"Difficulty:"}),q.jsxs(eT,{children:[q.jsx(As,{onClick:()=>l(na),className:Yu("mr-1",{selected:a==na}),children:xc(na)}),q.jsx(As,{onClick:()=>l(_c),className:Yu("mr-1",{selected:a==_c}),children:xc(_c)}),q.jsx(As,{onClick:()=>l(Lc),className:Yu({selected:a==Lc}),children:xc(Lc)})]})]}),q.jsxs("div",{className:"leave-trail mt-4",children:[q.jsxs("p",{children:["Use ",q.jsx("span",{className:"keyboard-shortcut",children:"Shift + Arrows"})," to auto sweep."]}),q.jsx("p",{children:"Trail Wall Size"}),q.jsx("div",{children:q.jsx(eT,{size:"sm",children:$.map(M=>q.jsx(As,{size:"sm",className:Yu("p-0",{selected:C==M}),onClick:()=>k(M),children:M},M))})}),q.jsx("p",{className:"text-xs text-slate-500",children:"Leave trail when around virus to help slow growth."})]})]}),q.jsx("div",{className:"top-right-bar",children:q.jsxs("div",{className:"stats",children:[q.jsxs("p",{children:["You: ",x.stats.activeCellCount]}),q.jsxs("p",{children:["Virus: ",x.stats.virusCellCount]})]})}),q.jsx(Dxe,{gameEngine:x}),q.jsx("div",{className:"bottom-left-bar",children:q.jsx("a",{href:"https://github.com/antoineMoPa/grid",target:"_blank",children:"GitHub: antoineMoPa/grid"})}),q.jsx("div",{className:"bottom-right-bar",children:q.jsx(As,{className:"surrender",onClick:w,children:"Surrender"})}),q.jsx(q.Fragment,{children:q.jsx($M,{isOpen:e,onOpenChange:s,onClose:b,isDismissable:!1,children:q.jsx(yM,{className:"win-modal",children:M=>q.jsxs(q.Fragment,{children:[q.jsxs("div",{children:[x.hasWon&&Rxe(x.generation,xc(a)),x.hasLost&&Axe()]}),u&&q.jsxs("div",{children:[q.jsx("p",{className:"text-right m-4",children:q.jsx("a",{onClick:m,children:q.jsx("img",{src:u.toDataURL(),alt:"game result",className:"mt-4 image-result cursor-pointer"})})}),q.jsx("p",{className:"text-sm text-slate-500 text-center",children:"Click on the image to enlarge"})]}),q.jsx("p",{className:"text-center m-4 mobile-hidden",children:q.jsx(As,{color:"default",onPress:()=>{x.generateShareVideo()},children:"Generate Video"})}),q.jsx(bM,{children:q.jsx(As,{color:"primary",onPress:M,children:"Play Again"})})]})})})}),u&&q.jsxs("div",{className:Yu({hidden:!f,"big-share-image":f}),onClick:M=>{M.preventDefault(),M.stopPropagation(),m()},children:[q.jsx("div",{className:"close-button",onClick:m,children:q.jsx("svg",{"aria-hidden":"true",fill:"none",focusable:"false",height:"1em",role:"presentation",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",width:"1em",children:q.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),q.jsx("img",{src:u.toDataURL(),alt:"game result"})]})]})}ty.createRoot(document.getElementById("root")).render(q.jsx(ct.StrictMode,{children:q.jsx(Fxe,{})}));
